

## <a name="memory-preserving-updates"></a>メモリ保護更新
Microsoft Azure の更新のクラスの場合、実行中の仮想マシンに何らかの影響があってもお客様にはわかりません。 これらの更新の多くは、実行中のインスタンスに干渉することがなく更新可能なコンポーネントまたはサービスを対象にしています。 これらの更新の一部は、ホスト オペレーティング システムのプラットフォーム インフラストラクチャに対する更新であり、仮想マシンの完全な再起動を必要とせずに適用できます。

これらの更新は、インプレース ライブ移行 ("メモリ保護" 更新とも呼ばれます) を実現するテクノロジによって達成されます。 更新時、仮想マシンは "一時停止" 状態になり、RAM 内のメモリは保護されます。この状態で、基礎となるホスト オペレーティング システムが必要な更新プログラムと修正プログラムを受信します。 仮想マシンは、30 秒以内の一時停止で再開されます。 再開後、仮想マシンのクロックは自動的に同期されます。

このメカニズムを使用してすべての更新をデプロイできるわけではありませんが、一時停止の期間が短い場合、この方法で更新をデプロイすることにより、仮想マシンへの影響が大幅に軽減されます。

複数インスタンスの更新 (可用性セット内の仮想マシンの場合) が、一度に 1 つの更新ドメインに適用されます。  

## <a name="virtual-machine-configurations"></a>仮想マシンの構成
仮想マシンの構成には、マルチインスタンスと単一インスタンスの 2 種類があります。 マルチインスタンス構成では、1 つの可用性セットに似たような仮想マシンが複数配置されます。

マルチインスタンス構成を使用すると、物理コンピューター、電源、ネットワークの冗長性が得られます。アプリケーションの可用性を確保するために、この構成の使用をお勧めします。 可用性セットのすべての仮想マシンは、アプリケーションに対する目的が同じである必要があります。

高可用性を達成するための仮想マシン構成の詳細については、[Windows 仮想マシンの可用性管理](../articles/virtual-machines/windows/manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)に関するページまたは [Linux 仮想マシンの可用性管理](../articles/virtual-machines/linux/manage-availability.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)に関するページを参照してください。

対照的に、可用性セットに配置されていないスタンドアロンの仮想マシンに対しては、単一インスタンス構成が使用されます。 これらの仮想マシンは、同一の可用性セットに複数の仮想マシンをデプロイすることを必要とするサービス レベル アグリーメント (SLA) の対象になりません。

SLA の詳細については、「[サービス レベル アグリーメント](https://azure.microsoft.com/support/legal/sla/)」の Cloud Services と Virtual Machines のセクションを参照してください。

## <a name="multi-instance-configuration-updates"></a>マルチインスタンス構成の更新
計画的なメンテナンス時に、Azure プラットフォームは最初に仮想マシンのセットを更新します。 この更新により、仮想マシンが再起動され、約 15 分間のダウンタイムが発生します。

マルチインスタンス構成の更新では、仮想マシンは、それぞれが可用性セット内の他のマシンと同様の機能を提供していると仮定しています。 この設定では、更新プロセス全体にわたって可用性が維持されるように仮想マシンが更新されます。

基盤となる Azure プラットフォームにより、可用性セット内の各仮想マシンに更新ドメインと障害ドメインが割り当てられます。 各更新ドメインは同じ時間帯に再起動される仮想マシンのグループです。 また、各障害ドメインは共通の電源とネットワーク スイッチを使用する仮想マシンのグループです。


更新ドメインと障害ドメインの詳細については、「 [冗長性実現のために複数の仮想マシンを可用性セット内に構成する](../articles/virtual-machines/windows/manage-availability.md#configure-multiple-virtual-machines-in-an-availability-set-for-redundancy)」を参照してください。

更新中に可用性を維持するために、Azure では、更新ドメインごとにメンテナンスを実行し、一度に 1 つのドメインを更新します。 更新ドメインのメンテナンスは、ドメイン内のそれぞれの仮想マシンをシャットダウンし、ホスト コンピューターに更新を適用した後、仮想マシンを再起動するという流れで進行します。 ドメイン内のメンテナンスが完了すると、Azure は次の更新ドメインに対してこのプロセスを繰り返し、すべてが更新されるまで各ドメインのメンテナンスを続けます。

計画的なメンテナンス中に更新ドメインが順番に再起動されるとは限りませんが、一度に 1 つの更新ドメインのみが再起動されます。 現在、Azure では、マルチインスタンス構成の仮想マシンの計画的メンテナンスが行われる 1 週間前に通知されます。

仮想マシンが復元されると、Windows イベント ビューアーに次のような情報が表示される場合があります。

<!--Image reference-->
![][image2]


ビューアーを使用して、Azure Portal、Azure PowerShell、または Azure CLI を使ってマルチインスタンス構成で構成されている仮想マシンを報告します。 たとえば、Azure Portal を使用して、**[仮想マシン (クラシック)]** 参照ダイアログに _[可用性セット]_ を追加できます。 同じ可用性セットを報告する仮想マシンは、マルチインスタンス構成の一部です。 次の例では、マルチ インスタンス構成は仮想マシン SQLContoso01 と SQLContoso02 で構成されています。

<!--Image reference-->
  ![Azure Portal からの [仮想マシン (クラシック)] ビュー][image4]

## <a name="single-instance-configuration-updates"></a>単一インスタンス構成の更新
マルチインスタンス構成の更新完了後に、Azure は単一インスタンス構成の更新を実行します。 これらの更新によって、可用性セットで実行していない仮想マシンも再起動されます。

> [!NOTE]
> 可用性セットで 1 つの仮想マシン インスタンスしか実行していなくても、Azure プラットフォームではそのインスタンスをマルチインスタンス構成の更新として処理します。
>

単一インスタンス構成のメンテナンスは、ホスト コンピューターで実行されている各仮想マシンをシャットダウンし、ホスト コンピューターを更新して、仮想マシンを再起動するという流れで進行します。 このメンテナンスでは、約 15 分間のダウンタイムが発生します。 計画的メンテナンス イベントは、1 つのリージョンの 1 つのメンテナンス期間に含まれるすべての仮想マシンに対して実行されます。


この計画的メンテナンス イベントは、単一インスタンス構成のアプリケーションの可用性に影響を及ぼします。 Azure では、単一インスタンス構成内の仮想マシンに対する計画的なメンテナンスについて、1 週間前に通知します。

## <a name="email-notification"></a>電子メール通知
単一インスタンスとマルチインスタンスの仮想マシンの構成に限り、Azure では計画的なメンテナンスが近づいていることを注意喚起するために電子メールを送信します (1 週間前)。 この電子メールは、サブスクリプション管理者と共同管理者の電子メール アカウントに送信されます。 この電子メールの例を次に示します。

<!--Image reference-->
![][image1]

## <a name="region-pairs"></a>リージョンのペア

メンテナンスでは、リージョン ペアの一方のリージョンの仮想マシン インスタンスだけが更新されます。 たとえば、米国中北部の Virtual Machines が更新されるとき、同時に米国中南部の Virtual Machines が更新されることはありません。 リージョン間のフェールオーバーまたは負荷分散が可能なように、時間をずらしてスケジュールされます。 ただし、北ヨーロッパなどのその他のリージョンは、米国東部と同時にメンテナンスされる可能性があります。

現在のリージョン ペアについては、次の表を参照してください。

| リージョン 1 | リージョン 2 |
|:--- | ---:|
| 米国東部 |米国西部 |
| 米国東部 2 |米国中央部 |
| 米国中北部 |米国中南部 |
| 米国中西部 |米国西部 2 |
| カナダ東部 |カナダ中部 |
| ブラジル南部 |米国中南部 |
| 米国政府アイオワ州 |米国政府バージニア州 |
| US DoD East |US DoD Central |
| 北ヨーロッパ |西ヨーロッパ |
| 英国西部 |英国南部 |
| ドイツ中部 |ドイツ北東部 |
| 東南アジア |東アジア |
| オーストラリア南東部 |オーストラリア東部 |
| インド中部 |インド南部 |
| インド西部 |インド南部 |
| 東日本 |西日本 |
| 韓国中部 |韓国南部 |
| 中国東部 |中国北部 |


<!--Anchors-->
[image1]: ./media/virtual-machines-common-planned-maintenance/vmplanned1.png
[image2]: ./media/virtual-machines-common-planned-maintenance/EventViewerPostReboot.png
[image3]: ./media/virtual-machines-planned-maintenance/RegionPairs.PNG
[image4]: ./media/virtual-machines-common-planned-maintenance/availabilitysetexample.png


<!--Link references-->
[Virtual Machines Manage Availability]: ../articles/virtual-machines/virtual-machines-windows-hero-tutorial.md

[Understand planned versus unplanned maintenance]: ../articles/virtual-machines/windows/manage-availability.md#Understand-planned-versus-unplanned-maintenance/
