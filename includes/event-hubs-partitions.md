---
title: インクルード ファイル
description: インクルード ファイル
services: event-hubs
author: spelluru
ms.service: event-hubs
ms.topic: include
ms.date: 03/15/2021
ms.author: spelluru
ms.custom: include file
ms.openlocfilehash: 1dd78ba3799573e05e4ebbf55887bae3d9674b7c
ms.sourcegitcommit: b4fbb7a6a0aa93656e8dd29979786069eca567dc
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/13/2021
ms.locfileid: "107310081"
---
イベント ハブでは、イベント ハブに送信されたイベントのシーケンスを 1 つまたは複数のパーティションにまとめて整理します。 新しいイベントが到着すると、このシーケンスの末尾に追加されます。 

![Event Hubs](./media/event-hubs-partitions/multiple-partitions.png)

パーティションは "コミット ログ" として考えることができます。 イベント本体、イベントを表すユーザー定義のプロパティ バッグ、メタデータ (パーティションにおけるオフセット、ストリーム シーケンスにおける番号、イベントが受理されたサービス側のタイムスタンプなど) を含んだイベント データがパーティションに格納されます。

![古いものから新しいものへのイベントのシーケンスを表示する図。](./media/event-hubs-partitions/partition.png)

### <a name="advantages-of-using-partitions"></a>パーティションを使用する利点
Event Hubs の目的は、大量のイベントの処理を支援することです。パーティションは、2 つの方法でそれを支援します。

- Event Hubs は PaaS サービスであるとはいえ、根底には物理的な現実があります。イベントの順序を保持するログを維持するためには、根底にあるストレージとそのレプリカにそれらのイベントがまとめて保持されている必要があるため、そのようなログにはスループットの上限が生じます。 パーティションに分割することにより、同じイベント ハブで複数の並列ログを使用できるため、生の IO の処理に利用できるスループット容量が増えます。
- 個々のアプリケーションは、イベント ハブに送信される量のイベントの処理に遅れずついていくことができなければなりません。 これは複雑で、相当にスケールアウトされた並列処理能力が必要となる場合があります。 イベントを処理する 1 つのプロセスの容量は限られているため、複数のプロセスが必要になります。 パーティションを使用することで、そうしたプロセスにイベントをフィードしながら、各イベントの処理の所有者を明確化することができます。 

### <a name="number-of-partitions"></a>パーティションの数
パーティションの数は、作成時に 1 から 32 の間 (Event Hubs Standard の場合) で指定する必要があります。 Event Hubs Dedicated では、容量ユニットあたり最大 2,000 パーティションまで指定できます。 

アプリケーションの負荷がピークに達している状態で[スループット ユニット (TU)](../articles/event-hubs/event-hubs-faq.yml#what-are-event-hubs-throughput-units-) の持続に必要となるであろう数以上のパーティションを、その特定のイベント ハブに選択することをお勧めします。 1 つのパーティションのスループット容量は 1 TU (1 MB の入力、2 MB の出力) として計算する必要があります。 パーティション数とは別にクラスターの容量ユニットまたは名前空間の TU をスケーリングすることができます。 名前空間の容量が 1 TU に設定されているとき、パーティションが 32 個のイベント ハブとパーティションが 1 個のイベント ハブで発生するコストはまったく同じです。 

[専用の Event Hubs クラスター](../articles/event-hubs/event-hubs-dedicated-overview.md)内のイベント ハブのパーティション数は、イベント ハブの作成後に[増やす](../articles/event-hubs/dynamically-add-partitions.md)こともできますが、パーティションへのパーティション キーのマッピングが変わるので、パーティション全体に対するストリームの配分が変化します。そのため、アプリケーションの中でイベントの相対的な順序が重要な場合は、そのような変更は極力避けるようにしてください。

パーティション数を上限に設定したくなるかもしれませんが、複数のパーティションの利点を実際に活かせるようにイベント ストリームを構築する必要があることを常に念頭に置いてください。 すべてのイベントについて、または一部のサブストリームのみについて、絶対的な順序を保持する必要がある場合、多くのパーティションを活用できないことがあります。 また、パーティション数が多いと処理する側もより複雑になります。 


### <a name="mapping-of-events-to-partitions"></a>パーティションへのイベントのマッピング
パーティション キーを使用すると、データ編成を目的として受信イベント データを特定のパーティションにマップすることができます。 パーティション キーは、送信者によって指定され、イベント ハブに渡される値です。 これは、パーティション割り当てを作成する静的なハッシュ関数で処理されます。 イベントを発行するときにパーティション キーを指定しないと、ラウンド ロビン割り当てが使用されます。

イベント発行元は、そのパーティション キーのみを認識し、イベントの発行先となるパーティションは認識しません。 このようにキーとパーティションを分離することにより、送信者はダウンストリーム処理について余分な情報を把握しなくてもよくなります。 デバイスごとまたはユーザーの一意の ID は適切なパーティション キーになりますが、地理的条件などのその他の属性を使用して関連するイベントを 1 つのパーティションにまとめることもできます。

パーティション キーを指定すると、関連するイベントを同じパーティションにまとめて、送信されたときとまったく同じ順番で保存することができます。 パーティション キーは、アプリケーションのコンテキストから得られる文字列で、イベントの相互関係を識別するものです。 パーティション キーによって識別される一連のイベントが "*ストリーム*" です。 パーティションは、そのようなたくさんのストリームが混在するログ ストアです。 

> [!NOTE]
> イベントはパーティションに直接送信できますが、特に、高可用性が重要な場合は推奨されません。 イベント ハブの可用性がパーティション レベルにダウングレードされます。 詳細については、[可用性と一貫性](../articles/event-hubs/event-hubs-availability-and-consistency.md)に関するページを参照してください。

