# <a name="using-cdn-for-azure"></a>Azure 用 CDN の使用
Azure Content Delivery Network (CDN) は、米国、ヨーロッパ、アジア、オーストラリア、および南米にある物理ノードで、コンピューティング インスタンスの BLOB と静的コンテンツをキャッシュすることで、高帯域幅コンテンツを配信するグローバル ソリューションを開発者に提供します。 現在の CDN ノードの場所の一覧については、 [Azure CDN ノードの場所]に関するページを参照してください。

このタスクの手順は次のとおりです。

* [手順 1. ストレージ アカウントを作成する](#Step1)
* [手順 2. ストレージ アカウントに対する新しい CDN エンドポイントを作成する](#Step2)
* [手順 3. CDN コンテンツにアクセスする](#Step3)
* [手順 4. CDN からコンテンツを削除する](#Step4)

CDN を使用して Azure データをキャッシュすることには、次のような利点があります。

* コンテンツ ソースから遠く離れた場所にいる、コンテンツの読み込みに数多くの "インターネット トリップ" が必要なアプリケーションを使用するエンド ユーザーに対する、パフォーマンスとユーザー エクスペリエンスの向上
* 製品発表イベントの開始時のような、瞬間的高負荷を処理しやすくする大型の配信スケール

既存の CDN のお客様は、 [Azure クラシック ポータル]で Azure CDN を使用できます。 CDN はサブスクリプションのアドオン機能であり、別の [お支払いプラン]があります。

<a id="Step1"> </a>

<h2>手順 1. ストレージ アカウントを作成する</h2>

Azure サブスクリプションの新しいストレージ アカウントを作成するには、次の手順に従います。 ストレージ アカウントを使用すると、Azure のストレージ サービスにアクセスできます。 ストレージ アカウントは、BLOB サービス、Queue サービス、および Table サービスという Azure の各ストレージ サービス コンポーネントへのアクセスに使用する最高レベルの名前空間です。 Azure ストレージ サービスの詳細については、 [Azure ストレージ サービスの使用](http://msdn.microsoft.com/library/azure/gg433040.aspx)に関するページを参照してください。

ストレージ アカウントを作成するには、関連付けられているサブスクリプションのサービス管理者または共同管理者である必要があります。

> [!NOTE]
> Azure サービス管理 API を使用してこの操作を実行する方法については、 [ストレージ アカウントの作成](http://msdn.microsoft.com/library/windowsazure/hh264518.aspx) に関するリファレンス トピックを参照してください。
> 
> 

**Azure サブスクリプションのストレージ アカウントを作成するには**

1. [Azure クラシック ポータル]にログインします。
2. 左下隅にある **[新規]**をクリックします。 **[新規]** ダイアログ ボックスで **[Data Services]** を選択し、**[ストレージ]**、**[簡易作成]** の順にクリックします。
   
   **[ストレージ アカウントの作成]** ダイアログ ボックスが表示されます。
   
   ![ストレージ アカウントの作成][create-new-storage-account]
3. **[URL]** フィールドにサブドメイン名を入力します。 文字数は 3 ～ 24 文字とし、アルファベット小文字と数字を使用できます。
   
    この名前は、対応するサブスクリプションの BLOB リソース、キュー リソース、またはテーブル リソースのアドレス指定に使用される URI のホスト名になります。 Blob service でコンテナー リソースをアドレス指定するには、次の形式の URI を使用します。*&lt;StorageAccountLabel&gt;* は、**[URL を入力してください]** に入力した値を表します。
   
    http://*&lt;StorageAcountLabel&gt;*.blob.core.windows.net/*&lt;mycontainer&gt;*
   
    **重要:** この URL は、ストレージ アカウントの URI のサブドメインとなるため、Azure のすべてのホストされるサービスで一意である必要があります。
   
    この値は、このストレージ アカウントの名前として、ポータルやプログラムでこのアカウントにアクセスするときにも使用されます。
4. **[リージョン/アフィニティ グループ]** ボックスの一覧で、ストレージ アカウントのリージョンまたはアフィニティ グループを選択します。 使用している他の Microsoft Azure サービスと同じデータ センターにストレージ サービスを配置する場合は、リージョンの代わりにアフィニティ グループを選択します。 これによりパフォーマンスが向上し、送信料金も発生しません。  
   
   **注:** アフィニティ グループを作成するには、管理ポータルの **[設定]** 領域を開いて **[アフィニティ グループ]** をクリックし、**[アフィニティ グループの追加]** または **[追加]** をクリックします。 また、Microsoft Azure サービス管理 API を使用してアフィニティ グループを作成し管理することもできます。 詳細については、「[アフィニティ グループに対する操作]」を参照してください。
5. **[サブスクリプション]** ボックスの一覧で、ストレージ アカウントを使用するサブスクリプションを選択します。
6. **[ストレージ アカウントの作成]**をクリックします。 ストレージ アカウントを作成するプロセスは、完了までに数分かかる場合があります。
7. ストレージ アカウントが正常に作成されたことを確認するには、アカウントが **[ストレージ]** の一覧に表示され、状態が **[オンライン]** になっていることを確かめます。

<a id="Step2"> </a>

<h2>手順 2. ストレージ アカウントに対する新しい CDN エンドポイントを作成する</h2>

ストレージ アカウントまたはホストされるサービスへの CDN アクセスを有効にすると、パブリックにアクセスできるオブジェクトは CDN エッジ キャッシュの対象になります。 CDN で現在キャッシュされているオブジェクトを変更する場合、キャッシュされたコンテンツの有効期限終了時に CDN によりそのコンテンツが更新されるまでは、CDN を通じて新しいコンテンツを使用することはできません。

**ストレージ アカウントに対する新しい CDN エンドポイントを作成するには**

1. [Azure クラシック ポータル]のナビゲーション ウィンドウで、 **[CDN]**をクリックします。
2. リボンで、 **[新規]**をクリックします。 **[新規]** ダイアログで、**[App Services]**、**[CDN]**、**[簡易作成]** の順に選択します。
3. **[元のドメイン]** ボックスで、前のセクションで作成したストレージ アカウントを、利用可能なストレージ アカウントの一覧から選択します。 
4. **[作成]** ボタンをクリックして、新しいエンドポイントを作成します。
5. エンドポイントが作成されると、サブスクリプションのエンドポイントの一覧に表示されます。 一覧には、キャッシュされたコンテンツへのアクセスに使用する URL と元のドメインが表示されます。 
   
    元のドメインは、CDN がコンテンツをキャッシュする場所です。 元のドメインは、ストレージ アカウントまたはクラウド サービスのどちらかになります。この例では、ストレージ アカウントが使用されます。 ストレージ コンテンツは、指定したキャッシュ制御の設定またはキャッシュ ネットワークの既定のヒューリスティックに従って末端サーバーにキャッシュされます。 

    > [AZURE.NOTE] エンドポイントのために作成された構成は、すぐには使用できません。CDN ネットワークを通じて伝播する登録などのために最大 60 分かかります。 CDN ドメイン名を直ちに使用しようとするユーザーは、CDN を経由してコンテンツを取得できるようになるまでは状態コード 400 (正しくない要求) を受け取る場合があります。

<a id="Step3"> </a>

<h2>ステップ 3: CDN コンテンツにアクセスする</h2> 

CDN にキャッシュされたコンテンツにアクセスするには、ポータルで提供される CDN URL を使用します。 キャッシュされた BLOB のアドレスは、次のようになります。

http://<*CDNNamespace*\>.vo.msecnd.net/<*myPublicContainer*\>/<*BlobName*\>

<a id="Step4"> </a>

<h2>ステップ 4: CDN からコンテンツを削除する</h2>

Azure Content Delivery Network (CDN) にオブジェクトをキャッシュする必要がなくなった場合は、次のいずれかの手順を実行できます。

* Azure BLOB の場合は、パブリック コンテナーから BLOB を削除できます。
* コンテナーをパブリックではなくプライベートに設定できます。 詳細については、 [コンテナーと BLOB へのアクセスの制限](https://azure.microsoft.com/documentation/articles/storage-manage-access-to-resources/#restrict-access-to-containers-and-blobs) を参照してください。
* 管理ポータルを使用して CDN エンドポイントを無効にしたり削除したりできます。
* オブジェクトの要求に応答しなくなるようにホストされるサービスを変更できます。

CDN に既にキャッシュされているオブジェクトは、オブジェクトの有効期限が切れるまでキャッシュに残ったままとなります。 有効期限が切れると、CDN エンドポイントがまだ有効で、オブジェクトがまだ匿名アクセス可能かどうかが CDN によって確認されます。 CDN エンドポイントが無効になり、オブジェクトに匿名でアクセスできなくなった場合、オブジェクトはキャッシュされなくなります。

コンテンツを即座に消去する機能は、Azure 管理ポータルで現在サポートされていません。 コンテンツを即座に消去する必要がある場合は、[Azure サポート](https://azure.microsoft.com/support/options/)にお問い合わせください。 

## <a name="additional-resources"></a>その他のリソース
* [Azure でアフィニティ グループを作成する方法]
* [方法: Azure サブスクリプションのストレージ アカウントを管理する]
* [サービス管理 API について]
* [CDN コンテンツをカスタム ドメインにマッピングする方法]

[Create Storage Account]: http://azure.microsoft.com/documentation/articles/storage-create-storage-account/
[Azure CDN ノードの場所]: http://msdn.microsoft.com/library/windowsazure/gg680302.aspx
[Azure クラシック ポータル]: https://manage.windowsazure.com/
[お支払いプラン]: /pricing/calculator/?scenario=full
[Azure でアフィニティ グループを作成する方法]: http://msdn.microsoft.com/library/azure/ee460798.aspx
[Overview of the Azure CDN]: http://msdn.microsoft.com/library/windowsazure/ff919703.aspx
[サービス管理 API について]: http://msdn.microsoft.com/library/windowsazure/ee460807.aspx
[CDN コンテンツをカスタム ドメインにマッピングする方法]: http://msdn.microsoft.com/library/windowsazure/gg680307.aspx


[create-new-storage-account]: ./media/cdn/CDN_CreateNewStorageAcct.png
[Previous Management Portal]: ../../Shared/Media/previous-portal.png


<!--HONumber=Jan17_HO3-->


