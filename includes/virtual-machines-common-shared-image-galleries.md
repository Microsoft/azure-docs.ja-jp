---
title: インクルード ファイル
description: インクルード ファイル
services: virtual-machines
author: axayjo
ms.service: virtual-machines
ms.topic: include
ms.date: 01/09/2018
ms.author: akjosh; cynthn
ms.custom: include file
ms.openlocfilehash: 8c7da8d04b456642b158dda77d9c745891aa18e6
ms.sourcegitcommit: 5839af386c5a2ad46aaaeb90a13065ef94e61e74
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/19/2019
ms.locfileid: "58052136"
---
共有イメージ ギャラリーは、カスタム マネージド VM イメージに関連する構造および組織を構築できるサービスです。 共有イメージ ギャラリーを使用すると、組織内のさまざまなユーザー、サービス プリンシパル、AD グループに対してイメージを共有できます。 共有イメージを複数のリージョンにレプリケートすることで、デプロイのスケーリングにかかる時間を短縮することができます。

マネージド イメージは、イメージの作成方法に応じて、完全な VM (アタッチされた任意のデータ ディスクを含む) または OS ディスク単独のどちらかのコピーです。 イメージから VM を作成するときに、新しい VM のディスクを作成するために、イメージ内の VHD のコピーが使用されます。 マネージド イメージはストレージ内に残り、繰り返し使用して新しい VM を作成できます。

メンテナンスが必要なマネージド イメージや社内全体で利用可能にしたいマネージド イメージが多数ある場合は、イメージを簡単に更新して共有できるリポジトリとして、共有イメージ ギャラリーを使用できます。 共有イメージ ギャラリーを使用した場合の料金として、イメージで使用されるストレージのコストに加えて、ソース リージョンからパブリッシュ リージョンへイメージをレプリケートするためのネットワーク エグレスのコストがかかります。

共有イメージ ギャラリー機能には、次のような複数のリソースの種類があります。

| リソース | 説明|
|----------|------------|
| **マネージド イメージ** | これは、単独で使用することも、イメージ ギャラリーに**イメージ バージョン**を作成するために使用することもできる基本的なイメージです。 マネージド イメージは、一般化された VM から作成されます。 マネージド イメージは、複数の VM を作成する際に使用できる特別な種類の VHD で、共有イメージ バージョンを作成する際にも使用できるようになりました。 |
| **イメージ ギャラリー** | Azure Marketplace などの **イメージ ギャラリー**は、イメージを管理して共有するためのリポジトリです。ただし、アクセス権の所有者を制御します。 |
| **イメージ定義** | イメージはギャラリー内で定義され、内部で使用するためにイメージと要件に関する情報を伝達します。 この情報には、イメージが Windows または Linux のどちらか、リリース ノート、および最小と最大のメモリ要件が含まれます。 これは、イメージの種類の定義です。 |
| **イメージ バージョン** | **イメージ バージョン**は、ギャラリーを利用している場合に、VM の作成に使用します。 お使いの環境に必要な複数のイメージ バージョンを保持できます。 マネージド イメージのように、**イメージ バージョン**を使用して VM を作成する場合、イメージ バージョンは VM 用の新しいディスクを作成するために使用されます。 イメージ バージョンは複数回、使用できます。 |

<br>


![ギャラリー内に複数のイメージ バージョンを保持できる仕組みを示した図](./media/shared-image-galleries/shared-image-gallery.png)

### <a name="regional-support"></a>リージョン サポート

共有イメージ ギャラリーのリージョン サポートは制限付きのプレビュー段階ですが、随時、拡大される予定です。 次に示すのは、制限付きのプレビューでギャラリーを作成できるリージョンの一覧と、ギャラリー イメージをレプリケートできるリージョンの一覧です。 

| ギャラリーの作成場所  | バージョンのレプリケート先 |
|--------------------|----------------------|
| 米国中西部    |すべてのパブリック リージョン &#42;|
| 米国東部 2          ||
| 米国中南部   ||
| 東南アジア     ||
| 西ヨーロッパ        ||
| 米国西部            ||
| 米国東部            ||
| カナダ中部     ||
|                    ||



&#42; オーストラリア中部およびオーストラリア中部 2 にレプリケートするには、サブスクリプションがホワイトリストに登録されている必要があります。 ホワイトリストへの登録を申請するには、 https://www.microsoft.com/en-au/central-regions-eligibility/ にアクセスしてください。

## <a name="scaling"></a>スケーリング
共有イメージ ギャラリーを使用して、Azure で保持したいイメージのレプリカ数を指定できます。 これにより、単一レプリカのオーバーロードが原因でインスタンス作成処理の機会が減少しているさまざまなレプリカに対して、VM のデプロイを拡大できるので、マルチ VM デプロイのシナリオに役立ちます。

![イメージをスケーリングできる仕組みを示した図](./media/shared-image-galleries/scaling.png)


## <a name="replication"></a>レプリケーション
共有イメージ ギャラリーでは、他の Azure リージョンにイメージを自動的にレプリケートすることもできます。 各共有イメージ バージョンは、組織の目的に応じて、さまざまなリージョンにレプリケートできます。 たとえば、古いバージョンをすべて 1 つのリージョン内のみで利用可能にし、その一方で、複数のリージョンに最新のイメージを常にレプリケートするとします。 これにより、共有イメージ バージョンのストレージに対するコストが節約できます。 

共有イメージ バージョンのレプリケート先のリージョンは、作成時刻より後に更新できます。 さまざまなリージョンへのレプリケートにかかる時間は、コピーされるデータ量と、バージョンのレプリケート先となるリージョン数に応じて変わります。 場合によっては、これに 2 ～ 3 時間かかることがあります。 レプリケーションが行われている間は、リージョンごとのレプリケーション ステータスを確認できます。 リージョンでイメージのレプリケーションが完了すると、以降はリージョン内でそのイメージ バージョンを使って、VM または VMSS をデプロイできます。

![イメージをレプリケートできる仕組みを示した図](./media/shared-image-galleries/replication.png)


## <a name="access"></a>Access
共有イメージ ギャラリー、共有イメージ、および共有イメージ バージョンはすべてリソースなので、組み込みのネイティブ Azure RBAC コントロールを使用して共有できます。 RBAC を使用して、組織内の他のユーザー、サービス プリンシパル、およびグループに、これらのリソースを共有できます。 これらのリソースを共有するスコープは、同じ Azure AD テナント内にあります。 ユーザーが共有イメージ バージョンにアクセス可能になると、共有イメージ バージョンと同じ Azure AD テナント内でアクセス可能な任意のサブスクリプションに、VM または仮想マシン スケール セットをデプロイできます。  ユーザーが取得するアクセスを理解するための共有マトリックスを次に示します。

| ユーザーによる共有     | 共有イメージ ギャラリー | 共有イメージ | 共有イメージ バージョン |
|----------------------|----------------------|--------------|----------------------|
| 共有イメージ ギャラリー | はい                  | はい          | はい                  |
| 共有イメージ         | いいえ                    | 可能           | はい                  |
| 共有イメージ バージョン | いいえ                    | いいえ            | はい                  |



## <a name="billing"></a>課金
共有イメージ ギャラリー サービスを使用するための追加料金はかかりません。 次のリソースに対しては、課金されます。
- 共有イメージ バージョンを格納するためのストレージ コスト。 これは、そのバージョンのレプリカ数と、そのバージョンのレプリケート先となるリージョン数に応じて変わります。
- バージョンをソース リージョンからレプリケート先のリージョンへレプリケートするための、ネットワーク エグレスの料金。

## <a name="sdk-support"></a>SDK のサポート

共有イメージ ギャラリーの作成は、次の SDK でサポートされます。

- [.NET](https://docs.microsoft.com/dotnet/api/overview/azure/virtualmachines/management?view=azure-dotnet)
- [Java](https://docs.microsoft.com/java/azure/?view=azure-java-stable)
- [Node.js](https://docs.microsoft.com/javascript/api/azure-arm-compute/?view=azure-node-latest)
- [Python](https://docs.microsoft.com/python/api/overview/azure/virtualmachines?view=azure-python)
- [Go](https://docs.microsoft.com/go/azure/)

## <a name="templates"></a>テンプレート

共有イメージ ギャラリー リソースは、テンプレートを使用して作成できます。 いくつかの Azure クイック スタート テンプレートが用意されています。 

- [共有イメージ ギャラリーを作成する](https://azure.microsoft.com/resources/templates/101-sig-create/)
- [共有イメージ ギャラリーにイメージ定義を作成する](https://azure.microsoft.com/resources/templates/101-sig-image-definition-create/)
- [共有イメージ ギャラリーにイメージのバージョンを作成する](https://azure.microsoft.com/resources/templates/101-sig-image-version-create/)
- [イメージ バージョンから VM を作成する](https://azure.microsoft.com/resources/templates/101-vm-from-sig/)

## <a name="frequently-asked-questions"></a>よく寄せられる質問 

**Q.** 共有イメージ ギャラリーのパブリック プレビューには、どのようにサインアップすればいいですか?
 
 A. 共有イメージ ギャラリーのパブリック プレビューにサインアップするには、共有イメージ ギャラリー、イメージ定義、またはイメージ バージョンのリソースを作成すると共に、イメージ バージョンを使用して Virtual Machines をデプロイする予定の各サブスクリプションから、次のコマンドを実行して、該当の機能に登録する必要があります。

**CLI**: 

```bash 
az feature register --namespace Microsoft.Compute --name GalleryPreview
az provider register --name Microsoft.Compute
```

**PowerShell**: 

```powershell
Register-AzProviderFeature -FeatureName GalleryPreview -ProviderNamespace Microsoft.Compute
Register-AzResourceProvider -ProviderNamespace Microsoft.Compute
```

**Q.** サブスクリプション全体のすべての共有イメージ ギャラリーのリソースを表示する方法はありますか? 
 
 A. アクセス可能なサブスクリプション全体の共有イメージ ギャラリーのリソースをAzure portal 上にすべて一覧表示するには、次の手順に従います。

1. [Azure Portal](https://portal.azure.com)を開きます。
1. **[すべてのリソース]** に移動します。
1. 全リソースを一覧表示するサブスクリプションを、すべて選択します。
1. リソースの種類の **[プライベート ギャラリー]** を探します。
 
   イメージ定義とイメージ バージョンを表示するには、**[非表示の型の表示]** も選択する必要があります。
 
   アクセス可能なサブスクリプション全体の共有イメージ ギャラリー リソースをすべて一覧表示するために、Azure CLI で次のコマンドを使用します。

   ```bash
   az account list -otsv --query "[].id" | xargs -n 1 az sig list --subscription
   ```


**Q.** サブスクリプション全体でイメージを共有するには、どうしたらいいですか?
 
 A. ロール ベース アクセス制御 (RBAC) を使用して、サブスクリプション全体でイメージを共有できます。 イメージ バージョンへの読み取りアクセス許可があるユーザーは、サブスクリプション間でも、そのイメージ バージョンを使用して仮想マシンをデプロイできます。


**Q.** 共有イメージ ギャラリーに既存のイメージを移動できますか?
 
 A. はい。 イメージの種類に基づいて、次の 3 つのシナリオが考えられます。

 シナリオ 1:マネージド イメージがある場合は、イメージ定義を作成して、その定義からイメージ バージョンを作成できる。

 シナリオ 2:汎用のアンマネージド イメージがある場合、そこからマネージド イメージを作成して、イメージ定義を作成し、その定義からイメージ バージョンを作成できる。 

 シナリオ 3:ローカル ファイル システムに VHD がある場合、VHD をアップロードして、マネージド イメージを作成する必要がある。その後、イメージ定義と、定義からのイメージ バージョンを作成できる。
- VHD が Windows VM 対応の場合は、[汎用 VHD のアップロード](https://docs.microsoft.com/azure/virtual-machines/windows/upload-generalized-managed)に関するページを参照してください。
- VHD が Linux VM 対応の場合は、「[VHD をアップロードする](https://docs.microsoft.com/azure/virtual-machines/linux/upload-vhd#option-1-upload-a-vhd)」の手順を参照してください。


**Q.** 特殊なディスクからイメージ バージョンを作成できますか?

 A. いいえ、特殊なディスクは現在、イメージとしてサポートしていません。 特殊なディスクがある場合、新しい VM にそのディスクをアタッチして、[VHD から VM を作成する](https://docs.microsoft.com/azure/virtual-machines/windows/create-vm-specialized-portal#create-a-vm-from-a-disk)必要があります。 VM が実行されたら、[Windows VM](https://docs.microsoft.com/azure/virtual-machines/windows/tutorial-custom-images) または [Linux VM](https://docs.microsoft.com/azure/virtual-machines/linux/tutorial-custom-images) からマネージド イメージを作成する手順を実行する必要があります。 汎用のマネージド イメージができたら、共有イメージの説明とイメージ バージョンを作成するプロセスを開始できます。


**Q.** 共有イメージ ギャラリー、イメージ定義、およびイメージ バージョンを Azure portal 経由で作成できますか?

 A. いいえ、Azure portal 経由では現在、どの共有イメージ ギャラリー リソースの作成もサポートされていません。 ただし、CLI、テンプレート、および SDK を利用した、共有イメージ ギャラリー リソースの作成がサポートされています。 また、PowerShell も間もなくリリースされる予定です。

 
**Q.** 作成後は、イメージ定義またはイメージ バージョンを更新できますか? どの種類の詳細情報を変更できますか?

 A. 各リソースで更新できる詳細情報を次に示します。
 
共有イメージ ギャラリー:
- 説明

イメージ定義:
- 推奨される vCPU:
- メモリ
- 説明
- 有効期限の終了日

イメージ バージョン:
- リージョンのレプリカ数
- ターゲット リージョン
- 最新バージョンからの除外
- 有効期限の終了日


**Q.** 作成後、別のサブスクリプションに共有イメージ ギャラリー リソースを移動できますか?

 A. いいえ、別のサブスクリプションに共有イメージ ギャラリー リソースを移動することはできません。 ただし、今後、必要に応じてギャラリー内のイメージ バージョンを他のリージョンにレプリケートできるようにする予定です。

**Q.** Azure China 21Vianet、Azure Germany、および Azure Government Cloud の複数のクラウド間で、自分のイメージ バージョンをレプリケートできますか? 

 A. いいえ、クラウド間でイメージのバージョンをレプリケートすることはできません。

**Q.** サブスクリプション間で自分のイメージ バージョンをレプリケートできますか? 

 A. いいえ、1 つのサブスクリプション内にあるリージョン全体にイメージ バージョンをレプリケートして、RBAC 経由で他のサブスクリプションでこれを使用できます。

**Q.** Azure AD のテナント間でイメージ バージョンを共有できますか? 

 A. いいえ、現在、共有イメージ ギャラリーでは、Azure AD テナント間でのイメージ バージョンの共有はサポートされていません。 ただし、Azure Marketplace でプライベート プラン機能を使用して、これを実現できます。


**Q.** ターゲット リージョン全体にイメージ バージョンをレプリケートするには、どのくらいの時間がかかりますか?

 A. イメージ バージョンのレプリケート時間は、イメージのサイズとレプリケートされるリージョン数に完全に依存します。 ただし、最短時間にするには、ベスト プラクティスとして、イメージを小規模なままにして、ソースとターゲットのリージョンを近接させることをお勧めします。 -ReplicationStatus フラグを使用して、レプリケーション ステータスをチェックできます。


**Q.** 1 つのサブスクリプションで作成できる共有イメージ ギャラリーの数は、いくつですか?

 A. 既定のクォータは次のとおりです。 
- 10 の共有イメージ ギャラリー (サブスクリプション別、リージョン別)
- 200 のイメージ定義 (サブスクリプション別、リージョン別)
- 2000 のイメージ バージョン (サブスクリプション別、リージョン別)


**Q.** ソース リージョンとターゲット リージョンの違いは何ですか?

 A. ソース リージョンとは、イメージ バージョンが作成されるリージョンであり、ターゲット リージョンとは、イメージ バージョンのコピーが保管されるリージョンです。 イメージ バージョンごとに、ソース リージョンは 1 つだけです。 また、イメージ バージョンを作成するときに、必ずソース リージョンの場所をターゲット リージョンの 1 つとして渡すようにします。  


**Q.** イメージ バージョンの作成時にソース リージョンを指定する方法を教えてください。

 A. イメージ バージョンの作成時は、CLI の場合 **-location** タグ、PowerShell の場合 **-Location** タグを使用して、ソース リージョンを指定できます。 イメージ バージョンを作成するための基本イメージとして使用しているマネージド イメージが、イメージ バージョンの作成を予定している場所と同じ場所にあることを確認してください。 また、イメージ バージョンを作成するときに、必ずソース リージョンの場所をターゲット リージョンの 1 つとして渡すようにします。  


**Q.** 各リージョンで作成されるイメージ バージョンのレプリカ数を指定する方法を教えてください。

 A. 各リージョンで作成されるイメージ バージョンのレプリカ数は、次の 2 つの方法で指定できます。
 
1. リージョン レプリカ数。リージョンごとに作成したいレプリカ数を指定します。 
2. リージョン レプリカ数が指定されない場合、リージョンごとの既定値となる共通レプリカ数。 

リージョン レプリカ数を指定するには、そのリージョンで作成するレプリカの数と場所を渡します (例: "South Central US=2")。 

各場所のリージョン レプリカ数が指定されない場合は、指定した共通レプリカ数が、レプリカの既定の数になります。 

CLI で共通レプリカ数を指定するには、`az sig image-version create` コマンドで **-replica-count** 引数を使用します。


**Q.** イメージ定義とイメージ バージョンの作成場所とは別の場所に、共有イメージ ギャラリーを作成できますか?

 A. はい、これは可能です。 ただし、ベスト プラクティスとしては、リソース グループ、共有イメージ ギャラリー、イメージ定義、およびイメージ バージョンを同じ場所に保持することをお勧めします。


**Q.** 共有イメージ ギャラリーの使用料金はどうなりますか?

 A. イメージ バージョンを格納するためのストレージの料金、ソース リージョンからターゲット リージョンへイメージ バージョンをレプリケートするためのネットワーク エグレスの料金を除いて、共有イメージ ギャラリー サービスの使用料金はかかりません。

**Q.** 共有イメージ ギャラリー、イメージ定義、イメージ バージョン、およびイメージ バージョンからの VM/VMSS を作成するには、どの API バージョンを使用する必要がありますか?

 A. イメージ バージョンを使用する VM と仮想マシン スケール セットのデプロイには、API バージョン 2018-04-01 以上を使用することをお勧めします。 共有イメージ ギャラリー、イメージ定義、およびイメージ バージョンを操作するには、API バージョン 2018-06-01 を使用することをお勧めします。 
