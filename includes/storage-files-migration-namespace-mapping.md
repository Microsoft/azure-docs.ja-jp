---
title: フォルダー構造を Azure File Sync トポロジにマップする
description: Azure File Sync で使用するために既存のファイルおよびフォルダー構造を Azure ファイル共有にマップします。移行ドキュメント間で共有される一般的なテキスト ブロック。
author: fauhse
ms.service: storage
ms.topic: conceptual
ms.date: 2/20/2020
ms.author: fauhse
ms.subservice: files
ms.openlocfilehash: 441632ea33195ff8bcb6da5f4fb2298c337a6c97
ms.sourcegitcommit: 4f4a2b16ff3a76e5d39e3fcf295bca19cff43540
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/30/2020
ms.locfileid: "93043186"
---
この手順では、必要な Azure ファイル共有の数を評価します。 1 つの Windows Server インスタンス (またはクラスター) では、最大 30 個の Azure ファイル共有を同期できます。

現在、SMB 共有としてユーザーとアプリに対してローカルに共有しているボリュームには、さらに多くのフォルダーが存在する場合があります。 このシナリオを理解する最も簡単な方法は、1:1 で Azure ファイル共有にマップするオンプレミスの共有を想像することです。 数が十分に少ない場合 (1 つの Windows Server インスタンスに対して 30 個未満) は、1:1 のマッピングをお勧めします。

30 個を超える共有がある場合、通常、オンプレミスの共有を 1 対 1 で Azure ファイル共有にマッピングする必要はありません。 次のオプションを検討してください。

#### <a name="share-grouping"></a>共有のグループ化

たとえば、人事 (HR) 部門に合計 15 個の共有がある場合、すべての HR データを 1 つの Azure ファイル共有に格納することを検討できます。 1 つの Azure ファイル共有にオンプレミスの共有を複数格納しても、ローカルの Windows Server インスタンスに通常の 15 個の SMB 共有を作成できます。 これは、単にこれらの 15 個の共有のルート フォルダーを共通フォルダーの下のサブフォルダーとして整理することを意味します。 その後、この共通フォルダーを Azure ファイル共有に同期します。 そうすることで、このオンプレミスの共有グループに必要なのは、クラウド内の 1 つの Azure ファイル共有のみとなります。

#### <a name="volume-sync"></a>ボリュームの同期

Azure File Sync では、ボリュームのルートを Azure ファイル共有に同期することをサポートしています。 ルート フォルダーを同期した場合、すべてのサブフォルダーとファイルは同じ Azure ファイル共有に格納されます。

ボリュームのルートを同期することが常に最適な答えとは限りません。 複数の場所を同期することには利点があります。 たとえば、そうすることで、同期スコープあたりの項目数を少なく抑えることができます。 Azure ファイル共有と Azure File Sync は、共有ごとに 1 億項目 (ファイルとフォルダー) を使用してテストされていますが、ベスト プラクティスは、単一の共有での項目数を 2,000 万から 3,000 万未満に抑えるようにすることです。 より少数の項目で Azure File Sync を設定することは、ファイルの同期にとって有益というだけではありません。項目の数が少ないと、次のようなシナリオでも利点があります。

* Azure File Sync 対応サーバーに名前空間の表示が開始される前のクラウド コンテンツの初期スキャンを高速で完了できます。
* Azure ファイル共有スナップショットからのクラウド側の復元が高速になります。
* オンプレミスサーバーのディザスター リカバリーが大幅にスピードアップされます。
* Azure ファイル共有 (同期以外) で直接行われた変更を検出して、より迅速に同期できます。

> [!TIP]
> ファイルとフォルダーの数が不明な場合は、JAM Software GmbH の TreeSize ツールで確認します。

#### <a name="a-structured-approach-to-a-deployment-map"></a>デプロイ マップへの構造化アプローチ

後の手順でクラウド ストレージをデプロイする前に、オンプレミス フォルダーと Azure ファイル共有の間にマップを作成することが重要です。 このマッピングを行うと、その後、プロビジョニングする Azure File Sync の " *同期グループ* " リソースの数と名称が通知されます。 同期グループは、Azure ファイル共有とサーバー上のフォルダーを連携させ、同期接続を確立します。

必要な Azure ファイル共有の数を決定するにあたっては、次の制限事項とベストプラクティスをレビューしてください。 そのことが、マップの最適化に役立ちます。

* Azure File Sync エージェントがインストールされているサーバーは、最大 30 個の Azure ファイル共有と同期できます。
* Azure ファイル共有は、ストレージ アカウント内にデプロイされます。 これにより、このストレージ アカウントが、IOPS やスループットなどのパフォーマンス数のスケールターゲットになります。

  理論的には、2 つの標準 (プレミアムではない) Azure ファイル共有により、ストレージ アカウントが提供できる最大パフォーマンスが飽和状態になる可能性があります。 これらのファイル共有への Azure File Sync のみのアタッチを計画している場合は、複数の Azure ファイル共有を同じストレージ アカウントにグループ化しても問題は発生しません。 考慮すべき関連メトリックの詳細については、「Azure ファイル共有のパフォーマンス ターゲット」を参照してください。

  Azure ファイル共有をネイティブで使用するアプリを Azure にリフトする場合は、Azure ファイル共有のパフォーマンスをさらに上げる必要があります。 将来的にでもこの種の使用の可能性がある場合は、Azure ファイル共有をそれ独自のストレージ アカウントにマッピングするのが最善です。
* 1 つの Azure リージョンにつき、1サブスクリプションあたりのストレージ アカウント数は 250 に制限されています。

> [!TIP]
> この情報を考慮して、ボリューム上の複数のトップレベルフォルダーを共通の新しいルート ディレクトリにグループ化することがしばしば必要になります。 次に、この新しいルート ディレクトリと、その中にグループ化したすべてのフォルダーを、1 つの Azure ファイル共有に同期します。 この手法を使用すると、サーバーあたり 30 個の Azure ファイル共有同期の制限内に抑えることができます。
>
> 共通のルートの下でのこのグループ化は、データへのアクセスにはいっさい影響しません。 ACL はそのままです。 今ここで共通のルートに変更したサーバー フォルダー上に必要共有パス (SMB 共有や NFS 共有など) がある場合に限り、その調整が必要となります。 それ以外の変更はありません。

> [!IMPORTANT]
> Azure File Sync の最も重要なスケール ベクターは、同期が必要な項目 (ファイルとフォルダー) の数です。

Azure File Sync では、1つの Azure ファイル共有に対して最大 1 億項目の同期がサポートされています。 ただし、Azure File Sync チームが定期的に行うテスト内容の表示に限っては、この制限を超えることができます。

ここでのベストプラクティスは、同期スコープあたりの項目数を少なくしておくことです。 これは、フォルダーを Azure ファイル共有にマッピングする際に考慮する必要がある重要な要素です。 Azure ファイル共有と Azure File Sync は、共有ごとに 1 億項目 (ファイルとフォルダー) を使用してテストされていますが、ベスト プラクティスは、単一の共有での項目数を 2,000 万から 3,000 万未満に抑えるようにすることです。 これらの数値を超え始めた場合は、名前空間を複数の共有に分割します。 これらの数値をほぼ下回っている場合、複数のオンプレミスの共有を同じ Azure ファイル共有にグループ化することを続行できます。 この方法により、拡大する余地が得られます。

状況によっては、一連のフォルダーが同じ Azure ファイル共有に論理的に同期される可能性があります (前述の新しい共通のルート フォルダーのアプローチを使用します)。 ただし、1 つの Azure ファイル共有ではなく 2 つに同期されるように、フォルダーを再グループ化することをお勧めします。 このアプローチを使用すると、ファイル共有あたりのファイルとフォルダーの数をサーバー間に分散させることができます。

#### <a name="create-a-mapping-table"></a>マッピング テーブルを作成する

:::row:::
    :::column:::
        [![マッピング テーブルの例。以下のファイルをエクスペリエンスにダウンロードし、このイメージの内容を使用する。](media/storage-files-migration-namespace-mapping/namespace-mapping.png)](media/storage-files-migration-namespace-mapping/namespace-mapping-expanded.png#lightbox)
    :::column-end:::
    :::column:::
        上記のコンセプトを組み合わせて使用すると、必要とする Azure ファイル共有の数を決定し、既存のデータのどの部分がどの Azure ファイル共有に格納されるかを判断する際の役に立ちます。
        
        必要に応じて参照できるように、自分の考えを記録しておく表を作成します。 一度に多数の Azure リソースをプロビジョニングするときは、マッピング計画の詳細がおろそかになりがちなので、情報が整理された状態を維持することが重要です。 完全なマッピングの作成に役立てるには、Microsoft Excel ファイルをテンプレートとしてダウンロードできます。

[//]: # (HTML 表示は、入れ子になった2列のテーブルを追加するための唯一の方法です。ここでは、作業イメージの解析とテキスト/ハイパーリンクが同じ行にあります。)

<br>
<table>
    <tr>
        <td>
            <img src="media/storage-files-migration-namespace-mapping/excel.png" alt="Microsoft Excel file icon that helps to set the context for the type of file download for the link next to it.">
        </td>
        <td>
            <a href="https://download.microsoft.com/download/1/8/D/18DC8184-E7E2-45EF-823F-F8A36B9FF240/Azure File Sync - Namespace Mapping.xlsx">名前空間マッピング テンプレートをダウンロードします。</a>
        </td>
    </tr>
</table>
    :::column-end:::
:::row-end:::
