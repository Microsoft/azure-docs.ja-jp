---
title: インクルード ファイル
description: インクルード ファイル
services: virtual-machines
author: albecker1
ms.service: virtual-machines
ms.topic: include
ms.date: 10/12/2020
ms.author: albecker1
ms.custom: include file
ms.openlocfilehash: 82b4c127f983f3133326bf7fb538e40713ef9655
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/19/2021
ms.locfileid: "100580381"
---
![Ds v3 の仕様を示すグラフ。](media/vm-disk-performance/dsv3-documentation.jpg)

- "*キャッシュされない*" ディスクの最大スループットは、仮想マシンが処理できる既定のストレージの上限になります。
- *キャッシュされる* ストレージのスループットの上限は、ホストキャッシュを有効にすると、別個の制限になります。

ホスト キャッシュは、書き込みまたは読み取りを迅速に実行できるストレージを VM の近くに配置することで機能します。 ホスト キャッシュ用に VM で使用できるストレージの容量は、ドキュメントに記載されています。 たとえば、Standard_D8s_v3 には 200 GiB のキャッシュ ストレージが備わっていることがわかります。

仮想マシンを作成してディスクをアタッチするときに、ホスト キャッシュを有効にすることができます。 また、既存の VM 上のディスクに対するホスト キャッシュをオンまたはオフにすることもできます。

![ホスト キャッシュを示すスクリーンショット。](media/vm-disk-performance/host-caching.jpg)

各ディスクのワークロードの要件に合うように、ホスト キャッシュを調整できます。 ホスト キャッシュを次のように設定できます。

- **読み取り専用**:読み取り操作のみを行うワークロードの場合
- **読み取り/書き込み**: バランスの取れた読み取り操作と書き込み操作を行うワークロードの場合

ワークロードがこれらのパターンのいずれにも該当しない場合は、ホスト キャッシュを使用しないことをお勧めします。

さまざまなホスト キャッシュ設定の例をいくつか紹介し、データ フローとパフォーマンスにどのように影響するかを見てみましょう。 この最初の例では、ホスト キャッシュ設定が **読み取り専用** に設定されている場合の IO 要求の処理について説明します。

**セットアップ:**

- Standard_D8s_v3
  - キャッシュされる IOPS:16,000
  - キャッシュされない IOPS:12,800
- P30 データ ディスク
  - IOPS:5,000
  - ホスト キャッシュ: **読み取り専用です。**

読み取りが実行されたとき、必要なデータがキャッシュで利用可能になっている場合は、要求されたデータがキャッシュから返されます。 ディスクから読み取る必要はありません。 この読み取りは、VM のキャッシュ制限にカウントされます。

![読み取りホスト キャッシュの読み取りヒットを示す図。](media/vm-disk-performance/host-caching-read-hit.jpg)

読み取りが実行されたとき、必要なデータがキャッシュで利用可能になって "*いない*" 場合は、読み取り要求がディスクに中継されます。 その後、ディスクからキャッシュと VM の両方に提供されます。 この読み取りは、VM の未キャッシュ制限と VM のキャッシュ制限の両方にカウントされます。

![読み取りホスト キャッシュの読み取りミスを示す図。](media/vm-disk-performance/host-caching-read-miss.jpg)

書き込みが実行された場合、書き込みが完了したと見なされるには、キャッシュとディスクの両方に書き込まれている必要があります。 この書き込みは、VM の未キャッシュ制限と VM のキャッシュ制限にカウントされます。

![読み取りホスト キャッシュの書き込みを示す図。](media/vm-disk-performance/host-caching-write.jpg)

次に、ホスト キャッシュの設定が **読み取り/書き込み** に設定されている場合の IO 要求の処理について説明します。

**セットアップ:**

- Standard_D8s_v3
  - キャッシュされる IOPS:16,000
  - キャッシュされない IOPS:12,800
- P30 データ ディスク
  - IOPS:5,000
  - ホスト キャッシュ: **読み取り/書き込み**

読み取りは、読み取り専用と同じ方法で処理されます。 読み取り/書き込みキャッシュで異なる部分は書き込みだけです。 ホスト キャッシュが **読み取り/書き込み** に設定されている書き込みの場合、ホスト キャッシュに書き込まれただけで、書き込みが完了したと見なされます。 その後、書き込みはバックグラウンド プロセスとしてディスクに遅延書き込みされます。 これは、キャッシュに書き込まれるときに、書き込みがキャッシュされた IO にカウントされることを意味します。 ディスクへの遅延書き込みの場合は、キャッシュされない IO にカウントされます。

![読み取り/書き込みホスト キャッシュの書き込みを示す図。](media/vm-disk-performance/host-caching-read-write.jpg)

Standard_D8s_v3 仮想マシンの説明を続けましょう。 この場合を除き、ディスクでホスト キャッシュを有効にします。 また、VM の IOPS の上限は 16,000 IOPS になりました。 VM にアタッチされているのは、それぞれ 5,000 IOPS を処理できる 3 台の基になる P30 ディスクです。

**セットアップ:**

- Standard_D8s_v3
  - キャッシュされる IOPS:16,000
  - キャッシュされない IOPS:12,800
- P30 OS ディスク
  - IOPS:5,000
  - ホスト キャッシュ: **読み取り/書き込み**
- 2 台の P30 データ ディスク x 2
  - IOPS:5,000
  - ホスト キャッシュ: **読み取り/書き込み**

![ホスト キャッシュの例を示す図。](media/vm-disk-performance/host-caching-example-without-remote.jpg)

アプリケーションにより、キャッシュが有効な Standard_D8s_v3 仮想マシンが使用されます。 15,000 IOPS で要求を行います。 この要求は、アタッチされている基になるディスクごとに 5,000 IOPS として分解されます。 パフォーマンスの上限が発生することはありません。

## <a name="combined-uncached-and-cached-limits"></a>未キャッシュ制限とキャッシュ制限の組み合わせ

仮想マシンのキャッシュ制限と未キャッシュ制限は切り離されています。 つまり、VM にアタッチされているディスクでホスト キャッシュを有効にしながら、他のディスクではホスト キャッシュを有効にしないでおくことができます。 この構成により、仮想マシンで、キャッシュされた制限とキャッシュされていない制限の合計ストレージ IO を取得できるようになります。

これらの制限がどのように連携するかを理解しやすいように、例を使用して説明します。 引き続き、Standard_D8s_v3 仮想マシンと Premium ディスクがアタッチされた構成を使用します。

**セットアップ:**

- Standard_D8s_v3
  - キャッシュされる IOPS:16,000
  - キャッシュされない IOPS:12,800
- P30 OS ディスク
  - IOPS:5,000
  - ホスト キャッシュ: **読み取り/書き込み**
- 2 台の P30 データ ディスク x 2
  - IOPS:5,000
  - ホスト キャッシュ: **読み取り/書き込み**
- 2 台の P30 データ ディスク x 2
  - IOPS:5,000
  - ホスト キャッシュ: **無効**

![リモート ストレージを使用するホスト キャッシュの例を示す図。](media/vm-disk-performance/host-caching-example-with-remote.jpg)

この例で、Standard_D8s_v3 仮想マシンで実行されているアプリケーションにより、25,000 IOPS の要求を行います。 要求は、アタッチされている各ディスクに 5,000 IOPS として分割されます。 3 台のディスクではホスト キャッシュが使用されており、2 台のディスクではホスト キャッシュが使用されていません。

- ホスト キャッシュが使用されている 3 台のディスクはキャッシュ制限である 16,000 の範囲内であるため、それらの要求は正常に完了します。 ストレージ パフォーマンスの上限に達することはありません。
- ホスト キャッシュが使用されていない 2 台のディスクは非キャッシュ制限である 12,800 の範囲内であるため、それらの要求も正常に完了します。 上限には達しません。

