---
author: roygara
ms.service: storage
ms.topic: include
ms.date: 12/11/2018
ms.author: rogarana
ms.openlocfilehash: aeb15fbb8da44a203789e06a359cb664998602ab
ms.sourcegitcommit: 7c18afdaf67442eeb537ae3574670541e471463d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/11/2020
ms.locfileid: "77123194"
---
Azure File Sync エージェントは、新機能の追加や問題の解決を目的として定期的に更新されます。 Azure File Sync エージェントの更新プログラムを公開されしだい入手できるように Microsoft Update を構成しておくことをお勧めします。

#### <a name="major-vs-minor-agent-versions"></a>エージェントのメジャー バージョンとマイナー バージョン
* エージェントのメジャー バージョンには、多くの場合、新しい機能が含まれています。メジャー バージョンでは、バージョン番号の先頭部分の数値が増えていきます。 次に例を示します。\*2.\*.\*\*
* エージェントのマイナー バージョンは "修正プログラム" とも呼ばれ、メジャー バージョンよりも頻繁にリリースされます。 多くの場合、バグの修正と軽微な機能強化が含まれ、新しい機能は含まれません。 例: \*\*.3.\*\*

#### <a name="upgrade-paths"></a>アップグレード パス
Azure File Sync エージェントの更新プログラムのインストールを承認してテストする方法は 4 つあります。 
1. **(推奨) エージェントの更新プログラムを自動的にダウンロードしてインストールするように Microsoft Update を構成する。**  
    すべての Azure File Sync の更新プログラムを実行して、サーバー エージェントの最新の修正を確実に適用することを常にお勧めします。 Microsoft Update では、更新プログラムのダウンロードとインストールを自動的に実行することで、このプロセスをシームレスにしています。
2. **AfsUpdater.exe を使用してエージェントの更新プログラムをダウンロードし、インストールする。**  
    AfsUpdater.exe は、エージェントのインストール ディレクトリにあります。 実行可能ファイルをダブルクリックすると、エージェントの更新プログラムがダウンロードされてインストールされます。 
3. **Microsoft Update 修正プログラム ファイル (.msp 実行可能ファイル) を使用して、既存の Azure File Sync エージェントを修正する。最新の Azure File Sync 更新プログラム パッケージは、[Microsoft Update カタログ](https://www.catalog.update.microsoft.com/Search.aspx?q=Azure%20File%20Sync)からダウンロードできます。**  
    .msp 実行可能ファイルを実行すると、前回の更新パスで Microsoft Update によって自動的に使用されたのと同じ方法を使用して、Azure File Sync のインストールがアップグレードされます。 Microsoft Update 修正プログラムを適用すると、Azure File Sync のインストールのインプレース アップグレードが実行されます。
4. [Microsoft ダウンロード センター](https://go.microsoft.com/fwlink/?linkid=858257)から**最新の Azure File Sync エージェント インストーラーをダウンロードする。**  
    既存の Azure File Sync エージェントのインストールをアップグレードするには、古いバージョンをアンインストールした後、ダウンロードしたインストーラーから最新バージョンをインストールします。 サーバーの登録、同期グループ、およびその他の設定は、Azure File Sync インストーラーによって管理されます。

#### <a name="automatic-agent-lifecycle-management"></a>自動エージェントのライフサイクル管理
バージョン 6 のエージェントでは、ファイル同期チームによってエージェントの自動アップグレード機能が導入されました。 2 つのモードのいずれかを選択して、サーバーでアップグレードが試行されるメンテナンス期間を指定できます。 この機能は、エージェントの期限切れを防止する手段を提供するか、面倒な作業なしで最新状態を維持する設定を許可することで、エージェントのライフサイクル管理を支援するように設計されています。
1. **既定の設定**では、エージェントの期限切れの防止が試行されます。 示されているエージェントの有効期限の 21 日以内に、エージェントがセルフアップグレードを試行します。 有効期限まで 21 日以内になると週に 1 回、選択されているメンテナンス期間にアップグレードを試行します。 **このオプションでは、通常の Microsoft Update 修正プログラムを適用する必要性は解消されません。**
1. 必要に応じて、新しいエージェント バージョンが使用可能になるとすぐにエージェントが自動アップグレードされるように選択できます (現在クラスター サーバーには適用できません)。 この更新は、選択されているメンテナンス期間内に行われ、新機能と機能強化が一般提供されるとすぐに、サーバーはそれらの恩恵を受けることができます。 これは安心して利用できる推奨設定であり、エージェントのメジャー バージョンだけでなく定期的な更新プログラムがサーバーに提供されます。 リリースされるすべてのエージェントは GA 品質です。 このオプションを選択すると、Microsoft はお客様に最新のエージェント バージョンをフライト化します。 クラスター化サーバーは除外されます。 フライト化が完了すると、エージェントは [Microsoft ダウンロード センター](https://go.microsoft.com/fwlink/?linkid=858257)でも利用可能になります (aka.ms/AFS/agent)。

 ##### <a name="changing-the-auto-upgrade-setting"></a>自動アップグレードの設定の変更

次の手順では、インストーラーの完了後に変更を行う必要がある場合に、設定を変更する方法について説明します。

PowerShell コンソールを開き、同期エージェントをインストールしたディレクトリに移動してから、サーバー コマンドレットをインポートします。 これは、既定ではこのようになります。
```powershell
cd 'C:\Program Files\Azure\StorageSyncAgent'
Import-Module -Name .\StorageSync.Management.ServerCmdlets.dll
```

`Get-StorageSyncAgentAutoUpdatePolicy` を実行して、現在のポリシー設定を確認し、変更するかどうかを判断できます。

現在のポリシー設定を遅延更新追跡に変更する場合は、以下を使用できます。
```powershell
Set-StorageSyncAgentAutoUpdatePolicy -PolicyMode UpdateBeforeExpiration
```

現在のポリシー設定を即時更新追跡に変更する場合は、以下を使用できます
```powershell
Set-StorageSyncAgentAutoUpdatePolicy -PolicyMode InstallLatest
```

#### <a name="agent-lifecycle-and-change-management-guarantees"></a>エージェントのライフサイクルと変更管理の保証
Azure File Sync は、新機能および機能強化を継続的に導入するするクラウド サービスです。 つまり、Azure File Sync エージェントの特定のバージョンは、一定の期間のみサポートされます。 デプロイを容易にするために、次のルールによって、変更管理プロセス中にエージェントの更新/アップグレードに対応するための十分な時間と通知が保証されます。

- エージェントのメジャー バージョンは、最初のリリースから少なくとも 6 か月間サポートされます。
- エージェントのメジャー バージョン間のサポートは、少なくとも 3 か月間重複することが保証されます。 
- 登録済みサーバーに対する警告は、有効期限がまもなく終了することを通知するエージェントを使用して、有効期限の少なくとも 3 か月前に発行されます。 Storage Sync Service の登録済みサーバー セクションで、登録済みサーバーがエージェントの古いバージョンを使用しているかどうかをチェックできます。
- マイナー エージェントの有効期間は、メジャー バージョンに関連付けられています。 たとえば、エージェントのバージョン 3.0 がリリースされると、エージェントのバージョン 2.\*は、すべてがまとめて期限切れになります。

> [!Note]
> 有効期間に関する警告が表示されているエージェントのバージョンをインストールしようとすると、警告が表示されますが、インストールは成功します。 期限切れのエージェントのバージョンのインストールまたはそれを使用した接続は、サポートされていないためにブロックされます。
