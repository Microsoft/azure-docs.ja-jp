---
title: インクルード ファイル
description: インクルード ファイル
services: virtual-machines
author: cynthn
ms.service: virtual-machines
ms.topic: include
ms.date: 11/06/2019
ms.author: cynthn
ms.custom: include file
ms.openlocfilehash: 7bf71f55e1b49a9280b25cfcc01090afbd0c42db
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/03/2021
ms.locfileid: "101751036"
---
## <a name="create-an-image-gallery"></a>イメージ ギャラリーを作成する

イメージ ギャラリーは、イメージの共有を有効にするために使用されるプライマリ リソースです。 ギャラリー名で許可されている文字は、英字 (大文字または小文字)、数字、ドット、およびピリオドです。 ギャラリー名にダッシュを含めることはできません。  ギャラリー名は、お使いのサブスクリプション内で一意にする必要があります。 

次の例では、*myGalleryRG* リソース グループに *myGallery* という名前のギャラリーを作成します。

1. Azure Portal ( https://portal.azure.com ) にサインインします。
1. 検索ボックスで **共有イメージ ギャラリー** という種類を使用して、結果で **[共有イメージ ギャラリー]** を選択します。
1. **[共有イメージ ギャラリー]** ページで、 **[追加]** をクリックします。
1. **[Shared Image Gallery の作成]** ページで、適切なサブスクリプションを選択します。
1. **[リソース グループ]** で、 **[新規作成]** を選択し、名前として「*myGalleryRG*」を入力します。
1. **[名前]** に、ギャラリー名として「*myGallery*」と入力します。
1. **[リージョン]** は既定値のままにしておきます。
1. 「*テスト用の自分のイメージ ギャラリー*」など、ギャラリーの簡単な説明を入力し、 **[確認および作成]** をクリックすることができます。
1. 検証に合格した後、 **[作成]** を選択します。
1. デプロイが完了したら、 **[リソースに移動]** を選択します。


## <a name="create-an-image-definition"></a>イメージ定義を作成する 

イメージ定義では、イメージの論理グループを作成します。 これは、その中に作成されるイメージ バージョンに関する情報を管理するために使用されます。 イメージ定義名は、大文字または小文字、数字、ドット、ダッシュおよびピリオドで構成できます。 イメージ定義に指定できる値の詳細については、[イメージ定義](../articles/virtual-machines/shared-image-galleries.md#image-definitions)に関するページを参照してください。

ギャラリー内でギャラリー イメージ定義を作成します。 この例では、ギャラリー イメージが *myImageDefinition* という名前になっています。

1. 新しいイメージ ギャラリーのページで、ページの上部から **[Add a new image definition]\(新しいイメージ定義の追加\)** を選択します。 
1. **[共有イメージ ギャラリーに新しいイメージ定義を追加]** の **[リージョン]** で *[米国東部]* を選択します。
1. **[イメージの定義名]** で、「*myImageDefinition*」と入力します。
1. **[オペレーティング システム]** では、ソース VM に基づいて適切なオプションを選択します。  
1. **[VM の生成]** では、ソース VM に基づいてオプションを選択します。 ほとんどの場合、これは *[Gen 1]* になります。 詳細については、[第 2 世代 VM に対するサポート](../articles/virtual-machines/generation-2.md)に関するページを参照してください。
1. **[オペレーティング システムの状態]** では、ソース VM に基づいて適切なオプションを選択します。 詳細については、[一般化と特殊化](../articles/virtual-machines/shared-image-galleries.md#generalized-and-specialized-images)に関するページを参照してください。
1. **[発行元]** では、「*myPublisher*」と入力します。 
1. **[プラン]** では、「*myOffer*」と入力します。
1. **[SKU]** では、「*mySKU*」と入力します。
1. 終わったら、 **[確認と作成]** を選択します。
1. イメージ定義の検証に合格した後、 **[作成]** を選択します。
1. デプロイが完了したら、 **[リソースに移動]** を選択します。


## <a name="create-an-image-version"></a>イメージ バージョンを作成する

マネージド イメージからイメージ バージョンを作成します。 この例のイメージ バージョンは *1.0.0* で、"*米国中西部*" と "*米国中南部*" の両方のデータセンターにレプリケートされます。 レプリケーションのターゲット リージョンを選択するときに、レプリケーションのターゲットとして、"*ソース*" リージョンも含める必要があることに注意してください。

イメージ バージョンで許可されている文字は、数字とピリオドです。 数字は、32 ビット整数の範囲内になっている必要があります。 形式:*MajorVersion*.*MinorVersion*.*Patch*。

イメージのバージョンを作成する手順は、ソースが一般化されたイメージであるか、特殊化された VM のスナップショットであるかによって若干異なります。 

### <a name="option-generalized"></a>オプション:一般化されたイメージ

1. イメージ定義のページで、ページの上部から **[バージョンの追加]** を選択します。
1. **[リージョン]** で、マネージド イメージが格納されているリージョンを選択します。 イメージ バージョンは、作成元のマネージド イメージと同じリージョンに作成する必要があります。
1. **[名前]** で、「*1.0.0*」と入力します。 イメージ バージョン名では、整数を使用する *major*.*minor*.*patch* という形式に従う必要があります。 
1. **[ソース イメージ]** では、ドロップダウンからソースのマネージド イメージを選択します。
1. **[最新から除外]** は、既定値の *[いいえ]* のままにしておきます。
1. **[End of life date]\(有効期限の終了日\)** では、今後数か月の予定表から日付を選択します。
1. **[レプリケーション]** の **[既定のレプリカ数]** は、1 のままにしておきます。 ソース リージョンにレプリケートする必要があるため、最初のレプリカは既定値のままにし、2 番目のレプリカ リージョンとして *[米国東部]* を選択します。
1. 完了したら、 **[確認および作成]** を選択します。 Azure で構成が検証されます。
1. イメージ バージョンの検証に合格したら、 **[作成]** を選択します。
1. デプロイが完了したら、 **[リソースに移動]** を選択します。

イメージをすべてのターゲット リージョンにレプリケートするにはしばらく時間がかかる場合があります。

### <a name="option-specialized"></a>オプション:専用イメージ

1. イメージ定義のページで、ページの上部から **[バージョンの追加]** を選択します。
1. **[リージョン]** で、スナップショットが格納されているリージョンを選択します。 イメージのバージョンは、作成元のソースと同じリージョンに作成する必要があります。
1. **[名前]** で、「*1.0.0*」と入力します。 イメージ バージョン名では、整数を使用する *major*.*minor*.*patch* という形式に従う必要があります。 
1. **[OS ディスクのスナップショット]** で、ドロップダウンを使用してソース VM からスナップショットを選択します。 ソース VM に含める必要があるデータ ディスクがあった場合、ドロップダウンで正しい **LUN** 番号を選択してから、 **[データ ディスクのスナップショット]** でそのデータ ディスクのスナップショットを選択します。 
1. **[最新から除外]** は、既定値の *[いいえ]* のままにしておきます。
1. **[End of life date]\(有効期限の終了日\)** では、今後数か月の予定表から日付を選択します。
1. **[レプリケーション]** の **[既定のレプリカ数]** は、1 のままにしておきます。 ソース リージョンにレプリケートする必要があるため、最初のレプリカは既定値のままにし、2 番目のレプリカ リージョンとして *[米国東部]* を選択します。
1. 完了したら、 **[確認および作成]** を選択します。 Azure で構成が検証されます。
1. イメージ バージョンの検証に合格したら、 **[作成]** を選択します。
1. デプロイが完了したら、 **[リソースに移動]** を選択します。

## <a name="share-the-gallery"></a>ギャラリーを共有する

イメージ ギャラリー レベルでアクセスを共有することをお勧めします。 先ほど作成したギャラリーを共有する手順を以下に示します。

1. 新しいイメージ ギャラリーのページで、左側のメニューにある **[アクセス制御 (IAM)]** を選択します。 
1. **[ロールの割り当てを追加する]** で **[追加]** を選択します。 **[ロールの割り当てを追加する]** ウィンドウが開きます。 
1. **[ロール]** で **[閲覧者]** を選択します。
1. **[アクセスの割り当て先]** で既定値の **[Azure AD のユーザー、グループ、サービス プリンシパル]** のままにします。
1. **[選択]** の下で、招待する人のメール アドレスを入力します。
1. ユーザーが組織外の場合、"**このユーザーには、Microsoft で共同作業できるようにするメールが送信されます**" というメッセージが表示されます。 メール アドレスでユーザーを選択して、 **[保存]** をクリックします。

ユーザーが組織外の場合は、組織に参加するための招待メールを受け取ります。 そのユーザーは招待に同意する必要があり、その後ギャラリーとリソースの一覧にイメージの定義とバージョンをすべて表示できるようになります。
