
# <a name="azure-and-internet-of-things"></a>Azure とモノのインターネット

Microsoft Azure とモノのインターネット (IoT) にようこそ この記事では、Azure のサービスを使用してデプロイする IoT ソリューションの一般的な特性を記述する IoT ソリューション アーキテクチャについて説明します。 IoT ソリューションでは、数百万に達する可能性があるデバイスと、ソリューション バックエンドとの間にセキュリティで保護された双方向通信が必要です。 たとえばソリューション バックエンドでは、自動化された予測分析を使用して、デバイスとクラウドとの間でやり取りされるイベント ストリームから知見を得ることが考えられます。

この IoT ソリューション アーキテクチャを Azure サービスを使って実装するうえで主要な構成要素となるのが Azure IoT Hub です。 IoT Suite を利用すれば、特定の IoT シナリオに対して、このアーキテクチャをエンド ツー エンドで包括的に実装することができます。 For example:

* 自動販売機などのデバイスの状態を "*リモート監視*" ソリューションで監視することができます。
* 遠隔地にあるポンプ場の揚水機など、装置に対する保守の必要性を "*予測メンテナンス*" ソリューションで予測することによって予定外のダウンタイムを防ぐことができます。

## <a name="iot-solution-architecture"></a>IoT ソリューションのアーキテクチャ

次の図は、一般的な IoT ソリューションのアーキテクチャを示しています。 この図には、特定の Azure サービス名は含まれず、一般的な IoT ソリューションのアーキテクチャの主な要素が記されています。 このアーキテクチャでは、IoT デバイスはクラウド ゲートウェイに送信するデータを収集します。 クラウド ゲートウェイは、データを他のバックエンド サービスが処理できるようにします。データはバックエンド サービスから他の基幹業務アプリケーション、またはダッシュ ボードやその他のプレゼンテーション デバイスを通じて人間のオペレーターに送られます。

![IoT ソリューションのアーキテクチャ][img-solution-architecture]

> [!NOTE]
> IoT アーキテクチャの詳細については、「[Microsoft Azure IoT Reference Architecture (Microsoft Azure IoT リファレンス アーキテクチャ)][lnk-refarch]」を参照してください。

### <a name="device-connectivity"></a>デバイスの接続性

この IoT ソリューション アーキテクチャでは、デバイスが、テレメトリ (ポンプ場のセンサー測定値など) を格納と処理のためにクラウド エンドポイントに送信します。 予測メンテナンスのシナリオでは、ソリューション バックエンドでセンサー データのストリームを使用して、特定のポンプのメンテナンスが必要な時期を判断することがあります。 デバイスは、クラウドからデバイスへのメッセージを受信し、クラウド エンドポイントからのメッセージを読み取り、コマンドに応答することもできます。 たとえば、予測メンテナンスのシナリオでは、ソリューション バックエンドでポンプ場のその他のポンプにメッセージを送信してメンテナンスの開始予定直前にフローの再ルーティングを開始することが考えられます。 そうすればメンテナンス エンジニアが到着してすぐにメンテナンスを開始することが可能です。

IoT プロジェクトが直面する最も大きな課題の 1 つは、ソリューション バック エンドにデバイスを確実かつ安全に接続する方法です。 IoT デバイスには、ブラウザーやモバイル アプリなどの他のクライアントとは異なる特性があります。 IoT デバイスの特性は次のとおりです。

* 多くの場合、人間が操作することのない組み込みシステムです。
* 物理アクセスに大きなコストがかかる離れた場所にデプロイされている場合があります。
* ソリューション バック エンド経由でしか到達できない場合があります。 デバイスとやり取りする他の方法はありません。
* 電源や処理リソースが限られている場合があります。
* ネットワーク接続が断続的に切れたり、遅かったり、高コストである場合があります。
* 専用、カスタム、または業界固有のアプリケーション プロトコルを使用することが必要になる場合があります。
* 一般的なハードウェアおよびソフトウェア プラットフォームを多数使用して作成できます。

上記の要件に加え、IoT ソリューションはスケール、セキュリティ、および信頼性を提供する必要もあります。 そのため、一連の接続要件は、Web コンテナーやメッセージング ブローカーなどの従来のテクノロジを使用して実装するのが難しく、時間がかかります。 Azure IoT Hub と Azure IoT device SDK を利用すると、これらの要件を満たすソリューションの実装が簡単になります。

デバイスは、クラウド ゲートウェイ エンドポイントと直接通信できます。または、クラウド ゲートウェイがサポートする通信プロトコルをデバイスが使用できない場合は、中間ゲートウェイを介して接続できます。 たとえば、IoT Hub でサポートされるいずれのプロセスにもデバイスが対応していない場合、[Azure IoT プロトコル ゲートウェイ][lnk-protocol-gateway]でプロトコル変換を実行することができます。

### <a name="data-processing-and-analytics"></a>データ処理と分析

クラウドでは、IoT ソリューション バックエンドでデータ処理のほとんど (テレメトリのフィルター処理と集計、テレメトリの他のサービスへのルーティング) が行われます。 IoT ソリューション バックエンドでは以下が行われます。

* デバイスから大量のテレメトリを受信し、そのデータを処理および格納する方法を決定します。 
* クラウドから特定のデバイスにコマンドを送信できることもあります。
* デバイスをプロビジョニングし、インフラストラクチャへの接続が許可されるデバイスを制御できるようにする、デバイス登録機能を提供します。
* デバイスの状態を追跡し、そのアクティビティを監視できます。

予測メンテナンスのシナリオでは、テレメトリ データ履歴がソリューション バックエンドで保存されます。 ソリューション バックエンドでは、このデータから、特定の揚水機のメンテナンスが必要であることを示すパターンを見極めることができます。

IoT ソリューションには、自動フィードバックのループが含まれる場合があります。 たとえば、ソリューション バックエンドの分析モジュールは、テレメトリから特定のデバイスの温度が通常の運用レベルを超過していることを判別できます。 すると、ソリューションは、そのデバイスにコマンドを送信して是正措置を実行させることができます。

### <a name="presentation-and-business-connectivity"></a>プレゼンテーションおよびビジネスの接続性

プレゼンテーションおよびビジネスの接続性レイヤーでは、エンド ユーザーが IoT ソリューションおよびデバイスとやり取りできます。 このレイヤーによって、ユーザーが、デバイスから収集されたデータを表示して分析することができます。 これらのビューは、履歴データとほぼリアルタイムのデータの両方を表示できる、ダッシュボードまたは BI レポートの形式をとることができます。 たとえば、オペレーターは、特定のポンプ場の状態を確認し、システムによって生成されるアラートを参照できます。 また、このレイヤーによって、IoT ソリューション バックエンドと既存の基幹業務アプリケーションの統合が可能になり、企業のビジネス プロセスやワークフローと結びつけることができます。 たとえば、予測メンテナンス ソリューションは、ソリューションでメンテナンスを必要とするポンプ が特定されたときに、エンジニアのポンプ場訪問を予約するスケジューリング システムと統合することができます。

![IoT ソリューションのダッシュボード][img-dashboard]

[img-solution-architecture]: ./media/iot-azure-and-iot/iot-reference-architecture.png
[img-dashboard]: ./media/iot-azure-and-iot/iot-suite.png

[lnk-machinelearning]: http://azure.microsoft.com/documentation/services/machine-learning/
[Azure IoT Suite]: http://azure.microsoft.com/solutions/iot
[lnk-protocol-gateway]:  ../articles/iot-hub/iot-hub-protocol-gateway.md
[lnk-refarch]: http://download.microsoft.com/download/A/4/D/A4DAD253-BC21-41D3-B9D9-87D2AE6F0719/Microsoft_Azure_IoT_Reference_Architecture.pdf
