---
title: Azure Application Gateway でのエンド ツー エンド SSL の有効化
description: この記事では、Application Gateway によるエンドツーエンド SSL のサポートの概要を示します。
services: application-gateway
author: amsriva
ms.service: application-gateway
ms.topic: article
ms.date: 10/23/2018
ms.author: amsriva
ms.openlocfilehash: fcb49f532d5dfcd340baf017bd55c69d4e81e0e6
ms.sourcegitcommit: c94cf3840db42f099b4dc858cd0c77c4e3e4c436
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/19/2018
ms.locfileid: "53630684"
---
# <a name="overview-of-end-to-end-ssl-with-application-gateway"></a>Application Gateway でのエンド ツー エンド SSL の概要

Application Gateway は、ゲートウェイの SSL ターミネーションをサポートします。通常、トラフィックは、その後、暗号化されないままバックエンド サーバーに渡されます。 この機能により、Web サーバーは、負荷の大きい暗号化と復号化のオーバーヘッドから開放されます。 ただし、暗号化されていない通信をバックエンド サーバーで受け入れていない顧客もいます。 このように暗号化されていない通信が発生する原因としては、セキュリティの要件とコンプライアンスの要件が考えられます。また、アプリケーションでセキュリティで保護された接続以外は受け入れられないこともあります。 このようなアプリケーションのために、アプリケーション ゲートウェイでは、エンド ツー エンド SSL 暗号化がサポートされています。

エンド ツー エンド SSL により、暗号化されたバックエンドに機密データを安全に送信しながら、アプリケーション ゲートウェイによって提供されるレイヤー 7 の負荷分散機能の利点を引き続き利用できます｡ (レイヤー 7 の負荷分散機能には、Cookie ベースのセッション アフィニティ、URL ベースのルーティング、サイトに基づくルーティングのサポート、X-Forwarded-* ヘッダーを挿入する機能などがあります)。

エンド ツー エンド SSL 通信モードが構成されている場合、アプリケーション ゲートウェイによって SSL セッションがゲートウェイで終了され、ユーザー トラフィックの暗号化が解除されます。 次に、構成済みのルールが適用され、トラフィックのルーティング先になる適切なバックエンド プール インスタンスが選択されます。 バックエンドに要求を送信する前に、Application Gateway によってバックエンド サーバーへの新しい SSL 接続が開始され、バックエンド サーバーの公開キー証明書を使用してデータが再暗号化されます。 エンド ツー エンド SSL は **BackendHTTPSetting** のプロトコル設定を HTTPS に設定することによって有効になります。この設定は次にバックエンド プールに適用されます。 エンド ツー エンド SSL が有効になったバックエンド プール内の各バックエンド サーバーは、セキュリティで保護された通信を許可するように証明書で構成する必要があります。

![エンド ツー エンド SSL のシナリオ][1]

この例では、TLS1.2 を使用する要求が、エンド ツー エンド SSL を使用して Pool1 のバックエンド サーバーにルーティングされます。

## <a name="end-to-end-ssl-and-whitelisting-of-certificates"></a>エンド ツー エンド SSL と証明書のホワイト リスト

Application Gateway は、既知のバックエンド インスタンスのみと通信します。これらのインスタンスでは、アプリケーション ゲートウェイに関する証明書がホワイトリスト登録されています。 証明書のホワイトリスト登録を有効にするには、(ルート証明書ではなく) バックエンド サーバーの証明書の公開キーをアプリケーション ゲートウェイにアップロードする必要があります。 ホワイトリスト登録された既知のバックエンドへの接続のみが許可され、 それ以外ではゲートウェイ エラーが発生します。 自己署名証明書はテストのみを目的とするため、運用環境のワークロードで使用することはお勧めできません。 このような証明書は、使用する前に、上記の手順で説明したとおりに、アプリケーション ゲートウェイでホワイトリスト登録する必要があります。

> [!NOTE]
> 認証証明書のセットアップは、信頼済みの Azure サービス (Azure App Service など) では必要ありません。

## <a name="end-to-end-ssl-with-the-v2-sku"></a>v2 SKU を利用したエンド ツー エンド SSL

認証証明書は廃止され、Application Gateway v2 SKU の信頼されたルート証明書に置き換えられました。 これは認証証明書と同様の働きをしますが、いくつかの重要な違いがあります。

- 既知の CA 機関によって署名され､バックエンドの HTTP 設定のホスト名と一致する CN を持つ証明書は、エンド ツー エンド SSL が機能するため、追加の手順は必要ありません。 

   たとえば、バックエンド証明書が既知の CA により発行されて、その CN が contoso.com であり、バックエンドの http 設定の [ホスト] フィールドも contoso.com に設定されている場合、追加の手順は必要ありません。 バックエンドの http 設定のプロトコルとして HTTPS を設定すると、正常性プローブとデータ パスの両方が SSL で有効になります。 バックエンドとして Azure App Service または他の Azure の web サービスを使用している場合は、それらも暗黙で信頼されており、エンド ツー エンド SSL にはこれ以上の手順は必要ありません。
- 証明書が自己署名済みの場合、または不明な仲介者によって署名されている場合、 v2 SKU でエンド ツー エンド SSL を有効にするには、信頼できるルート証明書を定義する必要があります。 Application Gateway は、サーバー証明書のルート証明書がプールに関連付けられたバックエンドの HTTP 設定の信頼されたルート証明書のいずれかと一致するバックエンドとのみ通信します。

- ルート証明書の一致ばかりでなく、Application Gateway はバックエンドの HTTP 設定に指定されている [ホスト] 設定がバックエンド サーバーの SSL 証明書によって提示される共通名 (CN) のホスト設定と一致するかどうかも検証します｡ バックエンドとの SSL 接続を確立しようとする場合、アプリケーション ゲートウェイは バックエンドの http 設定で指定されているホストを Server Name Indication (SNI) 拡張機能に設定します。
- バックエンドの HTTP 設定で [ホスト] フィールドではなく､**[pick hostname from backend address]** が選択されている場合､SNI ヘッダーにはつねにバックエンド プールの FQDN が設定され､バックエンド サーバーの SSL 証明書の CN はその FDQN と一致している必要があります｡ このシナリオでは、IP アドレスを持つバックエンド プール メンバーはサポートされません。
- このルート証明書は､バックエンド サーバーの証明書からの base64 でエンコードされたルート証明書になります｡

## <a name="next-steps"></a>次の手順

エンド ツー エンド SSL について学習したら、「[Application Gateway で PowerShell を使用してエンド ツー エンド SSL を構成する](application-gateway-end-to-end-ssl-powershell.md)」に進んで、エンド ツー エンド SSL を使用するアプリケーション ゲートウェイを作成します。

<!--Image references-->

[1]: ./media/ssl-overview/scenario.png
