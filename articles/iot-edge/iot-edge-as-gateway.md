---
title: ダウンストリーム デバイスのゲートウェイ - Azure IoT Edge | Microsoft Docs
description: Azure IoT Edge を使って、複数のダウンストリーム デバイスからクラウドにデータを送信する、またはデータをローカルに処理する、透過的デバイス、非透過的デバイス、またはプロキシ ゲートウェイ デバイスを作成します。
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 02/25/2019
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom:
- amqp
- mqtt
ms.openlocfilehash: d7c924af297d9a315b61351b69d2fe6346bc1178
ms.sourcegitcommit: f7e160c820c1e2eb57dc480b2a8fd6bef7053e91
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/10/2020
ms.locfileid: "86232629"
---
# <a name="how-an-iot-edge-device-can-be-used-as-a-gateway"></a>IoT Edge デバイスをゲートウェイとして使用する方法

IoT Edge ソリューションのゲートウェイは、デバイス接続とエッジ分析を IoT デバイスに提供します。ゲートウェイ以外ではこれらの機能は提供されません。 Azure IoT Edge を使うと、目的が接続、ID、エッジ分析のいずれに関係していても、IoT ゲートウェイのあらゆるニーズを満たすことができます。 この記事のゲートウェイ パターンでは、ダウンストリーム デバイスの接続の特性とデバイスの ID のみが示されており、ゲートウェイでのデバイス データの処理方法は示されていません。

## <a name="patterns"></a>パターン

ゲートウェイとしての IoT Edge デバイスの使用には、透過、プロトコル変換、ID 変換の 3 つのパターンがあります。

* **透過** – IoT Hub に理論的に接続できるデバイスは、代わりにゲートウェイ デバイスに接続できます。 このダウンストリーム デバイスには独自の IoT Hub ID があり、MQTT、AMQP、HTTP のいずれかのプロトコルを使っています。 ゲートウェイは、デバイスと IoT Hub の間の通信を単純に受け渡します。 デバイスも、IoT Hub を介してそれと対話しているユーザーも、ゲートウェイが通信を仲介していることを認識しません。 このように認識されないことは、ゲートウェイが "*透過的*" と見なされることを意味します。 透過的なゲートウェイとして IoT Edge デバイスを使う方法については、「[透過的なゲートウェイの作成](how-to-create-transparent-gateway.md)」をご覧ください。
* **プロトコル変換** – 非透過的ゲートウェイ パターンとしても知られているものであり、MQTT、AMQP、または HTTP をサポートしていないデバイスは、ゲートウェイ デバイスを使って IoT Hub にデータを送信できます。 ゲートウェイは、ダウンストリーム デバイスによって使用されているプロトコルを認識します。またゲートウェイは、IoT Hub 内で ID を持つ唯一のデバイスです。 すべての情報は、1 つのデバイスつまりゲートウェイから送信されているように見えます。 クラウド アプリケーションでデバイスごとにデータを分析する必要がある場合、ダウンストリーム デバイスは追加の識別情報をメッセージに埋め込む必要があります。 さらに、ツインやメソッドのような IoT Hub プリミティブを使うことができるのはゲートウェイ デバイスのみであり、ダウンストリーム デバイスは使えません。
* **ID 変換** - IoT Hub に接続できないデバイスは、代わりにゲートウェイ デバイスに接続できます。 ゲートウェイは、ダウンストリーム デバイスに代わって IoT Hub ID とプロトコルの変換機能を提供します。 ゲートウェイは、ダウンストリーム デバイスによって使われているプロトコルを認識し、ダウンストリーム デバイスに ID を提供し、IoT Hub のプリミティブを変換できるほど十分にスマートです。 ダウンストリーム デバイスは、ツインとメソッドを備えたファースト クラスのデバイスとして IoT Hub に認識されます。 ユーザーは、中間のゲートウェイ デバイスを意識せずに IoT Hub 内のデバイスを操作できます。

![ダイアグラム - 透過、プロトコル、および ID ゲートウェイ パターン](./media/iot-edge-as-gateway/edge-as-gateway.png)

## <a name="use-cases"></a>ユース ケース

すべてのゲートウェイ パターンには次の利点があります。

* **エッジでの分析** – AI サービスをローカルに使って、クラウドに完全に忠実なテレメトリを送信することなく、ダウンストリーム デバイスからのデータを処理します。 ローカルに洞察を検索して対応し、データのサブセットのみを IoT Hub に送信します。
* **ダウンストリーム デバイスの分離** – ゲートウェイ デバイスは、すべてのダウンストリーム デバイスをインターネットへの露出から保護できます。 接続されていない OT ネットワークと、Web へのアクセスを提供する IT ネットワークの間に配置できます。
* **接続の多重化** - IoT Edge ゲートウェイを介して IoT Hub に接続するデバイスはすべて、基になっている同じ接続を使用します。
* **トラフィックのスムージング** - IoT Edge デバイスは、メッセージをローカルに保持しながら、IoT Hub でトラフィックを調整する場合に指数のバックオフを自動的に実装します。 このメリットにより、急増するトラフィックに対するソリューションの回復力が高まります。
* **オフライン サポート** - ゲートウェイ デバイスは、IoT Hub に配信できないメッセージとツインの更新を保存します。

プロトコル変換を行うゲートウェイは、リソースが制約される既存デバイスと新規デバイスに対し、エッジ分析、デバイス分離、トラフィック スムージング、およびオフライン サポートも実行できます。 既存の多くのデバイスは、ビジネスの洞察に役立つデータを生成します。しかし、クラウドへの接続を考慮して設計されてはいません。 非透過的なゲートウェイを使うと、このデータの制約がなくなり、IoT ソリューションで使用できるようになります。

ID 変換を行うゲートウェイを使うと、プロトコル変換の利点が提供され、さらにクラウドからダウンストリーム デバイスを完全に管理できます。 IoT ソリューションのすべてのデバイスは、使用しているプロトコルに関係なく、IoT Hub に認識されます。

## <a name="cheat-sheet"></a>チート シート

透過的、非透過的 (プロトコル)、およびプロキシ ゲートウェイを使ったときの IoT Hub プリミティブを比較した簡単なチート シートを次に示します。

| プリミティブ | 透過的なゲートウェイ | プロトコル変換 | ID 変換 |
|--------|-------------|--------|--------|
| IoT Hub ID レジストリに格納されている ID | 接続されているすべてのデバイスの ID | ゲートウェイ デバイスの ID のみ | 接続されているすべてのデバイスの ID |
| デバイス ツイン | 各接続のデバイスには、独自のデバイス ツインが含まれている | デバイスとモジュール ツインはゲートウェイにのみ含まれている | 各接続のデバイスには、独自のデバイス ツインが含まれている |
| ダイレクト メソッドおよびクラウドからデバイスへのメッセージ | クラウドは接続された各デバイスを個別にアドレスできる | クラウドはゲートウェイ デバイスのみをアドレスできる | クラウドは接続された各デバイスを個別にアドレスできる |
| [IoT Hub のスロットルおよびクォータ](../iot-hub/iot-hub-devguide-quotas-throttling.md) | 各デバイスに適用する | ゲートウェイ デバイスに適用する | 各デバイスに適用する |

非透過的なゲートウェイ (プロトコル変換) パターンを使用する場合、そのゲートウェイを介して接続するすべてのデバイスは、同一のクラウドからデバイスのキューを共有します。これには最大で 50 のメッセージを含めることができます。 したがって、各フィールド ゲートウェイを介して接続するデバイスが非常に少なく、クラウドからデバイスへのトラフィックが少ない場合にのみ、非透過的なゲートウェイ パターンを使用する必要があります。

## <a name="next-steps"></a>次のステップ

透過的なゲートウェイを設定する方法を学びます。

* [透過的なゲートウェイとして機能するように IoT Edge デバイスを構成](how-to-create-transparent-gateway.md)します。
* [Azure IoT Hub に対するダウンストリーム デバイスの認証を行う](how-to-authenticate-downstream-device.md)
* [ダウンストリーム デバイスを Azure IoT Edge ゲートウェイに接続する](how-to-connect-downstream-device.md)
