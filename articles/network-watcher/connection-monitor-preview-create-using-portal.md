---
title: 接続モニターを作成する (プレビュー) - Azure portal
titleSuffix: Azure Network Watcher
description: Azure portal を使用して接続モニター (プレビュー) を作成する方法について説明します。
services: network-watcher
documentationcenter: na
author: vinigam
ms.service: network-watcher
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/30/2020
ms.author: vinigam
ms.openlocfilehash: 4e7067e537ce8fb6faf82198f7863957f79ffb22
ms.sourcegitcommit: 97a0d868b9d36072ec5e872b3c77fa33b9ce7194
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87567832"
---
# <a name="create-a-connection-monitor-preview-using-the-azure-portal"></a>Azure portal を使用して接続モニター (プレビュー) を作成する

Azure portal を使用して接続モニター (プレビュー) を作成し、リソース間の通信を監視する方法について説明します。 これにより、ハイブリッド デプロイおよび Azure クラウドデプロイがサポートされます。

## <a name="before-you-begin"></a>開始する前に 

接続モニター (プレビュー) で作成する接続モニターでは、オンプレミスのコンピューターと Azure VM の両方をソースとして追加できます。 これらの接続モニターでは、エンドポイントへの接続も監視できます。 エンドポイントは、Azure または他の任意の URL や IP 上のどこにあってもかまいません。

接続モニター (プレビュー) には、次のエンティティが含まれています。


* **接続モニター リソース** – リージョン固有の Azure リソース。 以下のすべてのエンティティが、接続モニター リソースのプロパティです。
* **エンドポイント** –接続チェックに含まれるソースまたはターゲット。 エンドポイントの例としては、Azure VM、オンプレミスのエージェント、URL、IP などがあります。
* **テスト構成** – テスト用のプロトコル固有の構成。 選択したプロトコルに基づいて、ポート、しきい値、テストの頻度、その他のパラメーターを定義できます。
* **テスト グループ** – ソース エンドポイント、ターゲット エンドポイント、テスト構成が含まれるグループ。 接続モニターには、複数のテスト グループを含めることができます。
* **テスト** – ソース エンドポイント、ターゲット エンドポイント、テスト構成の組み合わせ。 テストは、監視データを入手できる最も小さいレベルです。 監視データには、失敗したチェックの割合と、ラウンドトリップ時間 (RTT) が含まれます。

    ![テスト グループとテストの関係が定義されている接続モニターを示す図](./media/connection-monitor-2-preview/cm-tg-2.png)

## <a name="steps-to-create"></a>作成の手順

Azure portal を使用して接続モニター (プレビュー) を作成するには、次の手順に従います。

1. Azure portal のホーム ページで、 **[Network Watcher]** に移動します。
1. 左側の **[監視]** セクションで、 **[接続モニター (プレビュー)]** を選択します。
1. 接続モニター (プレビュー) で作成されたすべての接続モニターが表示されます。 接続モニターの従来のエクスペリエンスで作成された接続モニターを表示するには、 **[接続モニター]** タブに移動します。

    ![接続モニター (プレビュー) で作成されたすべての接続モニターを示すスクリーンショット](./media/connection-monitor-2-preview/cm-resource-view.png)   
    
1. **[接続モニター (プレビュー)]** ダッシュボードの左上隅にある **[作成]** を選択します。
1. **[基本]** タブで、接続モニターの情報を入力します。
   * **[接続モニター名]** – 接続モニターの名前を追加します。 Azure リソースの標準的な名前付けルールを使用します。
   * **[サブスクリプション]** – 接続モニターのサブスクリプションを選択します。
   * **[リージョン]** – 接続モニターのリージョンを選択します。 選択できるのは、このリージョンに作成されたソース VM のみです。
   * **[ワークスペースの構成]** - ワークスペースには監視データが保持されます。 カスタム ワークスペースまたは既定のワークスペースを使用できます。 
       * 既定のワークスペースを使用するには、チェック ボックスをオンにします。 
       * カスタム ワークスペースを選択するには、チェック ボックスをオフにします。 そして、カスタム ワークスペースのサブスクリプションとリージョンを選択します。 
1. タブの下部にある **[次へ: テスト グループ]** を選択します。

   ![接続モニターの [基本] タブを示すスクリーンショット](./media/connection-monitor-2-preview/create-cm-basics.png)

1. **[テスト グループ]** タブで、 **[+ テスト グループ]** を選択します。 テスト グループの設定については、「[接続モニターでテスト グループを作成する](#create-test-groups-in-a-connection-monitor)」をご覧ください。 
1. タブの下部にある **[次へ: 確認と作成]** を選択して、接続モニターを確認します。

   ![[テスト グループ] タブと、テスト グループの詳細を追加するペインを示すスクリーンショット](./media/connection-monitor-2-preview/create-tg.png)

1. 接続モニターを作成する前に、 **[確認と作成]** タブで基本情報とテスト グループを確認します。 接続モニターを編集する必要がある場合:
   * 基本の詳細を編集するには、鉛筆アイコンを選択します。
   * テスト グループを編集するには、テスト グループを選択します。

   > [!NOTE] 
   > **[確認と作成]** タブには、接続モニターのプレビュー段階の間の 1 か月あたりのコストが表示されます。 現在、 **[現在のコスト]** 列には料金が表示されません。 接続モニターが一般提供されるようになると、この列に月額料金が表示されます。 
   > 
   > 接続モニターのプレビュー段階でも、Log Analytics のインジェスト料金がかかります。

1. 接続モニターを作成する準備ができたら、 **[確認と作成]** タブの下部にある **[作成]** を選択します。

   ![接続モニターの [確認と作成] タブのスクリーンショット](./media/connection-monitor-2-preview/review-create-cm.png)

接続モニター (プレビュー) により、接続モニター リソースがバックグラウンドで作成されます。

## <a name="create-test-groups-in-a-connection-monitor"></a>接続モニターでテスト グループを作成する

接続モニターの各テストグループには、ネットワーク パラメーターでテストされるソースとターゲットが含まれています。 それらは、テスト構成でのチェックの失敗率と RTT についてテストされます。

Azure portal を使用して、接続モニターでテスト グループを作成するには、次のフィールドの値を指定します。

* **[テスト グループの無効化]** – このフィールドをオンにすると、テスト グループで指定されているすべてのソースとターゲットに対する監視を無効にできます。 既定ではオフになっています。
* **[名前]** – テスト グループの名前です。
* **[ソース]** – エージェントがインストールされていれば、Azure VM でもオンプレミスのコンピューターでもソースとして指定できます。 ソース用のエージェントをインストールするには、「[監視エージェントをインストールする](https://docs.microsoft.com/azure/network-watcher/connection-monitor-preview#install-monitoring-agents)」を参照してください。
   * Azure エージェントを選択するには、 **[Azure エージェント]** タブを選択します。ここでは、接続モニターを作成するときに指定したリージョンにバインドされている VM のみが表示されます。 既定では、VM は属しているサブスクリプションにグループ化されます。 これらのグループは折りたたまれています。 
   
       サブスクリプション レベルから階層内の他のレベルにドリルダウンできます。

      **サブスクリプション** > **リソース グループ** > **VNET** > **サブネット** > **エージェントがインストールされている VM**

      また、 **[グループ化]** フィールドの値を変更して、他のレベルからツリーを開始することもできます。 たとえば、仮想ネットワークでグループ化すると、エージェントがインストールされている VM は階層 **VNET** > **サブネット** > **エージェントがインストールされている VM** に表示されます。

      ![接続モニターの [ソースの追加] パネルと [Azure エージェント] タブを示すスクリーンショット](./media/connection-monitor-2-preview/add-azure-sources.png)

   * オンプレミスのエージェントを選択するには、 **[Non–Azure Agents]\(非 Azure エージェント\)** タブを選択します。既定では、エージェントはリージョンごとにワークスペースにグループ化されます。 これらのワークスペースのすべてに、Network Performance Monitor ソリューションが構成されます。 
   
       ワークスペースに Network Performance Monitor ソリューションを追加する必要がある場合は、[Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.NetworkMonitoringOMS?tab=Overview) から入手します。 Network Performance Monitor を追加する方法について詳しくは、「[Azure Monitor での監視ソリューション](https://docs.microsoft.com/azure/azure-monitor/insights/solutions)」をご覧ください。 
   
       **[接続モニターの作成]** ビューの **[基本]** タブでは、既定のリージョンが選択されています。 リージョンを変更する場合、新しいリージョンのワークスペースからエージェントを選択できます。 サブネットでグループ化するように **[グループ化]** フィールドの値を変更することもできます。

      ![接続モニターの [ソースの追加] パネルと [Non-Azure Agents]\(非 Azure エージェント\) タブを示すスクリーンショット](./media/connection-monitor-2-preview/add-non-azure-sources.png)


   * 選択した Azure と Azure 以外のエージェントを確認するには、 **[確認]** をクリックします。

      ![接続モニターの [ソースの追加] パネルと [確認] タブを示すスクリーンショット](./media/connection-monitor-2-preview/review-sources.png)

   * ソースの設定が終わったら、 **[ソースの追加]** パネルの下部にある **[完了]** を選択します。

* **[ターゲット]** – Azure VM または任意のエンドポイント (パブリック IP、URL、FQDN) をターゲットとして指定することにより、それらへの接続を監視できます。 1 つのテスト グループに、Azure VM、Office 365 URL、Dynamics 365 URL、カスタム エンドポイントを追加できます。

    * Azure VM をターゲットとして選択するには、 **[Azure VM]** タブを選択します。既定では、Azure VM は、 **[接続モニターの作成]** ビューの **[基本]** タブで選択したのと同じリージョン内のサブスクリプション階層にグループ化されます。リージョンを変更し、新しく選択したリージョンから Azure VM を選択できます。 その後、Azure エージェント レベルと同じように、サブスクリプション レベルから階層内の他のレベルにドリルダウンできます。

       ![[ターゲットの追加] ペインの [Azure VM] タブが示されているスクリーンショット](./media/connection-monitor-2-preview/add-azure-dests1.png)

       ![[ターゲットの追加] ペインのサブスクリプション レベルが示されているスクリーンショット](./media/connection-monitor-2-preview/add-azure-dests2.png)

    * ターゲットとしてのエンドポイントを選択するには、 **[エンドポイント]** タブを選択します。エンドポイントの一覧には、Office 365 のテスト URL と Dynamics 365 のテスト URL が含まれ、名前でグループ化されています。 これらのエンドポイントに加えて、同じ接続モニターの他のテスト グループに作成されたエンドポイントを選択できます。 
    
        新しいエンドポイントを追加するには、右上隅の **[+ エンドポイント]** を選択します。 次に、エンドポイントの名前と、URL、IP、または FQDN を指定します。

       ![接続モニターのターゲットとしてエンドポイントを追加する場所を示すスクリーンショット](./media/connection-monitor-2-preview/add-endpoints.png)

    * 選択した Azure VM とエンドポイントを確認するには、 **[確認]** タブを選択します。
    * ターゲットの選択が終わったら、 **[完了]** を選択します。

* **[テスト構成]** – テスト グループ内のテスト構成を関連付けることができます。 Azure portal では、テスト グループごとに 1 つのテスト構成だけが許可されますが、ARMClient を使用してさらに追加できます。

    * **[名前]** – テスト構成の名前です。
    * **[プロトコル]** – TCP、ICMP、または HTTP を選択します。 HTTP を HTTPS に変更するには、プロトコルとして **[HTTP]** を、ポートとして **[443]** を選択します。
        * **[Create network test configuration]\(ネットワーク テスト構成の作成\)** – このチェック ボックスは、 **[プロトコル]** フィールドで **[HTTP]** を選択した場合にのみ表示されます。 構成の別の場所で指定したのと同じソースおよびターゲットを使用して別のテスト構成を作成するには、このボックスをオンにします。 新しく作成したテスト構成は、`<the name of your test configuration>_networkTestConfig` という名前になります。
        * **[Traceroute の無効化]** – このフィールドは、プロトコルが TCP または ICMP であるテスト グループに適用されます。 このボックスをオンにすると、ソースでのトポロジとホップバイホップ RTT の検出が停止します。
    * **[接続先ポート]** – このフィールドは、選択したターゲット ポートでカスタマイズできます。
    * **[テストの頻度]** – このフィールドを使用して、指定したプロトコルとポートでソースがターゲットに ping を実行する頻度を選択します。 30 秒、1 分、5 分、15 分、30 分のいずれかを選択できます。 ソースでは、選択した値に基づいて、ターゲットへの接続がテストされます。  たとえば、30 秒を選択すると、ソースにより、少なくとも 30 秒に 1 回、ターゲットへの接続が確認されます。
    * **[成功のしきい値]** – 以下のネットワーク パラメーターにしきい値を設定できます。
       * **[チェックの失敗]** – 指定した条件で行われるソースによるターゲットへの接続の確認で、失敗してもかまわないチェックの割合を設定します。 TCP または ICMP プロトコルでは、失敗したチェックの割合はパケット損失の割合と同等と考えられます。 HTTP プロトコルでは、このフィールドは、応答を受け取らなかった HTTP 要求の割合を表します。
       * **[ラウンド トリップ時間]** – テスト構成でソースがターゲットに接続するのにかかってもかまわない時間をミリ秒で設定します。
    
       ![接続モニターでテスト構成を設定する場所を示すスクリーンショット](./media/connection-monitor-2-preview/add-test-config.png)


## <a name="scale-limits"></a>スケールの上限

接続モニターには、次のようなスケール制限があります。

* 1 つのリージョンの 1 つのサブスクリプションあたりの接続モニターの最大数: 100
* 接続モニターあたりのテスト グループの最大数: 20
* 接続モニターあたりのソースとターゲットの最大数: 100
* 接続モニターあたりのテスト構成の最大数: 2 (Azure portal を使用した場合)

## <a name="next-steps"></a>次のステップ

* [監視データを分析してアラートを設定する方法](https://docs.microsoft.com/azure/network-watcher/connection-monitor-preview#analyze-monitoring-data-and-set-alerts)を確認する
* [ネットワークの問題を診断する方法](https://docs.microsoft.com/azure/network-watcher/connection-monitor-preview#diagnose-issues-in-your-network)を確認する
