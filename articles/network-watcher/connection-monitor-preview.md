---
title: 接続モニター (プレビュー) | Microsoft Docs
description: 接続モニター (プレビュー) を使用して分散環境でネットワーク通信を監視する方法について説明します。
services: network-watcher
documentationcenter: na
author: vinynigam
manager: agummadi
editor: ''
tags: azure-resource-manager
ms.service: network-watcher
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/27/2020
ms.author: vinigam
ms.custom: mvc
ms.openlocfilehash: 0cb51cd224145e7fe359e2b14a87ed2b87b18c26
ms.sourcegitcommit: 97a0d868b9d36072ec5e872b3c77fa33b9ce7194
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/04/2020
ms.locfileid: "87563026"
---
# <a name="network-connectivity-monitoring-with-connection-monitor-preview"></a>接続モニター (プレビュー) によるネットワーク接続の監視

接続モニター (プレビュー) では、Azure Network Watcher での統合されたエンド ツー エンドの接続監視が提供されます。 接続モニター (プレビュー) の機能では、ハイブリッド デプロイと Azure クラウド デプロイがサポートされています。 Network Watcher には、Azure のデプロイに対する接続に関連したメトリックを監視、診断、表示するためのツールが用意されています。

接続モニター (プレビュー) の使用例を次に示します。

- フロントエンド Web サーバー VM と、多層アプリケーション内のデータベース サーバー VM が通信している。 2 つの VM 間のネットワーク接続を確認したい。
- 米国東部リージョンの VM から、米国中部リージョンの VM に ping を実行して、リージョン間のネットワーク待ち時間を比較したい。
- ワシントン州シアトルと、バージニア州アッシュバーンに複数のオンプレミス オフィス サイトがある。 オフィス サイトは Office 365 の URL に接続している。 Office 365 URL のユーザーについて、シアトルとアッシュバーンの間で待機時間を比較する。
- ハイブリッド アプリケーションで Azure Storage エンドポイントに接続する必要がある。 オンプレミスのサイトと Azure アプリケーションは、同じ Azure Storage エンドポイントに接続する。 オンプレミス サイトの待機時間と、Azure アプリケーションの待機時間を比較したい。
- オンプレミスのセットアップと、クラウド アプリケーションがホストされている Azure VM 間の接続を確認したい。

プレビュー フェーズの接続モニターでは、Network Watcher の[接続モニター](https://docs.microsoft.com/azure/network-watcher/network-watcher-monitoring-overview#monitor-communication-between-a-virtual-machine-and-an-endpoint)機能と、Network Performance Monitor (NPM) の[サービス接続モニター](https://docs.microsoft.com/azure/azure-monitor/insights/network-performance-monitor-service-connectivity)機能の 2 つが組み合わされています。

接続モニター (プレビュー) の利点を次に示します。

* Azure とハイブリッドの監視のニーズに対応した、統合された直感的なエクスペリエンス
* クロス リージョン、クロス ワークスペースの接続の監視
* プローブ頻度の増加、およびネットワーク パフォーマンスの可視性の向上
* ハイブリッド デプロイでのアラートの高速化
* HTTP、TCP、ICMP に基づく接続チェックのサポート 
* Azure と Azure 以外のテストのセットアップに対するメトリックと Log Analytics のサポート

![接続モニターと Azure VM、Azure 以外のホスト、エンドポイント、データ ストレージの場所との間の対話方法を示す図](./media/connection-monitor-2-preview/hero-graphic.png)

接続モニター (プレビュー) を使用して監視を始めるには、次の手順のようにします。 

1. 監視エージェントをインストールします。
1. サブスクリプションで Network Watcher を有効にします。
1. 接続モニターを作成します。
1. データ分析とアラートを設定します。
1. ネットワークの問題を診断します。

以降のセクションではこれらの手順についてさらに詳しく説明します。

## <a name="install-monitoring-agents"></a>監視エージェントをインストールする

接続モニターでは、軽量の実行可能ファイルを使用して接続チェックが実行されます。  Azure 環境とオンプレミス環境両方からの接続チェックがサポートされています。 使用する実行可能ファイルは、VM が Azure とオンプレミスのどちらでホストされているかによって異なります。

### <a name="agents-for-azure-virtual-machines"></a>Azure 仮想マシンのエージェント

接続モニターにより Azure VM が監視ソースとして認識されるようにするには、Network Watcher エージェント仮想マシン拡張機能を VM にインストールします。 この拡張機能は、"*Network Watcher 拡張機能*" とも呼ばれます。 Azure 仮想マシンでは、エンドツーエンドの監視とその他の高度な機能をトリガーするために拡張機能が必要です。 

[VM を作成する](https://docs.microsoft.com/azure/network-watcher/connection-monitor#create-the-first-vm)ときに、Network Watcher 拡張機能をインストールできます。 また、[Linux](https://docs.microsoft.com/azure/virtual-machines/extensions/network-watcher-linux) 用と [Windows](https://docs.microsoft.com/azure/virtual-machines/extensions/network-watcher-windows) 用の Network Watcher 拡張機能を別々に、インストール、構成、トラブルシューティングすることもできます。

ネットワーク セキュリティ グループ (NSG) またはファイアウォールの規則により、ソースとターゲットの間の通信がブロックされる場合があります。 接続モニターを使うと、この問題を検出し、トポロジに診断メッセージとして表示できます。 接続監視を有効にするには、NSG とファイアウォール規則で、ソースとターゲットの間の TCP または ICMP 経由のパケットが許可されるようにします。

### <a name="agents-for-on-premises-machines"></a>オンプレミス コンピューター用のエージェント

接続モニターで、オンプレミスのコンピューターが監視のソースとして認識されるようにするには、コンピューターに Log Analytics エージェントをインストールします。 その後、Network Performance Monitor ソリューションを有効にします。 これらのエージェントは Log Analytics ワークスペースにリンクされているので、監視を開始するには、ワークスペース ID とプライマリ キーをセットアップする必要があります。

Windows コンピューター用の Log Analytics エージェントをインストールする方法については、「[Windows 用の Azure Monitor 仮想マシン拡張機能](https://docs.microsoft.com/azure/virtual-machines/extensions/oms-windows)」を参照してください。

パスにファイアウォールまたはネットワーク仮想アプライアンス (NVA) が含まれている場合は、ターゲットに到達可能であることを確認します。

## <a name="enable-network-watcher-on-your-subscription"></a>サブスクリプションで Network Watcher を有効にする

仮想ネットワークが含まれるすべてのサブスクリプションは、Network Watcher で有効になります。 サブスクリプションで仮想ネットワークを作成すると、その仮想ネットワークのリージョンとサブスクリプションで、Network Watcher が自動的に有効になります。 この自動有効化により、リソースが影響を受けたり、料金が発生したりすることはありません。 Network Watcher がサブスクリプションで明示的に無効になっていないことを確認してください。 

詳細については、[Network Watcher の有効化](https://docs.microsoft.com/azure/network-watcher/network-watcher-create)に関する記事をご覧ください。

## <a name="create-a-connection-monitor"></a>接続モニターを作成する 

接続モニターでは、一定の間隔で通信が監視されます。 それにより、到達可能性と待機時間の変化が通知されます。 また、ソース エージェントとターゲット エンドポイントの間の現在および過去のネットワーク トポロジを確認することもできます。

監視エージェントがインストールされている Azure VM またはオンプレミス コンピューターを、ソースにすることができます。 ターゲット エンドポイントとしては、Office 365 URL、Dynamics 365 URL、カスタム URL、Azure VM リソース ID、IPv4、IPv6、FQDN、または任意のドメイン名を使用できます。

### <a name="access-connection-monitor-preview"></a>接続モニター (プレビュー) にアクセスする

1. Azure portal のホーム ページで、 **[Network Watcher]** に移動します。
1. 左側の **[監視]** セクションで、 **[接続モニター (プレビュー)]** を選択します。
1. 接続モニター (プレビュー) で作成されたすべての接続モニターが表示されます。 接続モニターの従来のエクスペリエンスで作成された接続モニターを表示するには、 **[接続モニター]** タブに移動します。

    ![接続モニター (プレビュー) で作成されたすべての接続モニターを示すスクリーンショット](./media/connection-monitor-2-preview/cm-resource-view.png)


### <a name="create-a-connection-monitor"></a>接続モニターを作成する

接続モニター (プレビュー) で作成する接続モニターでは、オンプレミスのコンピューターと Azure VM の両方をソースとして追加できます。 これらの接続モニターでは、エンドポイントへの接続も監視できます。 エンドポイントは、Azure または他の任意の URL や IP 上のどこにあってもかまいません。

接続モニター (プレビュー) には、次のエンティティが含まれています。

* **接続モニター リソース** – リージョン固有の Azure リソース。 以下のすべてのエンティティが、接続モニター リソースのプロパティです。
* **エンドポイント** –接続チェックに含まれるソースまたはターゲット。 エンドポイントの例としては、Azure VM、オンプレミスのエージェント、URL、IP などがあります。
* **テスト構成** – テスト用のプロトコル固有の構成。 選択したプロトコルに基づいて、ポート、しきい値、テストの頻度、その他のパラメーターを定義できます。
* **テスト グループ** – ソース エンドポイント、ターゲット エンドポイント、テスト構成が含まれるグループ。 接続モニターには、複数のテスト グループを含めることができます。
* **テスト** – ソース エンドポイント、ターゲット エンドポイント、テスト構成の組み合わせ。 テストは、監視データを入手できる最も小さいレベルです。 監視データには、失敗したチェックの割合と、ラウンドトリップ時間 (RTT) が含まれます。

 ![テスト グループとテストの関係が定義されている接続モニターを示す図](./media/connection-monitor-2-preview/cm-tg-2.png)

[Azure portal](connection-monitor-preview-create-using-portal.md) または [ARMClient](connection-monitor-preview-create-using-arm-client.md) を使用して、接続モニターのプレビューを作成できます。

テスト グループに追加したすべてのソース、ターゲット、テスト構成は、個々のテストに分割されます。 ソースとターゲットの分割方法の例を次に示します。

* テスト グループ: TG1
* ソース: 3 (A、B、C)
* 宛先: 2 (D、E)
* テスト構成: 2 (Config 1、Config 2)
* 作成される総テスト数: 12

| テスト番号 | ソース | 到着地 | テスト構成 |
| --- | --- | --- | --- |
| 1 | A | D | Config 1 |
| 2 | A | D | Config 2 |
| 3 | A | E | Config 1 |
| 4 | A | E | Config 2 |
| 5 | B | D | Config 1 |
| 6 | B | D | Config 2 |
| 7 | B | E | Config 1 |
| 8 | B | E | Config 2 |
| 9 | C | D | Config 1 |
| 10 | C | D | Config 2 |
| 11 | C | E | Config 1 |
| 12 | C | E | Config 2 |

### <a name="scale-limits"></a>スケールの上限

接続モニターには、次のようなスケール制限があります。

* 1 つのリージョンの 1 つのサブスクリプションあたりの接続モニターの最大数: 100
* 接続モニターあたりのテスト グループの最大数: 20
* 接続モニターあたりのソースとターゲットの最大数: 100
* 接続モニターあたりのテスト構成の最大数: 
    * 20 (ARMClient を使用した場合)
    * 2 (Azure portal を使用した場合)

## <a name="analyze-monitoring-data-and-set-alerts"></a>監視データを分析してアラートを設定する

接続モニターを作成すると、ソースにより、テスト構成に基づいてターゲットへの接続のチェックが行われます。

### <a name="checks-in-a-test"></a>テストでのチェック

テスト構成で選択したプロトコルに基づいて、接続モニター (プレビュー) により、ソースとターゲットのペアに対する一連のチェックが実行されます。 チェックは、選択したテストの頻度に従って実行されます。

HTTP を使用した場合、サービスにより、応答コードを返した HTTP 応答の数が計算されます。 その結果によって、失敗したチェックの割合が判定されます。 RTT を計算するため、サービスでは HTTP の呼び出しと応答の間の時間が測定されます。

TCP または ICMP を使用した場合、サービスでは、パケット損失率を計算して、失敗したチェックの割合が決定されます。 RTT を計算するため、サービスでは、送信されたパケットに対する受信確認 (ACK) を受け取るのにかかった時間が測定されます。 ネットワーク テスト用に Traceroute データを有効にした場合は、オンプレミスのネットワークに対するホップバイホップの損失と待ち時間を確認できます。

### <a name="states-of-a-test"></a>テストの状態

チェックによって返されるデータに基づいて、テストは次のような状態になる可能性があります。

* **合格** – 失敗したチェックの割合および RTT の実際の値が、指定したしきい値を超えていません。
* **失敗** – 失敗したチェックの割合または RTT の実際の値が、指定したしきい値を超えました。 しきい値が指定されていない場合は、失敗したチェックの割合が 100 のときに、テストは失敗状態になります。
* **警告** – 失敗したチェックの割合に対して条件が指定されませんでした。 条件が指定されていない場合は、接続モニター (プレビュー) によって自動的にしきい値が割り当てられます。 そのしきい値を超えると、テストの状態は警告に変わります。

### <a name="data-collection-analysis-and-alerts"></a>データの収集、分析、アラート

接続モニター (プレビュー) によって収集されたデータは、Log Analytics ワークスペースに格納されます。 このワークスペースは、接続モニターを作成したときに設定されています。 

監視データは Azure Monitor メトリックでも使用できます。 Log Analytics を使用すると、監視データを必要な限りいつまでも保持できます。 既定では、メトリックは Azure Monitor によって 30 日間だけ保管されます。 

[データに対してメトリックに基づくアラートを設定する](https://azure.microsoft.com/blog/monitor-at-scale-in-azure-monitor-with-multi-resource-metric-alerts/)ことができます。

#### <a name="monitoring-dashboards"></a>監視ダッシュボード

監視ダッシュボードには、サブスクリプション、リージョン、タイムスタンプ、ソース、およびターゲットの種類でアクセスできる接続モニターの一覧が表示されます。

Network Watcher から接続モニター (プレビュー) にアクセスし、次の方法でデータを表示できます。

* **[接続モニター]** – 自分のサブスクリプション、リージョン、タイムスタンプ、ソース、ターゲットの種類に対して作成されたすべての接続モニターの一覧です。 このビューが既定値です。
* **[テスト グループ]** – 自分のサブスクリプション、リージョン、タイムスタンプ、ソース、ターゲットの種類に対して作成されたすべてのテスト グループの一覧です。 これらのテスト グループは、接続モニターではフィルター処理されません。
* **[テスト]** – 自分のサブスクリプション、リージョン、タイムスタンプ、ソース、ターゲットの種類に対して実行されたすべてのテストの一覧です。 これらのテストは、接続モニターまたはテスト グループではフィルター処理されません。

次の図では、矢印 1 で 3 つのデータ ビューが示されています。

ダッシュボードでは、各接続モニターを展開して、そのテスト グループを表示できます。 その後、各テスト グループを展開して、テスト グループで実行されたテストを確認できます。 

一覧は、以下に基づいてフィルター処理できます。

* **最上位のフィルター** – サブスクリプション、リージョン、タイムスタンプ、ソース、ターゲットの種類を選択します。 下の図のボックス 2 を参照してください。
* **状態ベースのフィルター** – 接続モニター、テスト グループ、またはテストの状態によるフィルターです。 下の図の矢印 3 を参照してください。
* **カスタム フィルター** – 汎用検索を行うには、 **[すべて選択]** を選択します。 特定のエンティティで検索するには、ドロップダウン リストから選択します。 下の図の矢印 4 を参照してください。

![接続モニター (プレビュー) で接続モニター、テスト グループ、テストのビューをフィルター処理する方法を示すスクリーンショット](./media/connection-monitor-2-preview/cm-view.png)

たとえば、接続モニター (プレビュー) でソース IP が 10.192.64.56 であるすべてのテストを確認するには:
1. ビューを **[テスト]** に変更します。
1. 検索フィールドに、「*10.192.64.56*」と入力します
1. ドロップダウン リストで、 **[ソース]** を選択します。

接続モニター (プレビュー) でソース IP が 10.192.64.56 である失敗したテストだけを表示するには、次のようにします。
1. ビューを **[テスト]** に変更します。
1. 状態ベースのフィルターで、 **[失敗]** を選択します。
1. 検索フィールドに、「*10.192.64.56*」と入力します
1. ドロップダウン リストで、 **[ソース]** を選択します。

接続モニター (プレビュー) でターゲットが outlook.office365.com である失敗したテストだけを表示するには:
1. ビューを **[テスト]** に変更します。
1. 状態ベースのフィルターで、 **[失敗]** を選択します。
1. 検索フィールドに、「*outlook.office365.com*」と入力します
1. ドロップダウン リストで、 **[ターゲット]** を選択します。

   ![ターゲット Outlook.Office365.com に対する失敗したテストのみを表示するようにフィルター処理されたビューを示すスクリーンショット](./media/connection-monitor-2-preview/tests-view.png)

接続モニターの RTT の傾向と失敗したチェックの割合を表示するには:
1. 調査する接続モニターを選択します。 既定では、監視データはテスト グループ別に整理されています。

   ![テスト グループ別に表示された、接続モニターのメトリックを示すスクリーンショット](./media/connection-monitor-2-preview/cm-drill-landing.png)

1. 調査するテスト グループを選択します。

   ![テスト グループを選択する場所を示すスクリーンショット](./media/connection-monitor-2-preview/cm-drill-select-tg.png)

    RTT または失敗したチェックの割合に基づいて、テスト グループの失敗したテストの上位 5 件が表示されます。 テストごとに、RTT と失敗したチェックの割合の傾向線が表示されます。
1. 一覧からテストを選択するか、調査する別のテストを選択します。 時間間隔と失敗したチェックの割合について、しきい値と実際の値が表示されます。 RTT の場合、しきい値、平均値、最小値、および最大値が表示されます。

   ![RTT と失敗したチェックの割合のテスト結果を示すスクリーンショット](./media/connection-monitor-2-preview/cm-drill-charts.png)

1. さらに多くのデータを表示するには、期間を変更します。
1. ソース、ターゲット、またはテスト構成を表示するには、ビューを変更します。 
1. 失敗したテストに基づいてソースを選択し、失敗したテストの上位 5 件を調査します。 たとえば、接続モニターで関連するテストを調査する場合は、 **[View by]\(表示方法\)**  >  **[ソース]** および **[View by]\(表示方法\)**  >  **[ターゲット]** を選択します。

   ![失敗したテストの上位 5 つのパフォーマンス メトリックを示すスクリーンショット](./media/connection-monitor-2-preview/cm-drill-select-source.png)

テスト グループの RTT の傾向と失敗したチェックの割合を表示するには:

1. 調査するテスト グループを選択します。 

    既定では、監視データは、ソース、ターゲット、およびテスト構成 (テスト) ごとに整理されています。 後で、テスト グループからソース、ターゲット、またはテスト構成にビューを変更できます。 次に、失敗したテストの上位 5 件を調査するエンティティを選択します。 たとえば、選択した接続モニターで関連するテストを調査するには、ビューをソースとターゲットに変更します。
1. 調査するテストを選択します。

   ![テストを選択する場所を示すスクリーンショット](./media/connection-monitor-2-preview/tg-drill.png)

    時間間隔と失敗したチェックの割合について、しきい値と実際の値が表示されます。 RTT の場合、しきい値、平均値、最小値、および最大値が表示されます。 また、選択したテストに対して生成されたアラートも表示されます。
1. さらに多くのデータを表示するには、期間を変更します。

テストの RTT の傾向と失敗したチェックの割合を表示するには:
1. 調査するソース、ターゲット、テスト構成を選択します。

    時間間隔と失敗したチェックの割合について、しきい値と実際の値が表示されます。 RTT の場合、しきい値、平均値、最小値、および最大値が表示されます。 また、選択したテストに対して生成されたアラートも表示されます。

   ![テストのメトリックを示すスクリーンショット](./media/connection-monitor-2-preview/test-drill.png)

1. ネットワーク トポロジを表示するには、 **[トポロジ]** を選択します。

   ![ネットワーク トポロジのタブを示すスクリーンショット](./media/connection-monitor-2-preview/test-topo.png)

1. 特定された問題を確認するには、トポロジでパスの任意のホップを選択します。 (これらのホップは Azure リソースです)。現在、この機能は、オンプレミスのネットワークに対しては使用できません。

   ![[トポロジ] タブで選択したホップ リンクを示すスクリーンショット](./media/connection-monitor-2-preview/test-topo-hop.png)

#### <a name="log-queries-in-log-analytics"></a>Log Analytics でのログ クエリ

監視データのカスタム ビューを作成するには、Log Analytics を使用します。 UI に表示されるすべてのデータは、Log Analytics からのものです。 リポジトリ内のデータを対話形式で分析できます。 Log Analytics に基づく Agent Health または他のソリューションからのデータを関連付けます。 Excel や Power BI にデータをエクスポートするか、または共有可能なリンクを作成します。

#### <a name="metrics-in-azure-monitor"></a>Azure Monitor のメトリック

接続モニター (プレビュー) エクスペリエンスの前に作成された接続モニターでは、全部で次の 4 つメトリックを使用できます: 失敗したプローブの割合、AverageRoundtripMs、ChecksFailedPercent (プレビュー)、RoundTripTimeMs (プレビュー)。 接続モニター (プレビュー) エクスペリエンスで作成された接続モニターでは、" *(プレビュー)* " というタグが付いたメトリックに対してのみデータを使用できます。

![接続モニター (プレビュー) のメトリックを示すスクリーンショット](./media/connection-monitor-2-preview/monitor-metrics.png)

メトリックを使用するときは、リソースの種類を Microsoft.Network/networkWatchers/connectionMonitors に設定します

| メトリック | Display name | ユニット | 集計の種類 | 説明 | Dimensions |
| --- | --- | --- | --- | --- | --- |
| ProbesFailedPercent | 失敗したプローブの割合 | パーセント | Average | 失敗した接続監視プローブの割合。 | ディメンションなし |
| AverageRoundtripMs | Avg.ラウンド トリップ時間 (ミリ秒) | ミリ秒 | Average | ソースと接続先の間で送信された接続監視プローブのネットワーク RTT。 |             ディメンションなし |
| ChecksFailedPercent (プレビュー) | チェックの失敗率 (%) (プレビュー) | パーセント | Average | テストで失敗したチェックの割合。 | ConnectionMonitorResourceId <br>SourceAddress <br>SourceName <br>SourceResourceId <br>SourceType <br>Protocol <br>DestinationAddress <br>[DestinationName] <br>DestinationResourceId <br>[DestinationType] <br>DestinationPort <br>TestGroupName <br>TestConfigurationName <br>リージョン |
| RoundTripTimeMs (プレビュー) | ラウンド トリップ時間 (ミリ秒) (プレビュー) | ミリ秒 | Average | ソースとターゲットの間で送信されたチェックの RTT。 これは平均値ではありません。 | ConnectionMonitorResourceId <br>SourceAddress <br>SourceName <br>SourceResourceId <br>SourceType <br>Protocol <br>DestinationAddress <br>[DestinationName] <br>DestinationResourceId <br>[DestinationType] <br>DestinationPort <br>TestGroupName <br>TestConfigurationName <br>リージョン |

#### <a name="metric-alerts-in-azure-monitor"></a>Azure Monitor でのメトリック アラート

Azure Monitor でアラートを作成するには:

1. 接続モニター (プレビュー) で作成した接続モニター リソースを選択します。
1. 接続モニターの信号の種類として **[メトリック]** が表示されていることを確認します。
1. **[条件の追加]** で、 **[シグナル名]** として **[ChecksFailedPercent(Preview)]** または **[RoundTripTimeMs(Preview)]** を選択します。
1. **[シグナルの種類]** として、 **[メトリック]** を選択します。 たとえば、 **[ChecksFailedPercent(Preview)]** を選択します。
1. メトリックのすべてのディメンションが一覧表示されます。 ディメンション名とディメンション値を選択します。 たとえば、 **[送信元アドレス]** を選択し、接続モニターのソースの IP アドレスを入力します。
1. **[アラート ロジック]** に、次の詳細を入力します。
   * **[条件タイプ]** : **静的**。
   * **[条件]** と **[しきい値]** 。
   * **[集約粒度] と [評価の頻度]** : 接続モニター (プレビュー) で 1 分ごとにデータを更新します。
1. **[アクション]** で、アクション グループを選択します。
1. アラートの詳細を指定します。
1. アラート ルールを作成します。

   !["ソース アドレス" と "ソース エンド ポイント名" が強調して示されている Azure Monitor の [ルールの作成] 領域を示すスクリーンショット](./media/connection-monitor-2-preview/mdm-alerts.jpg)

## <a name="diagnose-issues-in-your-network"></a>ネットワークの問題を診断する

接続モニター (プレビュー) は、接続モニターとネットワークでの問題を診断するのに役立ちます。 ハイブリッド ネットワークの問題は、前にインストールした Log Analytics エージェントによって検出されます。 Azure の問題は、Network Watcher の拡張機能によって検出されます。 

Azure ネットワークの問題は、ネットワーク トポロジで確認できます。

ソースがオンプレミスの VM であるネットワークの場合、次の問題を検出できます。

* 要求がタイムアウトしました。
* エンドポイントが DNS によって解決されない (一時的または永続的)。 URL が無効。
* ホストが見つからない。
* ソースが宛先に接続できない。 ICMP 経由でターゲットに到達できない。
* 証明書関連の問題: 
    * エージェントの認証にクライアント証明書が必要である。 
    * 証明書再配置リストにアクセスできない。 
    * エンドポイントのホスト名が、証明書のサブジェクト名またはサブジェクト代替名と一致しない。 
    * ソースのローカル コンピューターの信頼された証明機関ストアにルート証明書がない。 
    * SSL 証明書が有効期限切れである、無効である、失効している、または互換性がない。

ソースが Azure VM であるネットワークの場合、次の問題を検出できます。

* エージェントに関する問題:
    * エージェントが停止した。
    * DNS の解決に失敗した。
    * ターゲット ポートでリッスンしているアプリケーションまたはリスナーがない。
    * ソケットを開けなかった。
* VM の状態の問題: 
    * 開始中
    * 停止中
    * 停止済み
    * 割り当て解除中
    * 割り当て解除済み
    * 再起動中
    * 未割り当て
* ARP テーブル エントリがない。
* ローカル ファイアウォールの問題または NSG の規則が原因で、トラフィックがブロックされた。
* 仮想ネットワーク ゲートウェイの問題: 
    * ルートがない。
    * 2 つのゲートウェイ間のトンネルが切断されているか、存在しない。
    * 2 番目のゲートウェイがトンネルによって検出されなかった。
    * ピアリング情報が見つからなかった。
* Microsoft Edge にルートがなかった。
* システム ルートまたは UDR が原因でトラフィックが停止した。
* ゲートウェイの接続で BGP が有効になっていない。
* ロード バランサーで DIP プローブがダウンする。
