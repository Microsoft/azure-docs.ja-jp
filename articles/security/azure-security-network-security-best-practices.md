---
title: Azure のネットワーク セキュリティに関するベスト プラクティス |Microsoft Docs
description: この記事では、Azure の組み込み機能を利用した、ネットワーク セキュリティに関する一連のベスト プラクティスについて説明します。
services: security
documentationcenter: na
author: TomShinder
manager: barbkess
editor: TomShinder
ms.assetid: 7f6aa45f-138f-4fde-a611-aaf7e8fe56d1
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/17/2018
ms.author: TomSh
ms.openlocfilehash: 86246d3d580737837ec07ccdc89ed82914cde209
ms.sourcegitcommit: fec0e51a3af74b428d5cc23b6d0835ed0ac1e4d8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/12/2019
ms.locfileid: "56118413"
---
# <a name="azure-network-security-best-practices"></a>Azure のネットワーク セキュリティに関するベスト プラクティス
[Azure Virtual Machines (VM)](https://azure.microsoft.com/services/virtual-machines/) およびアプライアンスを [Azure Virtual Networks](https://azure.microsoft.com/documentation/services/virtual-network/) に配置することで、他のネットワーク デバイスに接続することができます。 つまり、仮想ネットワーク インターフェイス カードを仮想ネットワークに接続することで、ネットワーク対応デバイス間で TCP/IP ベースの通信を実行できるようになります。 Azure Virtual Network に接続された仮想マシンは、同じ仮想ネットワーク上、異なる仮想ネットワーク上、インターネット上、または独自のオンプレミス ネットワーク上のデバイスに接続できます。

この記事では、Azure のネットワーク セキュリティに関するベスト プラクティスについて説明します。 このベスト プラクティスは、Azure のネットワークに関して Microsoft が蓄積してきたノウハウと、ユーザーの皆様の経験に基づいています。

それぞれのベスト プラクティスについて、この記事では次の事柄を取り上げます。

* ベスト プラクティスの内容
* そのベスト プラクティスをお勧めする理由
* そのベスト プラクティスを実践しなかった場合に発生する可能性がある事態
* そのベスト プラクティスに代わる対処法
* そのベスト プラクティスを実践する方法

この「Azure のネットワーク セキュリティに関するベスト プラクティス」の記事は、この記事の執筆時点における共通認識と、Azure プラットフォームの機能および機能セットに基づいています。 共通認識とテクノロジは時間が経つにつれて変化するため、そのような変化に対応するために、この記事は定期的に更新されます。

次のセクションでは、ネットワーク セキュリティのベスト プラクティスについて説明します。

## <a name="logically-segment-subnets"></a>サブネットを論理的にセグメント化する
Azure Virtual Networks は、オンプレミス ネットワーク上の LAN に似ています。 Azure Virtual Network の背景にある考え方は、ご利用の Azure Virtual Networks をすべて配置できる、単一のプライベート IP アドレス空間ベースのネットワークを作成するということです。 使用可能なプライベート IP アドレス空間は、クラス A (10.0.0.0/8)、クラス B (172.16.0.0/12)、およびクラス C (192.168.0.0/16) の範囲です。

サブネットの論理的なセグメント化に関するベスト プラクティスは次のとおりです。

**ベスト プラクティス**: 大きいアドレス空間をサブネットにセグメント化します。   
**詳細**: [CIDR](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing) ベースのサブネット原則を使用して、サブネットを作成します。

**ベスト プラクティス**: サブネット間のネットワーク アクセス制御を作成します。 サブネット間のルーティングは自動的に行われるため、ルーティング テーブルを手動で構成する必要はありません。 既定では、Azure Virtual Network 上で作成したサブネット間にはネットワーク アクセス制御はありません。   
**詳細**: [ネットワーク セキュリティ グループ](../virtual-network/virtual-networks-nsg.md) (NSG) を使用します。 NSG はシンプルなステートフル パケット インスペクション デバイスであり、5 タプル (発信元 IP、発信元ポート、接続先 IP、接続先ポート、レイヤー 4 プロトコル) アプローチを使用して、ネットワーク トラフィックに対する許可/拒否のルールを作成します。 許可または拒否の対象は、単一の IP アドレス、複数の IP アドレス、またはサブネット全体との間のトラフィックとなります。

サブネット間のネットワーク アクセス制御に NSG を使用すると、同じセキュリティ ゾーンまたはロールに属するリソースを専用のサブネットに配置できます。

## <a name="control-routing-behavior"></a>ルーティングの動作を制御する
Azure Virtual Network 上に仮想マシンを配置した場合、その VM を同じ仮想ネットワーク上にある他の VM に接続することができます。他の VM が異なるサブネット上にある場合でも同様です。 これが可能なのは、この種の通信が許可される一連のシステム ルートが既定で有効になるためです。 これらの既定のルートでは、同じ仮想ネットワーク上にある VM に対して、相互接続およびインターネットとの接続の開始が許可されています (インターネットの場合はインターネットへの送信のみ)。

既定のシステム ルートは多くのデプロイ シナリオで有用ですが、自社のデプロイ状況に合わせてルーティング構成をカスタマイズする必要がある場合もあります。 特定の接続先に到達するように次ホップ アドレスを構成できます。

仮想ネットワーク用のセキュリティ アプライアンスをデプロイする場合は、[ユーザー定義のルート](../virtual-network/virtual-networks-udr-overview.md)を構成することをお勧めします。 これについては、後述の「[重要な Azure サービス リソースへのアクセスを仮想ネットワークのみに限定する](azure-security-network-security-best-practices.md#secure-your-critical-azure-service-resources-to-only-your-virtual-networks)」というタイトルのセクションで説明します。

> [!NOTE]
> ユーザー定義のルートは必須ではありません。通常は既定のシステム ルートが動作します。
>
>

## <a name="enable-forced-tunneling"></a>強制トンネリングを有効にする
強制トンネリングを正しく理解するには、"分割トンネリング" について理解するのが効果的です。 分割トンネリングが最もよく見られるのは、VPN (仮想プライベート ネットワーク) 接続です。 ホテルの部屋から会社のネットワークに確立する VPN 接続を想像してください。 この接続では、企業のリソースにアクセスすることができます。 企業ネットワークに対する通信はすべて VPN トンネルを経由します。

インターネット上のリソースに接続する場合はどうなるのでしょうか。 分割トンネリングを有効にすると、この接続は VPN トンネルを経由せず、インターネットに直接向かいます。 一部のセキュリティの専門家は、これを潜在的なリスクと見なしています。 それらの専門家は、分割トンネリングを無効にし、すべての接続 (インターネットへの接続と企業リソースへの接続) が VPN トンネル経由で行われるようにすることを推奨しています。 分割トンネリングを無効にする利点は、インターネットへの接続が必ず企業ネットワークのセキュリティ デバイス経由で行われるようになることです。 これは、VPN クライアントが VPN トンネル外のインターネットに接続されている場合には該当しません。

では、Azure Virtual Network 上の VM について考えてみましょう。 Azure Virtual Network 用の既定のルートを使用することで、VM でインターネットへのトラフィックを開始できます。 これもセキュリティ リスクとなる可能性があります。これらの発信接続によって、VM の攻撃対象領域が増え、攻撃者に使用される場合があるためです。 そのため、Azure Virtual Network とオンプレミス ネットワークの間でクロスプレミス接続を行う場合は、VM に対して[強制トンネリングを有効にする](../vpn-gateway/vpn-gateway-forced-tunneling-rm.md)ことをお勧めします。 クロスプレミス接続については、後述のネットワークのベスト プラクティスで説明します。

クロスプレミス接続を行わない場合は、NSG (前述) または Azure Virtual Network セキュリティ アプライアンス (次項で説明) を利用して、Azure Virtual Machines からインターネットへの発信接続を防ぐようにしてください。

## <a name="use-virtual-network-appliances"></a>仮想ネットワーク アプライアンスを使用する
NSG とユーザー定義のルーティングでは、[OSI モデル](https://en.wikipedia.org/wiki/OSI_model)のネットワーク層とトランスポート層で一定のネットワーク セキュリティを提供できます。 しかし、場合によっては、より上位のスタックでセキュリティを有効にする必要があります。 このような状況では、Azure のパートナーによって提供されている仮想ネットワーク セキュリティ アプライアンスのデプロイをお勧めします。

Azure ネットワーク セキュリティ アプライアンスを使用すると、ネットワーク レベルの制御で提供されるよりも強力なセキュリティを実現できます。 仮想ネットワーク セキュリティ アプライアンスのネットワーク セキュリティ機能には、次のようなものがあります。


* ファイアウォール
* 侵入検出/侵入防止
* 脆弱性の管理
* アプリケーションの制御
* ネットワーク ベースの異常検出
* Web フィルタリング
* ウイルス対策
* ボットネットからの保護

利用可能な Azure Virtual Network セキュリティ アプライアンスを見つける場合は、[Azure Marketplace](https://azure.microsoft.com/marketplace/) に移動し、"security" や "network security" で検索してください。

## <a name="deploy-perimeter-networks-for-security-zones"></a>セキュリティ ゾーン用の境界ネットワークをデプロイする
[境界ネットワーク](https://docs.microsoft.com/azure/best-practices-network-security) (DMZ ともいう) は、資産とインターネットの間に追加のセキュリティ層を提供する物理的または論理的なネットワーク セグメントです。 境界ネットワークの端にある特殊なネットワーク アクセス制御デバイスでは、ご利用の仮想ネットワークへの必要なトラフィックのみが許可されます。

境界ネットワークは、Azure Virtual Network の端にあるデバイスでのネットワーク アクセス制御の管理、監視、ログ記録、レポート作成に集中できるため便利です。 ここでは通常、分散型サービス拒否 (DDoS) 防止、侵入検出/侵入防止システム (IDS/IPS)、ファイアウォール ルールとポリシー、Web フィルタリング、ネットワーク マルウェア対策などを有効にします。 ネットワーク セキュリティ デバイスは、インターネットと Azure Virtual Network の間に配置され、両方のネットワークに対するインターフェイスが備わっています。

これは境界ネットワークの基本的な設計ですが、バックツーバック、3 分岐、マルチホームなど、多様な設計があります。

高いセキュリティが求められるすべてのデプロイでは、Azure リソース用のネットワーク セキュリティ レベルを強化するために、境界ネットワークの使用を検討することをお勧めします。

## <a name="avoid-exposure-to-the-internet-with-dedicated-wan-links"></a>専用の WAN リンクを使用して、インターネットへの接続を防ぐ
多くの組織で、ハイブリッド IT ルートが選ばれています。 ハイブリッド IT では、企業の情報資産の一部が Azure に移行され、残りはオンプレミスに残されます。 多くの場合、サービスのコンポーネントの一部が Azure で実行され、他のコンポーネントはオンプレミスに残されます。

ハイブリッド IT シナリオでは、通常、なんらかのタイプのクロスプレミス接続が使用されます。 クロスプレミス接続を使用することで、企業ではそのオンプレミス ネットワークを Azure Virtual Network に接続できます。 以下の 2 つのクロスプレミス接続ソリューションを利用できます。

* **サイト間 VPN**: 信頼性の高い確立されたテクノロジですが、接続はインターネット経由で行われます。 帯域幅は、最大約 200 Mbps に制限されています。 サイト間 VPN は一部のシナリオで推奨されるオプションです。これについては、後述の「[仮想マシンへの RDP/SSH アクセスを無効にする](#disable-rdpssh-access-to-virtual-machines)」というセクションで説明します。
* **Azure ExpressRoute**: クロスプレミス接続では [ExpressRoute](https://docs.microsoft.com/azure/expressroute/expressroute-introduction) を使用することをお勧めします。 ExpressRoute は、オンプレミスの場所または Exchange ホスティング プロバイダーとの間に確立する専用 WAN リンクです。 これは電話会社の接続であるため、データはインターネットを経由せずに送信され、インターネット通信の潜在的なリスクにさらされることがありません。

## <a name="optimize-uptime-and-performance"></a>アップタイムとパフォーマンスを最適化する
サービスがダウンしていると、情報にアクセスすることはできません。 データを使用できないほどパフォーマンスが低下している場合、データをアクセス不能と見なすことができます。 セキュリティの観点から、サービスで最適なアップタイムとパフォーマンスを提供できるように、あらゆる手段を講じる必要があります。

可用性とパフォーマンスを向上させるために広く使用され、効果的な手法として、負荷分散があります。 負荷分散とは、サービスを構成する複数のサーバー間でネットワーク トラフィックを分散する手法です。 たとえば、サービスにフロント エンド Web サーバーが含まれている場合は、負荷分散を使用して、トラフィックを複数のフロント エンド Web サーバーに分散させることができます。

このトラフィック分散によって可用性が向上します。いずれかの Web サーバーが使用不能になると、ロード バランサーは、そのサーバーへのトラフィック送信を停止し、オンラインがまだ維持されているサーバーにリダイレクトするためです。 負荷分散はパフォーマンスの向上にも役立ちます。要求を処理するときのプロセッサ、ネットワーク、メモリのオーバーヘッドが負荷分散サーバー全体に分散されるためです。

可能な限り、提供するサービスに合わせて、負荷分散を使用することをお勧めします。 Azure Virtual Network レベルとグローバル レベルの両方でのシナリオを以下に示します。また、各レベルの負荷分散オプションについても説明します。

**シナリオ**: 次のようなアプリケーションがあります。

- 同じユーザー/クライアントのセッションからの要求が同じバックエンド仮想マシンに到達する必要がある。 この例として、ショッピング カート アプリや Web メール サーバーなどがあります。
- セキュリティで保護された接続のみが受け入れられるため、サーバーへの暗号化されていない通信は受け入れられない。
- 実行時間の長い同じ TCP 接続で複数の HTTP 要求を、異なるバックエンド サーバーにルーティングまたは負荷分散する必要がある。

**負荷分散オプション**:HTTP Web トラフィック ロード バランサーである、[Azure Application Gateway](../application-gateway/application-gateway-introduction.md) を使用します。 Application Gateway では、ゲートウェイでのエンド ツー エンド SSL 暗号化と [SSL 終了](../application-gateway/application-gateway-introduction.md)がサポートされています。 そのため、Web サーバーを、暗号化と暗号化解除のオーバーヘッドと、バックエンド サーバーへの暗号化されていないトラフィック フローから解放することができます。

**シナリオ**: Azure 仮想ネットワークに配置されたサーバー間で、インターネットからの着信接続の負荷分散を行う必要があります。 これは次のような場合のシナリオです。

- インターネットからの着信要求を受け入れるステートレス アプリケーションがある。
- スティッキー セッションや SSL オフロードを必要としない。 スティッキー セッションは、サーバー アフィニティを実現するために、アプリケーション負荷分散で使用される手法です。

**負荷分散オプション**:Azure portal を使用して、[外部ロード バランサーを作成](../load-balancer/quickstart-create-basic-load-balancer-portal.md)します。これにより、複数の VM 全体に着信要求を分散し、より高いレベルの可用性を提供することができます。

**シナリオ**: インターネット上にない VM からの接続の負荷分散が必要です。 負荷分散で受け入れられるのは、ほとんどの場合、SQL Server インスタンスや内部 Web サーバーなど、Azure Virtual Network 上のデバイスで開始された接続です。   
**負荷分散オプション**:Azure portal を使用して、[内部ロード バランサーを作成](../load-balancer/quickstart-create-basic-load-balancer-powershell.md)します。これにより、複数の VM 全体に着信要求を分散し、より高いレベルの可用性を提供することができます。

**シナリオ**: グローバル負荷分散が必要です。理由は次のとおりです。

- 複数のリージョン全体に広く分散され、可能な限り高いレベルのアップタイム (可用性) を必要とするクラウド ソリューションがある。
- データセンター全体が利用不可となった場合でも、サービスを利用できるようにするために、可能な限り高いレベルのアップタイムが必要である。

**負荷分散オプション**:Azure Traffic Manager を使用します。 Traffic Manager を使用すると、ユーザーの場所に基づいてサービスへの接続を負荷分散できます。

たとえば、ユーザーが EU からサービスに要求を行った場合、その接続が EU のデータセンター内にあるサービスに転送されます。 Traffic Manager グローバル負荷分散のこの処理によって、パフォーマンスも向上します。遠く離れたデータセンターに接続するよりも、最寄りのデータセンターに接続する方が、高速になるためです。

## <a name="disable-rdpssh-access-to-virtual-machines"></a>仮想マシンへの RDP/SSH アクセスを無効にする
Azure Virtual Machines へのアクセスには、[リモート デスクトップ プロトコル](https://en.wikipedia.org/wiki/Remote_Desktop_Protocol) (RDP) と [Secure Shell](https://en.wikipedia.org/wiki/Secure_Shell) (SSH) プロトコルを使用できます。 これらのプロトコルにより、遠隔地からの管理 VM が有効になります。これらは、データセンター コンピューティングにおける標準プロトコルです。

これらのプロトコルをインターネット経由で使用すると、攻撃者が[ブルート フォース](https://en.wikipedia.org/wiki/Brute-force_attack)手法を使って Azure Virtual Machines へのアクセス権を取得できるという潜在的なセキュリティの問題が生じます。 攻撃者がアクセス権を取得すると、VM を起点として仮想ネットワーク上の他のマシンを侵害したり、Azure の外部にあるネットワーク接続されたデバイスを攻撃したりすることができます。

インターネットから Azure Virtual Machines への RDP および SSH による直接アクセスは無効にすることをお勧めします。 インターネットからの RDP および SSH の直接アクセスを無効にした場合、リモート管理のためのこれらの VM へのアクセスに他のオプションを使用できます。

**シナリオ**: 1 人のユーザーがインターネット経由で Azure 仮想ネットワークに接続できます。   
**オプション**:[ポイント対サイト VPN](../vpn-gateway/vpn-gateway-point-to-site-create.md) は、リモート アクセス VPN によるクライアント/サーバー接続の別名です。 ポイント対サイト接続が確立されると、ユーザーは、ポイント対サイト VPN を介して接続した Azure Virtual Network 上にあるすべての VM に RDP または SSH を使用して接続できます。 この場合、そのユーザーがそれらの VM にアクセスすることを承認されていることが前提となります。

ユーザーは VM に接続する前に 2 回認証を受ける必要があるため、ポイント対サイト VPN は RDP や SSH による直接接続よりも安全です。 最初に、ユーザーは、ポイント対サイト VPN 接続を確立するために認証を受ける (および承認される) 必要があります。 次に、ユーザーは、RDP または SSH セッションを確立するために認証を受ける (および承認される) 必要があります。

**シナリオ**: オンプレミス ネットワーク上のユーザーは、Azure 仮想ネットワーク上の VM に接続することができます。   
**オプション**:[サイト間 VPN](../vpn-gateway/vpn-gateway-site-to-site-create.md) は、インターネット経由でネットワーク全体を別のネットワークに接続します。 サイト間 VPN を使用すると、オンプレミス ネットワークを Azure Virtual Network に接続できます。 オンプレミス ネットワーク上のユーザーは、サイト間 VPN 接続を介して RDP または SSH プロトコルを使用して接続します。 インターネット経由での RDP または SSH による直接アクセスを許可する必要はありません。

**シナリオ**: 専用 WAN リンクを使用して、サイト間 VPN に似た機能を提供します。   
**オプション**:[ExpressRoute](https://azure.microsoft.com/documentation/services/expressroute/) を使用します。 サイト間 VPN に似た機能が提供されます。 主な違いは次のとおりです。

- 専用 WAN リンクではインターネットを経由しません。
- 一般的には専用 WAN リンクの方が安定性とパフォーマンスに優れています。

## <a name="secure-your-critical-azure-service-resources-to-only-your-virtual-networks"></a>重要な Azure サービス リソースへのアクセスを仮想ネットワークのみに限定する
仮想ネットワーク サービス エンドポイントを使用し、直接接続を介して、仮想ネットワークのプライベート アドレス空間を拡張し、仮想ネットワークの ID を Azure サービスに提供します。 エンドポイントを使用することで、重要な Azure サービス リソースへのアクセスを仮想ネットワークのみに限定することができます。 仮想ネットワークから Azure サービスへのトラフィックは常に、Microsoft Azure のバックボーン ネットワーク上に残ります。

サービス エンドポイントには次の利点があります。

- **Azure サービス リソースのセキュリティ強化**:サービス エンドポイントを使用すると、Azure サービス リソースへのアクセスを仮想ネットワークに限定することができます。 サービス リソースを仮想ネットワークに限定することで、リソースへのパブリック インターネット アクセスを完全に排除し、ご利用の仮想ネットワークからのトラフィックのみを許可することにより、セキュリティが向上します。
- **ご利用の仮想ネットワークから Azure サービスへの最適なトラフィック ルーティング**:お客様のオンプレミス、仮想アプライアンス、またはその両方へのインターネット トラフィックが、ご利用の仮想ネットワーク内のすべてのルートにおいて強制されている場合 (強制トンネリング)、Azure サービス へのトラフィックにもそのインターネット トラフィックと同じルートが強制されます。 サービス エンドポイントを使用することで、Azure トラフィックのルーティングを最適化することができます。

  エンドポイントでは常に、ご利用の仮想ネットワークから Azure のバックボーン ネットワーク上のサービスへのサービス トラフィックを直接受け取ります。 Azure のバックボーン ネットワーク上でトラフィックを維持することで、サービス トラフィックに影響を与えることなく、強制トンネリングを通じて、ご利用の仮想ネットワークからの送信インターネット トラフィックの監査と監視を続けることができます。 詳細については、[ユーザー定義のルートと強制トンネリング](../virtual-network/virtual-networks-udr-overview.md)に関するページをご覧ください。

- **管理の手間がかからないシンプルな設定**:ご利用の仮想ネットワークで予約済みのパブリック IP アドレスを使用することなく、IP ファイアウォールを経由して Azure リソースにアクセスできるようになりました。 サービス エンドポイントの設定に NAT やゲートウェイ用のデバイスは必要ありません。 サービス エンドポイントは、サブネット上での単純なクリック操作で構成されます。 エンドポイントを維持するための追加のオーバーヘッドはありません。

サービス エンドポイントと、それらのサービス エンドポイントを利用できる Azure サービスとリージョンの詳細については、「[Virtual network service endpoints](../virtual-network/virtual-network-service-endpoints-overview.md)」 (仮想ネットワークのサービス エンドポイント) を参照してください。

## <a name="next-step"></a>次のステップ
Azure を使用してクラウド ソリューションを設計、デプロイ、管理するときに使用するセキュリティのベスト プラクティスの詳細については、「[Azure セキュリティのベスト プラクティスとパターン](security-best-practices-and-patterns.md)」を参照してください。
