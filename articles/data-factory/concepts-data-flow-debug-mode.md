---
title: マッピング データ フローのデバッグ モード
description: データ フローの構築時に対話型デバッグ セッションを開始する
ms.author: makromer
author: kromerm
ms.reviewer: douglasl
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 09/06/2019
ms.openlocfilehash: 02ec26c80a8a64f88a30ded2067a377c292d621d
ms.sourcegitcommit: 5f7b75e32222fe20ac68a053d141a0adbd16b347
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/31/2020
ms.locfileid: "87475602"
---
# <a name="mapping-data-flow-debug-mode"></a>マッピング データ フローのデバッグ モード

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

## <a name="overview"></a>概要

Azure Data Factory マッピング データ フローのデバッグ モードを使用すると、データ フローの構築およびデバッグ時にデータ シェイプの変換を対話的に監視できます。 デバッグ セッションは、Data Flow のデザイン セッションでも、データ フローのパイプライン デバッグ実行中でも使用できます。 デバッグ モードを有効にするには、デザイン サーフェスの上部にある [Data Flow Debug]\(データ フローのデバッグ\) ボタンを使用します。

![デバッグ スライダー](media/data-flow/debugbutton.png "デバッグ スライダー")

スライダーを有効にすると、使用する統合ランタイム構成を選択するように求めるメッセージが表示されます。 AutoResolveIntegrationRuntime を選択した場合は、60 分の Time to Live が設定された一般的なコンピューティングの 8 個のコアを持つクラスターがスピンアップされます。 データ フロー統合ランタイムの詳細については、[データ フローのパフォーマンス](concepts-data-flow-performance.md#ir)に関するページを参照してください。

![デバッグ IR の選択](media/data-flow/debugbutton2.png "デバッグ IR の選択")

デバッグ モードが有効なときは、アクティブな Spark クラスターを使用して対話的にデータ フローを構築します。 Azure Data Factory でデバッグを無効にすると、セッションは終了します。 デバッグ セッションを有効にしている間に Azure Databricks によって発生する 1 時間あたりの料金を把握しておく必要があります。

ほとんどの場合、デバッグ モードでデータ フローを構築し、ビジネス ロジックを検証してデータ変換を確認してから、Azure Data Factory で作業内容を公開することをお勧めします。 パイプライン パネルの [デバッグ] ボタンを使用して、パイプライン内部のデータ フローをテストします。

## <a name="cluster-status"></a>クラスターの状態

クラスターのデバッグの準備が整うと、デザイン サーフェスの上部にあるクラスター状態インジケーターが緑色に変わります。 クラスターが既に実行されている場合、緑色のインジケーターはほぼ瞬時に表示されます。 デバッグ モードを開始したときにクラスターがまだ実行されていなかった場合は、クラスターが起動するまで 5 分から 7 分待つ必要があります。 インジケーターは、その準備ができるまでスピンします。

デバッグが終了したら、[デバッグ] スイッチをオフにして、Azure Databricks クラスターを終了できるようにし、デバッグ アクティビティについて課金されないようにします。

## <a name="debug-settings"></a>デバッグの設定

デバッグ設定は、Data Flow のキャンバス ツール バーにある [Debug Settings] (デバッグ設定) をクリックすることで編集できます。 ここで、各ソース変換に使用する行制限やファイル ソースを選択できます。 この設定の行制限の対象となるのは、現在のデバッグ セッションのみです。 SQL DW ソースに使用する、ステージングのリンクされたサービスを選択することもできます。 

![デバッグ設定](media/data-flow/debug-settings.png "デバッグの設定")

データフローまたは参照されているデータセットにパラメーターがある場合は、 **[パラメーター]** タブを選択して、デバッグ中に使用する値を指定できます。

![デバッグ設定のパラメーター](media/data-flow/debug-settings2.png "デバッグ設定のパラメーター")

## <a name="data-preview"></a>データのプレビュー

デバッグが有効な場合、下部のパネルに [Data Preview]\(データのプレビュー\) タブが表示されます。 デバッグが有効ではない場合、Data Flow では、各変換に含まれる、または含まれない現在のメタデータのみが [Inspect]\(検査\) タブに表示されます。データのプレビューでは、デバッグ設定で制限として設定した行数のみのクエリが実行されます。 **[最新の情報に更新]** をクリックすると、データのプレビューがフェッチされます。

![データのプレビュー](media/data-flow/datapreview.png "データのプレビュー")

> [!NOTE]
> ファイル ソースでは、読み取られる行ではなく、表示される行のみを制限します。 データセットが非常に大規模な場合は、そのファイルのごく一部を取得して、ご自身のテストに使用することをお勧めします。 [Debug Settings]\(デバッグ設定\) では、ファイル データセットの種類のソースごとに一時ファイルを選択できます。

デバッグ モードで Data Flow を実行している場合、データはシンク変換に書き込まれません。 デバッグ セッションは、変換のテスト ハーネスとして機能することを目的としています。 シンクはデバッグ中には必要ではなく、データ フローでは無視されます。 シンクへのデータの書き込みをテストする場合は、Azure Data Factory パイプラインから Data Flow を実行し、パイプラインからデバッグの実行を使用します。

### <a name="testing-join-conditions"></a>結合条件のテスト

Join、Exists、または Lookup の変換を単体テストする場合、ご自身のテストには必ず小規模な既知のデータを使用するようにしてください。 上述の [Debug Settings]\(デバッグ設定\) オプションを使用すると、ご自身のテストで使用する一時ファイルを設定できます。 これは、大規模なデータセットから行を制限したり、サンプリングしたりするときに、どの行およびどのキーがテストのフローに読み込まれるかを予測できないために必要です。 結果は非決定論的であり、ご自身の結合条件が失敗する可能性があります。

### <a name="quick-actions"></a>クイック アクション

データのプレビューが表示されたら、クイック変換を生成して、列に対する型キャスト、削除、または変更を行うことができます。 列見出しをクリックした後、[データのプレビュー] ツールバーからいずれかのオプションを選択します。

![クイック アクション](media/data-flow/quick-actions1.png "クイック アクション")

[変更] を選択すると、データのプレビューがすぐに更新されます。 新しい変換を生成するには、右上隅にある **[確認]** をクリックします。

![クイック アクション](media/data-flow/quick-actions2.png "クイック アクション")

**[型キャスト]** と **[変更]** では派生列変換が生成され、 **[削除]** では選択変換が生成されます。

![クイック アクション](media/data-flow/quick-actions3.png "クイック アクション")

> [!NOTE]
> データフローを編集する場合は、クイック変換を追加する前にデータのプレビューを再フェッチする必要があります。

### <a name="data-profiling"></a>データ プロファイル

[データのプレビュー] タブで列を選択し、[データのプレビュー] ツール バーで **[統計]** をクリックすると、データ グリッドの右端にグラフがポップアップ表示され、各フィールドに関する詳細な統計情報が示されます。 Azure Data Factory では、表示するグラフの種類のデータ サンプリングに基づいて判断が下されます。 カーディナリティが高いフィールドの既定は NULL/NOT NULL グラフです。一方、カーディナリティが低いカテゴリ データや数値データでは、データ値の頻度を示す棒グラフが表示されます。 また、文字列フィールドの最大/長さ、数値フィールドの最小/最大値、標準偏差、百分位、カウント、および平均も表示されます。

![列の統計](media/data-flow/stats.png "列の統計")

## <a name="next-steps"></a>次のステップ

* データ フローの構築とデバッグが完了したら、[パイプラインからデータ フローを実行します。](control-flow-execute-data-flow-activity.md)
* データ フローでパイプラインをテストする場合は、パイプラインの[デバッグ実行の実行オプションを使用します。](iterative-development-debugging.md)
