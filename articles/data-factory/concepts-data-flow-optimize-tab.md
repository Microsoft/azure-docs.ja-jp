---
title: Azure Data Factory のマッピング データ フローの [最適化] タブ
description: '[最適化] タブのパーティション設定を使用した Azure Data Factory のマッピング データ フローの最適化'
author: kromerm
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.date: 01/31/2019
ms.openlocfilehash: 40023931b2a0b3788a583a5b5240e7916b187e34
ms.sourcegitcommit: 156b313eec59ad1b5a820fabb4d0f16b602737fc
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/18/2019
ms.locfileid: "67190641"
---
# <a name="mapping-data-flow-transformation-optimize-tab"></a>マッピング データ フロー変換の [最適化] タブ

[!INCLUDE [notes](../../includes/data-factory-data-flow-preview.md)]

各 Data Flow 変換には、[最適化] タブがあります。[最適化] タブには、データ フローのパーティション分割を構成するためのオプション設定が含まれています。

<img src="media/data-flow/opt001.png" width="800">

既定の設定では、"現在のパーティション分割を使用" します。 現在のパーティション分割の場合、Azure Data Factory では、Azure Databricks 内で Spark 上で実行されているデータ フローにネイティブのパーティション構成が使用されます。 通常は、これが推奨される方法です。

ただし、パーティション分割を調整したい場合もあります。 たとえば、変換をレイク内の 1 つのファイルに出力する場合は、シンク変換でのパーティション分割のため、[最適化] タブで [単一パーティション] を選択します。

パフォーマンスの観点で、データ変換に使用されているパーティション構成を制御したいケースもあります。 データのパーティション分割を調整すると、全体的なデータ フローのパフォーマンスに好影響を与えることも、悪影響も与えることもある、各計算ノードへのデータの分散とデータの局所性の最適化を一定レベルで制御できます。

いずれかの変換でパーティション分割を変更する場合は、[最適化] タブをクリックし、[Set Partitioning]\(パーティションの設定\) ラジオ ボタンを選択します。 パーティション分割用の一連のオプションが表示されます。 実装するパーティション分割の最適な方法は、データ ボリューム、候補キー、null 値、およびカーディナリティに応じて異なります。 ベスト プラクティスは、既定のパーティション分割から開始して、その後、別のパーティション分割のオプションを試す方法です。 パイプライン内でデバッグ実行を使用してテストを行い、その後、[Monitoring]\(監視\) ビューで各変換グループで費やされた時間と、パーティションの使用状況を確認します。

<img src="media/data-flow/opt002.png" width="600">

### <a name="round-robin"></a>ラウンド ロビン

ラウンド ロビンは、自動的に各パーティションにデータを均等に分散するシンプルなパーティションです。 堅固でスマートなパーティション分割戦略を実装するための適切な候補がないときは、ラウンド ロビンを使用します。 物理パーティションの数を設定できます。

### <a name="hash"></a>Hash

Azure Data Factory は、同様の値を持つ行が同じパーティション内に分類されるように、列のハッシュを生成して統一されたパーティションを生成します。 [ハッシュ] オプションを使用するときは、可能なパーティションの傾斜についてテストします。 物理パーティションの数を設定できます。

### <a name="dynamic-range"></a>動的範囲

動的範囲では、指定した列または式に基づく Spark の動的範囲が使用されます。 物理パーティションの数を設定できます。 

### <a name="fixed-range"></a>固定範囲

パーティション分割されたデータ列内の値に対する固定の範囲を提供する式を作成する必要があります。 パーティションの傾斜を避けるため、このオプションを使用する際は、データについて十分に理解する必要があります。 式に入力する値は、パーティション関数の一部として使用されます。 物理パーティションの数を設定できます。

### <a name="key"></a>キー

データのカーディナリティを十分に理解している場合は、キー パーティション分割が適切なパーティション戦略になるでしょう。 キー パーティション分割では、列内の一意の値ごとにパーティションが作成されます。 パーティションの数は、データ内の一意の値に基づくため、設定することはできません。

## <a name="next-steps"></a>次の手順

[マッピング データ フロー パフォーマンス ガイド](concepts-data-flow-performance.md)
[データ フローの監視](concepts-data-flow-monitoring.md)
