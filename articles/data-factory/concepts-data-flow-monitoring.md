---
title: マッピング データ フローの監視
description: Azure Data Factory でマッピング データ フローを視覚的に監視する方法
author: kromerm
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 04/11/2021
ms.openlocfilehash: 82aba428627cba1a3df26fc67c5da0cde52d368c
ms.sourcegitcommit: b4fbb7a6a0aa93656e8dd29979786069eca567dc
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/13/2021
ms.locfileid: "107309069"
---
# <a name="monitor-data-flows"></a>データ フローの監視

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

データ フローの作成とデバッグが完了したら、データ フローをスケジュールし、そのスケジュールに基づいて、パイプラインのコンテキスト内でデータ フローを実行する必要があります。 Azure Data Factory からパイプラインをスケジュールするときは、トリガーを使用します。 Azure Data Factory のパイプライン ビルダーから [Trigger Now]\(今すぐトリガー\) オプションを使用して単体実行を行い、パイプラインのコンテキスト内でデータ フローをテストすることもできます。

パイプラインを実行するときは、パイプラインとその中に含まれるすべてのアクティビティ (データ フロー アクティビティなど) を監視できます。 左側の Azure Data Factory UI パネル内にある監視アイコンをクリックします。 次のような画面が表示されます。 強調表示されているアイコンを使用すると、パイプライン内のアクティビティ (データ フロー アクティビティなど) にドリルダウンできます。

![スクリーンショットに、詳細を表示するためのパイプラインの選択用のアイコンが示されています。](media/data-flow/mon001.png "データ フローの監視")

実行時間や状態など、このレベルでの統計も表示されます。 アクティビティ レベルの実行 ID は、パイプライン レベルの実行 ID とは異なります。 以前のレベルの実行 ID は、パイプラインの実行 ID です。 眼鏡を選択すると、データ フローの実行に関する詳細が示されます。

![スクリーンショットに、データ フローの実行の詳細を表示する眼鏡アイコンが示されています。](media/data-flow/monitoring-details.png "データ フローの監視")

グラフィカルなノード監視ビューを開いているときは、表示専用のシンプルなバージョンのデータ フロー グラフが表示されます。

![スクリーンショットに、グラフの表示専用バージョンが示されています。](media/data-flow/mon003.png "データ フローの監視")

次のビデオでは、ADF の監視画面からデータ フローのパフォーマンスを監視するようすを簡単に紹介しています。

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4u4mH]

## <a name="view-data-flow-execution-plans"></a>データ フローの実行プランの表示

データ フローが Spark で実行されると、データ フロー全体に基づいて、最適なコード パスが決定されます。 実行パスが別のスケールアウト ノードやデータ パーティション上に出現する場合もあります。 したがって、監視グラフでは、変換の実行パスを考慮して、フローのデザインが表示されています。 個々のノードを選択すると、クラスター上で同時に実行されたコードを表す "グループ" が表示されます。 表示されるタイミングとカウントは、デザイン内の個々のステップではなく、それらのグループを表しています。

![スクリーンショットに、データ フローのページが示されています。](media/data-flow/mon004.png "データ フローの監視")

* 監視ウィンドウ内の空間を選択すると、下部のウィンドウ内の統計に、各シンクのタイミングと行数、および変換系列のシンク データの基になる変換が表示されます。

* 個々の変換を選択すると、パーティションの統計、列数、歪度 (パーティション全体で分散されたデータの均等さ)、尖度 (データのスパイクの程度) を示す追加のフィードバックが右側のパネルに表示されます。

* ノード ビュー内で [シンク] を選択すると、列の系列が表示されます。 データ フローを通じてシンクのランドに列が累積される方法には、3 種類あります。 これらは次のとおりです。

  * 計算:列は、条件付き処理、またはデータ フローの式内で使用しますが、シンク内には置かないでください。
  * 派生:列は、フロー内で生成した新しい列です。つまり、ソース内には存在していなかったものです。
  * マップ:列は、ソースから発生しており、シンク フィールドにマッピングされています。
  * データ フローの状態:実行の現在の状態
  * クラスターの起動時間:データ フロー実行のための JIT Spark コンピューティング環境を取得する時間
  * 変換の数:フロー内で実行されている変換ステップの数
  
![スクリーンショットに、[更新] オプションが示されています。](media/data-flow/monitornew.png "データ フローの監視 新規")

## <a name="total-sink-processing-time-vs-transformation-processing-time"></a>合計シンク処理時間と変換処理時間

各変換ステージには、そのステージを完了するまでの合計時間と、各パーティションの実行時間の合計が含まれます。 [シンク] をクリックすると、"シンク処理時間" が表示されます。 この時間には、変換時間の合計に "*加えて*"、データを保存先ストアに書き込むために要した I/O 時間が含まれます。 シンク処理時間と変換の合計との違いは、データを書き込むための I/O 時間です。

また、ADF パイプラインの監視ビューでデータ フロー アクティビティからの JSON 出力を開くと、各パーティション変換手順の詳細なタイミングも確認できます。 JSON には各パーティションのミリ秒のタイミングが含まれていますが、UX 監視ビューには各パーティションを加算した集計時間が示されます。

```
 {
     "stage": 4,
     "partitionTimes": [
          14353,
          14914,
          14246,
          14912,
          ...
         ]
}
```

### <a name="sink-processing-time"></a>シンク処理時間

マップでシンク変換アイコンを選択すると、右側のスライドイン パネルの下部に "後処理時間" という追加のデータ ポイントが表示されます。 これは、データが読み込まれ、変換され、書き込まれた "*後に*"、Spark クラスターでジョブを実行するために費やされた時間です。 この時間には、接続プールの終了、ドライバーのシャットダウン、ファイルの削除、ファイルの結合などが含まれます。フローで "ファイルの移動" や "1 つのファイルへの出力" などの操作を実行すると、後処理時間の値が増加することがあります。

* ステージ書き込み期間: Synapse SQL のステージング場所にデータを書き込む時間
* テーブル操作 SQL 期間: 一時テーブルからターゲット テーブルへのデータ移動にかかった時間
* 事前 SQL 期間と事後 SQL 期間: 事前および事後のSQL コマンドの実行にかかった時間
* 事前コマンド期間と事後コマンド期間: ファイル ベースのソースまたはシンクに対するすべての事前および事後の操作の実行にかかった時間。 たとえば、処理後にファイルを移動または削除します。
* マージ期間: ファイルのマージにかかった時間。1 つのファイルに書き込むとき、または "列データとしてのファイル名" が使用されるときに、ファイル ベースのシンクにファイルのマージが使用されます。 このメトリックでかなりの時間がかかる場合は、これらのオプションを使用しないようにしてください。
  
## <a name="error-rows"></a>エラー行数

データ フロー シンクでエラー行の処理を有効にすると、監視出力に反映されます。 シンクを [report success on error]\(エラー発生時に成功を報告\) に設定した場合、シンク監視ノードをクリックすると、監視出力に、成功および失敗した行の数が表示されます。

![エラー行数を示すスクリーンショット。](media/data-flow/error-row-2.png "エラー行の監視 (成功)")

[report failure on error]\(エラー発生時に失敗を報告\) を選択すると、同じ出力がアクティビティ監視出力テキストにのみ表示されます。 これは、データ フロー アクティビティが実行の失敗を返したので、詳細な監視ビューを利用できないためです。

![アクティビティ内のエラー行数を示すスクリーンショット。](media/data-flow/error-rows-4.png "エラー行の監視 (失敗)")

## <a name="monitor-icons"></a>監視アイコン

このアイコンは、変換データが既にクラスターにキャッシュされており、タイミングと実行パスでそのことが考慮されていることを示します。

![スクリーンショットに、ディスク アイコンが示されています。](media/data-flow/mon005.png "データ フローの監視")

変換内には、緑色の円のアイコンも表示されます。 これは、データ送信先のシンク数のカウントを示しています。
