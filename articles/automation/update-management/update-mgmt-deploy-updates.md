---
title: Azure Automation Update Management の更新プログラムの展開を作成する方法
description: この記事では、更新プログラムの展開をスケジュールし、その状態を確認する方法について説明します。
services: automation
ms.subservice: update-management
ms.date: 08/20/2020
ms.topic: conceptual
ms.openlocfilehash: 4336ba272dd83ad2a35060c1c7524a564b928484
ms.sourcegitcommit: 6fc156ceedd0fbbb2eec1e9f5e3c6d0915f65b8e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/21/2020
ms.locfileid: "88717695"
---
# <a name="how-to-deploy-updates-and-review-results"></a>更新プログラムを展開して結果を確認する方法

この記事では、更新プログラムの展開をスケジュールし、展開の完了後に処理を確認する方法について説明します。

## <a name="sign-in-to-the-azure-portal"></a>Azure portal にサインインする

[Azure ポータル](https://portal.azure.com)

## <a name="schedule-an-update-deployment"></a>更新プログラムのデプロイをスケジュールする

更新プログラムの展開をスケジュールすると、対象マシンへの更新プログラムの展開を処理する **Patch-MicrosoftOMSComputers**Runbook にリンクされた[スケジュール](../shared-resources/schedules.md) リソースが作成されます。 リリース スケジュールとサービス期間に従って展開をスケジュールし、更新プログラムをインストールする必要があります。 展開に含める更新プログラムの種類を選択できます。 たとえば、緊急更新プログラムやセキュリティ更新プログラムを追加し、更新プログラムのロールアップを除外できます。

>[!NOTE]
>展開の作成後に Azure portal または PowerShell を使用してこのスケジュール リソースを削除した場合、スケジュールされた更新プログラムの展開が破棄され、ポータルからスケジュール リソースを再構成しようとするとエラーが表示されます。 スケジュール リソースは、対応するデプロイ スケジュールを削除することによってのみ削除することができます。  

新しい更新プログラムの展開をスケジュールするには:

1. ご自分の Automation アカウントで、 **[更新の管理]** の **[更新の管理]** に移動し、 **[更新プログラムの展開のスケジュール]** を選択します。

2. **[新しい更新プログラムの展開]** の下の **[名前]** フィールドを使用して、展開に一意の名前を入力します。

3. 更新プログラムの展開の対象となるオペレーティング システムを選択します。

4. **[更新するグループ (プレビュー)]** 領域で、サブスクリプション、リソース グループ、場所、タグを組み合わせたクエリを定義し、展開に含める Azure VM の動的グループを構築します。 詳細については、「[Update Management を利用して動的グループを使用する](update-mgmt-groups.md)」を参照してください。

5. **[更新するマシン]** 領域で、保存した検索またはインポートしたグループを選択するか、ドロップダウン メニューから **[マシン]** を選択し、個々のマシンを選択します。 このオプションを使用すると、各マシンの Log Analytics エージェントの準備状況を確認できます。 Azure Monitor ログでコンピューター グループを作成するさまざまな方法については、[Azure Monitor ログのコンピューター グループ](../../azure-monitor/platform/computer-groups.md)に関するページを参照してください

6. **[更新プログラムの分類]** 領域を使用して、製品の[更新プログラムの分類](update-mgmt-view-update-assessments.md#work-with-update-classifications)を指定します。 製品ごとに、更新プログラムの展開に含めるものを除き、サポート対象の更新プログラムの分類すべての選択を解除します。

    選択した更新プログラムのセットのみを展開で適用する場合は、次の手順で説明するように、 **[更新プログラムの包含/除外]** オプションを構成するときに、事前に選択されている更新プログラムの分類をすべて選択解除する必要があります。 これにより、ターゲット マシンにインストールされているのは、この展開で *[含める]* に指定した更新プログラムのみになります。

7. **[更新プログラムの包含/除外]** 領域を使用して、選択した更新プログラムを展開に追加または除外します。 **[包含/除外]** ページで、包含または除外するサポート技術情報の記事 ID 番号を入力します。

   > [!IMPORTANT]
   > 包含より除外が優先されることを覚えておいてください。 たとえば、`*` の除外ルールを定義すると、Update Management ではすべてのパッチまたはパッケージがインストールから除外されます。 除外されたパッチは、マシンに不足しているものとして表示されます。 Linux マシンでは、除外された依存パッケージを含むパッケージを含めた場合、メイン パッケージはインストールされません。

   > [!NOTE]
   > 置き換え済みの更新プログラムを更新プログラムの展開に含めるように指定することはできません。

8. **[スケジュール設定]** を選択します。 既定の開始時刻は、現在の時刻の 30 分後です。 開始時刻は、10 分後以降の将来の任意の時点に設定できます。

9. **[繰り返し]** フィールドを使用して、展開を 1 回だけ実行するか、定期的なスケジュールを使用するかどうかを指定し、 **[OK]** を選択します。

10. **[事前スクリプトと事後スクリプト (プレビュー)]** 領域で、展開の前後に実行するスクリプトを選択します。 詳細については、「[事前スクリプトと事後スクリプトを管理する](update-mgmt-pre-post-scripts.md)」を参照してください。
    
11. **[メンテナンス期間 (分)]** フィールドを使用して、更新プログラムをインストールするために許容される時間を指定します。 メンテナンス期間を指定するときは、次の詳細を考慮してください。

    * メンテナンス期間によって、インストールされる更新プログラムの数が制御されます。
    * メンテナンス期間の終了が近づいている場合でも、Update Management では、新しい更新プログラムのインストールは停止されません。
    * メンテナンス期間を超過した場合でも、進行中の更新は終了されません。
    * Windows でメンテナンス期間が超過した場合、Service Pack の更新プログラムのインストールに時間がかかることが原因であることがよくあります。

    > [!NOTE]
    > Ubuntu でメンテナンス期間外に更新プログラムが適用されないようにするには、`Unattended-Upgrade` パッケージを再構成して自動更新を無効にします。 パッケージの構成方法については、[Ubuntu サーバー ガイドの自動更新に関するトピック](https://help.ubuntu.com/lts/serverguide/automatic-updates.html)をご覧ください。

12. **[再起動のオプション]** フィールドを使用して、展開中の再起動の処理方法を指定します。 次のオプションを使用できます。 
    * 必要に応じて再起動 (既定値)
    * 常に再起動
    * 再起動しない
    * 再起動のみ (このオプションでは更新プログラムはインストールされません)

    > [!NOTE]
    > **[再起動のオプション]** が **[再起動しない]** に設定されている場合、「[再起動の管理に使われるレジストリ キー](/windows/deployment/update/waas-restart#registry-keys-used-to-manage-restart)」に記載されているレジストリ キーにより、再起動イベントが発生する可能性があります。

13. 展開スケジュールの構成が完了したら、 **[作成]** を選択します。

    ![更新プログラムのスケジュール設定ウィンドウ](./media/update-mgmt-deploy-updates/manageupdates-schedule-win.png)

14. 状態ダッシュボードに戻ります。 **[スケジュールされた更新プログラムの展開]** を選択して、作成した展開スケジュールを表示します。

## <a name="schedule-an-update-deployment-programmatically"></a>プログラムで更新プログラムの展開をスケジュールする

REST API を使用して更新プログラムの展開を作成する方法については、「[ソフトウェア更新プログラムの構成 - 作成](/rest/api/automation/softwareupdateconfigurations/create)」を参照してください。

サンプル Runbook を使用して、週単位の更新プログラムの展開を作成できます。 この Runbook について詳しくは、「[Create a weekly update deployment for one or more VMs in a resource group](https://gallery.technet.microsoft.com/scriptcenter/Create-a-weekly-update-2ad359a1)」(リソース グループ内の VM に対して週単位の更新プログラムのデプロイを作成する) をご覧ください。

## <a name="check-deployment-status"></a>展開の状態を確認する

スケジュールされた展開の開始後、 **[更新の管理]** の **[更新プログラムの展開]** タブに、その状態が表示されます。 展開が現在実行中の場合、状態は **[処理中]** と表示されます。 展開が正常に終了すると、状態が **[成功]** に変わります。 展開に含まれる 1 つ以上の更新プログラムでエラーが発生した場合、状態は **[Partially failed]\(部分的に失敗\)** になります。

## <a name="view-results-of-a-completed-update-deployment"></a>完了した更新プログラムの展開の結果を表示する

展開が完了したら、それを選択してその結果を表示することができます。

[![特定の展開に関する更新プログラムの展開ステータスのダッシュボード](./media/update-mgmt-deploy-updates/manageupdates-view-results.png)](./media/update-mgmt-deploy-updates/manageupdates-view-results-expanded.png#lightbox)

**[更新プログラムを実行した結果]** には、ターゲット VM 上の更新プログラムの合計数と展開結果が表示されます。 右側の表には、更新プログラムの詳細な内訳とそれぞれのインストール結果が示されます。

使用できる値は次のとおりです。

* **試行されていません** - 定義されたメンテナンス期間に基づく利用可能な時間が十分ではなかったため、更新プログラムがインストールされませんでした。
* **選択されていません** - 更新プログラムが展開用に選択されていませんでした。
* **成功** - 更新できました。
* **失敗** - 更新できませんでした。

展開によって作成されたログ エントリをすべて表示するには、 **[すべてのログ]** を選択します。

ターゲット VM での更新プログラムの展開を管理する Runbook のジョブ ストリームを確認するには、 **[出力]** を選択します。

展開で発生したエラーの詳細情報を確認するには、 **[エラー]** を選択します。

## <a name="next-steps"></a>次のステップ

更新プログラムの展開の結果について通知するアラートを作成する方法については、[Update Management のアラートの作成](update-mgmt-configure-alerts.md)に関する記事を参照してください。