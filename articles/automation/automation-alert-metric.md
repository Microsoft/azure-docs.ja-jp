---
title: メトリック アラートを使用して Azure Automation Runbook を監視する
description: この記事では、Runbook の完了状態に基づいてメトリック アラートを設定する方法について説明します。
services: automation
ms.date: 08/10/2020
ms.topic: article
ms.openlocfilehash: 8767687f0b72d3469bef570770ac81fa8300097f
ms.sourcegitcommit: 269da970ef8d6fab1e0a5c1a781e4e550ffd2c55
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/10/2020
ms.locfileid: "88055932"
---
# <a name="monitor-runbooks-with-metric-alerts"></a>メトリック アラートによる Runbook の監視

この記事では、Runbook の完了状態に基づいて[メトリック アラート](../azure-monitor/platform/alerts-metric-overview.md)を設定する方法について説明します。

## <a name="sign-in-to-azure"></a>Azure へのサインイン

[Azure ポータル](https://portal.azure.com)

## <a name="create-alert"></a>アラートを作成する

アラートを使うと、監視対象の条件と、その条件が満たされたときに実行するアクションを定義できます。

1. Azure portal 上で **[すべてのサービス]** をクリックし、 **[Automation アカウント]** を検索して選択し、Azure Automation サービスを起動します。

2. Automation アカウントの一覧で、アラートを作成するアカウントを選択します。 

3. **[監視]** で、 **[アラート]** を選択し、 **[+ 新しいアラート ルール]** を選択します。 ターゲットのスコープは、既に定義されており、Automation アカウントに関連付けられています。

### <a name="configure-alert-criteria"></a>アラートの条件を構成する

1. **[条件の選択]** をクリックします。 **[シグナルの種類]** で **[メトリック]** を選択し、一覧から **[合計ジョブ数]** を選択します。

2. **[シグナル ロジックの構成]** ページでは、アラートをトリガーするロジックを定義します。 履歴のグラフの下に、 **[Runbook 名]** と **[状態]** の 2 つのディメンションが表示されます。 ディメンションは、結果のフィルター処理に使用できるメトリックのさまざまなプロパティです。 **[Runbook 名]** では、アラート対象の Runbook を選ぶか、空白にままにしてすべての Runbook についてアラートします。 **[状態]** では、監視対象の状態をドロップダウンから選びます。 ドロップダウンに表示される Runbook 名と状態の値は、過去 1 週間に実行したジョブに対するものだけです。

   ドロップダウンに表示されていない状態または Runbook に対するアラートを作成する場合は、ディメンションの横にある **[カスタム値を追加]** オプションをクリックします。 このアクションによって開くダイアログボックスで、そのディメンションに対して最近生成されなかったカスタム値を指定できます。 プロパティに対して存在しない値を入力すると、アラートはトリガーされません。

   > [!NOTE]
   > **[Runbook 名]** ディメンションに名前を指定しない場合、状態基準を満たす Runbook (隠しシステム Runbook を含む) があると、アラートが表示されます。

    たとえば、Runbook から "_失敗_" 状態が返されたときにアラートするには、Runbook 名の指定に加えて、 **[状態]** ディメンションに対してカスタム ディメンション値**失敗**を追加します。

    :::image type="content" source="./media/automation-alert-metric/specify-dimension-custom-value.png" alt-text="カスタム ディメンション値を指定する" border="false":::

3. **[アラート ロジック]** で、アラートの条件としきい値を定義します。 定義した条件のプレビューが下に表示されます。

4. **[評価基準]** で、クエリの対象期間と、クエリの実行頻度を選択します。 たとえば、 **[期間]** で **[直近 5 分]** を選択し、 **[頻度]** で **[1 分ごと]** を選択すると、アラートによって過去 5 分間に条件に一致した Runbook の数が検索されます。 このクエリは 1 分ごとに実行し、定義されているアラート条件が 5 分の期間内に見つからなくなると、アラートは自動的に解消されます。 終了したら、 **[完了]** をクリックします。

   ![アラート対象のリソースを選択する](./media/automation-alert-activity-log/configure-signal-logic.png)

### <a name="define-the-action-to-take"></a>実行するアクションを定義する

1. **[アクション グループ]** で、 **[Specify action group]\(アクション グループの指定\)** をクリックします。 アクション グループとは、複数のアラートで使用できるアクションのグループです。 アクションには、電子メール通知、Runbook、webhook などがありますが、これらに限定されるわけではありません。 アクション グループの詳細と、電子メール通知を送信するアクション グループを作成する手順については、[アクショングループの作成と管理](../azure-monitor/platform/action-groups.md)に関する記事を参照してください。

### <a name="define-alert-details"></a>アラートの詳細を定義する

1. **[警告ルールの詳細]** で、アラートのフレンドリ名と説明を入力します。 アラートの条件に一致するように **[重要度]** を設定します。 0 から 4 まで 5 つの重大度レベルがあります。 アラートは重大度とは関係なく同じように処理され、ビジネス ロジックに合わせて重大度を一致させることができます。

1. 既定では、 **[Enable alert rule upon creation]\(作成時に警告ルールを有効にする\)** オプションで **[いいえ]** を選択しない限り、ルールは作成時に有効になります。 無効な状態で作成されたアラートについては、今後準備ができたときに有効にすることができます。 **[アラート ルールの作成]** を選択して変更を保存します。

## <a name="receive-notification"></a>通知の受信

アラートの条件が満たされると、アクション グループは定義されているアクションを実行します。 この記事の例では、メールが送信されます。 次の図は、アラートがトリガーされた後で受け取るメールの例です。

![電子メール アラート](./media/automation-alert-activity-log/alert-email.png)

メトリックが定義されているしきい値を超えなくなると、アラートは非アクティブ化されて、アクション グループは定義されているアクションを実行します。 メール アクションの種類を選択されていると、解消されたことを示す解消メールが送信されます。

## <a name="next-steps"></a>次のステップ

* 詳細については、「[Azure Automation Runbook をトリガーするアラートを使用する](automation-create-alert-triggered-runbook.md)」を参照してください。
