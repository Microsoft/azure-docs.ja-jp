---
title: "Service Fabric クラスターの容量計画 | Microsoft Docs"
description: "Service Fabric クラスターの容量計画に関する考慮事項。 Nodetypes、持続性と信頼性レベル"
services: service-fabric
documentationcenter: .net
author: ChackDan
manager: timlt
editor: 
ms.assetid: 4c584f4a-cb1f-400c-b61f-1f797f11c982
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/24/2017
ms.author: chackdan
translationtype: Human Translation
ms.sourcegitcommit: 4f2230ea0cc5b3e258a1a26a39e99433b04ffe18
ms.openlocfilehash: 788021a5b5715524a534ce3e9ff9019310450f4a
ms.lasthandoff: 03/25/2017


---
# <a name="service-fabric-cluster-capacity-planning-considerations"></a>Service Fabric クラスターの容量計画に関する考慮事項
容量計画は、運用環境へのデプロイにおいて重要なステップとなります。 ここでは、そのプロセスの一環として考慮すべき事柄をいくつか取り上げます。

* クラスターで最初に必要となるノード タイプの数
* ノード タイプごとの特性 (サイズ、プライマリ/非プライマリ、インターネット接続、VM 数など)
* クラスターの信頼性と耐久性の特徴

それぞれの項目について簡単に見ていきましょう。

## <a name="the-number-of-node-types-your-cluster-needs-to-start-out-with"></a>クラスターで最初に必要となるノード タイプの数
まず、これから作成するクラスターを何の目的に使用するのか、また、そのクラスターにどのようなアプリケーションをデプロイするのかを把握する必要があります。 クラスターの目的が明確でないとすれば、容量計画プロセスに着手するのはおそらく時期尚早です。

クラスターで最初に必要となるノード タイプの数をはっきりさせましょう。  ノード タイプはそれぞれ 1 つの仮想マシン スケール セットに対応付けられます。 各ノードの種類は、個別にスケール アップまたはスケール ダウンすることができ、さまざまなセットのポートを開き、異なる容量のメトリックスを持つことができます。 そのためノード タイプの数は、基本的に次の要因を考慮して決めることになります。

* アプリケーションに複数のサービスが存在するか、またその中に、外部に公開 (インターネットに接続) しなければならないサービスはあるか。 標準的なアプリケーションには、クライアントからの入力を受け取るフロントエンド ゲートウェイ サービスと、そのフロントエンド サービスと通信するバックエンド サービスが存在します。 したがってこのケースでは、最終的に少なくとも 2 つのノード タイプが必要となります。
* アプリケーションの構成要素として、インフラストラクチャ ニーズの異なる複数のサービスが存在するか (大容量の RAM が必要、高い CPU 処理能力が必要など)。 たとえばデプロイするアプリケーションに、フロントエンド サービスとバックエンド サービスが含まれていると仮定します。 フロントエンド サービスはバックエンド サービスよりも小さい VM (D2 など) で実行できますが、インターネットに対してポートを開放する必要があります。  一方バックエンド サービスは計算負荷が高く、より大きな VM (D4、D6、D15 など) で実行する必要はありますが、インターネット接続は不要です。
  
  この場合、1 つのノード タイプにすべてのサービスをデプロイすることもできますが、Microsoft としては、2 つのノード タイプから成るクラスターにデプロイすることをお勧めします。  そうすることでノード タイプごとに、インターネットの接続性や VM サイズなど異なる特性を持たせることができます。 VM 数を個別に増減させることもできます。  
* 将来を予測することはできないので、まずは把握している事実を踏まえ、アプリケーションの立ち上げ時に必要となるノード タイプの数を決めましょう。 ノード タイプは後からいつでも追加または削除できます。 Service Fabric クラスターには少なくとも 1 つのノード タイプが必要です。

## <a name="the-properties-of-each-node-type"></a>各ノード タイプの特性
**ノード タイプ** は、Cloud Services のロールと同等のものと見なすことができます。 ノードのタイプには、VM のサイズ、VM の数、プロパティが定義されています。 Service Fabric クラスターで定義されているすべてのノード タイプは、個別の仮想マシン スケール セット (VMSS) としてセットアップされます。 VMSS は、仮想マシンのコレクションをセットとしてデプロイ、管理するのに使用する Azure コンピューティング リソースです。 ノード タイプはそれぞれ別々の VMSS として定義されているため、個別にスケールアップまたはスケールダウンでき、異なるポートの組み合わせを開放し、異なる容量メトリックを割り当てることができます。

ノード タイプと VMSS との関係、いずれかのインスタンスに RDP で接続する方法、新しいポートを開く方法などの詳細については[こちらのドキュメント](service-fabric-cluster-nodetypes.md)を参照してください。

クラスターには複数のノード タイプを指定できますが、運用環境のワークロードに使用するクラスターの場合、プライマリ ノード タイプ、つまりポータルで最初に定義したノードには、少なくとも 5 つの VM が必要です (テスト環境のクラスターの場合は 3 つ以上)。 Resource Manager テンプレートを使用してクラスターを作成する場合は、ノード タイプの定義に **is Primary** 属性が存在します。 Service Fabric のシステム サービスは、プライマリ ノード タイプに配置されます。  

### <a name="primary-node-type"></a>プライマリ ノード タイプ
1 つのクラスターに複数のノード タイプが存在する場合、そのいずれかをプライマリにする必要があります。 プライマリ ノード タイプには、次の特徴があります。

* プライマリ ノード タイプの**最小 VM サイズ**は、選択した**耐久性レベル**によって決まります。 既定の耐久性レベルは Bronze です。 耐久性レベルとは何か、どのようなプランがあるかについては、このページの下の方で説明しています。  
* プライマリ ノード タイプの**最低 VM 数**は、選択した**信頼性レベル**によって決まります。 既定の信頼性レベルは Silver です。 信頼性レベルとは何か、どのようなプランがあるかについては、このページの下の方で説明しています。 

 

* Service Fabric システム サービス (クラスター マネージャー サービス、イメージ ストア サービスなど) はプライマリ ノード タイプに置かれるので、クラスターの信頼性と耐久性は、プライマリ ノード タイプに選択した信頼性レベルのプランと耐久性レベルのプランによって決まります。

![ノードが 2 種類あるクラスターのスクリーン ショット ][SystemServices]

### <a name="non-primary-node-type"></a>非プライマリ ノード タイプ
クラスターに複数のノード タイプが存在するとき、プライマリ ノード タイプは 1 つだけで、それ以外はすべて非プライマリ ノード タイプです。 非プライマリ ノード タイプには、次の特徴があります。

* このノード タイプの最小 VM サイズは、選択した耐久性レベルによって決まります。 既定の耐久性レベルは Bronze です。 耐久性レベルとは何か、どのようなプランがあるかについては、このページの下の方で説明しています。  
* このノード タイプの最低 VM 数は 1 です。 ただしこの数は、このノード タイプで実行するアプリケーション/サービスのレプリカ数に基づいて選ぶ必要があります。 ノード タイプの VM 数は、クラスターのデプロイ後に増やすことができます。

## <a name="the-durability-characteristics-of-the-cluster"></a>クラスターの耐久性の特徴
耐久性レベルは、ご利用の VM が、基になる Azure インフラストラクチャに対して持つ特権をシステムに表明する目的で使用します。 プライマリ ノード タイプでは、Service Fabric がこの特権を使って、システム サービスやステートフル サービスのクォーラム要件に影響を及ぼす、VM レベルのインフラストラクチャ要求 (VM の再起動、VM の再イメージ化、VM の移行など) を一時停止させることができます。 非プライマリ ノード タイプの場合も、Service Fabric がこの特権の下で、ノード内で実行されるステートフル サービスのクォーラム要件に影響を及ぼす、VM レベルのインフラストラクチャ要求 (VM の再起動、VM の再イメージ化、VM の移行など) を一時停止させることができます。

この特権は次のプランで表されます。

* Gold - 1 つの更新ドメインにつき 2 時間、インフラストラクチャ ジョブを一時停止させることができます。 Gold の持続性は、D15_V2 や G5 などのフル ノードの VM SKU でのみ有効にできます。
* Silver - 1 つの更新ドメインにつき 30 分、インフラストラクチャ ジョブを一時停止させることができます (現在有効になっていません。 有効にすると、単一コア以上のすべての Standard VM で使用できます)。
* Bronze - 特権はありません。 既定のプランです。

## <a name="the-reliability-characteristics-of-the-cluster"></a>クラスターの信頼性の特徴
信頼性レベルは、クラスターのプライマリ ノード タイプで実行するシステム サービスのレプリカ数を設定する目的で使用します。 レプリカ数が増えるほど、クラスター内のシステム サービスの信頼性が上がります。  

信頼性レベルは、以下のプランから選ぶことができます。

* Platinum - ターゲット レプリカ セット数を 9 としてシステム サービスを実行します。
* Gold - ターゲット レプリカ セット数を 7 としてシステム サービスを実行します。
* Silver - ターゲット レプリカ セット数を 5 としてシステム サービスを実行します。
* Bronze - ターゲット レプリカ セット数を 3 としてシステム サービスを実行します。

> [!NOTE]
> 選択した信頼性レベルによって、プライマリ ノード タイプに必要な最小ノード数が決まります。 信頼性レベルは、クラスターの最大サイズには何の影響も及ぼしません。 たとえば、20 ノードのクラスターを Bronze の信頼性で実行することもできます。
> 
> 

 クラスターの信頼性レベルはいつでも変更できます。 クラスターの信頼性レベルを変更すると、システム サービスのレプリカ セット数を変更するために必要なクラスターのアップグレードが開始されます。 ノードの追加など、クラスターにさらに変更を行う場合は、このアップグレードが完了してからにしてください。アップグレードの進行状況を監視するには、Service Fabric Explorer を使用するか、[Get-ServiceFabricClusterUpgrade](https://msdn.microsoft.com/library/mt126012.aspx) を実行します。


## <a name="primary-node-type---capacity-guidance"></a>プライマリ ノード タイプ - 容量に関するガイダンス

ここでは、プライマリ ノード タイプの容量計画のガイダンスを示します。

1. **VM インスタンスの数:** Azure で運用ワークロードを実行するには、信頼性レベルを Silver 以上にする必要があり、この場合最小プライマリ ノード タイプ サイズは 5 になります。
2. **VM SKU:** プライマリ ノード タイプはシステム サービスの実行場所となるため、VM SKU を選択する場合、クラスターに配置する予定の全ピーク負荷を考慮に入れる必要があります。 この要点を例え話で説明するために、プライマリ ノード タイプを "肺" と考えてください。そこから脳に酸素が送られるため、脳に十分な酸素が届かなければ身体に悪影響が出るということです。 

クラスターに必要な容量を決めるのは、クラスターで実行する予定のワークロードのみです。このため、特定のワークロードについて定性的なガイダンスを行うことはできませんが、以下に取っ掛かりとして役に立つ包括的なガイダンスを示します。

運用環境のワークロードの場合は次のとおりです。 


- 推奨される VM SKU は、Standard D3 か Standard D3_V2、またはローカル SSD が 14 GB 以上のこれらと同等の SKU です
- サポートされる最小の VM SKU は、Standard D1 か Standard D1_V2、またはローカル SSD が 14 GB 以上のこれらと同等の SKU です 
- コア数が少ない Standard A0 のような VM SKU は、運用ワークロードではサポートされません。
- 特に Standard A1 SKU は、パフォーマンス上の理由から運用ワークロードではサポートされません。


## <a name="non-primary-node-type---capacity-guidance-for-stateful-workloads"></a>非プライマリ ノード タイプ - ステートフル ワークロードの容量ガイダンス

Service Fabric の Reliable Collection または Reliable Actors を使用するワークロードの場合は以下を参照してください。 [プログラミング モデルの詳細についてはこちらを参照してください](service-fabric-choose-framework.md)。

1. **VM インスタンスの数:** ステートフルな運用ワークロードの場合、最小レプリカ数およびターゲット レプリカ数を 5 にして実行することをお勧めします。 こうすることで、安定状態では各障害ドメインとアップグレード ドメインに (1 つのレプリカ セットから) 1 つのレプリカが配置されることになります。 システム サービスの信頼性レベルという概念は、実質的にはシステム サービスに対してこの設定を指定する手段に他なりません。

このため、運用ワークロードで推奨される非プライマリ ノード タイプの最小サイズは、ステートフル ワークロードを実行する場合は 5 になります。

2. **VM SKU:** これは、アプリケーション サービスの実行場所となるノード タイプになるため、VM SKU を選択する場合は、各ノードに配置する予定のピーク負荷を考慮に入れる必要があります。 ノード タイプに必要な容量を決めるのは、クラスターで実行する予定のワークロードのみです。このため、特定のワークロードについて定性的なガイダンスを行うことはできませんが、以下に取っ掛かりとして役に立つ包括的なガイダンスを示します。

運用環境のワークロードの場合は次のとおりです。 

- 推奨される VM SKU は、Standard D3 か Standard D3_V2、またはローカル SSD が 14 GB 以上のこれらと同等の SKU です
- サポートされる最小の VM SKU は、Standard D1 か Standard D1_V2、またはローカル SSD が 14 GB 以上のこれらと同等の SKU です 
- コア数が少ない Standard A0 のような VM SKU は、運用ワークロードではサポートされません。
- 特に Standard A1 SKU は、パフォーマンス上の理由から運用ワークロードではサポートされません。


## <a name="non-primary-node-type---capacity-guidance-for-stateless-workloads"></a>非プライマリ ノード タイプ - ステートレス ワークロードの容量ガイダンス

ステートレス ワークロードの場合は以下を参照してください。

**VM インスタンスの数:** ステートレスな運用ワークロードの場合は、サポートされる最小の非プライマリ ノード タイプ サイズは 2 です。 このサイズではアプリケーションのステートレス インスタンスを 2 つ実行できるため、1 つの VM インスタンスが損失してもサービスを存続させることができます。 

> [!NOTE]
> クラスターがバージョン 5.6 以前の Service Fabric で実行されている場合、ランタイムの欠陥 (5.6 で修正される予定です) のため、非プライマリ ノード タイプを 5 未満にスケールダウンするとクラスターの正常性が異常になります。この状態は [Remove-ServiceFabricNodeState cmd](https://docs.microsoft.com/powershell/servicefabric/vlatest/Remove-ServiceFabricNodeState) を適切なノード名を指定して呼び出すまで続きます。 詳細については、[Service Fabric クラスターのスケールイン/アウト](service-fabric-cluster-scale-up-down.md)に関する記事を参照してください。
> 
>

**VM SKU:** これは、アプリケーション サービスの実行場所となるノード タイプになるため、VM SKU を選択する場合は、各ノードに配置する予定のピーク負荷を考慮に入れる必要があります。 ノード タイプに必要な容量を決めるのは、クラスターで実行する予定のワークロードのみです。このため、特定のワークロードについて定性的なガイダンスを行うことはできませんが、以下に取っ掛かりとして役に立つ包括的なガイダンスを示します。

運用環境のワークロードの場合は次のとおりです。 


- 推奨される VM SKU は、Standard D3 か Standard D3_V2、またはこれらと同等の SKU です 
- サポートされる最小の VM SKU は、Standard D1 か Standard D1_V2、またはこれらと同等の SKU です 
- コア数が少ない Standard A0 のような VM SKU は、運用ワークロードではサポートされません。
- 特に Standard A1 SKU は、パフォーマンス上の理由から運用ワークロードではサポートされません。

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->

## <a name="next-steps"></a>次のステップ
容量計画が完了し、クラスターをセットアップしたら、以下のドキュメントをお読みください。

* [Service Fabric クラスターのセキュリティ](service-fabric-cluster-security.md)
* [Service Fabric の正常性モデルの概要](service-fabric-health-introduction.md)
* [ノード タイプと VMSS の関係](service-fabric-cluster-nodetypes.md)

<!--Image references-->
[SystemServices]: ./media/service-fabric-cluster-capacity/SystemServices.png

