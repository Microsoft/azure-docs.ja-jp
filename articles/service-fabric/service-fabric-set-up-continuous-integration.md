---
title: "Azure マイクロサービスの継続的インテグレーションを設定する | Microsoft Docs"
description: "Visual Studio Team Services (VSTS) を使用して、Service Fabric アプリケーションの継続的インテグレーションとデプロイを設定する方法の概要を説明します。"
services: service-fabric
documentationcenter: na
author: mthalman-msft
manager: timlt
editor: 
ms.assetid: 3e8c2290-9e7a-456a-9b2c-db44d1b3988d
ms.service: multiple
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: multiple
ms.date: 12/06/2016
ms.author: mthalman;mikhegn
translationtype: Human Translation
ms.sourcegitcommit: f7edee399717ecb96fb920d0a938da551101c9e1
ms.openlocfilehash: 437e343425da5c8cfe71d4ae67c423fcc2b794c2


---
# <a name="set-up-service-fabric-continuous-integration-and-deployment-with-visual-studio-team-services"></a>Visual Studio Team Services による Service Fabric の継続的インテグレーションとデプロイの設定
この記事では、Visual Studio Team Services (VSTS) を使用して、Azure Service Fabric アプリケーションの継続的インテグレーションとデプロイを設定する手順について説明します。

このドキュメントは現在の手順を反映したものであり、今後変更される予定です。

## <a name="prerequisites"></a>前提条件
作業を開始するには、次の手順に従います。

1. Team Services アカウントにアクセスできることを確認するか、 [アカウントを作成](https://www.visualstudio.com/docs/setup-admin/team-services/sign-up-for-visual-studio-team-services) します。
2. Team Services チーム プロジェクトにアクセスできることを確認するか、 [チーム プロジェクトを作成](https://www.visualstudio.com/docs/setup-admin/create-team-project) します。
3. アプリケーションをデプロイできる Service Fabric クラスターがあることを確認するか、[Azure Portal](service-fabric-cluster-creation-via-portal.md)、[Azure Resource Manager テンプレート](service-fabric-cluster-creation-via-arm.md)、または [Visual Studio](service-fabric-cluster-creation-via-visual-studio.md) を使用してクラスターを作成します。
4. Service Fabric アプリケーション (.sfproj) プロジェクトを作成済みであることを確認します。 Service Fabric SDK 2.1 以上で作成または更新済みのプロジェクトが必要です (.sfproj ファイルには 1.1 以上の ProjectVersion プロパティ値が含まれている必要があります)。

> [!NOTE]
> カスタム ビルド エージェントは不要になりました。 Service Fabric クラスター管理ソフトウェアと共に、Team Services のホステッド エージェントがプレインストールされるようになったので、これらのエージェントから直接アプリケーションをデプロイできます。
> 
> 

## <a name="configure-and-share-your-source-files"></a>ソース ファイルの構成と共有
まず、Team Services 内で実行されるデプロイ プロセスで使用する発行プロファイルを準備します。  発行プロファイルは、あらかじめ準備しておいたクラスターを対象とするように構成する必要があります。

1. 継続的インテグレーション ワークフローに使用するアプリケーション プロジェクト内で発行プロファイルを選択します。 アプリケーションをリモート クラスターに発行する方法の[発行手順](service-fabric-publish-app-remote-cluster.md)に従います。 アプリケーションを実際に発行する必要はありません。 構成を適切に完了したら、発行ダイアログで **[保存]** ハイパーリンクをクリックします。
2. Team Services 内で実行される各デプロイでアプリケーションをアップグレードする場合は、発行プロファイルの構成でアップグレードを有効にします。 手順 1. で使用した同じ発行ダイアログで、**[アプリケーションをアップグレードする]** チェック ボックスがオンになっていることを確認します。  その他のアップグレード設定の構成の詳細については、[こちら](service-fabric-visualstudio-configure-upgrade.md)をご覧ください。 **[保存]** ハイパーリンクをクリックして、発行プロファイルに設定を保存します。
3. 発行プロファイルに変更が保存されていることを確認し、発行ダイアログをキャンセルします。
4. 次に、Team Services と [アプリケーション プロジェクトのソース ファイルを共有](https://www.visualstudio.com/docs/setup-admin/team-services/connect-to-visual-studio-team-services#vs) します。 Team Services でソース ファイルにアクセスできるようになったら、ビルドを生成する次の手順に進むことができます。 

## <a name="create-a-build-definition"></a>ビルド定義の作成
Team Services のビルド定義では、順次実行される一連のビルド ステップで構成されたワークフローを記述します。 作成するビルド定義の目的は、アプリケーションをデプロイする際に使用できる Service Fabric アプリケーション パッケージと他の成果物を生成することです。 Team Services のビルド定義の詳細については、 [こちら](https://www.visualstudio.com/docs/build/define/create)をご覧ください。

### <a name="create-a-definition-from-the-build-template"></a>ビルド テンプレートから定義を作成する
1. Visual Studio Team Services でチーム プロジェクトを開きます。
2. **[ビルド]** タブを選択します。
3. 緑色の **+** 記号をクリックして、新しいビルド定義を作成します。
4. 表示されたダイアログで、テンプレート カテゴリの **[ビルド]** 内の **[Azure Service Fabric アプリケーション]** を選択します。
5. **[次へ]**を選択します。
6. Service Fabric アプリケーションに関連付けられているリポジトリと分岐を選択します。
7. 使用するエージェント キューを選択します。 ホステッド エージェントがサポートされています。
8. **[作成]**を選択します。
9. ビルド定義を保存し、名前を付けます。
10. テンプレートによって生成されるビルド ステップの説明を次に示します。

| ビルド ステップ | Description |
| --- | --- |
| NuGet の復元 |ソリューションの NuGet パッケージを復元します。 |
| ソリューション \*.sln のビルド |ソリューション全体をビルドします。 |
| ソリューション \*.sfproj のビルド |アプリケーションをデプロイする際に使用する Service Fabric アプリケーション パッケージを生成します。 アプリケーション パッケージの場所は、ビルドのアーティファクトのディレクトリ内に指定されています。 |
| Service Fabric アプリケーションのバージョンの更新 |アップグレードをサポートできるように、アプリケーション パッケージのマニフェスト ファイルに含まれているバージョン値を更新します。 詳細については、 [タスクに関するドキュメントのページ](https://go.microsoft.com/fwlink/?LinkId=820529) をご覧ください。 |
| ファイルのコピー |デプロイに使用するために、発行プロファイルとアプリケーション パラメーター ファイルをビルドの成果物にコピーします。 |
| 成果物の発行 |ビルドの成果物を発行します。 これにより、リリース定義でビルドの成果物を使用できるようになります。 |

### <a name="verify-the-default-set-of-tasks"></a>既定の一連のタスクを確認する
1. "**NuGet の復元**"、"**ソリューションのビルド**" の各ビルド ステップの **[ソリューション]** 入力フィールドを確認します。  既定では、これらのビルド ステップは関連付けられているリポジトリに格納されたすべてのソリューション ファイルで実行されます。  これらのソリューション ファイルのいずれかでのみビルド定義を実行する場合は、そのファイルのパスを明示的に更新する必要があります。
2. **アプリケーションのパッケージ化** ビルド ステップの **[ソリューション]** 入力フィールドを確認します。  既定では、このビルド ステップは、リポジトリに Service Fabric アプリケーション プロジェクト (.sfproj) が&1; つしか存在しないことを前提としています。  リポジトリにこのようなファイルが複数あり、その中の&1; つだけをこのビルド定義の対象にする場合は、そのファイルのパスを明示的に更新する必要があります。  リポジトリ内の複数のアプリケーション プロジェクトをパッケージ化する場合は、それぞれのアプリケーション プロジェクトを対象とする追加の **Visual Studio ビルド** ステップをビルド定義で作成する必要があります。  また、それらのビルド ステップごとにパッケージの場所が一意になるように、各ビルド ステップの **[MSBuild 引数]** フィールドを更新する必要があります。
3. **Service Fabric アプリケーションのバージョンの更新** ビルド ステップで定義したバージョン管理の動作を確認します。  既定では、このビルド ステップはアプリケーション パッケージのマニフェスト ファイル内のすべてのバージョン値にビルド番号を追加します。 詳細については、 [タスクに関するドキュメントのページ](https://go.microsoft.com/fwlink/?LinkId=820529) をご覧ください。 各アップグレード デプロイメントでは、以前のデプロイメントとは異なるバージョン値が必要となるため、これはアプリケーションのアップグレードをサポートする際に役立ちます。 ワークフローでアプリケーションのアップグレードを使用しない場合は、このビルド ステップを無効にすることを検討しても構いません。 既存の Service Fabric アプリケーションを上書きする際に使用できるビルドを作成する場合は、無効にする必要があります。 ビルドによって生成されたアプリケーションのバージョンが、クラスター内のアプリケーションのバージョンと一致しない場合、デプロイは失敗します。
4. ソリューションに .NET Core プロジェクトが含まれる場合、依存関係を復元するビルド ステップをビルド定義に必ず含める必要があります。
   1. **[Add build step... (ビルド ステップの追加...)]**を選択します。
   2. [ユーティリティ] タブで **[コマンド ライン]** タスクを見つけ、このタスクの [追加] をクリックします。
   3. タスクの入力フィールドでは、次の値を使用します。
   4. ツール: dotnet
   5. 引数: restore
   6. タスクをドラッグして、" **NuGet の復元** " ステップのすぐ後に配置します。
5. ビルド定義に加えた変更を保存します。

### <a name="try-it"></a>試してみる
**[キュー ビルド]** を選択して、ビルドを手動で開始します。 プッシュまたはチェックイン時にもビルドがトリガーされます。 ビルドが正常に実行されていることを確認したら、アプリケーションをクラスターにデプロイするためのリリース定義の作成に進むことができます。

## <a name="create-a-release-definition"></a>リリース定義の作成
Team Services のリリース定義では、順次実行される一連のタスクで構成されたワークフローを記述します。 作成するリリース定義の目的は、アプリケーション パッケージを取得してクラスターにデプロイすることです。 ビルド定義とリリース定義を併用すると、ソース ファイルから始まり、クラスターでのアプリケーションの実行で終わるワークフロー全体を実行できます。 Team Services のリリース定義の詳細については、 [こちら](https://www.visualstudio.com/docs/release/author-release-definition/more-release-definition)をご覧ください。

### <a name="create-a-definition-from-the-release-template"></a>リリース テンプレートから定義を作成する
1. Visual Studio Team Services でプロジェクトを開きます。
2. **[リリース]** タブを選択します。
3. 新しいリリース定義を作成する緑色の **+** 記号をクリックし、メニューの **[リリース定義の作成]** を選択します。
4. 表示されたダイアログで、テンプレート カテゴリの **[デプロイ]** 内の **[Azure Service Fabric の配置]** を選択します。
5. **[次へ]**を選択します。
6. このリリース定義のソースとして使用するビルド定義を選択します。  リリース定義では、選択したビルド定義によって生成された成果物を参照します。
7. ビルドが完了するたびに Team Services で自動的に新しいリリースを作成し、Service Fabric アプリケーションをデプロイする場合は、 **[継続的なデプロイ]** チェック ボックスをオンにします。
8. 使用するエージェント キューを選択します。 ホステッド エージェントがサポートされています。
9. **[作成]**を選択します。
10. 定義の名前を編集するには、ページの上部にある鉛筆アイコンをクリックします。
11. タスクの **[Cluster Connection (クラスター接続)]** 入力フィールドで、アプリケーションのデプロイ先のクラスターを選択します。 クラスター接続では、デプロイメント タスクでクラスターに接続できるようにするために必要な情報が提供されます。 クラスター用のクラスター接続がまだない場合は、このフィールドの横の **[管理]** ハイパーリンクを選択して、クラスター接続を追加します。 表示されたページで次の手順を実行します。
    1. **[新しいサービス エンドポイント]** を選択し、メニューの **[Azure Service Fabric]** を選択します。
    2. このエンドポイントが対象とするクラスターで使用される認証の種類を選択します。
    3. **[接続名]** フィールドで、接続の名前を定義します。  通常はクラスターの名前を使用します。
    4. **[Cluster Endpoint (クラスター エンドポイント)]** フィールドで、クライアントの接続エンドポイントの URL を定義します。  例: https://contoso.westus.cloudapp.azure.com:19000
    5. Azure Active Directory の資格情報について、**[ユーザー名]** フィールドと **[パスワード]** フィールドにクラスターへの接続で使用する資格情報を指定します。
    6. 証明書ベースの認証について、 **[クライアント証明書]** フィールドにクライアント証明書ファイルの Base64 エンコードを指定します。  この値の取得方法については、このフィールドのポップアップ ヘルプをご覧ください。  証明書がパスワードで保護されている場合は、 **[パスワード]** フィールドでパスワードを定義します。
    7. **[OK]**をクリックして変更を確定します。 リリース定義に戻り、 **[Cluster Connection (クラスター接続)]** フィールドの更新アイコンをクリックして、先ほど追加したエンドポイントを確認します。
12. リリース定義を保存します。

> [!NOTE]
> Microsoft アカウント (例: @hotmail.com、@outlook.com) は、Azure Active Directory 認証でサポートされていません。
> 
> 

作成した定義は、" **Service Fabric アプリケーションのデプロイ**" というタイプの&1; つのタスクで構成されています。 このタスクの詳細については、 [タスクに関するドキュメントのページ](https://go.microsoft.com/fwlink/?LinkId=820528) をご覧ください。

### <a name="verify-the-template-defaults"></a>テンプレートの既定値の確認
1. "**Service Fabric アプリケーションのデプロイ**" タスクの **[発行プロファイル]** 入力フィールドを確認します。 既定では、このフィールドは、ビルドの成果物に含まれている Cloud.xml という名前の発行プロファイルを参照します。 別の発行プロファイルを参照する場合や、ビルドの成果物に複数のアプリケーション パッケージが含まれている場合は、パスを適切に更新する必要があります。
2. "**Service Fabric アプリケーションのデプロイ**" タスクの **[アプリケーション パッケージ]** 入力フィールドを確認します。 既定では、このフィールドは、ビルド定義テンプレートで使用されるアプリケーション パッケージの既定のパスを参照します。  ビルド定義でアプリケーション パッケージの既定のパスを変更した場合は、ここでもパスを適切に更新する必要があります。

### <a name="try-it"></a>試してみる
**[リリース]** ボタン メニューの **[リリースの作成]** を選択して、リリースを手動で作成します。 表示されたダイアログ ボックスで、このリリースの基になるビルドを選択し、 **[作成]**をクリックします。 継続的デプロイを有効にした場合は、関連付けられているビルド定義でビルドが完了すると、リリースが自動的に作成されます。

## <a name="next-steps"></a>次のステップ
Service Fabric アプリケーションの継続的インテグレーションに関する詳細については、次の記事を参照してください。

* [Team Services のドキュメント ホーム](https://www.visualstudio.com/docs/overview)
* [Team Services でのビルド管理](https://www.visualstudio.com/docs/build/overview)
* [Team Services でのリリース管理](https://www.visualstudio.com/docs/release/overview)




<!--HONumber=Jan17_HO4-->


