---
title: "複数のサービス構成を使用した Azure プロジェクトの構成 | Microsoft Docs"
description: "ServiceDefinition.csdef および ServiceConfiguration.cscfg ファイルを変更して、Azure クラウド サービス プロジェクトを構成する方法について説明します。"
services: visual-studio-online
documentationcenter: na
author: kraigb
manager: ghogen
editor: 
ms.assetid: a4fb79ed-384f-4183-9f74-5cac257206b9
ms.service: multiple
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 11/11/2016
ms.author: kraigb
ms.translationtype: HT
ms.sourcegitcommit: 83f19cfdff37ce4bb03eae4d8d69ba3cbcdc42f3
ms.openlocfilehash: 24b2530b23211c654072a6edc8a31e53989bf0a8
ms.contentlocale: ja-jp
ms.lasthandoff: 08/22/2017

---
# <a name="configuring-your-azure-project-using-multiple-service-configurations"></a>複数のサービス構成を使用した Azure プロジェクトの構成
Azure クラウド サービス プロジェクトには、ServiceDefinition.csdef と ServiceConfiguration.cscfg の 2 つの構成ファイルが含まれています。 これらのファイルは、Azure クラウド サービス アプリケーションと共にパッケージ化され、Azure にデプロイされます。

* **ServiceDefinition.csdef** ファイルには、クラウド サービス アプリケーションの要件 (含まれるロールなど) について Azure 環境で必要なメタデータが含まれます。 このファイルには、すべてのインスタンスに適用される構成設定も含まれます。 これらの構成設定は、Azure サービス ホスト ランタイム API を使用して実行時に読み込むことができます。 このファイルは、Azure でサービスを実行しているときには更新できません。
* **ServiceConfiguration.cscfg** ファイルは、サービス定義ファイルに定義された構成設定の値を設定し、各ロールに対して実行するインスタンスの数を指定します。 このファイルは、Azure でクラウド サービスを実行しているときに更新できます。

Azure Tools for Microsoft Visual Studio は、これらのファイルに格納されている構成設定を設定するために使用できるプロパティ ページを備えています。 このプロパティ ページにアクセスするには、ソリューション エクスプローラーで Azure クラウド サービス プロジェクトの下にあるロールへの参照をダブルクリックするか、次の図に示すようにロールへの参照を右クリックして **[プロパティ]**を選択します。

![VS_Solution_Explorer_Roles_Properties](./media/vs-azure-tools-multiple-services-project-configurations/IC784076.png)

サービス定義ファイルとサービス構成ファイルの基になるスキーマについては、 [スキーマ リファレンス](https://msdn.microsoft.com/library/azure/dd179398.aspx)のページを参照してください。 サービス構成の詳細については、「[クラウド サービスの構成方法](cloud-services/cloud-services-how-to-configure.md)」を参照してください。

## <a name="configuring-role-properties"></a>ロール プロパティの構成
Web ロールと worker ロールのプロパティ ページは似ていますが、以降のセクションで説明するように、いくつかの違いがあります。

**[キャッシュ]** ページで、Azure のキャッシュ サービスを構成できます。

### <a name="configuration-page"></a>[構成] ページ
**[構成]** ページでは、次のプロパティを設定できます。

**インスタンス**

**[インスタンス数]** プロパティに、このロールに対してサービスが実行するインスタンスの数を設定します。

**[VM サイズ]** プロパティには、**[極小]**、**[小]**、**[中]**、**[大]**、**[特大]** のいずれかを設定します。  詳細については、「[クラウド サービスのサイズを構成する](cloud-services/cloud-services-sizes-specs.md)」を参照してください。

**スタートアップ アクション** (Web ロールのみ)

このプロパティを設定して、デバッグの開始時に Visual Studio が HTTP エンドポイントと HTTPS エンドポイントのいずれか、または両方のエンドポイント用に Web ブラウザーを起動するように指定します。

[HTTPS エンドポイント] オプションは、ロールの HTTPS エンドポイントを既に定義している場合のみ使用できます。 HTTPS エンドポイントは、 **[エンドポイント]** プロパティ ページで定義できます。

HTTPS エンドポイントを既に追加している場合は、既定で [HTTPS エンドポイント] オプションが有効になり、Visual Studio はデバッグ開始時にこのエンドポイント用のブラウザーと HTTP エンドポイント用のブラウザーを起動します。 これは、両方のスタートアップ オプションが有効になっていることを前提としています。

**診断**

既定では、Web ロールに対して診断が有効になっています。 Azure クラウド サービス プロジェクトとストレージ アカウントは、ローカル ストレージ エミュレーターを使用するように設定されています。 Azure にデプロイする準備ができたら、ビルダーのボタン (**[…]**) を選択して、クラウドで Azure Storage を使用するようにストレージ アカウントを更新できます。 要求時に、または自動的にスケジュールされた間隔で、ストレージ アカウントに診断データを転送できます。 Azure の診断の詳細については、[Azure Cloud Services および Virtual Machines での診断の有効化](cloud-services/cloud-services-dotnet-diagnostics.md)に関するページを参照してください。

## <a name="settings-page"></a>[設定] ページ
**[設定]** ページでは、サービスの構成設定を追加できます。 構成設定は、名前と値のペアです。 ロール内でコードを実行すると、 [Azure マネージ ライブラリ](http://go.microsoft.com/fwlink?LinkID=171026)で提供されるクラスを使用して、実行時に構成設定の値を読み込むことができます。 具体的には、 [GetConfigurationSettingValue](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.getconfigurationsettingvalue.aspx) メソッドによって、実行時に指定した構成設定の値が返されます。

### <a name="configuring-a-connection-string-to-a-storage-account"></a>ストレージ アカウントへの接続文字列の構成
接続文字列とは、ストレージ エミュレーターまたは Azure ストレージ アカウントの接続情報と認証情報を提供する構成設定です。 ロール内で実行されているコードから Azure Storage サービス データ (BLOB データ、キュー データ、またはテーブル データ) にアクセスする必要がある場合、そのストレージ アカウントの接続文字列を定義する必要があります。

Azure ストレージ アカウントを指す接続文字列には、定義された書式を使用する必要があります。 接続文字列の作成方法の詳細については、「[Azure Storage の接続文字列を構成する](storage/common/storage-configure-connection-string.md)」を参照してください。

Azure Storage サービスに対してサービスをテストする準備、またはクラウド サービスを Azure にデプロイする準備ができたら、Azure ストレージ アカウントを指すように任意の接続文字列の値を変更できます。 **[…]** を選択し、**[ストレージ アカウントの資格情報の入力]** を選択します。 アカウント名とアカウント キーを含むアカウント情報を入力します。 **[ストレージ アカウント接続文字列]** ダイアログ ボックスで、既定の HTTPS エンドポイント (既定のオプション)、既定の HTTP エンドポイント、カスタム エンドポイントのどれを使用するかを指定することもできます。 「[Azure ストレージ アカウントの BLOB データのカスタム ドメイン名の構成](storage/blobs/storage-custom-domain-name.md)」で説明されているように、サービスのカスタム ドメイン名を登録している場合は、カスタム エンドポイントを使用できます。

> [!IMPORTANT]
> サービスをデプロイする前に、Azure ストレージ アカウントを指すように接続文字列を変更する必要があります。 変更していないと、ロールの起動に失敗したり、初期化状態、ビジー状態、停止状態を順に繰り返す可能性があります。
> 
> 

## <a name="endpoints-page"></a>[エンドポイント] ページ
worker ロールは、任意の数の HTTP、HTTPS、TCP エンドポイントを含むことができます。 エンドポイントには、外部のクライアントが利用できる入力エンドポイント、またはサービスで実行されている他のロールが利用できる内部エンドポイントを指定できます。

* HTTP エンドポイントを外部クライアントおよび Web ブラウザーから利用できるようにするには、エンドポイントの種類を [入力] に変更し、名前とパブリック ポート番号を指定します。
* HTTPS エンドポイントを外部クライアントおよび Web ブラウザーから利用できるようにするには、エンドポイントの種類を **[入力]**に変更し、名前、パブリック ポート番号、管理証明書名を指定します。
  
    管理証明書を指定するには、 **[証明書]** プロパティ ページで証明書を定義しておく必要があります。
* クラウド サービス内の他のロールからエンドポイントを内部利用できるようにするには、エンドポイントの種類を [内部] に変更し、名前とこのエンドポイントに使用可能なプライベート ポートを指定します。

## <a name="local-storage-page"></a>[ローカル ストレージ] ページ
**[ローカル ストレージ]** プロパティ ページを使用して、ロール用に 1 つ以上のローカル ストレージ リソースを予約できます。 ローカル ストレージ リソースは、ロールのインスタンスが実行されている Azure 仮想マシンのファイル システム内の予約されたディレクトリです。

## <a name="certificates-page"></a>[証明書] ページ
**[証明書]** ページでは、証明書とロールを関連付けることができます。 追加する証明書は、 **[エンドポイント]** プロパティ ページでの HTTPS エンドポイントの構成に使用できます。

**[証明書]** プロパティ ページでは、証明書についての情報をサービス構成に追加します。 証明書はサービスと共にパッケージ化されないことに注意してください。[Azure クラシック ポータル](http://go.microsoft.com/fwlink/?LinkID=213885)を使用して、Azure に証明書を個別にアップロードする必要があります。

証明書をロールに関連付けるには、証明書の名前を指定します。 **[エンドポイント]** プロパティ ページで HTTPS エンドポイントを構成する際に、この名前を使用して証明書を参照します。 次に、証明書ストアが **[ローカル コンピューター]** と **[現在のユーザー]** のどちらであるかと、ストアの名前を指定します。 最後に、証明書のサムプリントを入力します。 証明書が Current User\Personal (My) ストアに存在する場合、表示されたリストから証明書を選択することで、証明書のサムプリントを入力できます。 他の場所に存在する場合は、サムプリントの値を手動で入力します。

証明書ストアから証明書を追加すると、すべての中間証明書は自動的に構成設定に追加されます。 SSL に対してサービスを適切に構成するために、これらの中間証明書も Azure にアップロードする必要があります。

サービスに関連付けられた管理証明書がサービスに適用されるのは、サービスがクラウドで実行されている場合のみです。 サービスがローカル開発環境で実行されている場合には、コンピューティング エミュレーターが管理する標準の証明書が使用されます。

## <a name="configuring-the-azure-cloud-service-project"></a>Azure クラウド サービス プロジェクトの構成
Azure クラウド サービス プロジェクト全体に適用される設定を構成するには、まずそのプロジェクト ノードのショートカット メニューを開き、次に [プロパティ] を選択し、プロパティ ページを開きます。 これらのプロパティ ページを次の表に示します。

| プロパティ ページ | Description |
| --- | --- |
| アプリケーション |このページでは、このクラウド サービス プロジェクトが使用する Azure Tools のバージョン情報を表示したり、ツールを最新バージョンにアップグレードすることができます。 |
| ビルド イベント |このページでは、ビルド前およびビルド後のイベントを設定できます。 |
| 開発 |このページでは、ビルド構成の手順や、ビルド後イベントを実行する条件を指定できます。 |
| Web |このページでは、Web サーバーに関連する設定を構成できます。 |


