---
title: Azure Data Share のトラブルシューティング
description: Azure Data Share でデータ共有を作成または受信するときに発生する招待の問題やエラーをトラブルシューティングする方法について説明します。
services: data-share
author: jifems
ms.author: jife
ms.service: data-share
ms.topic: troubleshooting
ms.date: 12/16/2020
ms.openlocfilehash: 3aa1c0b8579bd37d2bb51cbde70997131c696813
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/29/2021
ms.locfileid: "97964509"
---
# <a name="troubleshoot-common-problems-in-azure-data-share"></a>Azure Data Share での一般的な問題をトラブルシューティングする 

この記事では、Azure Data Share での一般的な問題をトラブルシューティングする方法について説明します。 

## <a name="azure-data-share-invitations"></a>Azure Data Share の招待 

場合によっては、新しいユーザーがメールの招待状で **[招待を承諾]** を選択すると、空の招待一覧が表示されることがあります。 

:::image type="content" source="media/no-invites.png" alt-text="空の招待一覧を示すスクリーンショット。":::

この問題には、次のいずれかの原因が考えられます。

* **Azure Data Share サービスが、Azure テナント内の Azure サブスクリプションのリソース プロバイダーとして登録されていない。** この問題は、Azure テナントに Data Share リソースがない場合に発生します。 

    Azure Data Share リソースを作成すると、Azure サブスクリプションにリソース プロバイダーが自動的に登録されます。 次の手順に従って、Data Share サービスを手動で登録できます。 これらの手順を実行するには、Azure サブスクリプションの[共同作成者ロール](../role-based-access-control/built-in-roles.md#contributor)が必要です。 

    1. Azure portal で **[サブスクリプション]** に移動します。
    1. Azure Data Share リソースの作成に使用するサブスクリプションを選択します。
    1. **[リソース プロバイダー]** を選択します。
    1. 「**Microsoft.DataShare**」を検索します。
    1. **[登録]** を選択します。

* **Azure サインイン用のメール アドレスではなく、メール エイリアスに招待が送信されている。** Azure Data Share サービスを既に登録している、または Azure テナントに Data Share リソースを作成しているのに招待が表示されない場合は、メール エイリアスが受信者としてリストされている可能性があります。 データ プロバイダーに連絡して、招待がメール エイリアスではなく、Azure サインイン用のメール アドレスに送信されるようにしてください。

* **招待が既に承諾されている。** メールに記載されているリンクを使用すると、Azure portal の **[Data Share Invitations]\(Data Share の招待\)** ページに移動します。 このページには、保留中の招待のみが表示されます。 承諾済みの招待は、このページに表示されません。 受信した共有を表示して、ターゲットの Azure Data Explorer クラスター設定を構成するには、招待を承諾するために使用した Data Share リソースに移動します。

## <a name="creating-and-receiving-shares"></a>共有の作成と受信

新しい共有を作成したり、データセットを追加したり、データセットをマップしたりするときに、次のエラーが表示されることがあります。

* データセットを追加できませんでした。
* データセットをマップできませんでした。
* Data Share リソース x に y へのアクセス許可を付与できません。
* x に対する適切なアクセス許可がありません。
* 選択された 1 つ以上のリソースに対する Azure Data Share アカウントのアクセス許可を追加できませんでした。

Azure データ ストアに対する十分なアクセス許可がない場合、これらのエラーのいずれかが表示されることがあります。 詳細については、「[ロールと要件](concepts-roles-permissions.md)」を参照してください。 

Azure データ ストアとの間でデータを共有または受信するには、書き込みアクセス許可が必要です。 通常、このアクセス許可は共同作成者ロールの一部です。 

初めて Azure データ ストアからデータを共有または受信する場合は、*Microsoft.Authorization/role assignments/write* アクセス許可も必要です。 通常、このアクセス許可は所有者ロールの一部です。 自分で Azure データ ストア リソースを作成したとしても、必ずしもそのリソースの所有者になるわけではありません。 

適切なアクセス許可がある場合は、Azure Data Share サービスによって、データ ストアにアクセスするためのデータ共有リソースの管理 ID が自動的に付与されます。 このプロセスには数分かかることがあります。 この遅延のためにエラーが発生した場合は、数分後にもう一度やり直してください。

SQL ベースの共有には、追加のアクセス許可が必要です。 前提条件の詳細については、[SQL ソースからの共有](how-to-share-from-sql.md)に関する記事を参照してください。

## <a name="snapshots"></a>スナップショット
スナップショットは、さまざまな理由で失敗する場合があります。 スナップショットの開始時刻、次に各データ セットの状態を選択して、詳細なエラー メッセージを開きます。 

スナップショットは、通常、次の理由で失敗します。

* Data Share に、ソース データ ストアからの読み取り、またはターゲット データ ストアへの書き込みアクセス許可がない。 詳細については、「[ロールと要件](concepts-roles-permissions.md)」を参照してください。 スナップショットを初めて使用する場合、Data Share リソースが Azure データ ストアにアクセスするのに数分かかることがあります。 しばらくしてからもう一度試してください。
* ソース データ ストアまたはターゲット データ ストアへの Data Share の接続がファイアウォールによってブロックされている。
* 共有データセット、ソース データ ストア、またはターゲット データ ストアが削除された。

ストレージ アカウントの場合、スナップショットの実行中にソースでファイルが更新されているために、スナップショットが失敗することがあります。 その結果、0 バイトのファイルがターゲットに表示されることがあります。 ソースで更新が完了すると、スナップショットは成功します。

SQL ソースの場合、スナップショットは次のような理由で失敗することがあります。

* Data Share のアクセス許可を付与するソース SQL スクリプトまたはターゲット SQL スクリプトが実行されていない。 または、Azure SQL Database または Azure Synapse Analytics (旧称 Azure SQL Data Warehouse) の場合は、Azure Active Directory 認証ではなく、SQL 認証を使用してスクリプトが実行されている。  
* ソース データ ストアまたはターゲット SQL データ ストアが一時停止されている。
* スナップショット プロセスまたはターゲット データ ストアで SQL データ型がサポートされていない。 詳細については、[SQL ソースからの共有](how-to-share-from-sql.md#supported-data-types)に関する記事を参照してください。
* ソース データ ストアまたはターゲット SQL データ ストアが他のプロセスによってロックされている。 Azure Data Share では、これらのデータ ストアをロックしません。 ただし、これらのデータ ストアの既存のロックによって、スナップショットが失敗する可能性があります。
* ターゲット SQL テーブルが外部キー制約により参照されています。 スナップショット中、ターゲット テーブルが、ソース データ内のテーブルと同じ名前を持っている場合、Azure Data Share ではそのテーブルを削除して、新しいテーブルを作成します。 ターゲット SQL テーブルが外部キー制約により参照されている場合は、テーブルを削除できません。
* ターゲット CSV ファイルは生成されるが、Excel でそのデータを読み取れない。 ソース SQL テーブルに英語以外の文字が含まれるデータが含まれている場合に、この問題が発生することがあります。 Excel で、 **[データの取得]** タブを選択し、CSV ファイルを選択します。 ファイルの Origin として **65001:Unicode (UTF-8)** を選択してから、データを読み込みます。

## <a name="updated-snapshot-schedules"></a>更新されたスナップショット スケジュール
送信された共有のスナップショット スケジュールがデータ プロバイダーによって更新された後、データ コンシューマーは、前のスナップショット スケジュールを無効化する必要があります。 次に、受信した共有で、更新されたスナップショット スケジュールを有効にします。 

## <a name="next-steps"></a>次のステップ

データの共有を始める方法については、[データの共有](share-your-data.md)に関するチュートリアルをご覧ください。 

データを受信する方法については、[データの受け入れと受信](subscribe-to-data-share.md)に関するチュートリアルに進んでください。