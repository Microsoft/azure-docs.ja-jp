---
title: Azure Site Recovery における物理サーバーのディザスター リカバリー アーキテクチャ
description: この記事では、Azure Site Recovery サービスを使用してオンプレミスの物理サーバー を Azure にディザスター リカバリーするときに使用されるコンポーネントとアーキテクチャの概要を説明します。
ms.topic: conceptual
ms.date: 02/11/2020
ms.openlocfilehash: 089d981284986a2b6eb0ee7f1dbd401fc7ce4fcd
ms.sourcegitcommit: 76bc196464334a99510e33d836669d95d7f57643
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/12/2020
ms.locfileid: "77162839"
---
# <a name="physical-server-to-azure-disaster-recovery-architecture"></a>物理サーバーの Azure へのディザスター リカバリー アーキテクチャ

この記事では、[Azure Site Recovery](site-recovery-overview.md) サービスを使用してオンプレミスのサイトと Azure 間で物理 Windows サーバーおよび Linux サーバーをレプリケート、フェールオーバー、および復旧する場合に使用されるアーキテクチャとプロセスについて説明します。

## <a name="architectural-components"></a>アーキテクチャ コンポーネント

次の表と図は、Azure への物理サーバーのレプリケーションに使用するコンポーネントの概要を示したものです。

| **コンポーネント** | **要件** | **詳細** |
| --- | --- | --- |
| **Azure** | Azure サブスクリプションと Azure ネットワーク。 | オンプレミスの物理マシンからレプリケートされたデータは、Azure マネージド ディスクに格納されます。 オンプレミスから Azure へのフェールオーバーを実行すると、そのレプリケートされたデータで Azure VM が作成されます。 Azure VM は、作成時に Azure 仮想ネットワークに接続します。 |
| **プロセス サーバー** | 構成サーバーと共に既定でインストールされます。 | レプリケーション ゲートウェイとして機能します。 レプリケーション データを受信し、そのデータをキャッシュ、圧縮、暗号化によって最適化して、Azure Storage に送信します。<br/><br/> プロセス サーバーには、レプリケートするサーバー上のモビリティ サービスもインストールされます。<br/><br/> デプロイの拡大に合わせて、増大するレプリケーション トラフィックの処理を実行する独立したプロセス サーバーを追加できます。 |
| **マスター ターゲット サーバー** | 構成サーバーと共に既定でインストールされます。 | Azure からのフェールバック中にレプリケーション データを処理します。<br/><br/> 大規模なデプロイでは、フェールバック用に別のマスター ターゲット サーバーを追加できます。 |
| **レプリケートされるサーバー** | レプリケートする各サーバーにモビリティ サービスがインストールされます。 | プロセス サーバーから自動的にインストールできるようにすることをお勧めします。 または、サービスを手動でインストールしたり、Configuration Manager などの自動デプロイ方法を使用したりすることもできます。 |

**物理から Azure へのアーキテクチャ**

![Components](./media/physical-azure-architecture/arch-enhanced.png)

## <a name="replication-process"></a>レプリケーション プロセス

1. オンプレミスのコンポーネントと Azure コンポーネントを含むデプロイをセットアップします。 Recovery Services コンテナーで、レプリケーションのソースとターゲットの指定、構成サーバーのセットアップ、レプリケーション ポリシーの作成、レプリケーションの有効化を行います。
1. レプリケーション ポリシーを使用してマシンがレプリケートされると、サーバー データの初回コピーが Azure Storage にレプリケートされます。
1. 初回のレプリケーションの終了後、Azure への差分変更のレプリケーションが開始されます。 マシンの追跡された変更は _.hrl_ 拡張子のファイルに保持されます。
   - マシンは、レプリケーション管理のために、HTTPS 受信ポート 443 で構成サーバーと通信します。
   - マシンは、HTTPS 受信ポート 9443 でレプリケーション データをプロセス サーバーに送信します (変更可能)。
   - 構成サーバーは、HTTPS 送信ポート 443 経由で Azure によるレプリケーション管理を調整します。
   - プロセス サーバーは、ソース マシンからデータを受信し、そのデータを最適化して暗号化し、HTTPS 送信ポート 443 を介して Azure ストレージに送信します。
   - マルチ VM 整合性を有効にすると、レプリケーション グループ内のマシンは、ポート 20004 を介して相互に通信します。 フェールオーバー時にクラッシュ整合性復旧ポイントとアプリ整合性復旧ポイントを共有するレプリケーション グループに複数のマシンをグループ化する場合にマルチ VM が使用されます。 これらのグループは、これらのマシンが同じワークロードを実行していて、一貫性を持たせる必要がある場合に役立ちます。
1. トラフィックは、インターネット経由で Azure ストレージのパブリック エンドポイントにレプリケートされます。 また、Azure ExpressRoute の[パブリック ピアリング](../expressroute/about-public-peering.md)を使用することもできます。

   > [!NOTE]
   > オンプレミス サイトまたは Azure ExpressRoute の[プライベート ピアリング](concepts-expressroute-with-site-recovery.md#on-premises-to-azure-replication-with-expressroute)からのサイト間 VPN を介したレプリケーションはサポートされていません。

**物理から Azure へのレプリケーション プロセス**

![レプリケーション プロセス](./media/physical-azure-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a>フェールオーバーとフェールバックのプロセス

レプリケーションがセットアップされたら、ディザスター リカバリーの訓練 (フェールオーバーのテスト) を実行して、すべてが期待どおりに動作することを確認できます。 その後、必要に応じて、フェールオーバーとフェールバックを実行できます。 次の項目について検討してください。

- 計画フェールオーバーはサポートされていません。
- オンプレミスの VMware VM へのフェールバックは必要です。 オンプレミスの物理サーバーを Azure にレプリケートする場合でも、オンプレミスの VMware インフラストラクチャを作成する必要があります。
- 単一のマシンをフェールオーバーするか、復旧計画を作成して複数のマシンをまとめてフェールオーバーします。
- フェールオーバーを実行すると、Azure Storage のレプリケートされたデータから Azure VM が作成されます。
- 最初のフェールオーバーがトリガーされたら、Azure VM からワークロードへのアクセスを開始するようコミットします。
- プライマリ オンプレミス サイトが再度使用可能になると、フェールバックできます。
- 次のものを含むフェールバック インフラストラクチャを設定します。
  - **Azure 上の一時的なプロセス サーバー**:Azure からフェールバックするには、Azure からのレプリケーションを処理するプロセス サーバーとして機能する Azure VM を設定します。 この VM は、フェールバックの完了後に削除できます。
  - **VPN 接続**:フェールバックするには、Azure ネットワークからオンプレミス サイトへの VPN 接続 (または Azure ExpressRoute) が必要です。
  - **独立したマスター ターゲット サーバー**:既定では、フェールバックは、構成サーバーと共にオンプレミスの VMware VM にインストールされたマスター ターゲット サーバーによって処理されます。 大量のトラフィックをフェールバックする必要がある場合は、独立したオンプレミスのマスター ターゲット サーバーをセットアップする必要があります。
  - **フェールバック ポリシー**:ご利用のオンプレミスにもう一度レプリケートするには、フェールバック ポリシーが必要です。 このポリシーは、オンプレミスから Azure へのレプリケーション ポリシーを作成したときに自動的に作成されます。
  - **VMware インフラストラクチャ**: フェールバックするには VMware インフラストラクチャが必要です。 物理サーバーにはフェールバックできません。
- コンポーネントが配置されたら、フェールバックが 3 段階で発生します。
  - **ステージ 1**:Azure VM が Azure からオンプレミスの VMware VM へのレプリケートを開始するように、Azure VM を再保護します。
  - **ステージ 2**:オンプレミス サイトでフェールオーバーを実行します。
  - **ステージ 3**:ワークロードがフェールバックされたら、レプリケーションを再び有効にします。

**Azure からの VMware フェールバック**

![フェールバック](./media/physical-azure-architecture/enhanced-failback.png)

## <a name="next-steps"></a>次のステップ

Azure への物理サーバーのディザスター リカバリーを設定する方法については、[攻略ガイド](physical-azure-disaster-recovery.md)を参照してください。
