---
title: "Site Recovery でのフェールオーバー | Microsoft Docs"
description: "Azure Site Recovery は、仮想マシンと物理サーバーのレプリケーション、フェールオーバー、回復を調整します。 Azure またはセカンダリ データセンターへのフェールオーバーについて説明します。"
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/04/2017
ms.author: pratshar
ms.translationtype: Human Translation
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.openlocfilehash: ef586191f0b89dca89810644d45503fe42538635
ms.contentlocale: ja-jp
ms.lasthandoff: 07/08/2017


---
# <a name="failover-in-site-recovery"></a>Site Recovery でのフェールオーバー
この記事では、Site Recovery によって保護された仮想マシンと物理サーバーをフェールオーバーする方法について説明します。

## <a name="prerequisites"></a>前提条件
1. フェールオーバーを実行する前に、[テスト フェールオーバー](site-recovery-test-failover-to-azure.md)を行い、すべて想定どおりに実行されることを確認してください。
1. フェールオーバーの実行前にレプリケーション先の[ネットワークを準備](site-recovery-network-design.md)します。  


## <a name="run-a-failover"></a>フェールオーバーの実行
この手順では、[復旧計画](site-recovery-create-recovery-plans.md)のフェールオーバーを実行する方法について説明します。 別の方法として 1 台の仮想マシン (または物理サーバー) を対象に、**[レプリケートされたアイテム]** ページからフェールオーバーを実行することもできます。


![フェールオーバー](./media/site-recovery-failover/Failover.png)

1. **[復旧計画]**  >  *recoveryplan_name* を選択します。 **[フェールオーバー]** をクリックします。
2. フェールオーバーで復旧するポイント (**[復旧ポイント]**) を **[フェールオーバー]** 画面で選択します。 次のいずれかのオプションを使うことができます。
    1.  **Latest (最新)** (既定): このオプションは、Site Recovery サービスに送信されたすべてのデータを最初に処理して、各仮想マシンの復旧ポイントを作成してから、それにフェールオーバーします。 このオプションは、フェールオーバー後に作成された仮想マシンが、フェールオーバーがトリガーされた時点で Site Recovery サービスにレプリケートされたすべてのデータを含むようになるので、最も低い RPO (目標復旧時点) を提供します。
    1.  **Latest processed (最新の処理済み)**: このオプションは、復旧計画のすべての仮想マシンを、Site Recovery サービスによって既に処理された最新の復旧ポイントにフェールオーバーします。 仮想マシンのテスト フェールオーバーを行っているときは、最新の処理済み復旧ポイントのタイムスタンプも表示されます。 復旧計画のフェールオーバーを行っている場合は、個別の仮想マシンに移動し、**[最新の復旧ポイント]** タイルを見てこの情報を取得できます。 未処理データの処理に時間は費やされないので、このオプションは低 RTO (目標復旧時間) のフェールオーバー オプションを提供します。
    1.  **Latest app-consistent (最新のアプリ整合性)**: このオプションは、復旧計画のすべての仮想マシンを、Site Recovery サービスによって既に処理された最新のアプリケーション整合性復旧ポイントにフェールオーバーします。 仮想マシンのテスト フェールオーバーを行っているときは、最新のアプリ整合性復旧ポイントのタイムスタンプも表示されます。 復旧計画のフェールオーバーを行っている場合は、個別の仮想マシンに移動し、**[最新の復旧ポイント]** タイルを見てこの情報を取得できます。
    1.  **Latest multi-VM processed (最新のマルチ VM 処理済み)**: このオプションは、マルチ VM 整合性がオンになっている 1 つ以上の仮想マシンを含む復旧計画でのみ使用できます。 レプリケーション グループに含まれる仮想マシンは、最新の共通マルチ VM 整合性復旧ポイントにフェールオーバーされます。 その他の仮想マシンは、最新の処理済み復旧ポイントにフェールオーバーされます。  
    1.  **Latest multi-VM app-consistent (最新のマルチ VM アプリ整合性)**: このオプションは、マルチ VM 整合性がオンになっている 1 つ以上の仮想マシンを含む復旧計画でのみ使用できます。 レプリケーション グループに含まれる仮想マシンは、最新の共通マルチ VM アプリケーション整合性復旧ポイントにフェールオーバーされます。 その他の仮想マシンは、最新のアプリケーション整合性復旧ポイントにフェールオーバーされます。
    1.  **Custom (カスタム)**: 仮想マシンのテスト フェールオーバーを行う場合は、このオプションを使って特定の復旧ポイントにフェールオーバーできます。

    > [!NOTE]
    > 復旧ポイントを選択するオプションは、フェールオーバー先が Azure である場合にのみ使用できます。
    >
    >


1. 前回の実行時に、復旧計画に含まれる一部の仮想マシンをフェールオーバー済みで、現在それらの仮想マシンが切り替え元と切り替え先の両方でアクティブになっている場合、**[方向の変更]** オプションを使用して、フェールオーバーの方向を変えることができます。
1. Azure にフェールオーバーし、クラウドのデータ暗号化が有効になっている場合には (VMM サーバーから Hyper-V 仮想マシンを保護した場合のみ)、**[暗号化キー]** で、VMM サーバーへのセットアップ中にデータ暗号化を有効にしたときに発行された証明書を選択します。
1. Site Recovery でフェールオーバーを開始する前にそのソース仮想マシンをシャットダウンする場合は、**[フェールオーバーを開始する前にマシンをシャットダウンします]** を選択します。 仮にシャットダウンが失敗したとしても、フェールオーバーは続行されます。  

    > [!NOTE]
    > さらに Hyper-V 仮想マシンの場合、このオプションを選択すると、Site Recovery サービスへの送信が済んでいないオンプレミスのデータを同期するように、フェールオーバーの開始前に試行されます。
    >
    >

1. フェールオーバーの進行状況は **[ジョブ]** ページで確認できます。 計画されていないフェールオーバーの実行中にエラーが発生しても、復旧計画は最後まで実行されることに注意してください。
1. フェールオーバーの実行後、仮想マシンにログインして検証します。 仮想マシンの復旧ポイントを変更する場合は、**[復旧ポイントの変更]** を選択してください。
1. 正常な状態に仮想マシンがフェールオーバーされたら、フェールオーバーを**コミット**することができます。 Site Recovery サービスで利用できる復旧ポイントは、この操作ですべて削除され、それ以降 **[復旧ポイントの変更]** オプションは選択できなくなります。

## <a name="planned-failover"></a>計画されたフェールオーバー
Site Recovery を使って保護された Hyper-V 仮想マシンは、フェールオーバーとは別に、"**計画されたフェールオーバー**" に対応します。 これは、データの損失がまったく発生しないフェールオーバー方式です。 計画されたフェールオーバーを開始すると、まず、ソース仮想マシンがシャットダウンされ、未同期となっているデータが同期されてから、フェールオーバーが開始されます。

> [!NOTE]
> オンプレミス サイト間で Hyper-V 仮想マシンをフェールオーバーしている場合、プライマリ オンプレミス サイトにフェールバックするには、まず仮想マシンをプライマリ サイトに逆レプリケーション (**レプリケーションの反転**) してからフェールオーバーを開始します。 プライマリ仮想マシンが利用できない場合は、**レプリケーションの反転**を実行する前に、バックアップから仮想マシンを復元してください。   
>
>

## <a name="failover-job"></a>フェールオーバー ジョブ

![フェールオーバー](./media/site-recovery-failover/FailoverJob.png)

フェールオーバーを開始すると次の手順が実行されます。

1. 前提条件チェック: フェールオーバーに必要な条件がすべて満たされていることが、この手順で確認されます。
1. フェールオーバー: この手順でデータが処理され、Azure 仮想マシンを作成する準備が整います。 復旧ポイントとして "**Latest (最新)**" を選択した場合は、Site Recovery サービスに送信済みのデータから復旧ポイントが作成されます。
1. 開始: 前の手順で処理されたデータを使って Azure 仮想マシンが作成されます。

> [!WARNING]
> **進行中のフェールオーバーはキャンセルしないでください**。仮想マシンのレプリケーションは、フェールオーバーが開始される前に停止されます。 進行中のジョブを**キャンセル**した場合、フェールオーバーは停止しますが、仮想マシンのレプリケートは開始されません。 二度とレプリケーションを開始できなくなります。
>
>

## <a name="time-taken-for-failover-to-azure"></a>Azure へのフェールオーバーにかかる時間

一部のケースでは、仮想マシンのフェールオーバーに、通常 8 ～ 10 分かかる特別な中間ステップが必要となります。 次のケースが該当します。

* VMware 仮想マシンで使用されているモビリティ サービスのバージョンが 9.8 未満
* 物理サーバー 
* VMware Linux 仮想マシン
* 物理サーバーとして保護されている Hyper-V 仮想マシン
* ブート ドライバーとして次のドライバーが存在していない VMware 仮想マシン 
    * storvsc 
    * vmbus 
    * storflt 
    * intelide 
    * atapi
* DHCP サービス (DHCP と静的 IP アドレスのどちらでも可) が有効になっていない VMware 仮想マシン

その他すべてのケースでは、この中間ステップは不要であり、フェールオーバーに要する時間は大幅に短くなります。 





## <a name="using-scripts-in-failover"></a>フェールオーバーでのスクリプト使用
フェールオーバーの実行中に特定の操作を自動化したい場合があります。 そのような場合は、[復旧計画](site-recovery-create-recovery-plans.md)の中でスクリプトまたは [Azure Automation Runbook](site-recovery-runbook-automation.md) を使用してください。

## <a name="other-considerations"></a>その他の考慮事項
* **ドライブ文字** — フェールオーバー後に仮想マシンのドライブ文字を保持する場合は、仮想マシンの **SAN のポリシー**を **[OnlineAll]** に設定することができます。 詳細については、[こちら](https://support.microsoft.com/en-us/help/3031135/how-to-preserve-the-drive-letter-for-protected-virtual-machines-that-are-failed-over-or-migrated-to-azure)を参照してください。



## <a name="next-steps"></a>次のステップ
仮想マシンのフェールオーバー後、オンプレミスのデータ センターが復旧したら、オンプレミス データ センターをレプリケーション先として、VMware 仮想マシンを[**再保護**](site-recovery-how-to-reprotect.md)する必要があります。

Azure からオンプレミスに Hyper-V 仮想マシンを**フェールバック**するには、[**[計画されたフェールオーバー]**](site-recovery-failback-from-azure-to-hyper-v.md) オプションを使用します。

VMM サーバーによって管理された別のオンプレミス データ センターに Hyper-V 仮想マシンをフェールオーバーした後、プライマリ データ センターが稼働状態になった場合は、**[レプリケーションの反転]** オプションを使用して、プライマリ データ センターへの逆レプリケーションを開始してください。

