---
title: "Azure Site Recovery を使用して Azure に物理サーバーをレプリケートするためのアーキテクチャを確認する | Microsoft Docs"
description: "この記事では、Azure Site Recovery サービスを使用してオンプレミスの物理サーバー を Azure にレプリケートするときに使用されるコンポーネントとアーキテクチャの概要を説明します"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 09c9b136-35f5-465e-8d0f-f4c5d5d9f880
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.translationtype: Human Translation
ms.sourcegitcommit: 138f04f8e9f0a9a4f71e43e73593b03386e7e5a9
ms.openlocfilehash: 843c3f1b54f50fe50b162ed242deab717a080830
ms.contentlocale: ja-jp
ms.lasthandoff: 06/29/2017

---

# <a name="step-1-review-the-architecture-for-physical-server-replication-to-azure"></a>手順 1: Azure に物理サーバーをレプリケートするためのアーキテクチャを確認する

この記事では、[Azure Site Recovery](site-recovery-overview.md) サービスを使用してオンプレミスの Windows/Linux 物理サーバーを Azure にレプリケートするときに使用されるコンポーネントとプロセスについて説明します。

この記事の末尾にあるコメント欄でご意見をお送りください。または [Azure Recovery Services フォーラム](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr) に質問を投稿してください。


## <a name="architectural-components"></a>アーキテクチャ コンポーネント

必要なコンポーネントを次の表に示します。

**コンポーネント** | **要件** | **詳細**
--- | --- | ---
**Azure** | Azure アカウント、Azure Storage アカウント、および Azure ネットワークが必要です。 | レプリケートされたデータは Storage アカウントに格納され、フェールオーバーが発生すると、レプリケートされたデータを使用して Azure VM が作成されます。 Azure VM は、作成時に Azure 仮想ネットワークに接続します。
**構成サーバー** | すべてのオンプレミスの Site Recovery コンポーネントを実行する単一のオンプレミス管理サーバー (物理サーバーまたは VMware VM)。 これには、構成サーバー、プロセス サーバー、マスター ターゲット サーバーが含まれます。 | 構成サーバー コンポーネントは、オンプレミスと Azure の間の通信を調整し、データのレプリケーションを管理します。
 **プロセス サーバー**  | 構成サーバーに既定でインストールされます。 | レプリケーション ゲートウェイとして機能します。 レプリケーション データを受信し、そのデータをキャッシュ、圧縮、暗号化によって最適化して、Azure Storage に送信します。<br/><br/> プロセス サーバーは、保護されるマシンへのモビリティ サービスのプッシュ インストールも処理します。<br/><br/> 増大するレプリケーション トラフィックを処理するために、独立した専用プロセス サーバーを追加できます。
 **マスター ターゲット サーバー** | 既定で、オンプレミスの構成サーバーにインストールされます。 | Azure からのフェールバック中にレプリケーション データを処理します。<br/><br/> フェールバックのトラフィックの量が多い場合は、フェールバック用に別のマスター ターゲット サーバーをデプロイすることができます。
**レプリケートされるサーバー** | レプリケートされる各 Windows/Linux サーバーに、モビリティ サービス コンポーネントがインストールされている必要があります。 このサービスは、各マシンに手動でインストールすることも、プロセス サーバーからのプッシュ インストールでインストールすることもできます。
**フェールバック** | フェールバックするには、VMware インフラストラクチャが必要です。 物理サーバーにはフェールバックできません。


**図 1: 物理サーバーから Azure へのコンポーネント**

![コンポーネント](./media/physical-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a>レプリケーション プロセス

1. オンプレミスと Azure のコンポーネントを含むデプロイをセットアップします。 Recovery Services コンテナーで、レプリケーションのソースとターゲットの指定、構成サーバーのセットアップ、レプリケーション ポリシーの作成、モビリティ サービスのデプロイ、レプリケーションの有効化、およびテスト フェールオーバーを行います。
2.  レプリケーション ポリシーに従ってマシンのレプリケーションが実行されると、データの最初のコピーが Azure Storage にレプリケートされます。
4. 初回のレプリケーションの終了後、Azure への差分変更のレプリケーションが開始されます。 マシンの追跡された変更は .hrl ファイルに保持されます。
    - レプリケートするマシンは、レプリケーション管理のために、受信ポート HTTPS 443 で構成サーバーと通信します。
    - レプリケートするマシンは、受信ポート HTTPS 9443 でレプリケーション データをプロセス サーバーに送信します (変更可能)。
    - 構成サーバーは、送信ポート HTTPS 443 経由で Azure によるレプリケーション管理を調整します。
    - プロセス サーバーは、ソース マシンからデータを受信し、そのデータを最適化して暗号化し、送信ポート 443 を介して Azure Storage に送信します。
    - マルチ VM 整合性を有効にすると、レプリケーション グループ内のマシンは、ポート 20004 を介して相互に通信します。 フェールオーバー時にクラッシュ整合性復旧ポイントとアプリ整合性復旧ポイントを共有するレプリケーション グループに複数のマシンをグループ化する場合にマルチ VM が使用されます。 これは、これらのマシンが同じワークロードを実行していて、一貫性を持たせる必要がある場合に役立ちます。
5. トラフィックは、インターネット経由で Azure Storage のパブリック エンドポイントにレプリケートされます。 また、Azure ExpressRoute の[パブリック ピアリング](../expressroute/expressroute-circuit-peerings.md#public-peering)を使用することもできます。 オンプレミス サイトから Azure へのサイト間 VPN を介したトラフィックのレプリケートはサポートされていません。

**図 2: 物理サーバーから Azure へのレプリケーション**

![拡張](./media/physical-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a>フェールオーバーとフェールバックのプロセス

テスト フェールオーバーが想定どおりに動作することを確認した後、必要に応じて、Azure への計画されていないフェールオーバーを実行することができます。 フェールオーバーを実行すると、レプリケートされたデータから Azure VM が作成されます。 これにより、オンプレミスのプライマリ サイトが再び使用可能になったときにフェールバックを実行できます。 以下の点に注意してください。

- 計画フェールオーバーはサポートされていません。
- 単一のマシンをフェールオーバーするか、[復旧計画](site-recovery-create-recovery-plans.md)を作成して複数のマシンをまとめてフェールオーバーすることができます。
- フェールオーバーをコミットして、レプリカの Azure VM からワークロードへのアクセスを開始します。
- プライマリ サイトが再び使用可能になったときに、セカンダリからプライマリ サイトにマシンをレプリケートします。 次に、セカンダリ サイトから計画外のフェールオーバーを実行します。 このフェールオーバーをコミットすると、データがオンプレミスに戻るため、Azure へのレプリケーションをもう一度有効にする必要があります。

フェールバックには、次のコンポーネントが含まれます。

- **Azure 内の一時的なプロセス サーバー**: Azure からのレプリケーションを処理するために、プロセス サーバーとして機能する Azure VM をセットアップする必要があります。 この VM は、フェールバックの完了後に削除できます。
- **VPN 接続**: Azure ネットワークからオンプレミス サイトへの VPN 接続 (または Azure ExpressRoute) が必要です。
- **独立したオンプレミスのマスター ターゲット サーバー**: オンプレミスのマスター ターゲット サーバー (構成サーバーに規定でインストールされます) によって、フェールバックが処理されます。 大量のトラフィックをフェールバックする場合は、その目的を果たすための独立したオンプレミスのマスター ターゲット サーバーをセットアップする必要があります。
- **フェールバック ポリシー**: フェールバック ポリシーが必要です。 これは、レプリケーション ポリシーを作成したときに自動的に作成されます。
- **VMware インフラストラクチャ**: オンプレミスの VMware VM にフェールバックする必要があります。 これは、オンプレミスの物理サーバーを Azure にレプリケートする場合でも、オンプレミスの VMware インフラストラクチャを作成する必要があることを意味します。

**図 3: 物理サーバーのフェールバック**

![フェールバック](./media/physical-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a>次のステップ

「[手順 2: 前提条件と制限事項を確認する](physical-walkthrough-prerequisites.md)」に進みます。

