---
title: Azure Site Recovery を使用した VMware VM ディザスター リカバリーでのフェールバックのトラブルシューティング
description: この記事では、Azure Site Recovery を使用して VMware VM を Azure にディザスター リカバリーするときのフェールバックと再保護の問題をトラブルシューティングする方法について説明します。
author: Sharmistha-Rai
manager: gaggupta
ms.service: site-recovery
ms.topic: conceptual
ms.date: 11/27/2018
ms.author: sharrai
ms.openlocfilehash: ed4e52470264441a99c5ccf0a736bb00233510c1
ms.sourcegitcommit: e71da24cc108efc2c194007f976f74dd596ab013
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/29/2020
ms.locfileid: "87423118"
---
# <a name="troubleshoot-failback-to-on-premises-from-azure"></a>Azure からオンプレミスへのフェールバックのトラブルシューティング

この記事では、[Azure Site Recovery](site-recovery-overview.md) を使用して Azure にフェールオーバーした後で、Azure VM をオンプレミスの VMware インフラストラクチャにフェールバックする際に発生する可能性がある問題のトラブルシューティング方法について説明します。

基本的に、フェールバックには主な手順が 2 つあります。 最初の手順では、フェールオーバー後、Azure VM がレプリケートを開始するように、それらをオンプレミスで再保護する必要があります。 2 番目の手順は、Azure からフェールオーバーを実行して、オンプレミス サイトにフェールバックすることです。

## <a name="common-issues"></a>一般的な問題

- 読み取り専用ユーザー vCenter の検出を実行し、仮想マシンを保護すると、適切に保護され、フェールオーバーが機能します。 再保護中は、データストアが検出できないため、フェールオーバーは失敗します。 再保護中はデータストアが一覧表示されないという現象が発生します。 この問題を解決するには、アクセス許可が割り当てられている適切なアカウントを使用して vCenter 資格情報を更新し、ジョブを再試行します。
- Linux 仮想マシンをフェールバックし、それをオンプレミスで実行すると、ネットワーク マネージャー パッケージがマシンからアンインストールされていることを確認できます。 このアンインストールは、Azure で仮想マシンが復旧されるときに、ネットワーク マネージャー パッケージが削除されるために発生します。
- Linux 仮想マシンが静的 IP アドレスで構成されているときに Azure にフェールオーバーされると、IP アドレスは DHCP から取得されます。 オンプレミスにフェールオーバーすると、仮想マシンは、引き続き DHCP を使用して IP アドレスを取得します。 必要であれば、手動でマシンにサインインし、IP アドレスを静的アドレスに設定し直します。 Windows 仮想マシンは、同じ静的 IP アドレスを再度取得できます。
- ESXi 5.5 Free エディションまたは vSphere 6 Hypervisor Free エディションを使用すると、フェールオーバーは成功しますが、フェールバックが失敗します。 フェールバックを有効にするには、いずれかのプログラムの評価ライセンスにアップグレードしてください。
- プロセス サーバーから構成サーバーにアクセスできない場合は、Telnet を使用して、構成サーバーのポート 443 への接続を確認します。 プロセス サーバーから構成サーバーに対して ping を試すこともできます。 プロセス サーバーも、構成サーバーに接続されている場合、ハートビートを送信します。
- 物理オンプレミス サーバーとして保護されている Windows Server 2008 R2 SP1 サーバーは、Azure からオンプレミス サイトにフェールバックすることができません。
- 次のような状況ではフェールバックできません。
    - マシンを Azure に移行した。 
    - 別のリソース グループに VM を移動した。
    - Azure VM を削除した。
    - VM の保護を無効にした。
    - 手動で Azure に VM を作成した。 マシンは、最初にオンプレミスで保護されていて、再保護の前に Azure にフェールオーバーされたものでなければなりません。
    - ESXi ホストにのみ、フェールバックすることができます。 VMware VM または物理サーバーを Hyper-V ホスト、物理マシン、または VMware ワークステーションにフェールバックすることはできません。


## <a name="troubleshoot-reprotection-errors"></a>再保護エラーのトラブルシューティング

このセクションでは、一般的な再保護エラーとその修正方法について説明します。

### <a name="error-code-95226"></a>エラー コード 95226

**Azure 仮想マシンがオンプレミスの構成サーバーにアクセスできなかったため、再保護に失敗しました。**

このエラーは、次の場合に発生します。

* Azure VM がオンプレミスの構成サーバーに到達できません。 VM は検出されず、構成サーバーに登録されません。
* InMage Scout Application サービスが、フェールオーバー後に Azure VM で実行されていません。 このサービスは、オンプレミスの構成サーバーとの通信に必要です。

この問題を解決するには、次の手順を実行します。

* Azure VM ネットワークで、Azure VM がオンプレミスの構成サーバーと通信できるようになっていることを確認します。 オンプレミスのデータセンターへのサイト間 VPN をセットアップするか、Azure VM の仮想ネットワーク上でプライベート ピアリングを使用して Azure ExpressRoute 接続を構成することができます。
* VM がオンプレミスの構成サーバーと通信できる場合は、VM にサインインします。 次に、InMage Scout アプリケーション サービスを確認します。 実行中ではない場合は、手動でサービスを開始します。 サービスのスタートアップの種類が **[自動]** に設定されていることを確認します。

### <a name="error-code-78052"></a>エラー コード 78052

**仮想マシンの保護を完了できませんでした。**

この問題は、フェールバック先のマスター ターゲット サーバー上に同じ名前の VM が既に存在する場合に発生します。

この問題を解決するには、次の手順を実行します。

* 別のホスト上にある別のマスター ターゲット サーバーを選択して、再保護によって別のホストにマシンが作成され、名前が競合しないようにします。
* また、VMotion を使用して、名前の競合が発生しない別のホストにマスター ターゲットを移動することもできます。 既存の VM がはぐれたマシンである場合は、同じ ESXi ホストで新しい VM を作成できるように、はぐれたマシンの名前を変更します。


### <a name="error-code-78093"></a>エラー コード 78093

**VM が実行中でないか、応答していないか、アクセスできないかのいずれかです。**

この問題を解決するには、次の手順を実行します。

フェールオーバーした VM を再保護するには、Azure VM が動作している必要があります。これは、モビリティ サービスがオンプレミスの構成サーバーに登録され、プロセス サーバーと通信することでレプリケートを開始できるようにするためです。 マシンが不適切なネットワーク上にある場合や、実行されていない (応答しないまたはシャットダウンされている) 場合、構成サーバーは VM 上の Mobility Service に到達できず、再保護を開始することができません。

* VM を再起動して、オンプレミスで通信を開始できるようにします。
* Azure 仮想マシンを起動した後に、再保護ジョブを再起動します。

### <a name="error-code-8061"></a>エラー コード 8061

"**データ ストアには、ESXi ホストからアクセスできません。** "

[マスター ターゲットの前提条件とフェールバック用にサポートされているデータストア](vmware-azure-prepare-failback.md#deploy-a-separate-master-target-server)を確認してください。


## <a name="troubleshoot-failback-errors"></a>フェールバック エラーのトラブルシューティング

このセクションでは、フェールバック中に発生することがある一般的なエラーについて説明します。

### <a name="error-code-8038"></a>エラー コード 8038

**エラーが原因で、オンプレミスの仮想マシンを呼び出せませんでした。**

この問題が発生するのは、十分なメモリがプロビジョニングされていないホストでオンプレミスの VM が呼び出された場合です。 

この問題を解決するには、次の手順を実行します。

* ESXi ホストに、より多くのメモリをプロビジョニングします。
* また、VMotion を使用して、VM を起動するための充分なメモリがある別の ESXi ホストに VM を移動します。
