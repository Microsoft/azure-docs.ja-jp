---
title: "Azure Site Recovery によって保護された Hyper-V 仮想マシンのフェールバック | Microsoft Docs"
description: "Azure Site Recovery は、仮想マシンと物理サーバーのレプリケーション、フェールオーバー、回復を調整します。 Azure からオンプレミスのデータ センターにフェールバックする方法について説明します。"
services: site-recovery
documentationcenter: 
author: ruturaj
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 2/15/2017
ms.author: ruturajd
translationtype: Human Translation
ms.sourcegitcommit: 5e6ffbb8f1373f7170f87ad0e345a63cc20f08dd
ms.openlocfilehash: 845a950f02ba95a100ffedbb07e4d1491b22a2da
ms.lasthandoff: 03/24/2017


---
# <a name="failback-in-site-recovery"></a>Site Recovery でのフェールバック
> [!div class="op_single_selector"]
> * [Azure から VMware/物理マシン](site-recovery-failback-azure-to-vmware.md)
> * [Azure から Hyper-V VM](site-recovery-failback-from-azure-to-hyper-v.md)

この記事では、Site Recovery によって保護された仮想マシンをフェールバックする方法について説明します。 

## <a name="prerequisites"></a>前提条件
1. プライマリ サイトの VMM サーバー/Hyper-V サーバーが接続されていることを確認します。
2. 仮想マシンが**コミット**済みである必要があります。

## <a name="why-is-there-no-button-called-failback"></a>"フェールバック" という名前のボタンが存在しない理由
ポータルには、具体的に "フェールバック" という名称の付いた UI がありません。 フェールバックとは、退避した仮想マシンをプライマリ サイトに戻すための操作です。 プライマリ (オンプレミス) サイトから復旧 (Azure) サイトに仮想マシンを切り替えるときがフェールオーバーで、復旧サイトからプライマリ サイトに仮想マシンを切り替えるときがフェールバックであると考えることができます。

フェールオーバーを開始すると、そのジョブの方向がブレードに表示されます。 この方向が Azure からオンプレミスであるとき、特にフェールバックと呼んでいます。

## <a name="why-is-there-only-a-planned-failover-gesture-to-failback"></a>計画されたフェールオーバーの UI 操作しかフェールバックには存在しない理由
Azure は高可用性環境であり、皆さんの仮想マシンはいつでも利用できる状態にあります。 フェールバックとは、退避したワークロードを再度オンプレミスで実行できるよう、わずかなダウンタイムを見込んで行う "計画された" 作業です。 この作業では、データの損失がないことが要求されます。 UI 操作として利用できるのが計画されたフェールオーバーのみであるのはそのためです。計画されたフェールオーバーで、Azure 内の VM を停止してから直近の変更をダウンロードし、データの損失を確実に防ぎます。

## <a name="initiate-failback"></a>フェールバックの開始
プライマリからセカンダリの場所へのフェールオーバー後は、レプリケートされた仮想マシンは Site Recovery では保護されず、セカンダリの場所が "アクティブな場所" として機能するようになります。 元のプライマリ サイトにフェールバックするには、次の手順に従います。 この手順では、復旧計画の、計画されたフェールオーバーを実行する方法について説明します。 別の方法として、 **[仮想マシン]** タブで、単一の仮想マシンに対するフェールオーバーを実行することもできます。

1. **[復旧計画]**  >  *recoveryplan_name* を選択します。 **フェールオーバー** > **Planned フェールオーバー**で投稿してください。
2. **[計画されたフェールオーバーの確認]**ページで、ソースとターゲットの場所を選択します。 フェールオーバーの方向に注意してください。 プライマリからのフェールオーバーが想定どおりに機能し、すべての仮想マシンがセカンダリの場所にある場合には、これは情報の提供のみを目的としています。
3. Azure からフェールバックする場合は、 **[データの同期 (Data Synchronization)]**で次の設定を選択してください。

   * **[フェールオーバーの前にデータを同期する (差分変更のみを同期する)]** - 仮想マシンをシャットダウンせずに同期するため、仮想マシンのダウンタイムが最小限に抑えられます。 その内容は次のとおりです。
     * フェーズ 1: Azure で仮想マシンのスナップショットを取得し、それをオンプレミスの Hyper-V ホストにコピーします。 マシンは Azure での実行を継続します。
     * フェーズ 2: Azure で仮想マシンをシャットダウンします。これでその仮想マシンでは新しい変更は発生しません。 差分変更の最終セットがオンプレミス サーバーに転送され、オンプレミスの仮想マシンが起動します。

    - **[フェールオーバー中にのみデータを同期する (すべてダウンロードする)]**- Azure の実行期間が長い場合にこのオプションを使用します。 ほとんどのディスクを変更し、チェックサム計算に時間をかけたくない場合は、このオプションの方が高速です。 ディスクのダウンロードが実行されます。 また、オンプレミスの仮想マシンを削除した場合にも便利です。

    >[!NOTE] 
    >Azure を長期間 (1 か月間以上) 実行している場合、またはオンプレミスの仮想マシンを削除した場合にこのオプションを使用することをお勧めします。このオプションを選択しても、チェックサム計算は実行されません。
    >
    >




4. クラウドのデータ暗号化が有効になっている場合には、**[暗号化キー]** で、VMM サーバーへのプロバイダーのインストール中にデータ暗号化を有効にしたときに発行された証明書を選択します。
5. フェールオーバーを開始します。 フェールオーバーの進行状況は、 **[ジョブ]** タブで確認できます。
6. フェールオーバー前のデータを同期するオプションを選択した場合、初期データの同期が完了して、Azure で仮想マシンをシャットダウンする準備ができたら、**[ジョブ]**、[計画されたフェールオーバーのジョブ名]、**[フェールオーバーの実行]** の順にクリックします。 これにより Azure で仮想マシンがシャットダウンされ、最新の変更がオンプレミスの仮想マシンに転送され、オンプレミスの VM が起動します。
7. これで仮想マシンにログオンして、それが想定どおりに使用できるかを検証できます。
8. 仮想マシンは、コミット保留中の状態になります。 **[コミット]** をクリックして、フェールオーバーをコミットします。
9. フェールバックを完了するために、 **[レプリケーションの反転]** をクリックして、プライマリ サイトの仮想マシンの保護を開始します。

## <a name="failback-to-an-alternate-location"></a>別の場所へのフェールバック
[Hyper-V サイトと Azure](site-recovery-hyper-v-site-to-azure.md) の間での保護がデプロイされている場合は、Azure から別のオンプレミスの場所にフェールバックを実行できます。 これは、新しいオンプレミス ハードウェアを設定する必要がある場合に便利です。 これを行うには、次の手順を実行します。

1. 新しいハードウェアを設定する場合は、Windows Server 2012 R2 および Hyper-V のロールをサーバーにインストールします。
2. 元のサーバーに保存していたものと同じ名前を使用して、仮想ネットワーク スイッチを作成します。
3. フェールバックの対象を **[保護された項目]**  ->  **[保護グループ]**  ->  <ProtectionGroupName>  ->  <VirtualMachineName>で選択して、**[計画されたフェールオーバー]** を選択します。
4. **[計画されたフェールオーバーの確認]** select **[オンプレミスの仮想マシンが存在しない場合に作成 (Create on-premises virtual machine if it does not exist)]**で投稿してください。
5. **[ホスト名]** で、仮想マシンを配置する、新しい Hyper-V ホスト サーバーを選択します。
6. [データの同期 (Data Synchronization)] で、オプション **[フェールオーバー前のデータを同期 (Synchronize the data before the failover)]**を選択することをお勧めします。 このオプションを指定すると、仮想マシンをシャットダウンせずに同期するため、ダウンタイムを最小限に抑えることができます。 その内容は次のとおりです。

   * フェーズ 1: Azure で仮想マシンのスナップショットを取得し、それをオンプレミスの Hyper-V ホストにコピーします。 マシンは Azure での実行を継続します。
   * フェーズ 2: Azure で仮想マシンをシャットダウンします。これでその仮想マシンでは新しい変更は発生しません。 変更の最終セットがオンプレミス サーバーに転送され、オンプレミスの仮想マシンが起動します。
7. チェックマークをクリックして、フェールオーバー (フェールバック) を開始します。
8. 初期の同期が終了し、Azure で仮想マシンをシャットダウンする準備ができたら、 **[ジョブ]** > <planned failover job> > **[フェールオーバーの実行]**で投稿してください。 これにより Azure で仮想マシンがシャットダウンされ、最新の変更がオンプレミスの仮想マシンに転送され、オンプレミスの仮想マシンが起動します。
9. これでオンプレミスの仮想マシンにログオンして、すべてが想定どおりに動作するかどうかを検証できます。 **[コミット]** をクリックして、フェールオーバーを完了します。
10. **[レプリケーションの反転]** をクリックして、オンプレミス仮想マシンの保護を開始します。

    > [!NOTE]
    > "データの同期" 中にフェールバック ジョブを取り消した場合、オンプレミスの VM は破損状態となります。 データの同期によって Azure VM ディスクからオンプレミスのデータ ディスクに最新のデータがコピーされるので、同期が完了するまでは、ディスク データの一貫性が保たれていない可能性があるためです。 データの同期を取り消した後でオンプレミスの VM を起動する場合、その VM は起動しないおそれがあります。 フェールオーバーの再トリガーを行い、データの同期を完了してください。
    >
    >



## <a name="next-steps"></a>次のステップ

フェールバック ジョブが完了したら、仮想マシンを**コミット**します。 コミットすることによって Azure 仮想マシンとそのディスクが削除され、再び VM が保護された状態になります。

**コミット**後、逆レプリケーション ("*レプリケーションの反転*") を開始できます。 この操作を境として、仮想マシンの保護の方向が再びオンプレミスから Azure となります。 このときにレプリケートされるのは、Azure で VM を停止した後に生じた変更のみであることに注意してください。つまり送信されるのは差分変更だけです。



