---
title: "VMware VM を Azure からオンプレミスにフェールバックする | Microsoft Docs"
description: "VMware VM および物理サーバーを Azure にフェールオーバーした後に、オンプレミス サイトにフェールバックする方法について説明します。"
services: site-recovery
documentationcenter: 
author: ruturaj
manager: mkjain
editor: 
ms.assetid: 5a47337f-89a9-43e8-8fdc-7da373c0fb0f
ms.service: site-recovery
ms.devlang: na
ms.tgt_pltfrm: na
ms.topic: article
ms.workload: storage-backup-recovery
ms.date: 03/27/2017
ms.author: ruturajd
ms.translationtype: HT
ms.sourcegitcommit: bde1bc7e140f9eb7bb864c1c0a1387b9da5d4d22
ms.openlocfilehash: dde0bb6b4f6bc10afdd7d40adc6689d42b37de81
ms.contentlocale: ja-jp
ms.lasthandoff: 07/21/2017

---
# <a name="fail-back-vmware-virtual-machines-and-physical-servers-to-the-on-premises-site"></a>VMware 仮想マシンと物理サーバーをオンプレミス サイトにフェールバックする


この記事では、Azure からオンプレミス サイトへ Azure Virtual Machines をフェールバックする方法について説明します。 ここに示す手順は、[こちら](site-recovery-how-to-reprotect.md)を参照してコンピューターを再保護した後に、VMware 仮想マシンまたは Windows/Linux 物理サーバーをフェールバックする準備ができたときに実行します。

>[!NOTE]
>従来の Azure Portal を使用している場合は、Azure アーキテクチャへと機能強化された VMware については[こちら](site-recovery-failback-azure-to-vmware-classic.md)の手順を参照し、従来のアーキテクチャについては[こちら](site-recovery-failback-azure-to-vmware-classic-legacy.md)の手順を参照してください。

## <a name="overview"></a>概要
このセクションの図では、このシナリオのフェールバック アーキテクチャを示します。

このアーキテクチャは、プロセス サーバーがオンプレミスであり、Azure ExpressRoute 接続を使用している場合に使用します。

![Expressroute のアーキテクチャ ダイアグラム](./media/site-recovery-failback-azure-to-vmware-classic/architecture.png)

プロセス サーバーが Azure 上にあり、VPN または ExpressRoute 接続のいずれかがある場合は、このアーキテクチャを使用します。

![VPN のアーキテクチャ ダイアグラム](./media/site-recovery-failback-azure-to-vmware-classic/architecture2.png)

ポートの一覧とフェールバック アーキテクチャ ダイアグラムについては、次の図をご覧ください。

![すべてのポートのフェールオーバー/フェールバックの一覧](./media/site-recovery-failback-azure-to-vmware-classic/Failover-Failback.png)

Azure にフェールオーバー後、オンプレミス サイトへは 3 つの段階でフェールバックします。

* **第 1 段階**: オンプレミス サイトで実行されている VMware VM へのレプリケートを開始できるように Azure VM を再保護します。
* **第 2 段階**: Azure VM がオンプレミス サイトにレプリケートされたら、フェールオーバーを実行して Azure からフェールバックします。
* **第 3 段階**: データがフェールバックされたら、フェールバック先のオンプレミスの VM を再保護します。これにより、オンプレミスの VM は Azure へのレプリケートを開始できるようになります。

### <a name="fail-back-to-the-original-location-or-an-alternate-location"></a>元の場所または別の場所にフェールバックする
VMware VM をフェールオーバーした後、ソース VM がオンプレミスにまだ存在する場合は、同じソース VM にフェールバックできます。 このシナリオでは、差分のみがフェールバックされます。

物理サーバーをフェールオーバーした場合、常に新しい VMware VM にフェールバックは実行されます。 物理マシンをフェールバックする前に、以下に注意してください。
* 保護されている物理マシンは、Azure から VMware にフェールバックされた場合は仮想マシンとして復旧されます。 Windows Server 2008 R2 SP1 の物理コンピューターが保護されていて、Azure にフェールオーバーした場合、これをフェールバックすることはできません。 オンプレミスの仮想マシンとして開始した Windows Server 2008 R2 SP1 はフェールバックできます。
* 1 つ以上のマスター ターゲット サーバーと、フェールバックするために必要な ESX/ESXi ホストが検出されることを確認します。

元の VM にフェールバックする場合、次の条件が必要です。

* vCenter サーバーで VM を管理する場合は、マスター ターゲットの ESX ホストが VM のデータストアにアクセスできる必要があります。
* VM が ESX ホスト上にあっても、vCenter によって管理されていない場合、VM のハード ディスクは MT のホストがアクセスできるデータストア内に存在する必要があります。
* VM が ESX ホスト上にあり vCenter を使用しない場合、再保護する前に、MT の ESX ホストの検出を完了する必要があります。 これは、物理サーバーにフェールバックする場合も同様です。
* (オンプレミスに VM がある場合) フェールバックを実行する前に削除するという選択肢もあります。 このようにすると、フェールバックにより、マスター ターゲット ESX ホストと同じホストに新しい VM が作成されます。

別の場所にフェールバックすると、オンプレミスのマスター ターゲット サーバーによって使用されるのと同じデータ ストアおよび同じ ESX ホストにデータは復元されます。

## <a name="prerequisites"></a>前提条件
* VMware VM および物理サーバーのフェールバックには、VMware 環境が必要です。 物理サーバーへのフェールバックはサポートされていません。
* フェールバックするには、最初に保護を設定するときに Azure ネットワークを作成する必要があります。 フェールバックには、Azure VM が配置されている Azure ネットワークからオンプレミス サイトへの VPN または ExpressRoute 接続が必要です。
* フェールバック先の VM が vCenter サーバーによって管理されている場合は、vCenter サーバー上の VM の検出に必要な権限があることを確認します。 詳細については、「[Azure Site Recovery を使用して VMware 仮想マシンと物理サーバーを Azure にレプリケートする](site-recovery-vmware-to-azure-classic.md)」を参照してください。
* VM 上にスナップショットがある場合、再保護は失敗します。 スナップショットまたはディスクを削除します。
* フェールバックする前に、次のコンポーネントを作成します。
  * **Azure にプロセス サーバーを作成する**:  このコンポーネントは、自分で作成してフェールバック中に実行し続ける Azure VM です。 この VM は、フェールバックの完了後に削除できます。
  * **マスター ターゲット サーバーを作成する**: マスター ターゲット サーバーは、フェールバック データを送受信します。 オンプレミスに作成した管理サーバーには、既定でマスター ターゲット サーバーがインストールされています。 ただし、フェールバック トラフィックの量によっては、フェールバック用に別のマスター ターゲット サーバーを作成する必要があります。
  * Linux 上で実行するマスター ターゲット サーバーを別に作成する場合は、後述の説明に従って、マスター ターゲット サーバーをインストールする前に Linux VM を設定します。
* フェールバックを実行するときは、構成サーバーがオンプレミスに存在している必要があります。 フェールバック中、仮想マシンが構成サーバー データベースに存在している必要があります。 構成サーバー データベースに VM が含まれていない場合、フェールバックを成功させることはできません。 そのため、サーバーを定期的にバックアップするようにスケジュールを設定してください。 障害が発生した場合は、フェールバックが正常に機能するように、同じ IP アドレスで復元する必要があります。
* VMware でマスター ターゲット VM の**構成パラメーター**に disk.enableUUID=true を設定します。 この行が存在しない場合は追加してください。 この設定は、仮想マシン ディスク (VMDK) ファイルに一貫性のある汎用一意識別子 (UUID) を指定して、それが正常にマウントされるようにするために必要です。
* "マスター ターゲット サーバーをストレージ vMotioned にすることはできません" という条件に注意してください。これが原因でフェールバックが失敗する可能性があります。 ディスクが使用可能にならないため、VM は起動しません。
* マスター ターゲット サーバー上にリテンション ドライブと呼ばれるドライブを追加します。 ディスクを追加し、ドライブをフォーマットします。

## <a name="failback-policy"></a>フェールバック ポリシー
オンプレミスにレプリケートするには、フェールバック ポリシーが必要です。 このポリシーは、順方向のポリシーを作成したときに自動的に作成され、構成サーバーに自動的に関連付けられます。 編集することはできません。 ポリシーには、次のレプリケーション設定があります。

* RPO しきい値 = 15 分
* 復旧ポイントのリテンション期間 = 24 時間
* アプリケーション整合性スナップショットの頻度= 60 分

 ![フェールバック ポリシーのレプリケーション設定](./media/site-recovery-failback-azure-to-vmware-new/failback-policy.png)

## <a name="set-up-a-process-server-in-azure"></a>Azure にプロセス サーバーを設定する
Azure の VM がデータをオンプレミスのマスター ターゲット サーバーに戻せるようにするために、Azure にプロセス サーバーをインストールします。

マシンをクラシック リソースとして保護した場合 (Azure で回復された VM がクラシック デプロイ モデルを使用して作成された場合)、Azure にクラシック プロセス サーバーが必要です。 デプロイの種類として Azure Resource Manager で仮想マシンを回復している場合、プロセス サーバーでは、デプロイの種類として Resource Manager を使用する必要があります。 デプロイの種類は、プロセス サーバーのデプロイ先の Azure 仮想ネットワークによって選択されます。

1. **[コンテナー]** > **[設定]** > **[Site Recovery インフラストラクチャ]** (**[管理]** の下) > **[構成サーバー]**(**[For VMware and Physical Machines (VMware マシンと物理マシン用)**] の下) で、構成サーバーを選択します。
2. **[プロセス サーバー]** をクリックします。

  ![プロセス サーバー](./media/site-recovery-failback-azure-to-vmware-classic/add-processserver.png)
3. プロセス サーバーのデプロイ先として、**[フェールバック プロセス サーバーを Azure にデプロイします]** を選択します。
4. VM の回復時に使用したサブスクリプションを選択します。
5. VM の回復時に使用した Azure ネットワークを選択します。 復旧した VM とプロセス サーバーが通信できるように、プロセス サーバーが同じネットワークに存在する必要があります。
6. "*クラシック デプロイ モデル*" ネットワークを選択した場合は、Azure Marketplace 経由で VM を作成した後、プロセス サーバーをインストールします。

 ![[プロセス サーバーの追加] ウィンドウ](./media/site-recovery-failback-azure-to-vmware-classic/add-classic.png)

 プロセス サーバーを作成するとき、以下に注意してください。
 * イメージの名前は、"*Microsoft Azure Site Recovery Process Server V2*" です。 デプロイ モデルとして、**[クラシック]** を選択します。

       ![Select "Classic" as the Process Server deployment model](./media/site-recovery-failback-azure-to-vmware-classic/templatename.png)
 * 「[Azure Site Recovery を使用して VMware 仮想マシンと物理サーバーを Azure にレプリケートする](site-recovery-vmware-to-azure-classic.md)」の説明に従って、プロセス サーバーをインストールします。
7. "*Resource Manager*" Azure ネットワークを選択した場合は、次の情報を指定してサーバーをデプロイします。

  * サーバーのデプロイ先のリソース グループの名前
  * サーバーの名前
  * サーバーにサインインするためのユーザー名とパスワード
  * サーバーのデプロイ先のストレージ アカウント
  * 接続先のサブネットとネットワーク インターフェイス
   >[!NOTE]
   >独自の [ネットワーク インターフェイス](../virtual-network/virtual-networks-multiple-nics.md) (NIC) を作成し、プロセス サーバーのデプロイに選択する必要があります。

    ![[プロセス サーバーの追加] ダイアログ ボックスへの情報の入力](./media/site-recovery-failback-azure-to-vmware-classic/psinputsadd.png)

8. **[OK]**をクリックします。 これにより、プロセス サーバーのセットアップ時に、デプロイの種類が Resource Manager の仮想マシンを作成するジョブがトリガーされます。 構成サーバーにサーバーを登録するには、「[Azure Site Recovery を使用して VMware 仮想マシンと物理サーバーを Azure にレプリケートする](site-recovery-vmware-to-azure-classic.md)」の手順に従って VM 内でセットアップを実行します。 プロセス サーバーをデプロイするジョブもトリガーされます。

  プロセス サーバーは、**[構成サーバー]** > **[関連付けられたサーバー]** > **[プロセス サーバー]** タブに表示されます。

    ![](./media/site-recovery-failback-azure-to-vmware-new/pslistingincs.png)

    > [!NOTE]
    > プロセス サーバーは、**[VM プロパティ]** の下には表示されません。 登録先である管理サーバーの **[サーバー]** タブにのみ表示されます。 プロセス サーバーの表示には、10 ～ 15 分かかる可能性があります。


## <a name="set-up-the-master-target-server-on-premises"></a>マスター ターゲット サーバーをオンプレミスで設定する
マスター ターゲット サーバーは、フェールバック データを受信します。 サーバーは、オンプレミスの管理サーバーに自動的にインストールされますが、大量のデータをフェールバックする場合は、マスター ターゲット サーバーを追加で設定した方がよい場合があります。 マスター ターゲット サーバーをオンプレミスで設定するには、次の操作を行います。

> [!NOTE]
> Linux 上にマスター ターゲット サーバーをセットアップする場合は、次の手順に進んでください。 マスター ターゲット OS として、最小限のCentOS 6.6 オペレーティング システムのみを使用してください。

1. マスター ターゲット サーバーを Windows 上にセットアップする場合は、マスター ターゲット サーバーをインストールする VM からクイック スタート ページを開きます。
2. Azure Site Recovery 統合セットアップ ウィザード用のインストール ファイルをダウンロードします。
3. セットアップを実行し、**[開始する前に]** で **[Add additional process servers to scale out deployment (デプロイをスケールアウトするためにプロセス サーバーを追加する)]** を選択します。
4. [管理サーバーをセットアップ](site-recovery-vmware-to-azure-classic.md)したときと同様にウィザードを完了します。 **[構成サーバーの詳細]** ページで、このマスター ターゲット サーバーの IP アドレスを指定し、VM にアクセスするためのパスフレーズを入力します。

### <a name="set-up-a-linux-vm-as-the-master-target-server"></a>マスター ターゲット サーバーとしての Linux VM をセットアップする
マスター ターゲット サーバーを実行する管理サーバーを Linux VM としてセットアップするには、最小限の CentOS 6.6 オペレーティング システムをインストールします。 次に、各 SCSI ハード_ディスクの SCSI ID を取得し、追加のパッケージをいくつかインストールし、いくつかのカスタム変更を適用します。

#### <a name="install-centos-66"></a>CentOS 6.6 をインストールする

1. 管理サーバー VM に CentOS 6.6 最小構成オペレーティング システムをインストールします。 DVD ドライブに ISO イメージを保持し、システムを起動します。 メディア テストをスキップします。 言語として **[Japanese (日本語)]** を選択し、**[基本ストレージ デバイス]** を選択します。ハード ドライブに重要なデータがないことを確認したら、**[はい]** をクリックしてすべてのデータを破棄します。 管理サーバーのホスト名を入力し、サーバーのネットワーク アダプターを選択します。  **[Editing System (システムの編集)]** ダイアログ ボックスで **[自動接続する]** を選択し、静的 IP アドレス設定、ネットワーク設定、DNS 設定を追加します。 タイム ゾーンを指定します。 管理サーバーにアクセスするには、ルート パスワードを入力します。
2. 希望するインストールのタイプを求められたら、パーティションとして **[カスタム レイアウトを作成する]** を選択します。 **[次へ]** をクリックします。 **[Free (フリー)]** を選択し、**[作成]** をクリックします。 **ファイル システム タイプ:** **ext4** で **/**、**/var/crash**、**/home** の各パーティションを作成します。 **FS Type: swap**としてスワップ パーティションを作成します。
3. 既存のデバイスが検出される場合、警告メッセージが表示されます。 **[フォーマット]** をクリックし、パーティション設定を使用してドライブをフォーマットします。 **[Write change to disk (変更をディスクに書き込む)]** をクリックして、パーティションの変更を適用します。
4. **[Install boot loader (ブート ローダーをインストールする)]**  >  **[次へ]** の順に選択して、ルート パーティションにブート ローダーをインストールします。
5. インストールが完了したら、**[再起動]** をクリックします。

#### <a name="retrieve-the-scsi-ids"></a>SCSI ID を取得する

1. インストール後、VM 内の各 SCSI ハード ディスクの SCSI ID を取得します。 これを行うには、管理サーバー VM をシャット ダウンします。 VMware の VM のプロパティで VM エントリを右クリックし、**[設定の編集]**  > **[オプション]** をクリックします。
2. **[詳細設定]** > **[General item (全般)]** を選択し、**[構成パラメーター]** をクリックします。 このオプションは、コンピューターの実行中は使用できません。 オプションを使用できるようにするには、コンピューターをシャットダウンする必要があります。
3. 次のいずれかを実行します。
 * **disk.EnableUUID** 行が存在する場合は、値が **True** に設定されていることを確認します (大文字と小文字が区別されます)。 値がすでに True に設定されている場合は、キャンセルして、ゲスト オペレーティング システムの起動後に、その OS 内で SCSI コマンドをテストできます。
 * **disk.EnableUUID**行が存在しない場合は、**[行の追加]** をクリックし、値を **True** に設定して行を追加します。 二重引用符は使用しないでください。

#### <a name="install-additional-packages"></a>追加パッケージをインストールする
その他のパッケージをダウンロードしてインストールします。

1. マスター ターゲット サーバーがインターネットに接続されていることを確認します。
2. CentOS リポジトリから 15 のパッケージをダウンロードしてインストールするために、次のコマンドを実行します。`# yum install –y xfsprogs perl lsscsi rsync wget kexec-tools`
3. 保護しているソース マシンが、ルートまたはブート デバイス用に Linux wit Reiser または XFS ファイル システムを実行している場合、次のようなパッケージを追加でインストールします。

   * \# cd /usr/local
   * \# wget [http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm](http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm)
   * \# wget [http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm](http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm)
   * \# rpm –ivh kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm
   * \# wget [http://mirror.centos.org/centos/6.6/os/x86_64/Packages/xfsprogs-3.1.1-16.el6.x86_65.rpm](http://mirror.centos.org/centos/6.6/os/x86_64/Packages/xfsprogs-3.1.1-16.el6.x86_65.rpm)
   * \# rpm –ivh xfsprogs-3.1.1-16.el6.x86_64.rpm
   * \# yum install device-mapper-multipath (マスター ターゲット サーバーでマルチパス パッケージを有効にするために必要)

#### <a name="apply-custom-changes"></a>カスタム変更を適用する
インストール後の手順とパッケージのインストールが完了したら、次を実行して独自の変更を適用します。

1. RHEL 6-64 ユニファイド エージェント バイナリを、VM にコピーします。 バイナリを解凍するには、次のコマンドを実行します。`tar –zxvf <file name>`
2. アクセス許可を付与するには、次のコマンドを実行します。`# chmod 755 ./ApplyCustomChanges.sh`
3. スクリプト `# ./ApplyCustomChanges.sh` を実行します。 1 回だけ実行してください。 正常に実行されたら、サーバーを再起動します。

## <a name="run-the-failback"></a>フェールバックを実行する
### <a name="reprotect-the-azure-vms"></a>Azure VM を再保護する
1. **[コンテナー]** の **[レプリケートされたアイテム]** で、フェールオーバーされた VM を右クリックして **[再保護]** をクリックします。
2. ブレードで、保護の方向として **[Azure からオンプレミスへ]** が既に選択されていることを確認します。
3. **[マスター ターゲット サーバー]** と **[プロセス サーバー]** で、オンプレミスのマスター ターゲット サーバーと Azure VM プロセス サーバーを選択します。
4. オンプレミスのディスクの復旧先となるデータストアを選択します。 このオプションは、オンプレミスの VM を削除し、新しいディスクを作成する必要がある場合に使用します。 ディスクが既に存在する場合、このオプションは無視しますが、値は指定しておく必要があります。
5. リテンション ドライブは、VM がオンプレミスにレプリケートされたときの特定の時点で停止するために使用します。 リテンション ドライブを使用するためのいくつかの条件を次に示します。 これらの条件を満たさない場合、ドライブはマスター ターゲット サーバーに表示されません。

  * ボリュームを他の目的 (レプリケーションのターゲットなど) に使用することはできません。
  * ボリュームをロック モードにすることはできません。
  * ボリュームをキャッシュ ボリュームにすることはできません  (そのボリュームにマスター ターゲット インストールが存在してはいけません。 プロセス サーバーとマスター ターゲットのカスタム インストール ボリュームは、リテンション ボリュームになる資格はありません。 ここでは、インストールされるプロセス サーバーとマスター ターゲット ボリュームは、マスター ターゲットのキャッシュ ボリュームです)。
  * ボリューム ファイル システムの種類として、FAT および FAT32 は使用できません。
  * ボリュームの容量は 0 以外である必要があります。
  * Windows の既定のリテンション ボリュームは R ボリュームです。
  * Linux の既定のリテンション ボリュームは /mnt/retention/ です。

6. フェールバック ポリシーは自動的に選択されます。
7. **[OK]** をクリックして再保護を開始すると、Azure からオンプレミス サイトに VM をレプリケートするジョブが開始されます。 進行状況は **[ジョブ]** タブで追跡できます。

別の場所に復元する場合は、マスター ターゲット サーバー用に構成したリテンション ドライブとデータ ストアを選択します。 オンプレミス サイトにフェールバックする場合、フェールバック保護計画の VMware VM はマスター ターゲット サーバーと同じデータ ストアを使用します。 レプリカの Azure VM を同じオンプレミスの VM に復元する場合、オンプレミスの VM は、マスター ターゲット サーバーと同じデータ ストアに存在している必要があります。 オンプレミスに VM がない場合、再保護時に新しいものが作成されます。

![ドロップダウン メニューの [Azure からオンプレミスへ] を選択します。](./media/site-recovery-failback-azure-to-vmware-new/reprotectinputs.png)

また、復旧計画レベルで再保護を実行することもできます。 レプリケーション グループがある場合、グループは、復旧計画を使用してのみ再保護することができます。 復旧計画を使用して再保護するときは、すべての保護対象コンピューターで前にあげた値を使用します。

> [!NOTE]
> レプリケーション グループは、同じマスター ターゲットを使用して保護する必要があります。 別のマスター ターゲット サーバーを使用して保護される場合、共通のポイントインタイムを決定できなくなります。

### <a name="run-a-failover-to-the-on-premises-site"></a>オンプレミス サイトでフェールオーバーを実行する
VM を再保護したら、Azure からオンプレミスへのフェールオーバーを開始できます。

1. [レプリケートされたアイテム] ページで仮想マシンを右クリックし、**[計画されていないフェールオーバー]** をクリックします。
2. **[フェールオーバーの確認]** で、フェールオーバーの方向 (Azure から) を確認し、フェールオーバーに使用する復旧ポイント (最新の、またはアプリケーションと整合性が取れた最新の復旧ポイント) を選択します。 アプリケーションと整合性が取れた最新の復旧ポイントは最新のポイントインタイムの前に発生するため、多少のデータ損失が発生します。
3. フェールオーバー中に、Site Recovery によって Azure VM がシャットダウンされます。 フェールバックが期待どおりに完了したことを確認したら、Azure VM が期待どおりにシャット ダウンされていることを確認できます。

### <a name="reprotect-the-on-premises-site"></a>オンプレミス サイトを再保護する
フェールバックが完了したら、Azure に復旧された VM が確実に削除されるように、仮想マシンをコミットする必要があります。 これを行うには保護された項目を右クリックし、**[コミット]** をクリックします。 この操作によって、Azure に復旧された前の仮想マシンを削除するジョブがトリガーされます。

コミットが完了したら、データはオンプレミス サイトに戻りますが、保護はされていません。 Azure へのレプリケートを再び開始するには、次を実行します。

1. **[コンテナー]** で、**[設定]** > **[レプリケートされたアイテム]** をクリックし、フェールバックされた VM を選択し、**[再保護]** をクリックします。
2. Azure にデータを送信する際に使用する必要があるプロセス サーバーの値を指定します。
3. **[OK]**をクリックします。

再保護が完了すると、VM が Azure にレプリケートされるので、フェールオーバーを実行できます。

### <a name="resolve-common-failback-issues"></a>フェールバックの一般的な問題を解決する
* 読み取り専用ユーザー vCenter の検出を実行し、仮想マシンを保護すると、適切に動作し、フェールオーバーが実行されます。 再保護中は、データストアが検出できないため、フェールオーバーは失敗します。 症状としては、再保護中はデータストアの一覧が表示されません。 この問題を解決するには、適切な権限を持つアカウントを使用して vCenter 資格情報を更新し、ジョブを再試行します。 詳細については、「[Azure Site Recovery を使用して VMware 仮想マシンと物理サーバーを Azure にレプリケートする](site-recovery-vmware-to-azure-classic.md)」を参照してください。
* Linux VM をフェールバックしてオンプレミスで実行すると、ネットワーク マネージャー パッケージがマシンからアンインストールされていることを確認できます。 このアンインストールは、Azure で VM が 復旧されるときに、ネットワーク マネージャー パッケージが削除されるために発生します。
* VM が静的 IP アドレスで構成されているときに Azure にフェールオーバーされると、IP アドレスは DHCP 経由で取得されます。 オンプレミスにフェールオーバーすると、VM は引き続き DHCP を使用して、IP アドレスを取得します。 必要であれば、手動でコンピューターにサインインし、IP アドレスを静的アドレスに設定し直します。
* ESXi 5.5 無償版または vSphere 6 Hypervisor 無償版のいずれかを使用すると、フェールオーバーは成功しますが、フェールバックは失敗します。 フェールバックを有効にするには、いずれかのプログラムの評価ライセンスにアップグレードしてください。
* プロセス サーバーから構成サーバーにアクセスできない場合は、構成サーバー コンピューターのポート 443 で Telnet を実行して、構成サーバーへの接続を確認します。 プロセス サーバー コンピューターから構成サーバーに対して ping を試すこともできます。 プロセス サーバーが構成サーバーに接続されるときは、ハートビートも必要です。
* 代替の vCenter にフェールバックする場合は、新しい vCenter が検出されること、またマスター ターゲット サーバーも検出されることを確認してください。 典型的な症状は、データストアにアクセスできないか、**[再保護]** ダイアログに表示されないことです。
* 物理オンプレミス コンピューターとして保護されている WS2008R2SP1 コンピューターは、Azure からオンプレミスにフェールバックすることができません。

## <a name="fail-back-with-expressroute"></a>ExpressRoute を使用したフェールバック
VPN 接続または ExpressRoute 接続を使用してフェールバックできます。 ExpressRoute 接続を使用する場合、次に注意してください。

* ExpressRoute 接続が、ソース コンピューターのフェールオーバー先であり、フェールオーバーの発生後に Azure VM が配置される Azure 仮想ネットワーク上に設定されている必要があります。
* データは、パブリック エンドポイントの Azure ストレージ アカウントに複製されます。 ExpressRoute 接続を使用するには、Site Recovery のレプリケーション用のターゲット データ センターを使用して ExpressRoute でパブリック ピアリングを設定します。

