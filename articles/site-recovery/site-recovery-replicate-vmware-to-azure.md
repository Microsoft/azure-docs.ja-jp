---
title: "アプリケーションのレプリケート (VMware から Azure へ) | Microsoft Docs"
description: "この記事では、VMware 上で実行されている仮想マシンの Azure へのレプリケーションを設定する方法について説明します。"
services: site-recovery
documentationcenter: 
author: asgang
manager: rochakm
editor: 
ms.assetid: 
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 06/05/2017
ms.author: asgang
ms.translationtype: HT
ms.sourcegitcommit: 83f19cfdff37ce4bb03eae4d8d69ba3cbcdc42f3
ms.openlocfilehash: e0047a996c9bfd7d950b32f0871ddd7608924b42
ms.contentlocale: ja-jp
ms.lasthandoff: 08/22/2017

---


# <a name="replicate-applications-running-on-vmware-vms-to-azure"></a>VMware VM から Azure にアプリケーションをレプリケートする



この記事では、VMware 上で実行されている仮想マシンの Azure へのレプリケーションを設定する方法について説明します。
## <a name="prerequisites"></a>前提条件

この記事は、既に以下の操作を行っていることを前提としています。

1.  [オンプレミスのソース環境のセットアップ](site-recovery-set-up-vmware-to-azure.md)
2.  [Azure でのターゲット環境のセットアップ](site-recovery-prepare-target-vmware-to-azure.md)


## <a name="enable-replication"></a>レプリケーションを有効にする
#### <a name="before-you-start"></a>開始する前に
VMware 仮想マシンをレプリケートする場合、次の点に注意してください。

* Azure ユーザー アカウントには、新しい仮想マシンを Azure にレプリケートできるようにするための特定の[アクセス許可](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines)が必要です。
* VMware VM の検出は 15 分ごとに行われます。 VM の検出後、ポータルに表示されるまで 15 分以上かかることがあります。 同様に、新しい vCenter サーバーまたは vSphere ホストを追加したときも、検出に 15 分以上かかることがあります。
* 仮想マシンの環境の変更 (VMware ツールのインストールなど) 内容がポータルで更新されるまでには 15 分以上かかることがあります。
* **[構成サーバー]** ブレードにある vCenter サーバー/vSphere ホストの **[最後の使用]** フィールドで、VMware VM の最終検出時刻を確認できます。
* 定期検出を待たずにレプリケートするマシンを追加するには、構成サーバーを強調表示し (クリックしないでください)、**[更新]** ボタンをクリックします。
* レプリケーションを有効にした場合、マシンの準備が完了すると、プロセス サーバーではモビリティ サービスが自動的にインストールされます。


**レプリケーションを有効にするには、次の手順に従います**。

1. **[手順 2: アプリケーションをレプリケートする]** > **[ソース]** の順にクリックします。 レプリケーションを初めて有効にした後は、コンテナーで **[+ レプリケート]** をクリックして、追加のマシンのレプリケーションを有効にします。
2. **[ソース]** ブレードで **[ソース]** をクリックし、構成サーバーを選択します。
3. **[マシンの種類]** で、**[仮想マシン]** または **[物理マシン]** を選択します。
4. **[vCenter/vSphere Hypervisor] \(vCenter/vSphere ハイパーバイザー)** で、vSphere ホストを管理する vCenter サーバーを選択するか、ホストを選択します。 物理マシンをレプリケートする場合、この設定は関係ありません。
5. プロセス サーバーを選択します。 追加のプロセス サーバーを作成していない場合、これは構成サーバーの名前になります。 次に、 **[OK]**をクリックします

    ![Enable replication](./media/site-recovery-vmware-to-azure/enable-replication2.png)

6. **[ターゲット]** で、フェールオーバー対象の仮想マシンを作成するサブスクリプションとリソース グループを選択します。 Azure で、フェールオーバーされた仮想マシンに使用するデプロイ モデル (クラシックまたはリソース管理) を選択します。
7. データのレプリケーションに使用する Azure Storage アカウントを選択します。 以下の点に注意してください。

   * Premium または Standard ストレージ アカウントを選択できます。 Premium アカウントを選択した場合は、継続的なレプリケーション ログ用に追加の Standard ストレージ アカウントを指定する必要があります。 アカウントは、Recovery Services コンテナーと同じリージョンに存在する必要があります。
   * 自分が所有しているアカウント以外のストレージ アカウントを使用する場合は、*概要で説明されている、Resource Manager を使用してストレージ アカウントを作成するためのプレースホルダー リンク*を作成できます。 Resource Manager を使用してストレージ アカウントを作成する場合は、**[新規作成]** をクリックします。 クラシック モデルを使用してストレージ アカウントを作成する場合は、 [Azure Portal](../storage/common/storage-create-storage-account.md) で作成できます。

8. フェールオーバー後に Azure VM がスピンアップされたときに接続する Azure ネットワークとサブネットを選択します。 ネットワークは、Recovery Services コンテナーと同じリージョンにある必要があります。 保護の対象として選択したすべてのマシンにネットワーク設定を適用する場合は、**[選択したマシン用に今すぐ構成します。]** を選択します。 マシンごとに Azure ネットワークを選択する場合は、**[後で構成する]** を選択します。 ネットワークがない場合は、[作成する](#set-up-an-azure-network)必要があります。 Resource Manager を使用してネットワークを作成する場合は、**[新規作成]** をクリックします。 クラシック モデルを使用してネットワークを作成する場合は、[Azure Portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) で作成できます。 該当する場合は、サブネットを選択します。 次に、 **[OK]**をクリックします

    ![Enable replication](./media/site-recovery-vmware-to-azure/enable-rep3.png)
9. **[仮想マシン]** > **[仮想マシンの選択]** で、レプリケートする各マシンをクリックして選択します。 選択できるのは、レプリケーションを有効にできるマシンのみです。 次に、 **[OK]**をクリックします

    ![Enable replication](./media/site-recovery-vmware-to-azure/enable-replication5.png)
10. **[プロパティ]** >  の **[プロパティの構成]** で、モビリティ サービスをマシンに自動的にインストールするためにプロセス サーバーが使用するアカウントを選択します。  
11. 既定では、すべてのディスクがレプリケートされます。 レプリケーションからディスクを除外するには、**[すべてのディスク]** をクリックし、レプリケートしないディスクをオフにします。  次に、 **[OK]**をクリックします 後で追加のプロパティを設定できます。 ディスクの除外の詳細については、[こちら](site-recovery-exclude-disk.md)をご覧ください。

    ![Enable replication](./media/site-recovery-vmware-to-azure/enable-replication6.png)

12. **[レプリケーションの設定]** > **[レプリケーション設定の構成]** で、正しいレプリケーション ポリシーが選択されていることを確認します。 レプリケーション ポリシー設定を変更するには、**[設定]** > **[レプリケーション ポリシー]**、ポリシー名、**[設定の編集]** の順にクリックします。 ポリシーに適用した変更は、レプリケートしているマシンと新しいマシンに適用されます。
13. マシンをレプリケーション グループにまとめる場合は、**[マルチ VM 整合性]** を有効にし、グループの名前を指定します。 次に、 **[OK]**をクリックします 以下の点に注意してください。

    * レプリケーション グループのマシンはまとめてレプリケートされ、フェールオーバー時にクラッシュ整合性復旧ポイントとアプリ整合性復旧ポイントを共有します。
    * VM と物理サーバーがワークロードをミラー化できるように、これらをまとめることをお勧めします。 マルチ VM 整合性を有効にすると、ワークロードのパフォーマンスに影響を及ぼす可能性があるので、複数のマシンが同じワークロードを実行しており、整合性が必要な場合にのみ使用します。

    ![Enable replication](./media/site-recovery-vmware-to-azure/enable-replication7.png)
14. **[レプリケーションを有効にする]**をクリックします。 **[設定]** > **[ジョブ]** > **[Site Recovery ジョブ]** の順にクリックして、**保護の有効化**ジョブの進行状況を追跡できます。 **保護の最終処理** ジョブが実行されると、マシンはフェールオーバーできる状態になります。

> [!NOTE]
> 保護が有効になっている場合、マシンでプッシュ インストールの準備が完了すると、モビリティ サービス コンポーネントがインストールされます。 コンポーネントがマシンにインストールされたら、保護ジョブが開始され、失敗します。 ジョブの失敗後、各マシンを手動で再起動する必要があります。 再起動後に、保護ジョブが再び開始され、最初のレプリケーションが実行されます。
>
>

## <a name="view-and-manage-vm-properties"></a>VM プロパティを表示して管理する

ソース マシンのプロパティを確認することをお勧めします。 Azure VM の名前は、 [Azure 仮想マシンの要件](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements)に準拠している必要があります。

1. **[設定]** > **[レプリケートされたアイテム]** の順にクリックし、マシンを選択します。 **[要点]** ブレードにマシンの設定と状態に関する情報が表示されます。
2. **[プロパティ]** で、VM のレプリケーションとフェールオーバーの情報を確認できます。
3. **[コンピューティングとネットワーク]** > **[コンピューティングのプロパティ]** で、Azure VM の名前とターゲットのサイズを指定できます。 必要に応じて、Azure の要件に準拠するように名前を変更します。
    ![Enable replication](./media/site-recovery-vmware-to-azure/VMProperties_AVSET.png)
 
4.  フェール オーバー後にマシンが属する[リソース グループ](https://docs.microsoft.com/azure/virtual-machines/windows/infrastructure-resource-groups-guidelines)を選択できます。 この設定は、フェール オーバー前にいつでも変更できます。 フェール オーバー後に、マシンを別のリソース グループに移行すると、マシンの保護設定が解除されます。
5. マシンが 1 つのポスト フェールオーバーに属する必要がある場合、[可用性セット](https://docs.microsoft.com/azure/virtual-machines/windows/infrastructure-availability-sets-guidelines)を選択できます。 可用性セットを選択するときは、以下のことに注意してください。

    * 指定されたリソース グループに属している可用性セットだけが一覧表示されます。  
    * 異なる仮想ネットワークに属するマシンが同じ可用性セットに属することはできません。
    * 同じサイズの仮想マシンだけが同じ可用性セットに属することができます。
5. Azure VM に割り当てられるターゲット ネットワーク、サブネット、および IP アドレスに関する情報を表示および追加することもできます。
6. **[ディスク]** で、レプリケートされる VM のオペレーティング システム ディスクとデータ ディスクを確認できます。

### <a name="network-adapters-and-ip-addressing"></a>ネットワーク アダプターと IP アドレス指定 

- ターゲット IP アドレスを設定できます。 アドレスを指定しなかった場合、フェールオーバーされたマシンで DHCP が使用されます。 フェールオーバーで使用できないアドレスを設定した場合、フェールオーバーは機能しません。 テスト フェールオーバー ネットワークのアドレスを利用できる場合、テスト フェールオーバーに同じターゲット IP アドレスを使用できます。
- ネットワーク アダプターの数は、次に示すように、ターゲット仮想マシンに指定したサイズによって異なります。
    - ソース マシン上のネットワーク アダプターの数が、ターゲット マシンのサイズに許可されているアダプターの数以下の場合、ターゲットのアダプターの数は、ソースと同じになります。
    - ソース仮想マシン用のアダプターの数が、ターゲットのサイズに許可されている数を超える場合は、ターゲットの最大サイズが使用されます。
    - たとえば、ソース マシンに 2 つのネットワーク アダプターがあり、ターゲット マシンのサイズが 4 つをサポートしている場合は、ターゲット マシンのアダプターの数は、2 つになります。 ソース マシンに 2 つのアダプターがあるが、サポートされているターゲット サイズで 1 つしかサポートしていない場合、ターゲット マシンのアダプターの数は 1 つだけになります。
    - 仮想マシンにネットワーク アダプターが複数ある場合、これらのアダプターはすべて同じネットワークに接続されます。
    - 仮想マシンにネットワーク アダプターが複数ある場合は、一覧で最初に表示されるアダプターが、Azure 仮想マシンの*既定*のネットワーク アダプターとなります。
   



## <a name="common-issues"></a>一般的な問題

* 各ディスクのサイズは 1TB 未満である必要があります。
* OS ディスクは、ダイナミック ディスクではなく、ベーシック ディスクである必要があります。
* 第 2 世代/UEFI 対応仮想マシンでは、オペレーティング システム ファミリは Windows である必要があります。また、ブート ディスクは 300 GB 未満である必要があります。

## <a name="next-steps"></a>次のステップ

保護を完了したら、[フェールオーバー](site-recovery-failover.md)を実行して、アプリケーションが Azure で動作するかどうかを確認できます。

保護を無効にする場合は、[登録と保護の設定をクリーンアップ](site-recovery-manage-registration-and-protection.md)する方法を確認します。

