---
title: Azure Private Link を使用した Azure Cache for Redis (プレビュー)
description: Azure プライベート エンドポイントは、Azure Private Link を使用した Azure Cache for Redis にプライベートかつ安全に接続するネットワーク インターフェイスです。 この記事では、Azure portal を使用して Azure Cache、Azure 仮想ネットワーク、プライベート エンドポイントを作成する方法について学習します。
author: curib
ms.author: cauribeg
ms.service: cache
ms.topic: conceptual
ms.date: 10/14/2020
ms.openlocfilehash: 22bdf93e7236ae5220a6bb7c6ead898628bb51a1
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/19/2021
ms.locfileid: "97007587"
---
# <a name="azure-cache-for-redis-with-azure-private-link-public-preview"></a>Azure Private Link を使用した Azure Cache for Redis (パブリック プレビュー)
この記事では、Azure portal を使用して、仮想ネットワークと、プライベート エンドポイントを利用する Azure Cache for Redis インスタンスを作成する方法について学習します。 また、既存の Azure Cache for Redis インスタンスにプライベート エンドポイントを追加する方法について学習します。

Azure プライベート エンドポイントは、Azure Private Link を使用した Azure Cache for Redis にプライベートかつ安全に接続するネットワーク インターフェイスです。 

## <a name="prerequisites"></a>前提条件
* Azure サブスクリプション - [無料アカウントを作成する](https://azure.microsoft.com/free/)

> [!IMPORTANT]
> プライベート エンドポイントを使用するには、Azure Cache for Redis インスタンスが 2020 年 7 月 28 日より後に作成されている必要があります。
> 現在、geo レプリケーション、ファイアウォール規則、ポータル コンソールのサポート、クラスター化されたキャッシュごとの複数のエンドポイント、ファイアウォールと VNet の挿入されたキャッシュの永続化はサポートされていません。 
>
>

## <a name="create-a-private-endpoint-with-a-new-azure-cache-for-redis-instance"></a>新しい Azure Cache for Redis インスタンスを使用してプライベート エンドポイントを作成する 

このセクションでは、プライベート エンドポイントを利用する新しい Azure Cache for Redis インスタンスを作成します。

### <a name="create-a-virtual-network"></a>仮想ネットワークの作成 

1. [Azure Portal](https://portal.azure.com) にサインインし、**[リソースの作成]** を選択します。

    :::image type="content" source="media/cache-private-link/1-create-resource.png" alt-text="[リソースの作成] を選択します。":::

2. **[新規]** ページで、 **[ネットワーク]** を選択してから、 **[仮想ネットワーク]** を選択します。

3. **[追加]** を選択して仮想ネットワークを作成します。

4. **[仮想ネットワークの作成]** の **[基本]** タブで次の情報を入力または選択します。

   | 設定      | 推奨値  | 説明 |
   | ------------ |  ------- | -------------------------------------------------- |
   | **サブスクリプション** | ドロップダウンで、ご自身のサブスクリプションを選択します。 | この仮想ネットワークを作成するサブスクリプション。 | 
   | **リソース グループ** | ドロップ ダウンでリソース グループを選択するか、 **[新規作成]** を選択し、新しいリソース グループの名前を入力します。 | その中に仮想ネットワークやその他のリソースを作成するリソース グループの名前。 すべてのアプリ リソースを 1 つのリソース グループに配置することで、それらをまとめて簡単に管理または削除できます。 | 
   | **名前** | 仮想ネットワーク名を入力します。 | 名前は先頭が文字または数字、末尾が文字、数字、アンダースコアでなければならず、中に含めることができるのは文字、数字、アンダースコア、ピリオド、ハイフンのみです。 | 
   | **リージョン** | ドロップ ダウンでリージョンを選択します。 | 仮想ネットワークを使用する他のサービスの近くの[リージョン](https://azure.microsoft.com/regions/)を選択します。 |

5. **[IP アドレス]** タブを選択するか、ページの下部にある **[Next: IP Addresses]\(次へ: IP アドレス\)** ボタンをクリックします。

6. **[IP アドレス]** タブで、 **[IPv4 アドレス空間]** を、CIDR 表記で 1 つまたは複数のアドレス プレフィックスとして指定します (例: 192.168.1.0/24)。

7. **[サブネット名]** で、 **[既定]** をクリックしてサブネットのプロパティを編集します。

8. **[サブネットの編集]** ペインで、 **[サブネット名]** と **[サブネットのアドレス範囲]** を指定します。 サブネットのアドレス範囲は CIDR 表記である必要があります (例: 192.168.1.0/24)。 仮想ネットワークのアドレス空間に含まれている必要があります。

9. **[保存]** を選択します。

10. **[確認と作成]** タブを選択するか、 **[確認と作成]** ボタンをクリックします。

11. すべての情報が正しいことを確認し、 **[作成]** をクリックして仮想ネットワークをプロビジョニングします。

### <a name="create-an-azure-cache-for-redis-instance-with-a-private-endpoint"></a>プライベート エンドポイントを利用する Azure Cache for Redis インスタンスを作成する
キャッシュ インスタンスを作成するには、これらの手順に従います。

1. Azure portal ホームページに戻るか、サイドバー メニューを開き、 **[リソースの作成]** を選択します。 
   
1. **[新規]** ページで、 **[データベース]** を選択し、 **[Azure Cache for Redis]** を選択します。

    :::image type="content" source="media/cache-private-link/2-select-cache.png" alt-text="[Azure Cache for Redis] を選択します。":::
   
1. **[新規 Redis Cache]** ページで、新しいキャッシュの設定を構成します。
   
   | 設定      | 推奨値  | 説明 |
   | ------------ |  ------- | -------------------------------------------------- |
   | **DNS 名** | グローバルに一意の名前を入力します。 | キャッシュ名は 1 から 63 文字の文字列で、数字、英字、ハイフンのみを使用する必要があります。 名前の先頭と末尾には数字または文字を使用する必要があり、連続するハイフンを含めることはできません。 キャッシュ インスタンスの "*ホスト名*" は、 *\<DNS name>.redis.cache.windows.net* になります。 | 
   | **サブスクリプション** | ドロップダウンで、ご自身のサブスクリプションを選択します。 | この新しい Azure Cache for Redis インスタンスが作成されるサブスクリプション。 | 
   | **リソース グループ** | ドロップ ダウンでリソース グループを選択するか、 **[新規作成]** を選択し、新しいリソース グループの名前を入力します。 | その中にキャッシュやその他のリソースを作成するリソース グループの名前。 すべてのアプリ リソースを 1 つのリソース グループに配置することで、それらをまとめて簡単に管理または削除できます。 | 
   | **場所** | ドロップ ダウンで場所を選択します。 | キャッシュを使用する他のサービスの近くの[リージョン](https://azure.microsoft.com/regions/)を選択します。 |
   | **価格レベル** | ドロップ ダウンで[価格レベル](https://azure.microsoft.com/pricing/details/cache/)を選択します。 |  価格レベルによって、キャッシュに使用できるのサイズ、パフォーマンス、および機能が決まります。 詳細については、[Azure Cache for Redis の概要](cache-overview.md)に関するページを参照してください。 |

1. **[ネットワーク]** タブを選択するか、ページの下部にある **[ネットワーク]** ボタンをクリックします。

1. **[ネットワーク]** タブで、接続方法として **[プライベート エンドポイント]** を選択します。

1. **[追加]** ボタンをクリックして、プライベート エンドポイントを作成します。

    :::image type="content" source="media/cache-private-link/3-add-private-endpoint.png" alt-text="[ネットワーク] で、プライベート エンドポイントを追加する。":::

1. **[プライベート エンドポイントの作成]** ページで、前のセクションで作成した仮想ネットワークとサブネットを使用してプライベート エンドポイントの設定を構成し、 **[OK]** を選択します。 

1. **[次へ: 詳細]** タブを選択するか、ページの下部にある **[次へ: 詳細]** ボタンをクリックします。

1. Basic または Standard のキャッシュ インスタンスの **[詳細]** タブで、非 TLS ポートを有効にする場合は有効トグルをオンにします。

1. Premium キャッシュ インスタンスの **[詳細]** タブで、非 TLS ポート、クラスタリング、データ永続化の設定を構成します。

1. **[次へ: タグ]** タブを選択するか、ページの下部にある **[次へ: タグ]** ボタンをクリックします。

1. 必要に応じて、 **[タグ]** タブで、リソースを分類する場合は名前と値を入力します。 

1. **[Review + create]\(レビュー + 作成\)** を選択します。 [確認および作成] タブが表示され、Azure によって構成が検証されます。

1. 緑色の検証に成功のメッセージが表示された後、 **[作成]** を選択します。

キャッシュが作成されるまで、しばらく時間がかかります。 Azure Cache for Redis の **[概要]** ページで進行状況を監視できます。 **[状態]** に "**実行中**" と表示されている場合は、キャッシュを使用する準備ができています。 
    
> [!IMPORTANT]
> 
> `publicNetworkAccess` フラグは既定で `Disabled` に設定されています。 
> このフラグは、パブリック エンドポイントとプライベート エンドポイントの両方に対してキャッシュへのアクセスを必要に応じて許可できるようにするためにあります (`Enabled` に設定されている場合)。 `Disabled` に設定すると、プライベート エンドポイントのアクセスのみが許可されます。 この値を `Disabled` または `Enabled` に設定するには、次の PATCH 要求を使用します。 この値を編集して、キャッシュに適したフラグを指定します。
> ```http
> PATCH  https://management.azure.com/subscriptions/{subscription}/resourceGroups/{resourcegroup}/providers/Microsoft.Cache/Redis/{cache}?api-version=2020-06-01
> {    "properties": {
>        "publicNetworkAccess":"Disabled"
>    }
> }
> ```
>

> [!IMPORTANT]
> 
> クラスター化されたキャッシュに接続するには、`publicNetworkAccess` を `Disabled` に設定する必要があり、プライベート エンドポイント接続は 1 つしか保持できません。 
>

## <a name="create-a-private-endpoint-with-an-existing-azure-cache-for-redis-instance"></a>既存の Azure Cache for Redis インスタンスを使用してプライベート エンドポイントを作成する 

このセクションでは、既存の Azure Cache for Redis インスタンスにプライベート エンドポイントを追加します。 

### <a name="create-a-virtual-network"></a>仮想ネットワークの作成 
仮想ネットワークを作成するには、これらの手順に従います。

1. [Azure Portal](https://portal.azure.com) にサインインし、**[リソースの作成]** を選択します。

2. **[新規]** ページで、 **[ネットワーク]** を選択してから、 **[仮想ネットワーク]** を選択します。

3. **[追加]** を選択して仮想ネットワークを作成します。

4. **[仮想ネットワークの作成]** の **[基本]** タブで次の情報を入力または選択します。

   | 設定      | 推奨値  | 説明 |
   | ------------ |  ------- | -------------------------------------------------- |
   | **サブスクリプション** | ドロップダウンで、ご自身のサブスクリプションを選択します。 | この仮想ネットワークを作成するサブスクリプション。 | 
   | **リソース グループ** | ドロップ ダウンでリソース グループを選択するか、 **[新規作成]** を選択し、新しいリソース グループの名前を入力します。 | その中に仮想ネットワークやその他のリソースを作成するリソース グループの名前。 すべてのアプリ リソースを 1 つのリソース グループに配置することで、それらをまとめて簡単に管理または削除できます。 | 
   | **名前** | 仮想ネットワーク名を入力します。 | 名前は先頭が文字または数字、末尾が文字、数字、アンダースコアでなければならず、中に含めることができるのは文字、数字、アンダースコア、ピリオド、ハイフンのみです。 | 
   | **リージョン** | ドロップ ダウンでリージョンを選択します。 | 仮想ネットワークを使用する他のサービスの近くの[リージョン](https://azure.microsoft.com/regions/)を選択します。 |

5. **[IP アドレス]** タブを選択するか、ページの下部にある **[Next: IP Addresses]\(次へ: IP アドレス\)** ボタンをクリックします。

6. **[IP アドレス]** タブで、 **[IPv4 アドレス空間]** を、CIDR 表記で 1 つまたは複数のアドレス プレフィックスとして指定します (例: 192.168.1.0/24)。

7. **[サブネット名]** で、 **[既定]** をクリックしてサブネットのプロパティを編集します。

8. **[サブネットの編集]** ペインで、 **[サブネット名]** と **[サブネットのアドレス範囲]** を指定します。 サブネットのアドレス範囲は CIDR 表記である必要があります (例: 192.168.1.0/24)。 仮想ネットワークのアドレス空間に含まれている必要があります。

9. **[保存]** を選択します。

10. **[確認と作成]** タブを選択するか、 **[確認と作成]** ボタンをクリックします。

11. すべての情報が正しいことを確認し、 **[作成]** をクリックして仮想ネットワークをプロビジョニングします。

### <a name="create-a-private-endpoint"></a>プライベート エンドポイントの作成 

プライベート エンドポイントを作成するには、これらの手順に従います。

1. Azure portal で、**Azure Cache for Redis** を検索し、Enter キーを押すか、検索候補からそれを選択します。

    :::image type="content" source="media/cache-private-link/4-search-for-cache.png" alt-text="Azure Cache for Redis を検索する。":::

2. プライベート エンドポイントを追加するキャッシュ インスタンスを選択します。

3. 画面の左側で、 **[(PREVIEW) Private Endpoint]\((プレビュー) プライベート エンドポイント\)** を選択します。

4. **[プライベート エンドポイント]** ボタンをクリックして、プライベート エンドポイントを作成します。

    :::image type="content" source="media/cache-private-link/5-add-private-endpoint.png" alt-text="プライベート エンドポイントを追加する。":::

5. **[プライベート エンドポイントの作成] ページ** で、プライベート エンドポイントの設定を構成します。

   | 設定      | 推奨値  | 説明 |
   | ------------ |  ------- | -------------------------------------------------- |
   | **サブスクリプション** | ドロップダウンで、ご自身のサブスクリプションを選択します。 | このプライベート エンドポイントを作成するサブスクリプション。 | 
   | **リソース グループ** | ドロップ ダウンでリソース グループを選択するか、 **[新規作成]** を選択し、新しいリソース グループの名前を入力します。 | その中にプライベート エンドポイントやその他のリソースを作成するリソース グループの名前。 すべてのアプリ リソースを 1 つのリソース グループに配置することで、それらをまとめて簡単に管理または削除できます。 | 
   | **名前** | プライベート エンドポイント名を入力します。 | 名前は先頭が文字または数字、末尾が文字、数字、アンダースコアでなければならず、中に含めることができるのは文字、数字、アンダースコア、ピリオド、ハイフンのみです。 | 
   | **リージョン** | ドロップ ダウンでリージョンを選択します。 | プライベート エンドポイントを使用する他のサービスの近くの[リージョン](https://azure.microsoft.com/regions/)を選択します。 |

6. **[次へ:リソース]** ボタンを選択します。

7. **[リソース]** タブで、該当するサブスクリプションを選択し、リソースの種類として [`Microsoft.Cache/Redis`] を選んでから、プライベート エンドポイントを接続するキャッシュを選択します。

8. **[次へ:構成]** ボタンを選択します。

9. **[構成]** タブで、前のセクションで作成した仮想ネットワークとサブネットを選択します。

10. **[次へ:タグ]** ボタンを選択します。

11. 必要に応じて、 **[タグ]** タブで、リソースを分類する場合は名前と値を入力します。

12. **[Review + create]\(レビュー + 作成\)** を選択します。 **[確認および作成]** タブが表示され、Azure によって構成が検証されます。

13. 緑色の **検証に成功** のメッセージが表示された後、 **[作成]** を選択します。

## <a name="faq"></a>よく寄せられる質問

### <a name="why-cant-i-connect-to-a-private-endpoint"></a>プライベート エンドポイントに接続できないのはなぜですか。
キャッシュが既に VNet インジェクションされたキャッシュである場合、プライベート エンドポイントをそのキャッシュ インスタンスで使用できません。 キャッシュ インスタンスがサポートされていない機能 (下記参照) を使用している場合は、プライベート エンドポイント インスタンスに接続できません。 さらに、プライベート エンドポイントを使用するには、キャッシュ インスタンスが 7 月 27 日より後に作成されている必要があります。

### <a name="what-features-are-not-supported-with-private-endpoints"></a>プライベート エンドポイントでサポートされていない機能は何ですか。
geo レプリケーション、ファイアウォール規則、ポータル コンソールのサポート、クラスター化されたキャッシュあたり複数のエンドポイント、ファイアウォール規則とゾーン冗長の永続化。 

### <a name="how-can-i-change-my-private-endpoint-to-be-disabled-or-enabled-from-public-network-access"></a>プライベート エンドポイントをパブリック ネットワーク アクセスに対して無効または有効になるように変更するにはどうすればよいですか。
`publicNetworkAccess` フラグは既定で `Disabled` に設定されています。 このフラグは、パブリック エンドポイントとプライベート エンドポイントの両方に対してキャッシュへのアクセスを必要に応じて許可できるようにするためにあります (`Enabled` に設定されている場合)。 `Disabled` に設定すると、プライベート エンドポイントのアクセスのみが許可されます。 この値を `Disabled` または `Enabled` に設定するには、次の PATCH 要求を使用します。 この値を編集して、キャッシュに適したフラグを指定します。

```http
PATCH  https://management.azure.com/subscriptions/{subscription}/resourceGroups/{resourcegroup}/providers/Microsoft.Cache/Redis/{cache}?api-version=2020-06-01
{    "properties": {
       "publicNetworkAccess":"Disabled"
   }
}
```

### <a name="are-network-security-groups-nsg-enabled-for-private-endpoints"></a>ネットワーク セキュリティ グループ (NSG) はプライベート エンドポイントでは有効になっていますか。
いいえ、プライベート エンドポイントでは無効になっています。 プライベート エンドポイントを含むサブネットに NSG を関連付けることはできますが、プライベート エンドポイントによって処理されるトラフィックに対して規則は有効ではありません。 サブネットにプライベート エンドポイントをデプロイするには、[ネットワーク ポリシーの適用を無効にする](../private-link/disable-private-endpoint-network-policy.md)必要があります。 NSG は、同じサブネット上にホストされている他のワークロードにも適用されます。 クライアント サブネット上のルートは /32 プレフィックスを使用するため、既定のルーティング動作を変更するには同様の UDR が必要です。 

ソース クライアントにおけるアウトバウンド トラフィックに対して NSG 規則を使用して、トラフィックを制御します。 /32 プレフィックスを持つ個々のルートをデプロイして、プライベート エンドポイント ルートをオーバーライドします。 送信接続の NSG フロー ログと監視情報は引き続きサポートされており、使用することができます

### <a name="can-i-use-firewall-rules-with-private-endpoints"></a>プライベート エンドポイントでファイアウォール ルールを使用できますか。
できません。これは、プライベート エンドポイントに関する現在の制限です。 キャッシュに対してファイアウォール ルールが構成されている場合、プライベート エンドポイントは正常に機能しません。

### <a name="how-can-i-connect-to-a-clustered-cache"></a>クラスター化されたキャッシュに接続するにはどうすればよいですか。
`publicNetworkAccess` を `Disabled` に設定する必要があり、プライベート エンドポイント接続は 1 つしか保持できません。

### <a name="since-my-private-endpoint-instance-is-not-in-my-vnet-how-is-it-associated-with-my-vnet"></a>プライベート エンドポイント インスタンスは自分の VNet に含まれていませんが、VNet とどのように関連付けられていますか。
お使いの VNet にリンクされているだけです。 これは VNet 内に存在しないため、依存エンドポイントに対して NSG 規則を変更する必要はありません。

### <a name="how-can-i-migrate-my-vnet-injected-cache-to-a-private-endpoint-cache"></a>VNet インジェクションされたキャッシュをプライベート エンドポイント キャッシュに移行するにはどうすればよいですか。
VNet インジェクションされたキャッシュを削除し、プライベート エンドポイントで新しいキャッシュ インスタンスを作成する必要があります。

## <a name="next-steps"></a>次の手順

* Azure Private Link の詳細については、[Azure Private Link のドキュメント](../private-link/private-link-overview.md)を参照してください。
* キャッシュ インスタンスのさまざまなネットワークの分離のオプションを比較するには、「[Azure Cache for Redis のネットワークの分離オプション](cache-network-isolation.md)」のドキュメントを参照してください。