---
redirect_url: https://azure.microsoft.com/services/documentdb/
ROBOTS: NOINDEX, NOFOLLOW
translationtype: Human Translation
ms.sourcegitcommit: d59ebef3cda36ba048b844f0cd2326fff66b4aa5
ms.openlocfilehash: 27880401ccfca4c2c504eecc1aeb128d40c501a3


---
# <a name="storage-and-predictable-performance-provisioning-in-documentdb"></a>DocumentDB のストレージと予測可能なパフォーマンスのプロビジョニング
Azure DocumentDB は、JSON ドキュメント用の完全に管理された、スケーラブルなドキュメント志向の NoSQL データベース サービスです。 DocumentDB では、仮想マシンのレンタル、ソフトウェアのデプロイ、データベースの監視などを自分で行う必要はありません。 Microsoft のエンジニアによって運用され、継続的な監視が行われる DocumentDB は、卓越した可用性、パフォーマンス、データ保護を提供します。  

DocumentDB を使用するには、[Azure Portal](https://portal.azure.com/) で[データベース アカウント](documentdb-create-account.md)を作成した後に、[DocumentDB コレクションおよびデータベース](documentdb-create-collection.md)を作成します。 DocumentDB データベースは、ソリッド ステート ドライブ (SSD) ベースのストレージとスループットから構成されるユニットで提供されます。 これらのストレージ ユニットをプロビジョニングするには、データベース コレクションを作成します。各コレクションには、アプリケーションのニーズを満たすためにいつでもスケールアップとスケールダウンが可能な予約されたスループットがあります。

1 つ以上のコレクションでアプリケーションが予約されたスループットを超えると、コレクションごとに要求が制限されます。 つまり、アプリケーションの要求が成功する場合と調整される場合があります。

この記事では、容量を管理してデータ ストレージを計画するために使用できるリソースとメトリックの概要を示します。

## <a name="database-account"></a>データベース アカウント
Azure の利用者であるお客様は、1 つまたは複数の DocumentDB データベース アカウントをプロビジョニングして、データベース リソースを管理できます。 各サブスクリプションは、1 つの Azure サブスクリプションに関連付けられます。

DocumentDB アカウントは、[Azure Portal](documentdb-create-account.md)、または [ARM テンプレートや Azure CLI](documentdb-automation-resource-manager-cli.md) を使用して作成できます。

## <a name="databases"></a>データベース
1 つの DocumentDB データベースには、実質的に容量が無限の、コレクションにグループ化されたドキュメント ストレージを格納できます。 コレクションによってパフォーマンスを分離できます。各コレクションは、同じデータベースまたはアカウント内の他のコレクションと共有されないスループットでプロビジョニングできます。 DocumentDB データベースのサイズは柔軟で、数 GB から数 TB に上る SSD ベースのドキュメント ストレージとプロビジョニング済みスループットが用意されています。 従来の RDBMS データベースとは異なり、DocumentDB のデータベースは単一のコンピューターにスコープが制限されず、複数のコンピューターまたはクラスターにまたがることができます。  

DocumentDB では、アプリケーションの規模を拡大することが必要になった時点で、さらに多くのコレクション、データベース、またはその両方を作成できます。 データベースは [Azure Portal](documentdb-create-database.md) またはいずれかの [DocumentDB SDK](documentdb-dotnet-samples.md) を使用して作成できます。   

## <a name="database-collections"></a>データベース コレクション
各 DocumentDB データベースには&1; つまたは複数のコレクションを格納できます。 コレクションはドキュメント ストレージやドキュメント処理の際に、可用性の高いデータ パーティションとして機能します。 各コレクションには多種多様なスキーマを持つドキュメントを保存できます。 DocumentDB の自動インデックス作成機能やクエリ機能により、ドキュメントを簡単にフィルター処理して取得できます。 コレクションは、ドキュメント ストレージとクエリ実行のスコープを提供します。 コレクションは、そこに含まれるすべてのドキュメントのトランザクション ドメインでもあります。 コレクションには、Azure ポータルまたは SDK を使用して設定された値に基づいてスループットが割り当てられます。

コレクションは、DocumentDB によって自動的に&1; つまたは複数の物理サーバーにパーティション分割されます。 プロビジョニングするスループットは、コレクションを作成するときに、1 秒あたりの要求ユニット数とパーティション キー プロパティの観点から指定できます。 DocumentDB がドキュメントを複数のパーティションに分散し、クエリなどの要求をルーティングする際に、このプロパティの値が使用されます。 パーティション キーの値は、ストアド プロシージャやトリガーに対するトランザクションの境界としても作用します。 コレクションごとに、同じアカウント内の他のコレクションとは共有されない、そのコレクション専用のスループットの量が予約されます。 したがって、ストレージとスループットの両方の観点からアプリケーションをスケールアウトすることができます。

コレクションは [Azure Portal](documentdb-create-collection.md) またはいずれかの [DocumentDB SDK](documentdb-sdk-dotnet.md) を使用して作成できます。   

## <a name="request-units-and-database-operations"></a>要求ユニットとデータベース操作
コレクションを作成するときに、1 秒あたりの [要求ユニット (RU)](documentdb-request-units.md) でスループットを予約します。 ハードウェア リソースの検討や管理をする代わりに、 **要求ユニット** をさまざまなデータベース操作の実行やアプリケーション要求の処理に必要なリソースの&1; つのメジャーとして考えることができます。 1 KB のドキュメントを読み取るには、コレクション内に格納されている項目数や、同時に実行されている並列要求数に関係なく、同じ 1 RU が使用されます。 SQL クエリなどの複雑な操作を含め、DocumentDB に対するすべての要求には予測可能な RU 値があり、開発時に判断することができます。 アプリケーションに対応するドキュメントのサイズと各処理 (読み取り、書き込み、クエリ) の頻度がわかっていれば、アプリケーションのニーズに合わせて正確な量のスループットをプロビジョニングし、パフォーマンスのニーズが変化するに従ってデータベースを拡張または縮小することができます。

各コレクションは、1 秒あたり 100 要求ユニットのブロックのスループットで、1 秒あたり数百から数百万の要求ユニットまで予約できます。 プロビジョニングしたスループットは、そのコレクションの有効期間にわたって、アプリケーションの処理ニーズの変化やアクセス パターンに合わせて調整できます。 詳細については、 [DocumentDB のパフォーマンス レベル](documentdb-performance-levels.md)に関する記事を参照してください。

> [!IMPORTANT]
> コレクションは課金対象のエンティティです。 コストは、コレクションのプロビジョニングされたスループットで決まります。1 秒あたりの要求ユニット数と、合計使用ストレージ (GB 単位) で測定されます。
>
>

挿入、削除、クエリ、または格納されたプロシージャ実行などの各処理には、どのくらいの要求ユニットが使用されるでしょうか。 要求単位は、要求の処理コストを標準化した測定単位です。 1 KB のドキュメントの読み取りは 1 RU ですが、同じドキュメントを挿入、置換、または削除する要求では、必要になるサービスの処理が多くなるため、使用される要求ユニットも多くなります。 サービスからの各応答には、要求で使用される要求ユニットをレポートするカスタム ヘッダー (`x-ms-request-charge`) が含まれます。 このヘッダーには、 [SDK](documentdb-sdk-dotnet.md)を介してアクセスすることもできます。 .NET SDK では、[RequestCharge](https://msdn.microsoft.com/library/azure/dn933057.aspx#P:Microsoft.Azure.Documents.Client.ResourceResponse`1.RequestCharge) は [ResourceResponse](https://msdn.microsoft.com/library/azure/dn799209.aspx) オブジェクトのプロパティです。 1 回の呼び出しを行う前にスループット ニーズを見積もる場合は、 [キャパシティ プランナー](documentdb-request-units.md#estimating-throughput-needs) をこの見積もりに利用することができます。

> [!NOTE]
> 1 KB のドキュメントは 1 要求ユニットという基本は、 [セッションの一貫性](documentdb-consistency-levels.md)に関するドキュメントの単純な GET に対応します。
>
>

DocumentDB データベース アカウントに対する操作に使用される要求ユニットに影響を及ぼす要因はいくつかあります。 その要因には次のものがあります。

* ドキュメント サイズ。 ドキュメントのサイズが増大すると、データの読み取りまたは書き込みに使用される単位も増加します。
* プロパティの数。 すべてのプロパティに既定でインデックスが作成されると想定すると、プロパティ数の増加に伴って、ドキュメントの書き込みに使用される単位が増加します。
* データの整合性。 Strong または Bounded Staleness のデータの整合性レベルを使用すると、ドキュメントの参照に使用される単位が増加します。
* インデックス付きプロパティ。 各コレクションのインデックス ポリシーによって、既定でインデックスが作成されるプロパティが決まります。 インデックス付きプロパティの数を制限することで、使用する要求ユニットを削減できます。
* ドキュメントのインデックス作成。 各ドキュメントには既定で自動的にインデックスが作成されます。一部のドキュメントにインデックスを作成しないようにすると、使用される要求単位が少なくなります。

詳細については、 [DocumentDB の要求ユニット](documentdb-request-units.md)に関するページを参照してください。

たとえば、次の表は、3 種類のサイズのドキュメント (1 KB、4 KB、64 KB) を 2 種類のパフォーマンス レベル (500 読み取り/秒 + 100 書き込み/秒と、500 読み取り/秒 + 500 書き込み/秒) でプロビジョニングした場合の要求ユニット数を示しています。 データの一貫性はセッションで構成され、インデックス作成ポリシーはなしに設定されています。

<table border="0" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td valign="top"><p><strong>ドキュメント サイズ</strong></p></td>
            <td valign="top"><p><strong>読み取り数/秒</strong></p></td>
            <td valign="top"><p><strong>書き込み数/秒</strong></p></td>
            <td valign="top"><p><strong>要求ユニット</strong></p></td>
        </tr>
        <tr>
            <td valign="top"><p>1 KB</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>100</p></td>
            <td valign="top"><p>(500 * 1) + (100 * 5) = 1,000 RU/秒</p></td>
        </tr>
        <tr>
            <td valign="top"><p>1 KB</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>(500 * 5) + (100 * 5) = 3,000 RU/秒</p></td>
        </tr>
        <tr>
            <td valign="top"><p>4 KB</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>100</p></td>
            <td valign="top"><p>(500 * 1.3) + (100 * 7) = 1,350 RU/秒</p></td>
        </tr>
        <tr>
            <td valign="top"><p>4 KB</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>(500 * 1.3) + (500 * 7) = 4,150 RU/秒</p></td>
        </tr>
        <tr>
            <td valign="top"><p>64 KB</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>100</p></td>
            <td valign="top"><p>(500 * 10) + (100 * 48) = 9,800 RU/秒</p></td>
        </tr>
        <tr>
            <td valign="top"><p>64 KB</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>(500 * 10) + (500 * 48) = 29,000 RU/秒</p></td>
        </tr>
    </tbody>
</table>

クエリ、ストアド プロシージャ、トリガーは、実行する操作の複雑さに基づいて要求ユニットを使用します。 アプリケーションを開発するときは、ヘッダーを調べて、各操作で使用される要求ユニットの量を詳しく把握するようにしてください。  

## <a name="choice-of-consistency-level-and-throughput"></a>整合性レベルの選択とスループット
既定の一貫性レベルの選択内容により、スループットと待機時間が影響を受けます。 既定の一貫性レベルは、プログラムで設定することも Azure ポータルを通じて設定することもできます。 また、要求ベースで一貫性レベルをオーバーライドすることもできます。 既定の整合性レベルは、モノトニックな読み取り/書き込みおよび書き込みの読み取り保証を提供する **Session**整合性レベルに設定されています。 "Session" 整合性レベルは、ユーザー中心のアプリケーションに効果的で、整合性とパフォーマンスのトレードオフが優れたバランスで実現されます。    

Azure ポータルで整合性レベルを変更する手順については、「 [DocumentDB アカウントの管理方法](documentdb-manage-account.md#consistency)」を参照してください。 または、一貫性レベルの詳細については、「 [一貫性レベルの使用](documentdb-consistency-levels.md)」を参照してください。

## <a name="provisioned-document-storage-and-index-overhead"></a>プロビジョニング済みドキュメント ストレージとインデックス オーバーヘッド
DocumentDB では、単一のパーティションとパーティション分割コレクションの両方の作成がサポートされています。 DocumentDB 内の各パーティションは、最大 10 GB の SSD ベースのストレージをサポートしています。 10 GB のドキュメント ストレージには、ドキュメントとインデックス用のストレージが含まれます。 既定では、DocumentDB コレクションは、セカンダリ インデックスまたはスキーマを明示的に必要とすることなくすべてのドキュメントのインデックスを自動的に作成するように構成されます。 DocumentDB を使用するアプリケーションに基づくと、一般的なインデックス オーバーヘッドは 2 ～ 20% です。 DocumentDB で使用しているインデックス作成テクノロジでは、プロパティの値に関係なく、既定の設定でインデックス オーバーヘッドがドキュメント サイズの 80% を超えることはありません。

既定では、DocumentDB によって自動的にすべてのドキュメントのインデックスが作成されます。 ただし、インデックス オーバーヘッドを調整する場合は、「 [DocumentDB インデックス作成ポリシー](documentdb-indexing-policies.md)」で説明されているように、ドキュメントの挿入時または置換時におけるインデックス作成の対象から特定のドキュメントを除外することができます。 コレクション内のすべてのドキュメントをインデックス作成の対象から除外するように DocumentDB コレクションを構成できます。 また、[コレクションのインデックス作成ポリシーのカスタマイズ](documentdb-indexing-policies.md#CustomizingIndexingPolicy)に関するトピックで説明されているように、JSON ドキュメントのワイルドカードを使用して特定のプロパティまたはパスに関してのみ選択的にインデックスを作成するように DocumentDB コレクションを構成することもできます。 プロパティまたはドキュメントを除外すると書き込みスループットが向上し、消費する要求ユニットが少なくなります。   

## <a name="next-steps"></a>次のステップ
DocumentDB のしくみについて引き続き学習するには、「 [Azure DocumentDB でのパーティション分割とスケーリング](documentdb-partition-data.md)」を参照してください。

Azure ポータルでパフォーマンス レベルを監視する手順については、 [DocumentDB アカウントの監視](documentdb-monitor-accounts.md)に関するページを参照してください。 コレクションのパフォーマンス レベルの選択の詳細については、「 [DocumentDB のパフォーマンス レベル](documentdb-performance-levels.md)」を参照してください。



<!--HONumber=Jan17_HO3-->


