---
title: "エネルギー需要予測のための Cortana Intelligence Solution Template Playbook | Microsoft Docs"
description: "エネルギー公益事業会社の需要予測に役立つ Microsoft Cortana Intelligence Solution Template。"
services: cortana-analytics
documentationcenter: 
author: ilanr9
manager: ilanr9
editor: yijichen
ms.assetid: 8855dbb9-8543-45b9-b4c6-aa743a04d547
ms.service: cortana-analytics
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/24/2016
ms.author: ilanr9;yijichen;garye
translationtype: Human Translation
ms.sourcegitcommit: c0e2324a2b2e6294df6e502f2e7a0ae36ff94158
ms.openlocfilehash: 0c07495a932c8bfdabb97e8eebe8d99de19fbd15
ms.lasthandoff: 01/30/2017


---
# <a name="cortana-intelligence-solution-template-playbook-for-demand-forecasting-of-energy"></a>エネルギー需要予測のための Cortana Intelligence Solution Template Playbook
## <a name="executive-summary"></a>概要
この数年間、モノのインターネット (IoT)、代替エネルギー ソース、ビッグ データの登場により、公益事業やエネルギー分野で膨大なビジネス チャンスが生まれています。 一方で、消費者はエネルギーの利用を制御する優れた方法を求めているため、公益事業およびエネルギー分野全体では消費が横ばいになっています。 そのため、公益事業会社やスマート グリッド企業は企業自体のイノベーションと刷新を大いに必要としています。 さらに、送電網や電力系統の多くは老朽化し、維持と管理にかかるコストが非常に高くなっています。 去年、Microsoft のチームはエネルギー分野でさまざまな取り組みを行いました。 これらの取り組みの中で、多くの公益事業会社や ISV (独立系ソフトウェア ベンダー) が将来のエネルギー需要の予測を研究していることがわかりました。 こうした予測は、現在および将来のビジネスにおいて重要な役割を果たし、さまざまなユース ケースの基盤となっています。 ユース ケースには、短期および長期の電力負荷予測、取引、負荷分散、電力網の最適化などがあります。正確で信頼性の高い予測を生成するうえで鍵となるのは、ビッグ データと機械学習 (ML) などの高度な分析 (AA) 手法です。  

このプレイブックは、エネルギー需要予測ソリューションの開発やデプロイの成功に必要なビジネス上のガイドラインと分析ガイドラインをまとめたものです。 ここで提示されているガイドラインは、公益事業会社、データ サイエンティスト、データ エンジニアが完全に運用可能なクラウド ベースの需要予測ソリューションを構築する際に役立ちます。 ビッグ データと高度な分析の利用を開始する企業にとっては、こうしたソリューションは長期的なスマート グリッド戦略の足がかりとなります。

> [!TIP]
> このテンプレートのアーキテクチャの概要を説明した図をダウンロードするには、「 [エネルギー需要予測のための Cortana Intelligence ソリューション テンプレートのアーキテクチャ](cortana-analytics-architecture-demand-forecasting-energy.md)」を参照してください。  
> 
> 

## <a name="overview"></a>概要
このドキュメントでは、Cortana Intelligence のほか、特に Azure Machine Learning (AML) を利用したエネルギー予測ソリューションの実装とデプロイについて、ビジネス、データ、および技術的な側面を説明します。 このドキュメントは、次の&3; つのパートで構成されています。  

1. ビジネスの把握  
2. データの把握  
3. 技術的な実装

「 **ビジネスの把握** 」では、投資の決定を行う前に把握、考慮する必要があるビジネスの側面について概説します。 実際のビジネス上の問題を評価して、予測分析と機械学習が本当に効果的で、適用可能であるかどうかを確認する方法について説明します。 さらに、機械学習の基礎と、機械学を使用してエネルギー予測の問題に対処する方法についても説明します。 また、ユース ケースの前提条件と資格基準を紹介します。 サンプルのユース ケースとビジネス ケース シナリオもいくつか用意しています。

データは、すべての機械学習ソリューションの主要な要素です。 このドキュメントの「 **データの把握** 」では、データのいくつかの重要な側面について説明します。 エネルギー予測に必要なデータの種類、データの品質要件、および一般的なデータ ソースを紹介します。 また、生データを使用して、モデリング部分を実際に稼働させるデータ特徴を準備する方法についても説明します。

ドキュメントの&3; つ目のパートでは、ソリューションの **技術的な実装** の側面について説明します。 特徴エンジニアリングとモデリングは、データ サイエンス プロセスの中核を成すものであるため、詳しく説明します。 予測分析ソリューションのクラウド デプロイの重要な手段である Web サービスの概念を紹介します。 また、運用可能なエンド ツー エンド ソリューションの一般的なアーキテクチャについても説明します。

さらに、この分野とテクノロジについて深く理解するのに役立つ参照資料も紹介します。

このドキュメントは、データ サイエンス プロセスや、その数学的、技術的な側面について詳しく説明するものではありませんので、ご注意ください。 これらの詳細については、[Azure ML に関するドキュメント](http://azure.microsoft.com/services/machine-learning/)と[ブログ](http://blogs.microsoft.com/blog/tag/azure-machine-learning/)を参照してください。

### <a name="target-audience"></a>対象読者
このドキュメントの対象読者は、Machine Learning ベースのソリューションと、特にエネルギー予測分野でそのソリューションを利用する方法について押さえておきたいビジネス担当者と技術担当者です。

データ サイエンティストも、このドキュメントを読むことで、エネルギー予測ソリューションのデプロイを推進する大まかなプロセスを深く理解できます。 そういう点では、このドキュメントで、より高度で詳細な資料を理解するための基礎をしっかりと固めることもできます。

### <a name="industry-trends"></a>業界の動向
この数年間、IoT、代替エネルギー ソース、ビッグ データの登場により、公益事業やエネルギー分野で膨大なビジネス チャンスが生まれています。 一方で、消費者はエネルギーの利用を制御する優れた方法を求めているため、公益事業およびエネルギー分野全体では消費が横ばいになっています。

多くの公益事業会社やスマート エネルギー企業は、電力網によって生成されたデータを利用したさまざまなユース ケースをデプロイすることで、[スマート グリッド](https://en.wikipedia.org/wiki/Smart_grid)を開発しています。 多くのユース ケースには、蓄積することや在庫として保管することができないという電力生産固有の特性が付いて回ります。 つまり、生産されたものは使用する必要があります。 効率の向上を望んでいる公益事業会社は、電力消費量を予測する必要があります。予測により、**供給と需要のバランスを取って**、エネルギーの浪費を抑え、**温室効果ガスの排出を削減**し、コストを制御することが容易になります。

コストには別の重要な側面があります。それは、価格です。 新たに公益事業会社間で電力を取引できるようになったため、**電力の将来の需要と将来の価格を予測**する必要性が高まっています。 予測は、生産量を決定するうえで役立ちます。

"スマート" という単語を使用した場合は、実際には、学習して予測できる電力網を指します。 スマート グリッドでは、消費量の季節的な変動を予測するだけでなく、 **一時的な過負荷状況を予測して、自動的に調整**することもできます。 (こうしたスマート メーターを利用して) 消費量をリモートから制御することで、局所的な過負荷状況を処理できます。 **最初に予測し、その後で対処することで**、時間の経過と共に電力網自体がよりスマートになります。

このドキュメントの残りの部分では、将来、短期、および長期のエネルギー需要の予測に関する一連の具体的なユース ケースに焦点を当てます。 これらの分野に数か月間取り組むことで獲得した知識とスキルにより、業界向けの成果を生み出すことができるようになりました。 他のユース ケースについても、近い将来このドキュメントで説明する予定です。

## <a name="business-understanding"></a>ビジネスの把握
### <a name="business-goals"></a>ビジネス目標
**エネルギー デモ** の目的は、非常に短い時間でデプロイできる標準的な予測分析と機械学習ソリューションの例を示すことです。 具体的には、今はエネルギー需要予測ソリューションの実現に焦点を当て、そのビジネス価値を短期間で実現して活用できるようにします。 このプレイブックの情報は、次の目標の達成に役立ちます。

* 機械学習ベースのソリューションの価値創造までの時間を短縮する
* パイロット ユース ケースを他のユース ケースや、ビジネス ニーズに応じてより広い範囲に拡張する
* Cortana Intelligence Suite 製品に関する知識を短期間で獲得する

このプレイブックは、これらの目標を念頭に置いて、これらの目標の達成に役立つビジネス面と技術面の知識を提供することを目的としています。

### <a name="power-load-and-demand-forecasting"></a>電力負荷と需要予測
エネルギー分野では、需要予測をさまざまな形でビジネス上の重要な問題の解決に役立てることができます。 実際には、需要予測は業界のさまざまな主要ユース ケースの基盤と考えることができます。 一般に、短期と長期という&2; 種類のエネルギー需要予測を検討します。 それぞれ異なる目的に使われ、アプローチが異なる場合があります。 2 つの主な違いは予測期間です。つまり、予測する未来の時間範囲が異なります。

#### <a name="short-term-load-forecasting"></a>短期負荷予測
エネルギー需要における短期負荷予測 (STLF) は、電力網のさまざまな箇所で近い将来に予測される負荷の集計と定義されます。 ここでいう短期は、1 ～ 24 時間の範囲の期間として定義されます。 期間が 48 時間の場合もあります。 そのため、STLF は電力網の運用ユース ケースにおいて非常に一般的です。 STLF を利用したユース ケースの例をいくつか次に示します。

* 供給と需要のバランス調整
* 電力取引のサポート
* 価格設定 (電力価格の設定)
* 電力網の運用の最適化
* [デマンド レスポンス](https://en.wikipedia.org/wiki/Demand_response)
* ピーク需要の予測
* デマンド サイド マネジメント
* 負荷分散と過負荷の防止
* 長期負荷予測
* 障害および異常の検出
* ピークの削減/平準化 

ほとんどの場合、STLF モデルは、近い過去 (前日または先週) の消費データに基づいており、予想気温を重要な予測因子として利用します。 現在では、1 ～ 24 時間後までの正確な予想気温の入手は困難ではなくなってきています。 こうしたモデルは、季節的なパターンや長期的な消費傾向の影響をあまり受けません。

SLTF ソリューションでは、予測呼び出し (サービス要求) が大量に生成される可能性があります。時間単位で (場合によっては、もっと高い頻度で) 呼び出されるためです。 また、個々の変電所や変圧器がスタンドアロン モデルとして表される実装も非常に一般的であるため、予測要求の量はさらに増えます。

#### <a name="long-term-load-forecasting"></a>長期負荷予測
長期負荷予測 (LTLF) の目的は、1 週間から数か月 (場合によっては、数年間) の期間の電力需要を予測することです。 この期間の範囲は、ほとんどの場合、計画と投資のユース ケースに適用されます。

長期シナリオには、複数年分 (最低 3 年分) の高品質データが必要です。 これらのモデルでは、通常、履歴データから季節性のパターンを抽出し、天気や気候のパターンなどの外部の予測因子を使用します。

予測期間が長くなるほど予測の精度が下がる可能性がある点をはっきりさせることが肝要です。 そのため、発生する可能性のある変動を手動で計画プロセスに組み込むことができるように、実際の予測と併せて、いくつかの信頼区間を生成することが重要です。

LTLF の利用シナリオはほとんどが計画であるため、予測量が (STLF と比較して) 大幅に減少すると考えられます。 通常、これらの予測は Excel や PowerBI などの視覚化ツールに埋め込まれ、ユーザーが手動で呼び出します。

### <a name="short-term-vs-long-term-prediction"></a>短期予測と長期予測
次の表では、STLF と LTLF の最も重要な属性を比較しています。

| 属性 | 短期負荷予測 | 長期負荷予測 |
| --- | --- | --- |
| 予測期間 |1 ～ 48 時間 |1 ～ 6 か月以上 |
| データの粒度 |時間単位 |時間単位または日単位 |
| 一般的なユース ケース |<ul><li>需要と供給のバランス調整</li><li>選択した時間の予測</li><li>デマンド レスポンス</li></ul> |<ul><li>長期の計画</li><li>グリッド資産の計画</li><li>リソースの計画</li></ul> |
| 一般的な予測因子 |<ul><li>日または週</li><li>時間</li><li>1 時間ごとの気温</li></ul> |<ul><li>月</li><li>日にち</li><li>長期の気温と気候</li></ul> |
| 履歴データの範囲 |2 ～&3; 年分のデータ |5 ～ 10 年分のデータ |
| 一般的な精度 |MAPE* 5% 以下 |MAPE* 25% 以下 |
| 予測頻度 |1 時間ごとまたは 24 時間ごとに生成 |1 か月おき、四半期ごと、または&1; 年おきに生成 |

\*[MAPE](https://en.wikipedia.org/wiki/Mean_absolute_percentage_error) – 平均絶対誤差率

この表からわかるように、短期予測と長期予測のシナリオは、対応するビジネス ニーズが異なり、デプロイや消費パターンも異なる場合があるため、区別することが非常に重要です。

### <a name="example-use-case-1-esmart-systems--overload-optimization"></a>サンプルのユース ケース 1: eSmart Systems – 過負荷の最適化
[スマート グリッド](https://en.wikipedia.org/wiki/Smart_grid) の重要な役割は、変動する消費パターンを動的および継続的に最適化し、調整することです。 電力消費量は、主に気温の上下によって引き起こされる短期的な変動の影響を受けることがあります (*たとえば*、エアコンや暖房に使用される電力が増加します)。 同時に、長期的な変動の影響も受けます。 そうした変動には、季節性の影響、祝日、長期的な消費量の増加、さらには消費者指数、原油価格、GDP などの経済的な要因があります。

このユース ケースでは、 [eSmart](http://www.esmartsystems.com/) は、電力網内のすべての変電所の過負荷状態の傾向を予測できるクラウド ベースのソリューションのデプロイを希望していました。 具体的には、1 時間以内に過負荷状態になる可能性のある変電所を特定し、早急な対応により、その状態を回避または解消できるようにしたいと考えていました。

正確な予測を迅速に実行するには、次の&3; つの予測モデルを実装する必要があります。

* 数週間や数か月にわたる各変電所の電力消費量を予測できる長期モデル
* 1 時間以内の特定の変電所の過負荷状態を予測できる短期モデル
* 複数のシナリオに対して未来の予想気温を提供する気温モデル

長期モデルの目的は、翌週または翌月に過負荷状態になる可能性の度合いに応じて変電所に順位を付けることです (それぞれの送電能力を考慮します)。 これにより、短期予測の入力となる変電所の簡単な一覧を作成できます。 気温は長期モデルの重要な予測因子であるため、複数のシナリオに対応した予想気温を継続的に生成し、入力として長期モデルに渡す必要があります。 その後、短期予測を呼び出して、1 時間以内に過負荷状態になる可能性のある変電所を予測します。

短期モデルと長期モデルは、変電所ごとに個別にデプロイします。 そのため、これらのモデルを実際に実行するには、広範なオーケストレーションが必要です。 短期予測の精度を上げるには、1 時間ごとのより詳細な専用モデルを用意します。 これらのモデルはすべて&1; 時間ごとに実行され、数分間で実行が終了します (その間に、応答し、必要に応じて予防措置を取ることができます)。 この一連のモデルは、最新のデータを利用した定期的な再トレーニングによって、最新の状態に維持されます。

このユース ケースの詳細については、 [こちら](https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=18945)を参照してください。

#### <a name="use-case-qualification-criteria--prerequisites"></a>ユース ケースの資格基準 – 前提条件
Cortana Intelligence の主な長所は、機械学習を軸としたソリューションをデプロイおよびスケールできる強力な機能にあります。 Cortana Analytics は、数千もの予測を同時実行できるよう設計されています。 また、変動する消費パターンに合わせて自動的にスケールできます。 そのため、ソリューションでは、精度とコンピューティング パフォーマンスに重点を置きます。 たとえば、電力会社は&1; 時間ごとの正確なエネルギー需要予測を生成したいと考えています。 その一方で、需要が現状のままになると予測される場合に、その原因の究明についてはあまり関心がありません (モデル自体が対処します)。

そのため、機械学習を利用してもすべてのユース ケースとビジネス上の問題を効果的に解決できるわけではないことに注意することが重要です。

Cortana Intelligence と機械学習は、次の条件を満たす場合に、ビジネス上の特定の問題を非常に効果的に解決できます。

* 実際のビジネス上の問題が **予測的** な性質を持っている。 予測のユース ケースの例としては、1 時間以内の特定の変電所の電力負荷を予測したい電力会社が挙げられます。 一方、履歴の需要の分析と順位付けの基準は **説明的** な性質を持つため、あまり適用できません。
* 予測できた場合に、明確な **対策のパス** が存在する。 たとえば、1 時間以内にある変電所で過負荷が発生すると予測される場合は、その変電所の負荷を削減するプロアクティブな対策を実施し、過負荷の発生を事前に防止できます。
* ユース ケースが、解決されると、他の同様のユース ケースも解決できるようになる **一般的な問題の種類** を表している。
* お客様がソリューションの実装の成功を明確に示す**質的および量的な目標**を設定できる。 たとえば、エネルギー需要予測の適切な量的目標は、必要な精度のしきい値です ("*たとえば*"、最大で 5% の誤差が許容されます)。つまり、変電所の過負荷が予想された場合に、精度 (真陽性率) と再現率 (真陽性の度合い) が特定のしきい値を超える必要があります。 これらの目標は、お客様のビジネス目標を基に設定する必要があります。
* 会社のビジネス ワークフローとの明確な **統合シナリオ** がある。 たとえば、変電所の負荷予測を電力網管理センターに統合すると、過負荷の予防措置を実施できようになります。
* お客様がユース ケースをサポートするのに**十分な品質のデータ**を使用できる (詳細については、このプレイブックの次のセクション「**データ品質**」を参照してください)。
* お客様がクラウド中心のデータ アーキテクチャまたは **クラウド ベースの機械学習**(Azure ML やその他の Cortana Intelligence Suite コンポーネントなど) を導入している。
* お客様が継続的なクラウドへのデータ配信を容易にする**エンド ツー エンドのデータ フロー**の確立とソリューションの**運用の実現**に積極的である。
* 実装が正常に完了したときにソリューションの知識と所有権をお客様に委譲できるように、お客様が最初のパイロット実装に積極的に取り組む **専属のリソースを割り当てる** 準備をしている。
* お客様のリソースは **技術を持ったデータ プロフェッショナル**(できれば、データ サイエンティスト) である必要があります。

上記の条件に基づくユース ケースの資格を満たすと、ユース ケースの成功率が大幅に向上し、将来のユース ケースの実装の適切な足がかりを築くことができます。

### <a name="cloud-based-solutions"></a>クラウド ベース ソリューション
Azure の Cortana Intelligence Suite は、クラウドにある統合環境です。 クラウド環境に高度な分析ソリューションをデプロイすると、ビジネスに大きなメリットがもたらされますが、これはオンプレミスの IT ソリューションを引き続き利用する企業にとっては大きな変化を意味する場合があります。 エネルギー分野では、クラウドに業務を段階的に移行する明確なトレンドがあります。 このトレンドは上の「 **業界の動向**」で説明したスマート グリッドの開発と密接な関係があります。 このプレイブックはエネルギー分野のクラウド ベース ソリューションに重点を置いているため、クラウド ベース ソリューションのデプロイのメリットとその他の考慮事項について説明することが重要です。

おそらく、クラウド ベース ソリューションの最大のメリットはコストです。 ソリューションではクラウドにデプロイされたコンポーネントを利用するため、関連する先行コストや COGS (売上原価) コンポーネント コストはありません。 つまり、ハードウェア、ソフトウェア、および IT のメンテナンスに投資する必要がなく、結果として、ビジネス上のリスクが大幅に減少します。

もう&1; つの重要なメリットは、クラウド ベース ソリューションの従量課金制コスト構造です。 クラウド ベースのコンピューティング サーバーやストレージ サーバーは、必要なときにだけデプロイおよびスケールできます。 これは、クラウド ベース ソリューションのコスト効率のメリットを表しています。

最後に、IT のメンテナンスや将来のインフラストラクチャの開発は、すべてクラウド ベース サービスに含まれているため、それらに投資する必要がありません。 Cortana Intelligence Suite にはそうしたクラス最高のサービスが含まれており、そのロードマップは進化し続けています。 新機能、コンポーネント、および機能が絶えず導入され、進化しています。

クラウドへの移行を開始する会社には、クラウド移行ロードマップを実装する段階的な方法を強くお勧めしています。 エネルギー分野の公益事業会社にとっては、このプレイブックで説明しているユース ケースがクラウドの予測分析ソリューションをパイロット運用するための良いきっかけとなると考えています。

#### <a name="business-case-justification-considerations"></a>ビジネス ケースの妥当性に関する考慮事項
多くの場合、お客様はクラウド ベース ソリューションと Machine Learning が重要なコンポーネントとなる特定のユース ケースのビジネス上の妥当性に関心があります。 クラウド ベースのソリューションの場合は、オンプレミスのソリューションとは異なり、先行コスト コンポーネントが最小限に抑えられ、コスト要素の大部分は実際の使用状況に関係しています。 Cortana Intelligence Suite のエネルギー予測ソリューションのデプロイでは、複数のサービスを&1; つの共通コスト構造に統合できます。 たとえば、データベース (*例:*SQL Azure) を使用して生データを格納し、実際の予測については、Azure ML を使用して予測サービスをホストできます。 この例では、コスト構造にはストレージとトランザクション コンポーネントが含まれます。

その一方で、エネルギー需要予測 (短期または長期) を運用することのビジネス価値を十分に把握する必要があります。 実際、各予測運用のビジネス価値を実現することが重要です。 たとえば、24 時間以内の電力負荷の正確な予測により、過剰生産を防止することや、電力網の過負荷を防止することができます。これは、日単位のコスト削減で定量化できます。

需要予測ソリューションの財務面でのメリットを計算するための基本的な数式は次のとおりです。![需要予測ソリューションの財務面でのメリットを計算するための基本的な数式](media/cortana-analytics-playbook-demand-forecasting-energy/financial-benefit-formula.png)

Cortana Intelligence Suite では従量課金価格モデルが提供されるため、この数式に固定コスト コンポーネントを追加する必要はありません。 この数式は、日、月、または年単位で計算できます。

Cortana Intelligence Suite と Azure ML の現行の価格プランについては、 [こちら](http://azure.microsoft.com/pricing/details/machine-learning/)を参照してください。

### <a name="solution-development-process"></a>ソリューション開発プロセス
エネルギー需要予測ソリューションの開発サイクルは、通常、4 つのフェーズに分かれています。そのすべてのフェーズで、Cortana Intelligence Suite のクラウド ベースのテクノロジとサービスを利用します。

それを示したのが次の図です。

![Smart Grid Cycle](media/cortana-analytics-playbook-demand-forecasting-energy/smart-grid-cycle.png)

次の段落では、この 4 段階のプロセスについて説明します。

1. **データ収集** – 高度な分析ベースのソリューションはすべてデータに依存します (「**データの把握**」を参照してください)。 具体的には、予測分析と予測については、継続的で動的なデータ フローに依存します。 エネルギー需要予測の場合は、このデータをスマート メーターから直接取得することや、オンプレミスのデータベースで集計することができます。 また、天気や気温など、外部ソースからの他のデータにも依存します。 この継続的なデータ フローを調整、スケジュール、保存する必要があります。 [Azure Data Factory](http://azure.microsoft.com/services/data-factory/) (ADF) は、このタスクを実行するための主要なサービスです。
2. **モデリング** – 正確で信頼性の高いエネルギー需要予測を実現するには、履歴データを使用し、データから意味のある予測パターンを抽出する優れたモデルを開発 (トレーニング) および管理する必要があります。 機械学習 (ML) の分野は、より高度なアルゴリズムが定期的に開発され、急速に成長しています。 Azure ML Studio は、包括的なワークフロー内で最も高度な ML アルゴリズムを利用できる優れたユーザー エクスペリエンスを提供します。 そのワークフローは、直感的なフロー図で示され、データの準備、特徴の抽出、モデリング、およびモデルの評価で構成されます。 ユーザーは、この環境に含まれている何百ものさまざまなモデルを利用できます。 このフェーズの終わりまでには、データ サイエンティストが完全に評価され、デプロイの準備が整った作業モデルを用意します。
   
   次の図は、一般的なワークフローを示しています。
   
   ![Modeling Workflow](media/cortana-analytics-playbook-demand-forecasting-energy/modeling-workflow.png)
3. **デプロイ** – 作業モデルが用意できたので、次の段階はデプロイです。 ここでモデルは、さまざまな消費クライアントからインターネット経由で同時に呼び出すことができる RESTful API を公開する Web サービスに変換されます。 Azure ML では、ボタンを&1; 回クリックするだけで Azure ML Studio から直接モデルをデプロイできる簡単な方法を用意しています。 デプロイ プロセス全体は内部で行われます。 このソリューションは、必要な利用量に応じて自動的にスケールできます。
4. **利用** – このフェーズでは、実際に予測モデルを利用して、予測を生成します。 ユーザー アプリケーション (*例:*ダッシュボード) から利用することや、需要と供給のバランス調整システムや電力網の最適化ソリューションなどの運用システムから直接利用することができます。 1 つのモデルから複数のユース ケースを生成できます。

## <a name="data-understanding"></a>データの把握
エネルギー需要予測ソリューションに関するビジネス上の考慮事項について説明し終えたので (「 **ビジネスの把握**」を参照)、次はデータについてです。 どの予測分析ソリューションも、信頼性の高いデータに依存します。 エネルギー需要予測では、さまざまな詳細レベルの過去の消費データを利用します。 履歴データは原材料として使用されます。 入念な分析が実行され、データ サイエンティストが最終的に必要な予測を生成するモデルに入力できる予測因子 (特徴とも呼ばれる) を特定します。

このセクションの残りの部分では、データについて把握するためのさまざまな手順と考慮事項のほか、データを使用可能な形式に変換する方法について説明します。

### <a name="the-model-development-cycle"></a>モデル開発サイクル
適切な予測モデルを生成するには、準備と計画を慎重に行う必要があります。 モデリング プロセスを複数の手順に分け、一度に&1; つの手順に専念すると、プロセス全体の成果を大幅に改善することができます。

次の図は、モデリング プロセスを複数の手順に分ける場合に、どのように分けることができるかを示しています。

![Model Development Cycle](media/cortana-analytics-playbook-demand-forecasting-energy/model-development-cycle.png)

ご覧のように、サイクルは次の&6; つの手順で構成されています。

* 問題の定式化
* データの取り込みとデータの探索
* データの準備と特徴エンジニアリング
* モデリング
* モデルの評価
* 開発

このセクションの残りの部分では、個々の手順と、各手順での考慮事項について説明します。

### <a name="problem-formulation"></a>問題の定式化
問題の定式化は、予測分析ソリューションを実装する前に実行する必要がある最も重要な手順であると考えられます。 この手順では、ビジネス上の問題を変換し、データとモデリング手法を使用して解決できる具体的な要素に分解します。 問題を回答が必要な一連の質問に変換することをお勧めします。 エネルギー需要予測に関しては、いくつかの質問が考えられます。

* 1 時間または&1; 日に個々の変電所で予想される負荷はどのくらいか?
* 電力網の需要がピークに達するのは何時か?
* 予想されるピーク時の負荷が継続する可能性はどのくらいか?
* 1 時間ごとに発電する必要がある電力量はどのくらいか?

こうした質問を定式化すると、適切なデータを入手し、実際のビジネス上の問題に最適なソリューションを実装することに専念できます。 さらに、モデルのパフォーマンスを評価できる重要な指標を設定することもできます。 たとえば、予測に求められる精度やビジネスで許容される誤差の範囲があります。

### <a name="data-sources"></a>データ ソース
最新のスマート グリッドでは、電力網のさまざまな構成要素やコンポーネントからデータを収集します。 このデータは、電力網の運用と利用のさまざまな側面を表しています。 エネルギー需要予測では、実際の需要 (消費量) が反映されるデータ ソースに限定して説明します。 エネルギー消費量の重要なソースの&1; つはスマート メーターです。 世界中の電力会社が消費者に対してスマート メーターの設置を急速に進めています。 スマート メーターは、実際の電力消費量を記録し、そのデータを随時電力会社に送信します。 データは、5 分から 1 時間までの間の一定の間隔で収集され、送信されます。 より高度なスマート メーターでは、リモートからプログラムして、世帯の実際の消費量を制御し、バランスを取ることができます。 スマート メーターのデータは比較的信頼性が高く、タイムスタンプが含まれています。 そのため、需要予測の重要な要素になります。 メーターのデータは、電力網トポロジ内のさまざまなレベル (変圧器、変電所、地域 "*など*") で集計 (合算) できます。次に、予測モデルを構築するために必要な集計レベルを選択できます。 たとえば、電力会社が電力網に含まれる各変電所の将来の負荷を予測する場合は、すべてのメーターのデータを個々の変電所ごとに集計し、予測モデルの入力として使用できます。 スマート メーターは内部データ ソースと呼ばれています。

信頼性の高いエネルギー需要予測では、他の外部データ ソースも利用します。 電力消費量に影響を与える重要な要因の&1; つは天気、より正確には気温です。 履歴データは、外気温と電力消費量の間の強い相関関係を示しています。 消費者は夏の暑い日にはエアコンを利用し、冬には暖房を利用します。 そのため、電力網が敷かれている地域の気温の履歴は信頼性の高い重要なソースです。 さらに、電力消費量の予測因子として気温の正確な予測も利用します。

その他の外部データ ソースもエネルギー需要予測モデルの構築に役立ちます。 そうしたデータ ソースには、長期的な気候変動や経済指標 (*例:*GDP) などがあります。 このドキュメントでは、そうした他のデータ ソースについては説明しません。

### <a name="data-structure"></a>データ構造
必要なデータ ソースを特定したら、収集した生データに適切なデータ特徴が含まれていることを確認します。 信頼性の高い需要予測モデルを構築するには、収集したデータに将来の需要予測に役立つデータ要素が含まれていることを確認する必要があります。 生データのデータ構造 (スキーマ) に関連するいくつかの基本的な要件を次に示します。

生データは行と列で構成されています。 各測定値は&1; 行のデータとして表されます。 データの各行には複数の列 (特徴またはフィールドとも呼ばれる) が含まれています。

1. **タイムスタンプ** – タイムスタンプ フィールドは、測定値が記録された実際の時間を表します。 一般的ないずれかの日付/時刻形式に準拠している必要があります。 日付と時刻の両方が含まれる必要もあります。 ほとんどの場合は、秒単位までの時刻を記録する必要はありません。 データが記録されたタイム ゾーンを指定することが重要です。
2. **メーター ID** - このフィールドは、メーターまたは測定デバイスを識別します。 これはカテゴリ変数で、数字と文字を組み合わせることができます。
3. **消費値** – これは特定の日付/時刻の実際の消費量です。 消費量は、kWh (キロワット毎時) など、任意の単位で測定できます。 データのすべての測定値で測定単位が一貫している必要があります。 場合によっては、三相電源の消費量であることがあります。 その場合は、個々の位相のすべての消費量を収集する必要があります。
4. **気温** – 気温は通常、独立したソースから収集します。 ただし、消費データと互換性がある必要があります。 実際の消費量データと同期できるように、前述のタイムスタンプが含まれている必要があります。 気温値は摂氏または華氏で指定できますが、すべての測定値で一貫している必要があります。
5. **場所** – 場所フィールドは、通常、気温データを収集した場所に関連付けられます。 郵便番号または緯度/経度 (lat/long) 形式で表すことができます。

次の表には、適切な消費量と気温のデータ形式の例を示します。

| **日付** | **Time** | **測定 ID** | **位相 1** | **位相 2** | **位相 3** |
| --- | --- | --- | --- | --- | --- |
| 2015/7/1 |10:00:00 |ABC1234 |7.0 |2.1 |5.3 |
| 2015/7/1 |10:00:01 |ABC1234 |7.1 |2.2 |4.3 |
| 2015/7/1 |10:00:02 |ABC1234 |6.0 |2.1 |4.0 |

| **日付** | **Time** | **場所** | **気温** |
| --- | --- | --- | --- |
| 2015/7/1 |10:00:00 |11242 |24.4 |
| 2015/7/1 |10:00:01 |11242 |24.4 |
| 2015/7/1 |10:00:02 |11242 |24.5 |

上記のように、この例には、三相電源に関連付けられている 3 つの異なる消費量が含まれています。 また、日付と時刻のフィールドが分かれていますが、1 つの列にまとめることもできます。 この例では、場所列は 5 桁の郵便番号形式で表され、気温は摂氏形式で表されています。

### <a name="data-format"></a>データ形式
Cortana Intelligence Suite では、CSV、TSV、JSON "*など*"、よく使用されるデータ形式をサポートできます。プロジェクトのライフサイクル全体を通してデータ形式が一貫していることが重要です。

### <a name="data-ingestion"></a>データの取り込み
エネルギー需要予測は継続的かつ頻繁に実行されるため、堅牢で信頼性の高いデータ取り込みプロセスを使用して生データが流れていることを確認する必要があります。 取り込みプロセスでは、生データが必要なときに予測プロセスで確実に使用できるようにする必要があります。 具体的には、データ取り込み頻度を予測頻度よりも高くする必要があります。

たとえば、需要予測ソリューションで毎日午前 8 時に新しい予測を生成する場合、過去 24 時間に収集されたその時点までのすべてのデータが完全に取り込まれ、1 時間前のデータも含まれていることを確認する必要があります。

これを実現するために、Cortana Intelligence Suite には、信頼性の高いデータ取り込みプロセスをサポートするさまざまな方法が用意されています。 これについては、このドキュメントの「 **デプロイ** 」セクションで詳しく説明します。

### <a name="data-quality"></a>データ品質
正確で信頼性の高い需要予測の実行に必要な生データ ソースは、いくつかの基本的なデータ品質基準を満たしている必要があります。 高度な統計的手法を使用することで、発生する可能性のあるデータ品質の問題の一部に対応できますが、それでも新しいデータを取り込む際にいくつかの基本的なデータ品質のしきい値を上回っていることを確認する必要があります。 生データの品質に関するいくつかの考慮事項を次に示します。

* **欠損値** – 特定の測定値が収集されなかった状況を示しています。 ここでの基本的な要件は、すべての期間で欠損値率が 10% 以下であることです。 単一の値が欠損している場合、欠損していることを示すのに、"0" ではなく、事前定義済みの値 (例: "9999") を使用します ("0" は、有効な測定値である可能性があります)。
* **測定精度** – 消費量や気温の実際の値は正確に記録する必要があります。 不正確な測定値では、不正確な予測が生成されます。 通常、真値に対する測定誤差が 1% を下回っている必要があります。
* **測定時刻** – 収集されたデータの実際のタイムスタンプと実際の測定値の真値の差が 10 秒以内である必要があります。
* **同期** – 複数のデータ ソース (*例:*消費量と気温) を使用する場合は、データ ソース間で時刻の同期の問題がないことを確認する必要があります。 つまり、2 つの異なるデータ ソースから収集したタイムスタンプの時差が 10 秒以内である必要があります。
* **遅延** - 上の「**データの取り込み**」で説明したように、信頼性の高いデータ フローと取り込みプロセスに依存しています。 それを制御するには、データの遅延を確実に制御する必要があります。 これは、実際の測定値が取得された時刻と、Cortana Intelligence Suite のストレージに読み込まれ、使用できるようになった時刻との差で表されます。 短期負荷予測では、遅延の合計時間が 30 分以内である必要があります。 長期負荷予測では、遅延の合計時間が 1 日以内である必要があります。

### <a name="data-preparation-and-feature-engineering"></a>データの準備と特徴エンジニアリング
生データが取り込まれ (「 **データの取り込み**」を参照)、安全に格納されると、処理できます。 データ準備フェーズでは、基本的に生データを取得し、モデリング フェーズ用の形式に変換 (変更、リシェイプ) します。 その際には、実際の測定値や標準値を含む生データ列をそのまま使用するなどの単純な操作や、[時間遅延](https://en.wikipedia.org/wiki/Lag_operator)などの複雑な操作が実行されます。 新しく作成されたデータ列はデータ特徴と呼ばれ、これらを生成するプロセスは特徴エンジニアリングと呼ばれます。 このプロセスが終わると、生データから派生し、モデリングに使用できる新しいデータ セットが生成されます。 さらに、データ準備フェーズでは、欠損値 (「 **データ品質**」を参照) を処理し、補完する必要があります。 また、データを正規化して、すべての値を同じスケールで表現することが必要な場合もあります。

このセクションでは、エネルギー需要予測モデルに含まれている一般的なデータ特徴の一部を紹介します。

**時刻主導の特徴:** これらの特徴は日付/時刻のスタンプ データから派生します。 抽出され、次のようなカテゴリ特徴に変換されます。

* 時間 – これは時間を表し、0 ～ 23 の値を取ります
* 曜日 – これは曜日を表し、1 (日曜日) ～ 7 (土曜日) の値を取ります
* 日にち – これは実際の日にちを表し、1 ～ 31 の値を取ります
* 月 – これは月を表し、1 (1 月) ～ 12 (12 月) の値を取ります
* 週末 – これはバイナリ値の特徴で、0 (平日) または 1 (週末) の値を取ります
* 祝日 – これはバイナリ値の特徴で、0 (祝日以外の日) または 1 (祝日) の値を取ります
* フーリエ条件 – フーリエ条件はタイムスタンプから派生した重みで、データの季節性 (周期) をキャプチャするために使用されます。 データに複数の季節が含まれている場合は、複数のフーリエ条件が必要です。 たとえば、需要値には年、週、および日単位の季節/周期があるため、フーリエ条件は 3 つになります。

**測定値の独立した特徴:** 独立した特徴には、このモデルの予測因子として使用するすべてのデータ要素が含まれます。 ここでは、予測する必要がある依存特徴を除外します。

* ラグ特徴 – これらは実際の需要の時間シフト値です。 たとえば、ラグ 1 の特徴は現在のタイムスタンプの 1 時間前の需要値を保持します (時間単位のデータの場合)。 同様に、ラグ 2、ラグ 3 "*など*" を追加できます。使用するラグ特徴の実際の組み合わせは、モデリング フェーズ中にモデルの結果の評価によって決定されます。
* 長期傾向 – この特徴は年単位の需要の線形成長を表します。

**依存特徴:** 依存特徴は、モデルで予測するデータ列です。 [教師あり機械学習](https://en.wikipedia.org/wiki/Supervised_learning)では、最初に依存特徴 (ラベルとも呼ばれる) を使用して、モデルをトレーニングする必要があります。 これにより、モデルは依存特徴に関連付けられているデータのパターンを学習できます。 エネルギー需要予測では、通常、実際の需要を予測します。そのため、実際の需要を依存特徴として使用します。

**欠損値の処理:** データ準備フェーズでは、欠損値を処理する最適な戦略を決定する必要があります。 これは通常、さまざまな統計の[データ補完法](https://en.wikipedia.org/wiki/Imputation_\(statistics\))を使用して行います。 エネルギー需要予測の場合は、通常、使用可能な以前のデータ ポイントの移動平均を使用して、欠損値を補完します。

**データの正規化:** データの正規化は、需要予測などのすべての数値データを同様のスケールに揃えるために使用する別の種類の変換です。 これは、通常、モデルの正確性と精度を向上させるのに役立ちます。 通常、正規化は実際の値をデータの範囲で除算することで行われます。
元の値を小さな範囲 (通常、-1 ～ 1) にスケールダウンします。

## <a name="modeling"></a>モデリング
モデリング フェーズでは、データをモデルに変換します。 このプロセスの中心となるのが、履歴データ (トレーニング データ) をスキャンし、パターンを抽出して、モデルを構築する高度なアルゴリズムです。 そのモデルは、後で、モデルの構築に使用されていない新しいデータでの予測に使用できます。

信頼性の高い作業モデルを構築すると、そのモデルを、必要な特徴 (X) を含むように構成された新しいデータのスコア付けに使用できます。 スコア付けプロセスでは、永続化されたモデル (トレーニング フェーズの成果物) を使用し、Ŷ で表される目標変数を予測します。

### <a name="demand-forecasting-modeling-techniques"></a>需要予測のモデリング手法
需要予測では、時系列に並べ替えられた履歴データを使用します。 一般的に、時間ディメンションを含むデータを [時系列](https://en.wikipedia.org/wiki/Time_series)と呼びます。 時系列モデリングの目的は、時間に関連する傾向、季節性、自動相関関係 (経時の相関関係) を見つけ、それらをモデルとして構築することです。

近年では、時系列予測に対応した高度なアルゴリズムが開発され、予測精度が向上しています。 ここでは、その一部について簡単に説明します。

> [!NOTE]
> このセクションは、機械学習や予測の概要ではなく、需要予測でよく使用されるモデリング手法を簡単に紹介することを目的としています。 時系列予測の詳細と教材については、オンライン ブックの『 [Forecasting: principles and practice (予測: 原則と実践)](https://www.otexts.org/book/fpp)』を参照することを強くお勧めします。
> 
> 

#### <a name="ma-moving-averagehttpswwwotextsorgfpp62"></a>[**MA (移動平均)**](https://www.otexts.org/fpp/6/2)
移動平均は、時系列予測に使用された最初の分析手法の&1; つで、現在でもよく使用されている手法の&1; つです。 より高度な予測手法の基盤でもあります。 移動平均では、K 番目に新しいポイントを平均することで、次のデータ ポイントを予測します (K は、移動平均の順序を示します)。

移動平均手法には、予測を平滑化する効果があります。そのため、データの大きなボラティリティをうまく処理できない場合があります。

#### <a name="ets-exponential-smoothinghttpswwwotextsorgfpp75"></a>[**ETS (指数平滑法)**](https://www.otexts.org/fpp/7/5)
指数平滑法 (ETS) は、次のデータ ポイントを予測するために、最新のデータ ポイントの加重平均を使用するさまざまな手法のグループです。 考え方としては、値が新しいほど大きい重みを割り当て、以前に測定した値に対してこの重みを徐々に減らしていきます。 このグループにはさまざまな手法があり、中には、 [季節調整指数平滑化法](https://www.otexts.org/fpp/7/5)など、データの季節性を処理するものもあります。

これらの手法では、データの季節性も考慮します。

#### <a name="arima-auto-regression-integrated-moving-averagehttpswwwotextsorgfpp8"></a>[**ARIMA (自己回帰和分移動平均)**](https://www.otexts.org/fpp/8)
自己回帰和分移動平均 (ARIMA) は、時系列予測によく使用される手法のもう&1; つのグループです。 実質的には、移動平均に自己回帰法を組み合わせた手法です。 自己回帰法では、前の時系列値を取得して、次のデータ ポイントを計算する回帰モデルを使用します。 ARIMA 法では、データ ポイント間の差を計算して、元の測定値の代わりに使用する差分手法も適用します。 最後に、ARIMA では、前に説明した移動平均法も使用します。 ARIMA 法のグループは、これらすべての手法をさまざまな形で組み合わせたもので構成されています。

ETS と ARIMA は現在、エネルギー需要予測などの各種予測問題に広く使用されています。 多くの場合、非常に正確な結果を得るために、これらを組み合わせます。

**一般的な多重回帰** 回帰モデルは、機械学習と統計の分野において最も重要なモデリング アプローチと考えられます。 時系列では、回帰を使用して、将来の (需要 "*など*" の) 値を予測します。 回帰では、予測因子を線形結合し、トレーニング プロセスでこれらの予測因子の重み (係数とも呼ばれる) を学習します。 目的は、予測値を予測する回帰直線を作成することです。 回帰手法は、目標変数が数値の場合に適しています。そのため、時系列予測に適しています。 回帰手法には、[線形回帰](https://en.wikipedia.org/wiki/Linear_regression)などの非常にシンプルな回帰モデルから、デシジョン ツリー、[ランダム フォレスト](https://en.wikipedia.org/wiki/Random_forest)、[ニューラル ネットワーク](https://en.wikipedia.org/wiki/Artificial_neural_network)、ブースト デシジョン ツリーなどのより高度なモデルまで、さまざまな種類があります。

エネルギー需要予測を回帰の問題として構築すると、実際の要求の時系列データと気温などの外的要因から組み合わせ可能なデータ特徴をかなり柔軟に選択することができます。 選択した特徴の詳細については、このプレイブックの特徴エンジニアリング (「 **データの準備と特徴エンジニアリング**」を参照) セクションで説明しています。

エネルギー需要予測のパイロットの実装とデプロイの経験から、Azure ML で使用できる高度な回帰モデルでは最適な結果が生成される傾向があることがわかったため、使用しています。

## <a name="model-evaluation"></a>モデルの評価
モデルの評価は、**モデル開発サイクル**内で重要な役割を担っています。 この手順では、実際のデータを使用したモデルとそのパフォーマンスの検証について説明します。 モデリング手順では、使用できるデータの一部をモデルのトレーニングに使用します。 評価フェーズでは、残りのデータを使用してモデルをテストします。 実際には、再構築し、トレーニング データセットと同じ特徴を含んでいる新しいデータをモデルに供給します。 ただし、検証プロセスでは、モデルを使用して、目標変数を予測します。使用可能な目標変数は提供しません。 このプロセスは、多くの場合、モデルのスコア付けと呼ばれます。 実際の目標値を使用して、予測値と比較します。 ここでの目的は、予測誤差 (予測と実際の値の差) を測定し、最小限に抑えることです。 モデルを微調整し、誤差が実際に減少しているかどうかを検証するため、誤差の測定値を定量化することが重要です。 モデルを微調整するには、学習プロセスを制御するモデル パラメーターを変更するか、データ特徴を追加または削除します ([パラメーター スイープ](https://channel9.msdn.com/Blogs/Azure/Data-Science-Series-Building-an-Optimal-Model-With-Parameter-Sweep)と呼ばれます)。 実際には、誤差が必要なレベルに下がるまで、特徴エンジニアリング、モデリング、およびモデルの評価の各フェーズを複数回繰り返すことが必要になる場合があります。

すべての結果を完全に予測できるモデルは存在しないため、予測誤差はゼロにはならないことに注意してください。 ビジネスには許容できるある程度の誤差が存在します。 検証プロセスでは、モデルの予測誤差がビジネスの許容レベルに収まっていることを確認します。 そのため、サイクルの最初の **問題の定式化** フェーズで、許容できる誤差レベルを設定することが重要です。

### <a name="typical-evaluation-techniques"></a>一般的な評価手法
予測誤差を測定および定量化できるさまざまな方法があります。 このセクションでは、特にエネルギー需要予測に適した、時系列に関連する評価手法について説明します。

#### <a name="mapehttpsenwikipediaorgwikimeanabsolutepercentageerror"></a>[**MAPE**](https://en.wikipedia.org/wiki/Mean_absolute_percentage_error)
MAPE は、Mean Absolute Percentage Error (平均絶対誤差率) の略です。 MAPE を使用して、予測された各ポイントとそのポイントの実際の値との差を計算します。 実際の値を基準に差の比率を計算することで、ポイントごとの誤差を定量化します。 最後の手順で、これらの値を平均します。 MAPE で使用される数式を次に示します。

![MAPE の数式](media/cortana-analytics-playbook-demand-forecasting-energy/mape-formula.png)
 "*A<sub>t</sub> は実際の値、F<sub>t</sub> は予測値、n は予測期間です。*"

## <a name="deployment"></a>デプロイ
モデリング フェーズが完了し、モデルのパフォーマンスを検証したら、デプロイ フェーズに進むことができます。 このコンテキストでは、デプロイとは、お客様がモデルを使用して、実際の予測を大規模に実行できるようにすることです。 主な目的は、データから洞察を得ることではなく、予測を継続的に呼び出すことであるため、Azure ML でのデプロイの概念が重要です。 デプロイ フェーズでは、モデルを大規模に利用できるようにします。

エネルギー需要予測の場合の目標は、継続的かつ定期的に予測を呼び出す一方で、モデルが最新のデータを使用できようにし、予測データが消費クライアントに送信されるようにすることです。

### <a name="web-services-deployment"></a>Web サービスのデプロイ
Azure ML でデプロイできる主な構成要素は、Web サービスです。 これは、予測モデルをクラウドで利用できるようにする最も効果的な方法です。 Web サービスは、モデルをカプセル化し、 [RESTful](http://www.restapitutorial.com/) API (アプリケーション プログラミング インターフェイス) でラップします。 この API は、次の図に示すようにクライアント コードの一部として使用できます。

![We Service Deployment and Consumption](media/cortana-analytics-playbook-demand-forecasting-energy/web-service-deployment-and-consumption.png)

ご覧のように、Web サービスは Cortana Intelligence Suite クラウドにデプロイされ、公開されている REST API エンドポイント経由で呼び出すことができます。 さまざまなドメインの各種クライアントで同時に Web API を使用してサービスを呼び出すことができます。 また、Web サービスはスケーリングによって何千もの同時呼び出しに対応できます。

### <a name="a-typical-solution-architecture"></a>一般的なソリューション アーキテクチャ
エネルギー需要予測ソリューションをデプロイする際には、予測 Web サービスを超えて、データ フロー全体を支援するエンド ツー エンド ソリューションのデプロイに注目しています。 新しい予測を呼び出すときに、モデルに最新のデータ特徴が供給されていることを確認する必要があります。 つまり、新しく収集された生データが継続的に取り込まれ、処理されて、モデルの構築に必要な特徴セットに変換されている必要があります。 同時に、予測データがエンド消費クライアントで利用できるようにする必要もあります。 次の図には、データ フロー サイクル (データ パイプライン) の例を示します。

![Energy Demand Forecast End to End Data Flow](media/cortana-analytics-playbook-demand-forecasting-energy/energy-demand-forecase-end-data-flow.png)

これらは、エネルギー需要予測サイクルの一環として実行されます。

1. 設置された数百万台ものデータ メーターが継続的にリアルタイムで電力消費量データを生成します。
2. このデータが収集され、クラウド リポジトリ (*例:*Azure BLOB) にアップロードされます。
3. 処理される前に、生データは変電所レベルまたは企業が定義した地域レベルで集計されます。
4. 特徴の処理 (「**データの準備と特徴エンジニアリング**」を参照) が実行され、モデルのトレーニングまたはスコア付けに必要なデータが生成されます。特徴セットのデータはデータベース (SQL Azure "*など*") に格納されます。
5. 再トレーニング サービスが呼び出されて、予測モデルが再トレーニングされます。そのモデルの更新されたバージョンが永続化され、スコア付け Web サービスで使用できるようになります。
6. 必要な予測頻度に応じたスケジュールでスコア付け Web サービスが呼び出されます。
7. 予測データがエンド消費クライアントからアクセスできるデータベースに格納されます。
8. 消費クライアントが予測を取得し、電力網に適用して、必要なユース ケースに従って利用します。

このサイクル全体が完全に自動化され、スケジュールに従って実行されることに注目してください。 このデータ サイクル全体のオーケストレーションは、 [Azure Data Factory](http://azure.microsoft.com/services/data-factory/)などのツールを使用して実行できます。

### <a name="end-to-end-deployment-architecture"></a>End to End Deployment Architecture
実際に Cortana Intelligence にエネルギー需要予測ソリューションをデプロイするには、必要なコンポーネントが適切に構築、構成されていることを確認する必要があります。

次の図は、上記のデータ フロー サイクルを実装および調整する Cortana Intelligence ベースの一般的なアーキテクチャを示しています。

![End to End Deployment Architecture](media/cortana-analytics-playbook-demand-forecasting-energy/architecture.png)

各コンポーネントとアーキテクチャ全体の詳細については、エネルギー ソリューション テンプレートを参照してください。


