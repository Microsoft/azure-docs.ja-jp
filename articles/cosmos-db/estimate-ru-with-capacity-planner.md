---
title: Azure Cosmos DB Capacity Planner を使用してコストを見積もる
description: Azure Cosmos DB Capacity Planner を使用すると、ワークロードに必要なスループット (RU/秒) とコストを見積もることができます。 この記事では、新しいバージョンの Capacity Planner を使用して、必要なスループットとコストを見積もる方法について説明します。
author: deborahc
ms.service: cosmos-db
ms.topic: how-to
ms.date: 07/30/2019
ms.author: dech
ms.openlocfilehash: 6a30535ac3aaa90dc3553f6901a83ab300546fb5
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/02/2020
ms.locfileid: "85261853"
---
# <a name="estimate-rus-using-the-azure-cosmos-db-capacity-planner"></a>Azure Cosmos DB Capacity Planner を使用して RU/秒を見積もる

ワークロードにとって適切な量のプロビジョニング済みスループット、つまり[要求ユニット (RU/秒)](request-units.md) を使用して Azure Cosmos データベースとコンテナーを構成することは、コストとパフォーマンスの最適化に不可欠です。 この記事では、Azure Cosmos DB [Capacity Planner](https://cosmos.azure.com/capacitycalculator/) を使用して、ワークロードに必要な RU/秒とコストの見積もりを取得する方法について説明します。 

## <a name="how-to-estimate-throughput-and-cost-with-azure-cosmos-db-capacity-planner"></a>Azure Cosmos DB Capacity Planner を使用してスループットとコストを見積もる方法

Capacity Planner は、2 つのモードで使用できます。

|**モード**  |**説明**  |
|---------|---------|
|Basic|迅速で大まかな RU/秒とコストの見積もりを提供します。 このモードは、インデックス作成ポリシー、一貫性、およびその他のパラメーターに対して既定の Azure Cosmos DB 設定を前提としています。 <br/><br/>Azure Cosmos DB で実行する可能性のあるワークロードを評価するときは、迅速で大まかな見積もりを得るために基本モードを使用します。|
|詳細設定|追加設定 (インデックス作成ポリシー、一貫性レベル、およびコストとスループットに影響を与えるその他のパラメーター) の調整機能により、より詳細な RU/秒とコストの見積もりを提供します。 <br/><br/>新しいプロジェクトの RU/秒の見積もりを作成する場合や、より詳細な見積もりが必要な場合は、詳細モードを使用します。 |


## <a name="estimate-provisioned-throughput-and-cost-using-basic-mode"></a>基本モードを使用してプロビジョニング済みスループットとコストを見積もる
基本モードを使ってワークロードの素早い見積もりを取得するには、[Capacity Planner](https://cosmos.azure.com/capacitycalculator/) に移動します。 該当のワークロードに基づいて次のパラメーターを入力します。 

|**入力**  |**説明**  |
|---------|---------|
|リージョンの数|Azure Cosmos DB は、すべての Azure リージョンで利用できます。 該当のワークロードに必要なリージョンの数を選択します。 ご使用の Cosmos アカウントには、任意の数のリージョンを関連付けることができます。 詳細については、Azure Cosmos DB の[グローバル分散](distribute-data-globally.md)に関する記事を参照してください。|
|マルチリージョンの書き込み|[マルチリージョンの書き込み](distribute-data-globally.md#key-benefits-of-global-distribution)を有効にすると、お使いのアプリケーションは任意の Azure リージョンに対して読み取りおよび書き込みを行うことができます。 マルチリージョンの書き込みを無効にすると、アプリケーションは単一リージョンに対してデータの書き込みを行うことができます。 <br/><br/> さまざまなリージョンでの待機時間の短い書き込みを必要とするアクティブ/アクティブのワークロードが予期される場合は、マルチリージョンの書き込みを有効にしてください。 たとえば、さまざまなリージョンでデータベースにデータを大量に書き込む IOT ワークロードがあります。 <br/><br/> マルチリージョンの書き込みでは、99.999% の読み取りと書き込みの可用性が保証されます。 マルチリージョンの書き込みでは、単一の書き込みリージョンと比べて、より多くのスループットが必要になります。 詳細については、[単一の書き込みリージョンと複数の書き込みリージョンでの RU の違い](optimize-cost-regions.md)に関する記事を参照してください。|
|格納されるデータの合計 (リージョンごと)|1 つのリージョンに格納される推定データの合計 (GB 単位)。|
|アイテムのサイズ|データ項目 (ドキュメントなど) の推定サイズ (1 KB から 2 MB の範囲)。 |
|リージョンごとの読み取り数/秒|1 秒あたりの予想される読み取り数。 |
|リージョンごとの書き込み数/秒|1 秒あたりの予想される書き込み数。 |

必要な詳細を入力したら、 **[計算]** を選択します。 **[コストの見積もり]** タブに、ストレージとプロビジョニング済みスループットの合計コストが表示されます。 このタブの **[詳細の表示]** リンクを展開すると、読み取り要求と書き込み要求に必要なスループットの内訳が表示されます。 フィールドの値を変更するたびに、 **[計算]** を選択して見積もりコストを再計算してください。 

:::image type="content" source="./media/estimate-ru-with-capacity-planner/basic-mode.png" alt-text="Capacity Planner の基本モード":::

## <a name="estimate-provisioned-throughput-and-cost-using-advanced-mode"></a>詳細モードを使用してプロビジョニング済みスループットとコストを見積もる

詳細モードでは、RU/秒の見積もりに影響を与える追加の設定を指定できます。 このオプションを使用するには、[Capacity Planner](https://cosmos.azure.com/capacitycalculator/) に移動し、Azure に使用しているアカウントでこのツールにサインインします。 サインイン オプションは、右側の隅にあります。 

サインインすると、基本モードのフィールドと比べて追加のフィールドが表示されます。 該当のワークロードに基づいて追加のパラメーターを入力します。 

|**入力**  |**説明**  |
|---------|---------|
|API|Azure Cosmos DB は、マルチモデルおよびマルチ API のサービスです。 新しいワークロードの場合は、SQL (Core) API を選択します。 |
|リージョンの数|Azure Cosmos DB は、すべての Azure リージョンで利用できます。 該当のワークロードに必要なリージョンの数を選択します。 ご使用の Cosmos アカウントには、任意の数のリージョンを関連付けることができます。 詳細については、Azure Cosmos DB の[グローバル分散](distribute-data-globally.md)に関する記事を参照してください。|
|マルチリージョンの書き込み|[マルチリージョンの書き込み](distribute-data-globally.md#key-benefits-of-global-distribution)を有効にすると、お使いのアプリケーションは任意の Azure リージョンに対して読み取りおよび書き込みを行うことができます。 マルチリージョンの書き込みを無効にすると、アプリケーションは単一リージョンに対してデータの書き込みを行うことができます。 <br/><br/> さまざまなリージョンでの待機時間の短い書き込みを必要とするアクティブ/アクティブのワークロードが予期される場合は、マルチリージョンの書き込みを有効にしてください。 たとえば、さまざまなリージョンでデータベースにデータを大量に書き込む IOT ワークロードがあります。 <br/><br/> マルチリージョンの書き込みでは、99.999% の読み取りと書き込みの可用性が保証されます。 マルチリージョンの書き込みでは、単一の書き込みリージョンと比べて、より多くのスループットが必要になります。 詳細については、[単一の書き込みリージョンと複数の書き込みリージョンでの RU の違い](optimize-cost-regions.md)に関する記事を参照してください。|
|既定の一貫性|Azure Cosmos DB では 5 つの一貫性レベルがサポートされており、開発者は一貫性、可用性、待機時間のトレードオフのバランスを取ることができます。 詳細については、[一貫性レベル](consistency-levels.md)に関する記事を参照してください。 <br/><br/> 既定では、Azure Cosmos DB はセッションの一貫性を使用します。これにより、セッションで自分の書き込みを読み取ることができるようになります。 <br/><br/> 厳密または有界整合性制約を選択すると、セッション、一貫性のあるプレフィックス、および最終的な整合性と比べて、読み取りに必要な RU/秒が 2 倍になります。 マルチリージョンの書き込みでの厳密な一貫性はサポートされておらず、厳密な一貫性での単一リージョンの書き込みが自動的に既定に設定されます。 |
|インデックス作成ポリシー|既定では、Azure Cosmos DB は、柔軟で効率的なクエリを実行するために、すべての項目の[すべてのプロパティのインデックス作成](index-policy.md)を行います (**自動**インデックス作成ポリシーにマップされます)。 <br/><br/> **[オフ]** を選択すると、どのプロパティでもインデックスは作成されません。 この場合、書き込みの RU 料金が最も低くなります。 [ポイント読み取り](https://docs.microsoft.com/dotnet/api/microsoft.azure.cosmos.container.readitemasync?view=azure-dotnet) (キー値の参照) と書き込み、またはそのいずれかのみを実行し、クエリを実行しない場合は、 **[オフ]** ポリシーを選択してください。 <br/><br/> カスタム インデックス作成ポリシーを使用すると、書き込みスループットとストレージの量を低下させるために、特定のプロパティをインデックスに含めたりインデックスから除外したりできます。 詳細については、[インデックス作成ポリシー](index-overview.md)と[インデックス作成ポリシーの例](how-to-manage-indexing-policy.md#indexing-policy-examples)に関する記事を参照してください。|
|格納されるデータの合計 (リージョンごと)|1 つのリージョンに格納される推定データの合計 (GB 単位)。|
|ワークロード モード|ワークロードのボリュームが一定の場合は、 **[Steady]\(安定\)** を選択します。 <br/><br/> ワークロードのボリュームが時間の経過とともに変化する場合は、 **[Variable]\(変動\)** を選択します。  たとえば、特定の 1 日間や 1 か月間などです。 <br/><br/> [Variable]\(変動\) のワークロード オプションを選択した場合、次の設定を使用できます。<ul><li>ピーク時の時間のパーセンテージ:ワークロードでピーク (最高) のスループットが必要となる、1 か月間の時間のパーセンテージ。 <br/><br/> たとえば、午前 9 時から午後 6 時の平日の営業時間中に高アクティビティとなるワークロードがある場合、ピーク時の時間のパーセンテージは次のようになります。ピーク時の 45 時間/730 時間/月 = ~6%。<br/><br/></li><li>ピーク時のリージョンごとの読み取り数/秒 - ピーク時の予期される読み取り数/秒。</li><li>ピーク時のリージョンごとの書き込み数/秒 - ピーク時の予期される書き込み数/秒。</li><li>オフピーク時のリージョンごとの読み取り数/秒 - オフピーク時の予期される読み取り数/秒。</li><li>オフピーク時のリージョンごとの書き込み数/秒 - オフピーク時の予期される書き込み数/秒。</li></ul>ピーク時とオフピーク時の間隔を使って、それに応じて[プロビジョニング済みスループットをプログラムで拡大縮小する](set-throughput.md#update-throughput-on-a-database-or-a-container)ことで、コストを最適化できます。|
|アイテムのサイズ|データ項目 (ドキュメントなど) のサイズ (1 KB から 2 MB の範囲)。 <br/><br/>また、より正確な見積もりを得るために、**サンプル (JSON) ドキュメントをアップロード**することもできます。<br/><br/>ワークロードの複数の種類の項目 (JSON コンテンツが異なる) が同じコンテナー内にある場合は、複数の JSON ドキュメントをアップロードして、見積もりを取得できます。 複数のサンプル JSON ドキュメントを追加するには、 **[新しい項目の追加]** ボタンを使用します。|

また、 **[Save Estimate]\(見積もりの保存\)** ボタンを使用して、現在の見積もりを含む CSV ファイルをダウンロードすることもできます。 

:::image type="content" source="./media/estimate-ru-with-capacity-planner/advanced-mode.png" alt-text="Capacity Planner の詳細モード":::

Azure Cosmos DB Capacity Planner に表示される価格は、スループットとストレージの公開価格料金に基づいた見積もりです。 すべての価格は米ドルで表示されます。 リージョン別のすべての料金を確認するには、[Azure Cosmos DB の価格のページ](https://azure.microsoft.com/pricing/details/cosmos-db/)を参照してください。  

## <a name="estimating-throughput-for-queries"></a>クエリのスループットの見積もり

Azure Cosmos Capacity Calculator は、ワークロードに対するポイント読み取り (ID とパーティション キー値による単一項目 (ドキュメントなど) の読み取り) と書き込みを前提としています。 クエリに必要なスループットを見積もるには、Cosmos コンテナーで代表的なデータ セットに対するクエリを実行して、[RU 料金を取得](find-request-unit-charge.md)します。 その RU 料金を、1 秒あたりに実行されると予測されるクエリの数で乗算して、必要な RU/秒の合計を取得します。 

たとえば、1 秒あたり 100 回実行されるクエリ ``SELECT * FROM c WHERE c.id = 'Alice'`` がワークロードに必要で、このクエリの RU 料金が 10 RU の場合、これらの要求を処理するには、100 クエリ/秒 * 10 RU/クエリ = 1000 RU/秒が必要になります。 これらの RU/秒 を、ワークロードで発生する読み取りや書き込みに必要な RU/秒に追加します。

## <a name="next-steps"></a>次のステップ

* [Azure Cosmos DB の価格モデル](how-pricing-works.md)の詳細を確認します。
* 新しい [Cosmos アカウント、データベース、コンテナー](create-cosmosdb-resources-portal.md)を作成します。
* [プロビジョニング済みスループットのコストを最適化する](optimize-cost-throughput.md)方法について学習します。
* [予約容量でコストを最適化する](cosmos-db-reserved-capacity.md)方法について学習します。

