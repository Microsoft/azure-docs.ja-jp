---
title: Azure Cosmos DB でのパーティション分割
description: Azure Cosmos DB でのパーティション分割の概要
ms.author: mjbrown
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/30/2018
ms.openlocfilehash: 20e869d30f9e7b8102b723870f0102e041e064d7
ms.sourcegitcommit: 8330a262abaddaafd4acb04016b68486fba5835b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/04/2019
ms.locfileid: "54042276"
---
# <a name="partitioning-in-azure-cosmos-db"></a>Azure Cosmos DB でのパーティション分割

パーティション分割は、Cosmos DB で使用して、データベースの個別のコンテナーをスケーリングし、アプリケーションのパフォーマンスのニーズを満たす手法です。 パーティション分割を使用して、コンテナー内の項目を、論理パーティションと呼ばれる特定のサブセットに分割します。 論理パーティションは、各項目に関連付けられているパーティション キーのプロパティの値に基づいて作成されます。

論理パーティションは、コンテナー内の項目のサブセットです。 論理パーティション内の項目は、論理パーティション内のすべての項目によって共有されているパーティション キー値によって識別されます。  たとえば、コンテナーにドキュメントがあり、各ドキュメントに `UserID` プロパティがあるとします。  `UserID` がコンテナー内の項目のパーティション キーとなり、1,000 個の一意の `UserID` 値がある場合、1,000 個の論理パーティションがコンテナーに作成されます。

コンテナー内の各項目には**パーティション キー**があり、それによって項目の**論理パーティション**が決まり、各項目には**項目 ID** (論理パーティション内で一意) もあります。  項目の**インデックス**によって項目が一意に識別され、パーティション キーと項目 ID を組み合わせることによってインデックスは構成されます。

パーティション キーを選択することは、アプリケーションのパフォーマンスに影響する重要な決定事項です。  詳細については、[パーティション キーの選択](partitioning-overview.md#choose-partitionkey)に関する記事の詳しい説明を参照してください。

## <a name="logical-partition-management"></a>論理パーティション管理

Cosmos DB では、論理パーティションの物理パーティション (サーバー インフラストラクチャ) への配置が透過的かつ自動的に管理され、コンテナーのスケーラビリティとパフォーマンスのニーズが効率的に満たされます。 アプリケーションのスループットとストレージの要件が上がると、Cosmos DB は論理パーティションを移動し、より多くのサーバーに負荷を自動的に分散します。 Cosmos DB でパーティションを管理する方法の詳細については、[論理パーティション](partition-data.md)に関する記事を参照してください。 アプリケーションの構築または実行のために、これらの詳細を理解する必要はありません。

Cosmos DB は、ハッシュベースのパーティション分割を使用して、論理パーティションを物理パーティションに分散します。  項目のパーティション キー値は、Cosmos DB によってハッシュされ、ハッシュの結果によって物理パーティションが決まります。 Cosmos DB が N 個の物理パーティションに対し、パーティション キー ハッシュのキー空間を均等に割り当てます。

1 つのパーティション内のデータにアクセスするクエリでは、複数のパーティションにアクセスするクエリよりもコスト効率が高くなります。 ストアド プロシージャまたはトリガー内のトランザクションは、1 つの論理パーティション内の項目に対してのみ使用できます。  

## <a id="choose-partitionkey"></a>パーティション キーを使用する場合

パーティション キーを選択する際に、次の詳細を考慮してください。

* 1 つの論理パーティションでは、10 GB のストレージの上限が許可されます。  

* パーティション分割コンテナーは、400 RU/秒の最小スループットで構成されます。 同じパーティション キーへの要求は、パーティションに割り当てられているスループットを超えることはできません。 割り当て済みのスループットを超えている場合、要求ではレートが制限されます。 そのため、アプリケーション内の "ホット スポット" にならないパーティション キーを選択することが重要です。

* すべてのパーティションと時間で均等にワークロードが分散されるパーティション キーを選択します。  パーティション キーの選択により、複数のパーティションに項目を分散してスケーラビリティを達成するという目標に対して、効率的なパーティションのクエリやトランザクションの必要性のバランスを取る必要があります。

* さまざまな値とアクセス パターンがあり、それが論理パーティション間で均等に分散されるパーティション キーを選択します。 基本的な考え方は、コンテナー内のデータとアクティビティを一連の論理パーティションに分散し、データ ストレージとスループットのリソースを論理パーティション間に分散できるようにすることです。

* パーティション キーの候補には、クエリ内でフィルターとして頻繁に出現するプロパティが含まれる場合があります。 フィルターの述語にパーティション キーを含めることで、クエリ呼び出しを効率的にルーティングできます。

## <a name="next-steps"></a>次の手順

* [パーティション](partition-data.md)について確認します
* [Azure Cosmos DB におけるスループットのプロビジョニング](request-units.md)について理解します
* [Azure Cosmos DB の世界規模での分散](distribute-data-globally.md)について理解します。
