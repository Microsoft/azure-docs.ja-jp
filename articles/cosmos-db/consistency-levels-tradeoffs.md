---
title: Azure Cosmos DB の整合性、可用性、パフォーマンスのトレードオフ
description: Azure Cosmos DB のさまざまな整合性レベルでの可用性およびパフォーマンスのトレードオフ。
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/23/2020
ms.reviewer: sngun
ms.openlocfilehash: 4de696e2538bf1fa4823aafe30f931b7852535a7
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/02/2020
ms.locfileid: "82191738"
---
# <a name="consistency-availability-and-performance-tradeoffs"></a>整合性、可用性、パフォーマンスのトレードオフ

高可用性、短い待機時間、またはその両方のためにレプリケーションに依存している分散型データベースでは、トレードオフを考慮する必要があります。 読み取りの整合性と、可用性、待機時間、およびスループットとのトレードオフです。

Azure Cosmos DB では、幅広い選択肢を利用できるデータ整合性に対応しています。 このアプローチには、厳密で最終的な整合性という 2 つの極端な方法よりも多くの選択肢があります。 整合性の程度に応じて明確に定義された 5 種類のレベルから選択することができます。 最強から最弱の順に、次のレベルがあります。

- *厳密*
- *有界整合性制約*
- *セッション*
- *整合性のあるプレフィックス*
- *最終的*

いずれのレベルでも、可用性とパフォーマンスのトレードオフが提供され、包括的な SLA に裏付けられています。

## <a name="consistency-levels-and-latency"></a>整合性レベルと待機時間

すべての整合性レベルの読み取り待機時間は 99 パーセンタイルで 10 ミリ秒未満となるように常に保証されています。 この読み取り待機時間は、SLA によってサポートされます。 平均読み取り待機時間は、(50 パーセンタイルで) 通常 4 ミリ秒以下です。

すべての整合性レベルの書き込み待機時間は 99 パーセンタイルで 10 ミリ秒未満となるように常に保証されています。 この書き込み待機時間は、SLA によってサポートされます。 平均書き込み待機時間は、(50 パーセンタイルで) 通常 5 ミリ秒以下です。 複数のリージョンにまたがり、厳密な整合性で構成されている Azure Cosmos アカウントは、この保証の例外です。

### <a name="write-latency-and-strong-consistency"></a>書き込み待機時間と厳密な整合性

複数のリージョンでの厳密な整合性によって構成された Azure Cosmos アカウントの場合、書き込み待機時間は、99 パーセンタイルで 2 つの最も遠いリージョン間のラウンドトリップ時間 (RTT) の 2 倍 + 10 ミリ秒に等しくなります。 アカウント内のすべてのリージョンにコミットされたことを確認した後にしか厳密な整合性による操作は完了されないため、リージョン間のネットワーク RTT が高くなると、Cosmos DB 要求の待機時間が長くなります。

正確な RTT 待機時間は、光の速さで通信する距離と Azure ネットワーク トポロジによって決まります。 Azure ネットワークでは、任意の 2 つの Azure リージョン間の RTT に対して待機時間の SLA は提供されません。 Azure Cosmos アカウントの場合、レプリケーションの待機時間は Azure portal に表示されます。 Azure portal を使用して ([メトリック] ブレードに移動する)、ご自身の Azure Cosmos アカウントに関連付けられているさまざまなリージョン間のレプリケーション待機時間を監視できます。

> [!IMPORTANT]
> 書き込み待機時間が長くなることから、5000 マイル (8000 キロメートル) を超えるリージョンでのアカウントの厳密な整合性は、既定でブロックされています。 この機能を有効にするには、サポートにお問い合わせください。

## <a name="consistency-levels-and-throughput"></a>整合性レベルとスループット

- 厳密と有界整合性制約では、一貫性の保証を提供するために、4 つのレプリカ セット (マイノリティ クォーラム) のうち 2 つのレプリカに対して読み取りが行われます。 セッション、一貫性のあるプレフィックス、および最終的では、単一のレプリカの読み取りが行われます。 結果として、同数の要求ユニットに対する厳密と有界整合性制約の読み取りスループットは、他の一貫性レベルの半分になります。

- 書き込み操作の種類 (挿入、置換、アップサート、削除) が指定された場合、要求ユニットに対するスループットはすべての整合性レベルで同じです。

|**整合性レベル**|**クォーラムの読み取り**|**クォーラムの書き込み**|
|--|--|--|
|**厳密**|ローカル マイノリティ|グローバル マジョリティ|
|**有界整合性制約**|ローカル マイノリティ|ローカル マジョリティ|
|**セッション**|単一のレプリカ (セッション トークンを使用)|ローカル マジョリティ|
|**一貫性のあるプレフィックス**|単一のレプリカ|ローカル マジョリティ|
|**最終的**|単一のレプリカ|ローカル マジョリティ|

## <a name="consistency-levels-and-data-durability"></a><a id="rto"></a>整合性レベルとデータ持続性

グローバルに分散されるデータベース環境内では、リージョン全体にわたる停止が発生した場合の整合性レベルとデータ持続性の間には、直接的な関係があります。 ビジネス継続性計画を開発するときは、破壊的なイベントが発生してから、アプリケーションが完全に復旧するまでの最大許容時間について理解する必要があります。 アプリケーションを完全に復旧するために必要な時間は、**目標復旧時間** (**RTO**) と呼ばれます。 さらに、破壊的なイベントの発生後、復旧中にアプリケーションが損失を許容できる新しいデータ更新の最大期間についても理解する必要があります。 損失を許容できる更新の期間は、**目標復旧時点** (**RPO**) と呼ばれます。

次の表は、リージョン全体の停止が発生した場合の整合性モデルとデータ持続性の間の関係を定義しています。 分散型システムでは、強力な整合性を備えていても、CAP 定理のために、RPO と RTO が 0 の分散型データベースを持つことは不可能である点に注意することが重要です。 理由の詳細については、「[Azure Cosmos DB の整合性レベル](consistency-levels.md)」を参照してください。

|**リージョン**|**レプリケーション モード**|**整合性レベル**|**RPO**|**RTO**|
|---------|---------|---------|---------|---------|
|1|シングルマスターまたはマルチマスター|任意の整合性レベル|240 分未満|1 週間未満|
|>1|シングルマスター|セッション、一貫性のあるプレフィックス、最終的|15 分未満|15 分未満|
|>1|シングルマスター|Bounded Staleness|*K* & *T*|15 分未満|
|>1|シングルマスター|Strong|0|15 分未満|
|>1|マルチマスター|セッション、一貫性のあるプレフィックス、最終的|15 分未満|0|
|>1|マルチマスター|Bounded Staleness|*K* & *T*|0|

*K* = 項目の *"K"* バージョン (更新) 数。

*T* = 前回の更新以降の期間 *"T"* 。

## <a name="strong-consistency-and-multi-master"></a>厳密な整合性とマルチマスター

分散システムでゼロの RPO とゼロの RTO を実現することはできないため、マルチマスター用に構成された Cosmos アカウントには厳密な整合性を構成できません。 さらに、すべての領域へのすべての書き込みは、アカウント内のすべての構成済みリージョンにレプリケートおよびコミットされる必要があるため、厳密な整合性とマルチマスターを併用しても書き込み待機時間の恩恵は受けられません。 この結果、1 つのマスター アカウントと同じ書き込み待機時間が発生します。

## <a name="next-steps"></a>次のステップ

分散システムでのグローバル分散および一般的な整合性のトレードオフについて学習します。 次の記事をご覧ください。

- [最新の分散データベース システム設計における整合性のトレードオフ](https://www.computer.org/csdl/magazine/co/2012/02/mco2012020037/13rRUxjyX7k)
- [高可用性](high-availability.md)
- [Azure Cosmos DB SLA](https://azure.microsoft.com/support/legal/sla/cosmos-db/v1_2/)
