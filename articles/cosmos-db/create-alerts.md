---
title: Azure Monitor を使用して Azure Cosmos DB のアラートを作成する
description: Azure Monitor を使用して Azure Cosmos DB のアラートを設定する方法について説明します。
author: SnehaGunda
ms.author: sngun
ms.service: cosmos-db
ms.subservice: cosmosdb-sql
ms.devlang: dotnet
ms.topic: how-to
ms.date: 07/16/2020
ms.openlocfilehash: 84c2ad3a24d944db6a55f3f21e8a2a0c4084d033
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/23/2020
ms.locfileid: "87095588"
---
# <a name="create-alerts-for-azure-cosmos-db-using-azure-monitor"></a>Azure Monitor を使用して Azure Cosmos DB のアラートを作成する

アラートは、Azure Cosmos DB リソースの可用性と応答性を監視するための定期的なテストを設定するために使用されます。 アラートでは、いずれかのメトリックがしきい値に達したとき、またはアクティビティ ログに特定のイベントが記録されたときに、電子メールの形式で通知を送信したり、Azure 関数を実行したりすることができます。

メトリック、または Azure Cosmos アカウントのアクティビティ ログ イベントに基づいて、アラートを受け取ることができます。

* **メトリック** - このアラートは、指定したメトリックの値が、割り当てたしきい値を超えたときにトリガーされます。 たとえば、使用された要求ユニットの合計が 1000 RU/秒を超えた場合などです。 このアラートは条件を最初に満たしたときと、後でその条件を満たさなくなったときの両方でトリガーされます。 Azure Cosmos DB で使用できるさまざまなメトリックについては、[監視データのリファレンス](monitor-cosmos-db-reference.md#metrics)に関する記事を参照してください。

* **アクティビティ ログ イベント** – このアラートは、特定のイベントが発生したときにトリガーされます。 たとえば、Azure Cosmos アカウントのキーへのアクセスがあったとき、または更新されたときです。

アラートは、[Azure Cosmos DB] ペインまたは Azure portal の Azure Monitor サービスから設定できます。 両方のインターフェイスに同じオプションが用意されています。 この記事では、Azure Monitor を使用して Azure Cosmos DB のアラートを設定する方法について説明します。

## <a name="create-an-alert-rule"></a>アラート ルールを作成する

この項では、HTTP 状態コード 429 を受信したときのアラートを作成する方法について説明します。この状態コードは、要求がレート制限されている場合に受け取ります。 たとえば、レート制限された要求が 100 以上ある場合にアラートを受け取ることができます。 この記事では、HTTP 状態コードを使用して、このようなシナリオのアラートを構成する方法について説明します。 同様の手順を使用して、他の種類のアラートを構成することもできます。この場合は、要件に基づいて別の条件を選択する必要があるだけです。

1. [Azure portal](https://portal.azure.com/) にサインインします。

1. 左側のナビゲーション バーから **[監視]** を選択し、 **[アラート]** を選択します。

1. [新しいアラート ルール] ボタンを選択して [アラート ルールの作成] ペインを開きます。  

1. **[スコープ]** セクションの項目に入力します。

   * **[リソースの選択]** ペインを開き、次のように構成します。

   * **サブスクリプション**名を選択します。

   * **[リソースの種類]** に **[Azure Cosmos DB アカウント]** を選択します。

   * Azure Cosmos アカウントの **[場所]** 。

   * 詳細を入力すると、選択したスコープの Azure Cosmos アカウントの一覧が表示されます。 アラートを構成するアカウントを選択して、 **[完了]** を選択します。

1. **[条件]** セクションの項目に入力します。

   * **[条件の選択]** ペインを開いて、 **[シグナル ロジックの構成]** ページを開き、次のように構成します。

   * シグナルを選択します。 **[シグナルの種類]** には、 **[メトリック]** または **[アクティビティ ログ]** を指定できます。 このシナリオの対象となる **[メトリック]** を選択します。 要求ユニットの合計メトリックでレート制限の問題が発生したときにアラートを受け取るようにするためです。

   * **[モニター サービス]** に **[すべて]** を選択します

   * **[シグナル名]** を選択します。 HTTP 状態コードに関するアラートを取得するには、 **[要求ユニットの合計]** シグナルを選択します。

   * 次のタブでは、アラートをトリガーするロジックを定義し、グラフを使用して Azure Cosmos アカウントの傾向を表示することができます。 **[合計要求ユニット数]** メトリックではディメンションがサポートされます。 これらのディメンションを使用すると、メトリックに基づいてフィルター処理を行うことができます。 ディメンションを選択していない場合、この値は無視されます。

   * **[ディメンション名]**として**[StatusCode]** を選択します。 **[カスタム値を追加]** を選択し、状態コードを 429 に設定します。

   * **[アラート ロジック]** で、 **[しきい値]** を **[静的]** に設定します。 静的しきい値では、ユーザー定義のしきい値を使用してルールを評価します。一方、動的しきい値では、組み込みの機械学習アルゴリズムを使用して、メトリックの動作パターンを継続的に学習し、しきい値を自動的に計算します。

   * **[演算子]** に **[次の値より大きい]** 、 **[集計の種類]** に **[合計]** 、および **[しきい値]** に **[100]** を設定します。 このロジックでは、ステータス コード 429 の要求が 100 を超えてクライアントに表示された場合に、アラートがトリガーされます。 また、要件に基づいて、集計の種類、集計の粒度、および評価の頻度を構成することもできます。

   * フォームへの入力が終わったら、 **[完了]** を選択します。 次のスクリーンショットは、アラート ロジックの詳細を示しています。

     :::image type="content" source="./media/create-alerts/configure-alert-logic.png" alt-text="レート制限/429 の要求のアラートを受信するロジックの構成":::

1. **[アクション グループ]** セクションの項目に入力します。

   * **[ルールの作成]** ペインで、既存のアクション グループを選択するか、新しいグループを作成します。 アクション グループを使用して、アラート条件が発生したときに実行するアクションを定義できます。 この例では、新しいアクション グループを作成して、アラートがトリガーされたときに電子メール通知を受信するようにします。 **[アクション グループの追加]** ペインを開き、次の詳細を入力します。

   * **アクション グループ名** - アクション グループ名は、リソース グループ内で一意である必要があります。

   * **短い名前** - アクション グループの短い名前。この値は、通知の送信元であるアクション グループを識別するために、電子メールおよび SMS 通知に含められます。

   * このアクション グループを作成するサブスクリプションとリソース グループを選択します。  

   * アクションの名前を指定し、 **[アクションの種類]** として **[電子メール/SMS メッセージ/プッシュ/音声]** を選択します。 次のスクリーンショットは、アクションの種類の詳細を示しています。

     :::image type="content" source="./media/create-alerts/configure-alert-action-type.png" alt-text="アクションの種類の構成 (アラートを受信するための電子メール通知など)":::

1. **[アラート ルールの詳細]** セクションの項目に入力します。

   * ルールの名前を定義し、必要に応じて説明とアラートの重大度レベルを入力し、ルールの作成時にルールを有効にするかどうかを選択した後、 **[ルールのアラートの作成]** を選択してメトリック ルールのアラートを作成します。

アラートを作成すると、10 分以内にアクティブになります。

## <a name="common-alerting-scenarios"></a>一般的なアラートのシナリオ

アラートを使用できるいくつかのシナリオを次に示します。

* Azure Cosmos アカウントのキーが更新されたとき。
* コンテナー、データベース、またはリージョンのデータまたはインデックスの使用量が特定のバイト数を超えたとき。
* 正規化された RU/秒の消費量が特定の割合を超えたとき。 正規化された RU 消費量メトリックは、レプリカ セット内の最大スループット利用率を示します。 詳細については、[正規化された RU/秒を監視する方法](monitor-normalized-request-units.md)に関する記事を参照してください。  
* リージョンが追加、削除されたとき、またはオフラインになったとき。
* データベースまたはコンテナーが作成、削除、または更新されたとき。
* データベースまたはコンテナーのスループットが変化したとき。

## <a name="next-steps"></a>次のステップ

* Azure Cosmos コンテナーの[正規化された RU/秒メトリックを監視](monitor-normalized-request-units.md)する方法。
* Azure Cosmos DB で操作の[スループットまたは要求ユニットの使用状況を監視](monitor-request-unit-usage.md)する方法。