---
title: Azure Cosmos DB での合成パーティション キー
description: Azure Cosmos DB コンテナーで合成パーティション キーを使用する方法について説明します
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/30/2018
ms.author: mjbrown
ms.openlocfilehash: 37d220a13aec99de94afa3357db1462d11f8662c
ms.sourcegitcommit: 8330a262abaddaafd4acb04016b68486fba5835b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/04/2019
ms.locfileid: "54043370"
---
# <a name="create-a-synthetic-partition-key"></a>合成パーティション キーの作成

数百から数千というように、多数の個別の値を備えたパーティション キーにすることをお勧めします。 目標は、これらのパーティション キー値に関連付けられている項目の間でデータとワークロードを均等に分散することです。 このようなプロパティがデータに存在しない場合、合成パーティション キーを構築できます。 次のセクションでは、コンテナーの合成パーティション キーを生成するためのいくつかの基本的な手法について説明します。

## <a name="concatenating-multiple-properties-of-an-item"></a>項目の複数のプロパティの連結

複数のプロパティ値を結合して、単一の人工 `partitionKey` プロパティにすることで、1 つのパーティション キーを形成できます。 これらのキーは合成キーと呼ばれます。 たとえば、次のドキュメント例を考えてみましょう。

```JavaScript
{
"deviceId": "abc-123",
"date": 2018
}
```

前のドキュメントでは、1 つのオプションでは、デバイス ID または日付のいずれかに基づいてコンテナーのパーティションを作成する場合、/deviceId または /date をパーティション キーとして設定します。 もう 1 つのオプションでは、これら 2 つの値を合成 `partitionKey` プロパティに連結し、パーティション キーとして使用します。

```JavaScript
{
"deviceId": "abc-123",
"date": 2018,
"partitionKey": "abc-123-2018"
}
```

実際のシナリオでは、多数のドキュメントをデータベースに保持する可能性があるため、合成キーを手動で追加する代わりに、値を連結して合成キーをドキュメントに挿入するクライアント側のロジックを定義する必要があります。

## <a name="using-a-partition-key-with-random-suffix"></a>ランダムなサフィックスを持つパーティション キーの使用

ワークロードをより均等に分散する別の方法では、パーティション キー値の末尾にランダムな数値を追加します。 この方法で項目を配布すると、パーティション間で書き込み操作を並列に実行できます。

たとえば、パーティション キーが日付を表している場合は、1 から 400 までのランダムな数値を選択し、日付のサフィックスとしてそれを連結できます。 このメソッドでは、2018-08-09.1、2018-08-09.2 のようなパーティション キー値が 2018-08-09.400 まで続きます。 パーティション キーをランダム化しているため、それぞれの日のコンテナーに対する書き込み操作は、複数のパーティションに均等に分散されます。 このメソッドにより、並列処理が改善され、全体的なスループットは高くなります。

## <a name="using-a-partition-key-with-pre-calculated-suffixes"></a>事前に計算されたサフィックスを持つパーティション キーの使用 

ランダム化戦略では、書き込みのスループットを大幅に改善できますが、項目を作成するときに使用されるサフィックスの値がわからないために、特定の項目を読み取ることは困難です。 個々の項目を読みやすくには、事前に計算されたサフィックスの戦略を使用できます。 パーティション間に項目を配布するためにランダムな数値を使用する代わりに、クエリを実行することに基づいて計算する番号を使用します。

コンテナーでパーティション キーに日付を使用する、前の例を検討してください。 ここで、アクセス可能な VIN (車両識別番号) 属性が各項目にあり、クエリを多く実行して、日付に加えて VIN によって項目を検索するとします。 アプリケーションで項目をコンテナーに書き込む前に、VIN に基づいてハッシュ サフィックスを計算し、パーティション キーの日付に追加できます。 この計算では、ランダム戦略のメソッドで生成される結果と同じように、1 から 400 までの数値が生成されて、均等に分散される可能性があります。 パーティション キー値は、計算結果と連結された日付になります。

この戦略では、書き込みは、パーティション キー値およびパーティション全体に均等に分散されます。 特定の車両識別番号のパーティション キー値を計算できるため、特定の項目と日付を簡単に読み取ることができます。 この方法の利点は、1 つのホット パーティション キー (すべてのワークロードを取るパーティション キー) の作成を回避できることです。 

## <a name="next-steps"></a>次の手順

パーティション分割の概念の詳細については、次の記事を参照してください。

* [論理パーティション](partition-data.md)の詳細を確認する
* [Cosmos のコンテナーとデータベースのスループットのプロビジョニング](set-throughput.md)の詳細を学習する
* [Cosmos コンテナーのスループットをプロビジョニングする方法](how-to-provision-container-throughput.md)について学習する
* [Cosmos データベースのスループットをプロビジョニングする方法](how-to-provision-database-throughput.md)について学習する
