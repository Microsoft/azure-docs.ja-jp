---
title: IoT プラグ アンド プレイ プレビュー モデル検出を実装する | Microsoft Docs
description: ソリューション開発者として、IoT プラグ アンド プレイ モデル検出をソリューションに実装する方法について説明します。
author: ChrisGMsft
ms.author: chrisgre
ms.date: 07/17/2019
ms.topic: conceptual
ms.custom: mvc
ms.service: iot-pnp
services: iot-pnp
manager: philmea
ms.openlocfilehash: e4ab1d45e27762ef05ab7ec74c98ab0b0b934cbf
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/21/2019
ms.locfileid: "69879231"
---
# <a name="implement-iot-plug-and-play-preview-model-discovery-in-an-iot-solution"></a>IoT プラグ アンド プレイ プレビュー モデル検出を IoT ソリューションに実装する

この記事では、ソリューション開発者が IoT プラグ アンド プレイ プレビュー モデル検出を IoT ソリューションに実装する方法について説明します。  IoT プラグ アンド プレイ モデル検出は、IoT プラグ アンド プレイ デバイスがサポートされている機能モデルとインターフェイスを識別する方法と、IoT ソリューションがそれらの機能モデルとインターフェイスを取得する方法を示します。

IoT ソリューションは、大きく既知の一連の IoT プラグ アンド プレイ デバイスと連携する特設型ソリューションと、任意の IoT プラグ アンド プレイ デバイスで動作するモデル駆動型ソリューションの 2 つに分けられます。

この記事では、両方の種類のソリューションでモデル検出を実装する方法の考え方について説明します。

## <a name="model-discovery"></a>モデル検出

IoT プラグ アンド プレイ デバイスが最初に IoT ハブに接続すると、モデル情報のテレメトリ メッセージが送信されます。 このメッセージには、デバイスが実装するインターフェイスの ID が含まれます。 ソリューションがデバイスで機能するには、その ID を解決して、各インターフェイスの定義を取得する必要があります。

IoT プラグ アンド プレイ デバイスがデバイス プロビジョニング サービス (DPS) を使用してハブに接続するときに実行される手順を次に示します。

1. デバイスの電源をオンにすると、そのデバイスは DPS のグローバル エンドポイントに接続され、許可されたメソッドのいずれかを使用して認証されます。
1. 次に、DPS はデバイスを認証し、デバイスを割り当てる IoT ハブを示すルールを検索します。 その後、DPS はデバイスをそのハブに登録します。
1. DPS はデバイスに IoT ハブの接続文字列を返します。
1. 次に、デバイスは IoT ハブに検出テレメトリ メッセージを送信します。 検出テレメトリ メッセージには、デバイスが実装するインターフェイスの ID が含まれます。
1. IoT プラグ アンド プレイ デバイスは、IoT ハブを使用するソリューションで使用できるようになりました。

デバイスが IoT ハブに直接接続している場合は、デバイス コードに埋め込まれている接続文字列を使用して接続します。 次に、デバイスは IoT ハブに検出テレメトリ メッセージを送信します。

モデル情報のテレメトリ メッセージの詳細については、[ModelInformation](concepts-common-interfaces.md) インターフェイスを参照してください。

### <a name="purpose-built-iot-solutions"></a>特設型 IoT ソリューション

特設型 IoT ソリューションは、既知の一連の IoT プラグ アンド プレイ デバイス機能モデルおよびインターフェイスと連携して動作します。

ソリューションに事前に接続するデバイスの機能モデルとインターフェイスが用意されています。 次の手順を実行して、ソリューションを準備します。

1. ソリューションが読み取ることができる場所に、Azure のインターフェイス JSON ファイルを格納します。
1. 期待される IoT プラグ アンド プレイ機能モデルとインターフェイスに基づいて、IoT ソリューションにロジックを記述します。
1. ソリューションで使用される IoT ハブからの通知をサブスクライブします。

新しいデバイス接続の通知を受け取ったら、次の手順を実行します。

1. 検出テレメトリ メッセージを確認し、デバイスによって実装されている機能モデルとインターフェイスの ID を取得します。
1. 機能モデルの ID を、事前に保存した機能モデルの ID と比較します。
1. これで、接続されているデバイスの種類がわかります。 前に記述したロジックを使用して、ユーザーがデバイスと適切に対話できるようにします。

### <a name="model-driven-solutions"></a>モデル駆動型ソリューション

モデル駆動型 IoT ソリューションは、任意の IoT プラグ アンド プレイ デバイスで使用できます。 モデル駆動型 IoT ソリューションのビルドはより複雑ですが、今後追加されるすべてのデバイスでソリューションが動作するという利点があります。

モデル駆動型 IoT ソリューションをビルドするには、IoT プラグ アンド プレイ インターフェイス プリミティブ (テレメトリ、プロパティ、コマンド) に対してロジックを構築する必要があります。 IoT ソリューションのロジックは、複数のテレメトリ、プロパティ、コマンドの機能を組み合わせることによってデバイスを表します。

また、ソリューションで使用される IoT ハブからの通知をサブスクライブする必要があります。

ソリューションが新しいデバイス接続の通知を受け取ったら、次の手順を実行します。

1. 検出テレメトリ メッセージを確認し、デバイスによって実装されている機能モデルとインターフェイスの ID を取得します。
1. ID ごとに、デバイスの機能を検索するための完全な JSON ファイルを読み取ります。
1. ソリューションで以前に取得した JSON ファイルを格納するために作成したすべてのキャッシュに、各インターフェイスが存在していることを確認します。
1. 次に、その ID を持つインターフェイスがグローバル モデル リポジトリに存在していることを確認します。 詳細については、[グローバル モデル リポジトリ](howto-manage-models.md)に関するページを参照してください。
1. グローバル モデル リポジトリにインターフェイスが存在しない場合は、ソリューションで認識されているプライベート モデル リポジトリの中を検索してみてください。 プライベート モデル リポジトリにアクセスするには、接続文字列が必要です。 詳細については、[プライベート モデル リポジトリ](howto-manage-models.md)に関するページを参照してください。
1. グローバル モデル リポジトリまたはプライベート モデル リポジトリのどちらにもすべてのインターフェイスが見つからない場合は、デバイスがインターフェイス定義を提供できることを確認できます。 デバイスには、コマンドを使用してインターフェイス ファイルを取得する方法に関する情報を公開するために、標準の [ModelDefinition](concepts-common-interfaces.md) インターフェイスを実装できます。
1. デバイスによって実装された各インターフェイスの JSON ファイルが見つかった場合は、デバイスの機能を列挙できます。 前に記述したロジックを使用して、ユーザーがデバイスと対話できるようにします。
1. デジタル ツイン API はいつでも呼び出して、デバイスの機能モデル ID とインターフェイス ID を取得できます。

## <a name="next-steps"></a>次の手順

ここまでで IoT ソリューションのモデル検出について学びました。次は [Azure IoT プラットフォーム](overview-iot-plug-and-play.md)の詳細について学び、別の機能をソリューションに活用してみてください。
