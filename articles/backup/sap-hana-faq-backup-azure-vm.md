---
title: FAQ - Azure VM 上の SAP HANA データベースのバックアップ
description: この記事では、Azure Backup サービスを使用した SAP HANA データベースのバックアップに関する一般的な質問への回答を示します。
ms.topic: conceptual
ms.date: 11/7/2019
ms.openlocfilehash: bf662600bafcd18b00c8f8d3b673fc3f9c110aca
ms.sourcegitcommit: 1d366d72357db47feaea20c54004dc4467391364
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/23/2020
ms.locfileid: "95400209"
---
# <a name="frequently-asked-questions--back-up-sap-hana-databases-on-azure-vms"></a>よく寄せられる質問 - Azure VM 上の SAP HANA データベースをバックアップする

この記事では、Azure Backup サービスを使用した SAP HANA データベースのバックアップに関する一般的な質問への回答を示します。

## <a name="backup"></a>バックアップ

### <a name="how-many-full-backups-are-supported-per-day"></a>1 日あたり何回の完全バックアップがサポートされていますか?

サポートされている完全バックアップは 1 日 1 回のみです。 同じ日に差分バックアップと完全バックアップをトリガーすることはできません。

### <a name="do-successful-backup-jobs-create-alerts"></a>成功したバックアップ ジョブでアラートが作成されますか?

いいえ。 成功したバックアップ ジョブではアラートは生成されません。 アラートは、失敗したバックアップ ジョブに対してのみ送信されます。 ポータル アラートの詳細な動作は[ここ](./backup-azure-monitoring-built-in-monitor.md)に記載されています。 ただし、成功したジョブに対してもアラートを生成することに関心がある場合は、[Azure Monitor](./backup-azure-monitoring-use-azuremonitor.md) を使用できます。

### <a name="can-i-see-scheduled-backup-jobs-in-the-backup-jobs-menu"></a>スケジュールされたバックアップ ジョブを [バックアップ ジョブ] メニューで確認できますか?

[バックアップ ジョブ] メニューには、オンデマンドのバックアップ ジョブのみが表示されます。 スケジュールされたジョブの場合は、[Azure Monitor](./backup-azure-monitoring-use-azuremonitor.md) を使用します。

### <a name="are-future-databases-automatically-added-for-backup"></a>今後作成されるデータベースはバックアップに自動的に追加されますか?

いいえ。これは現在サポートされていません。

### <a name="if-i-delete-a-database-from-an-instance-what-will-happen-to-the-backups"></a>インスタンスからデータベースを削除した場合、バックアップはどうなりますか?

SAP HANA インスタンスからデータベースが削除された場合でも、データベース バックアップは引き続き試行されます。 これは、削除されたデータベースが **[バックアップ項目]** に異常として表示され始め、引き続き保護されていることを示しています。
このデータベースの保護を停止するための正しい方法は、このデータベースに対して "**バックアップを停止してデータを削除する**" を実行することです。

### <a name="if-i-change-the-name-of-the-database-after-it-has-been-protected-what-will-the-behavior-be"></a>データベースが保護された後にその名前を変更した場合、その動作はどうなりますか?

名前が変更されたデータベースは、新しいデータベースとして処理されます。 このため、サービスにより、この状況は、データベースが見つからず、バックアップが失敗した場合と同様に処理されます。 名前が変更されたデータベースは新しいデータベースとして表示されるため、保護するように構成する必要があります。

### <a name="what-are-the-prerequisites-to-back-up-sap-hana-databases-on-an-azure-vm"></a>Azure VM 上の SAP HANA データベースをバックアップするための前提条件は何ですか?

「[前提条件](tutorial-backup-sap-hana-db.md#prerequisites)」セクションと[事前登録スクリプトの内容](tutorial-backup-sap-hana-db.md#what-the-pre-registration-script-does)に関するセクションを参照してください。

### <a name="what-permissions-should-be-set-so-azure-can-back-up-sap-hana-databases"></a>Azure で SAP HANA データベースをバックアップできるようにするには、どのようなアクセス許可を設定する必要がありますか?

事前登録スクリプトを実行すると、Azure で SAP HANA データベースをバックアップできるようにするために必要なアクセス許可が設定されます。 事前登録スクリプトで実行される処理の詳細については、[こちら](tutorial-backup-sap-hana-db.md#what-the-pre-registration-script-does)をご覧ください。

### <a name="will-backups-work-after-migrating-sap-hana-from-sdc-to-mdc"></a>SAP HANA を SDC から MDC に移行した後、バックアップは機能しますか?

トラブルシューティング ガイドの[こちらのセクション](./backup-azure-sap-hana-database-troubleshoot.md#sdc-to-mdc-upgrade-with-a-change-in-sid)をご覧ください。

### <a name="what-should-be-done-while-upgrading-within-the-same-version"></a>同じバージョン内でアップグレードする場合はどうすればよいですか?

トラブルシューティング ガイドの[こちらのセクション](backup-azure-sap-hana-database-troubleshoot.md#sdc-version-upgrade-or-mdc-version-upgrade-on-the-same-vm)を参照してください。

### <a name="can-azure-hana-backup-be-set-up-against-a-virtual-ip-load-balancer-and-not-a-virtual-machine"></a>仮想マシンではなく、仮想 IP (ロード バランサー) に対して Azure HANA バックアップを設定できますか?

現時点では、仮想 IP のみに対してソリューションを設定することはできません。 ソリューションを実行するには、仮想マシンが必要です。

### <a name="how-can-i-move-an-on-demand-backup-to-the-local-file-system-instead-of-the-azure-vault"></a>オンデマンド バックアップを Azure コンテナーではなくローカル ファイル システムに移動する方法はありますか?

1. 目的のデータベースで現在実行中のバックアップが完了するまで待ちます (完了は Studio で確認します)。
1. 次の手順を使用して、目的の DB のログ バックアップを無効にし、カタログ バックアップを **[Filesystem]\(ファイルシステム\)** に設定します。
1. **[SYSTEMDB]**  ->  **[構成]**  ->  **[データベースの選択]**  ->  **[Filter (log)]\(フィルター (ログ)\)** の順にダブルクリックします
    1. [enable_auto_log_backup] を **[no]** に設定します。
    1. [catalog_backup_using_backint] を **[false]** に設定します。
1. 目的のデータベースでオンデマンド バックアップ (完全/差分/増分) を実行し、バックアップとカタログ バックアップが完了するまで待ちます。
1. ログ バックアップもファイルシステムに移動する場合は、[enable_auto_log_backup] を **[yes]** に設定します。
1. 以前の設定に戻して、バックアップが Azure コンテナーにフローできるようにします。
    1. [enable_auto_log_backup] を **[yes]** に設定します。
    1. [catalog_backup_using_backint] を **[true]** に設定します。

>[!NOTE]
>バックアップをローカル ファイルシステムに移動し、再度 Azure コンテナーに切り替えると、コンテナー内のログ バックアップでログ チェーンが切断される場合があります。 これにより完全バックアップがトリガーされます。正常に完了すると、ログのバックアップが開始されます。

### <a name="how-can-i-use-sap-hana-backup-with-my-hana-replication-set-up"></a>HANA レプリケーションの設定で SAP HANA バックアップを使用するにはどうすればよいですか?

現時点では、Azure Backup は HSR の設定を理解する機能を備えていません。 つまり、HSR のプライマリおよびセカンダリのノードは、関連のない 2 つの個別の VM として扱われます。 最初に、プライマリ ノードでバックアップを構成する必要があります。 フェールオーバーが発生した場合は、セカンダリ ノード (こちらがプライマリ ノードになります) でバックアップを構成する必要があります。 他のノードに対するバックアップの自動フェールオーバーはありません。

任意の時点のアクティブ (プライマリ) ノードからデータをバックアップするには、フェールオーバー後にプライマリになったセカンダリ ノードに **保護を切り替える** ことができます。

この **保護の切り替え** を実行するには、次の手順に従います。

- プライマリで (データを保持して) [保護を停止](sap-hana-db-manage.md#stop-protection-for-an-sap-hana-database)します
- セカンダリ ノードで[事前登録スクリプト](https://aka.ms/scriptforpermsonhana)を実行します
- セカンダリ ノードで[データベースを検出](tutorial-backup-sap-hana-db.md#discover-the-databases)し、それらに[バックアップを構成](tutorial-backup-sap-hana-db.md#configure-backup)します

これらの手順は、フェールオーバーが終了するたびに手動で実行する必要があります。 これらの手順は、Azure portal に加えて、コマンド ライン/HTTP REST を使用して実行できます。 これらの手順を自動化するには、Azure Runbook を使用します。

**保護の切り替え** を実行する方法の詳細な例を次に示します。

この例では、HSR セットアップにノード 1 (プライマリ) とノード 2 (セカンダリ) の 2 つのノードがあります。  バックアップはノード 1 で構成されています。 前述のように、まだノード 2 でバックアップを構成しないようにしてください。

最初のフェールオーバーが発生すると、ノード 2 がプライマリになります。 このとき、次のようになります。

1. [データの保持] オプションを使用して、ノード 1 (前のプライマリ) の保護を停止します。
1. ノード 2 (現在のプライマリ) で事前登録スクリプトを実行します。
1. ノード 2 のデータベースを検出し、バックアップ ポリシーを割り当て、バックアップを構成します。

その後、ノード 2 で最初の完全バックアップがトリガーされ、その完了後にログ バックアップが開始されます。

次のフェールオーバーが発生すると、ノード 1 が再びプライマリになり、ノード 2 がセカンダリになります。 ここで、手順を繰り返します。

1. [データの保持] オプションを使用して、ノード 2 の保護を停止します。
1. ノード 1 (再びプライマリになっています) で事前登録スクリプトを実行します。
1. 次に、必要なポリシーを使用してノード 1 で[バックアップを再開](sap-hana-db-manage.md#resume-protection-for-an-sap-hana-database)します (前にノード 1 でバックアップが停止されているため)。

その後、ノード 1 で完全バックアップが再度トリガーされ、その完了後にログ バックアップが開始されます。

## <a name="restore"></a>復元

### <a name="why-cant-i-see-the-hana-system-i-want-my-database-to-be-restored-to"></a>データベースの復元先の HANA システムが表示されないのはなぜですか?

ターゲットの SAP HANA インスタンスに復元するためのすべての前提条件が満たされているかどうかを確認してください。 詳しくは、[Azure VM の SAP HANA データベースの復元の前提条件](./sap-hana-db-restore.md#prerequisites)に関する記事をご覧ください。

### <a name="why-is-the-overwrite-db-restore-failing-for-my-database"></a>データベースで DB の上書き復元が失敗するのはなぜですか?

復元の間に **[強制的に上書きします]** オプションが選択されていることを確認します。

### <a name="why-do-i-see-the-source-and-target-systems-for-restore-are-incompatible-error"></a>"復元のソース システムとターゲット システムには互換性がありません" というエラーが表示されるのはなぜですか?

SAP HANA ノート [1642148](https://launchpad.support.sap.com/#/notes/1642148) を参照し、現在サポートされている復元の種類を確認してください。

### <a name="can-i-use-a-backup-of-a-database-running-on-sles-to-restore-to-an-rhel-hana-system-or-vice-versa"></a>SLES で実行されているデータベースのバックアップを使用して RHEL HANA システムを復元できますか? また、その逆は可能ですか?

はい。SLES で実行されている HANA データベースでトリガーされたストリーミング バックアップを使用して、RHEL HANA システムに復元できます。また、その逆も可能です。 つまり、ストリーミング バックアップを使用すると、OS を跨いだ復元が可能になります。 ただし、復元先の HANA システムと復元に使用する HANA システムの両方が、SAP による復元に互換性があることを確認する必要があります。 互換性のある復元の種類については、SAP HANA メモ [1642148](https://launchpad.support.sap.com/#/notes/1642148) を参照してください。

## <a name="policy"></a>ポリシー

### <a name="different-options-available-during-creation-of-a-new-policy-for-sap-hana-backup"></a>SAP HANA バックアップの新しいポリシーを作成するときに使用できるさまざまなオプション

ポリシーを作成する前に、RPO および RTO の要件とその関連コストへの影響について明確にする必要があります。

RPO (目標復旧時点) は、ユーザーまたは顧客が許容できるデータ損失量を示します。 これは、ログ バックアップの頻度によって決まります。 ログ バックアップの頻度が高いほど RPO は短くなります。Azure Backup サービスでサポートされる最小値は 15 分です。 このため、ログ バックアップの頻度は、15 分以上にすることができます。

RTO (目標復旧時間) は、データ損失シナリオの後、最後の使用可能な時点にデータを復元する速度を示します。 これは、HANA によって採用される回復戦略によって異なり、通常は、復元に必要なファイルの数によって異なります。 これはコストにも影響します。次の表は、すべてのシナリオとその影響を理解するのに役立ちます。

|バックアップ ポリシー  |RTO  |コスト  |
|---------|---------|---------|
|毎日の完全 + ログ     |   ポイントインタイム リストアに必要なのは、1 つの完全なコピーとログのみであるため、最も速い      |    完全なコピーが毎日作成され、保持期間が経過するまでバックエンドに蓄積されるデータが増えるため、最もコストがかかるオプション   |
|毎週の完全 + 毎日の差分 + ログ     |   上記のオプションよりも低速ですが、ポイントインタイム リストアには、1 つの完全なコピー、1 つの差分コピー、ログが必要であるため、次のオプションよりは高速      |    通常、毎日の差分は完全よりも小さく、完全なコピーは週に 1 回だけ作成されるため、より安価なオプション      |
|毎週の完全 + 毎日の増分 + ログ     |  ポイントインタイム リストアのために 1 つの完全なコピー、'n' 個の増分、ログが必要なため、最も遅い       |     毎日の増分は差分よりも小さく、完全なコピーが作成されるのは週 1 回のみであるため、最も安価なオプション    |

> [!NOTE]
> 上記のオプションは最も一般的ですが、この限りではありません。 たとえば、毎週の完全バックアップ、週 2 回の差分、ログを使用することもできます。

このため、RPO と RTO の目標とコストに関する考慮事項に基づいてポリシーのバリエーションを選択できます。

### <a name="impact-of-modifying-a-policy"></a>ポリシー変更の影響

バックアップ項目のポリシーをポリシー 1 (P1) からポリシー 2 (P2) に切り替えるか、またはポリシー 1 (P1) を編集することによる影響を判断する場合、いくつかの原則に留意する必要があります。

- すべての変更はさかのぼっても適用されます。 最新のバックアップ ポリシーは、以前に作成した復旧ポイントにも適用されます。 たとえば、現在アクティブなポリシーに従って、毎日の完全なコピーの保持期間が 30 日で、10 個の復旧ポイントが作成されたとします。 毎日の完全コピーの保持期間を 10 日に変更した場合、以前のポイントの有効期限も、開始時間 + 10 日として再計算され、有効期限が切れている場合は削除されます。
- 変更の範囲には、保持期間だけでなく、バックアップの日、バックアップの種類も含まれます。 次に例を示します。ポリシーを毎日の完全から毎週日曜日の完全に変更した場合、日曜日以外の以前の完全コピーはすべて削除対象としてマークされます。
- 子が非アクティブまたは期限切れになるまで、親は削除されません。 すべてのバックアップの種類には、現在アクティブなポリシーに従って有効期限があります。 しかし、完全バックアップの種類は、それ以降の '差分'、'増分'、'ログ' の親と見なされます。 '差分' と 'ログ' は、他のどのバックアップの親でもありません。 '増分' は、それ以降の '増分' の親になることができます。 '親' が削除対象としてマークされても、子の '差分' または 'ログ' の有効期限が切れていなければ、実際には削除されません。 たとえば、ポリシーを毎日の完全から毎週日曜日の完全に変更した場合、日曜日以外の以前の完全なコピーはすべて削除対象としてマークされます。 しかし、それらは、以前に毎日作成されたログが期限切れになるまで実際には削除されません。 つまり、最新のログ期間に従って保持されます。 ログの有効期限が切れると、ログとこれらの完全なコピーの両方が削除されます。

これらの原則に留意して次の表を読むと、ポリシー変更の影響を理解することができます。

|古いポリシー/新しいポリシー  |毎日の完全 + ログ  | 毎週の完全 + 毎日の差分 + ログ  |毎週の完全 + 毎日の増分 + ログ  |
|---------|---------|---------|---------|
|毎日の完全 + ログ     |   -      |    同じ曜日以外の以前の完全コピーは削除対象としてマークされますが、ログの保持期間が経過するまで保持されます     |    同じ曜日以外の以前の完全コピーは削除対象としてマークされますが、ログの保持期間が経過するまで保持されます     |
|毎週の完全 + 毎日の差分 + ログ     |   以前が作成された毎週の完全コピーの保持期間は、最新のポリシーに従って再計算されます。 以前の差分は即座に削除されます      |    -     |    以前の差分は即座に削除されます     |
|毎週の完全 + 毎日の増分 + ログ     |     以前が作成された毎週の完全コピーの保持期間は、最新のポリシーに従って再計算されます。 以前の増分は即座に削除されます    |     以前の増分は即座に削除されます    |    -     |

## <a name="next-steps"></a>次のステップ

Azure VM で実行されている [SAP HANA データベースをバックアップする](./backup-azure-sap-hana-database.md)方法を学習します。
