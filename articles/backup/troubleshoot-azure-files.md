---
title: Azure ファイル共有のバックアップに関するトラブルシューティング
description: この記事は、Azure ファイル共有を保護する際に発生する問題に関するトラブルシューティング情報です。
services: backup
ms.service: backup
author: rayne-wiselman
ms.author: raynew
ms.date: 10/23/2018
ms.topic: tutorial
manager: carmonm
ms.openlocfilehash: 4806ca77bda1d380d3c5f1d958a335bceddc7f16
ms.sourcegitcommit: 295babdcfe86b7a3074fd5b65350c8c11a49f2f1
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/27/2018
ms.locfileid: "53787445"
---
# <a name="troubleshoot-problems-backing-up-azure-file-shares"></a>Azure ファイル共有のバックアップに関する問題のトラブルシューティング
次の表に示す情報を使って、Azure ファイル共有のバックアップを使用中に発生した問題やエラーのトラブルシューティングを行うことができます。

## <a name="limitations-for-azure-file-share-backup-during-preview"></a>プレビュー期間における Azure ファイル共有のバックアップの制限
Azure ファイル共有のバックアップはプレビュー段階です。 汎用 v1 ストレージ アカウントと汎用 v2 ストレージ アカウント、どちらの Azure ファイル共有もサポートされています。 次のバックアップ シナリオは、Azure ファイル共有ではサポートされていません。
- [読み取りアクセス geo 冗長ストレージ](../storage/common/storage-redundancy-grs.md) (RA-GRS) レプリケーションを使用してストレージ アカウントの Azure ファイル共有を保護することはできません。*
- 仮想ネットワークまたはファイアウォールが有効になっているストレージ アカウントの Azure ファイル共有を保護することはできません。
- Azure Backup を使用して Azure Files を保護するために利用できる CLI はありません。
- スケジュール バックアップの数は、1 日につき 1 個が上限となります。
- オンデマンド バックアップの数は、1 日につき 4 個が上限となります。
- ストレージ アカウントに対する[リソース ロック](https://docs.microsoft.com/cli/azure/resource/lock?view=azure-cli-latest)を使用して、Recovery Services コンテナー内のバックアップを誤って削除しないようにします。
- Azure Backup によって作成されたスナップショットを削除しないでください。 スナップショットを削除すると、復旧ポイントが失われたり、復元が失敗したりする場合があります。
- Azure Backup で保護されているファイル共有は削除しないでください。 現在のソリューションでは、ファイル共有が削除されると Azure Backup によって取得されたスナップショットがすべて削除されます。そのため、すべての復元ポイントが失われます。

\*[読み取りアクセス geo 冗長ストレージ](../storage/common/storage-redundancy-grs.md) (RA-GRS) レプリケーション機能を GRS として使用し、GRS の価格で課金される、ストレージ アカウントの Azure ファイル共有。

[ゾーン冗長ストレージ](../storage/common/storage-redundancy-zrs.md) (ZRS) レプリケーションを使用するストレージ アカウントでの Azure ファイル共有のバックアップは、現在、米国中部 (CUS)、米国東部 (EUS)、米国東部 2 (EUS2)、北ヨーロッパ (NE)、東南アジア (SEA)、西ヨーロッパ (WE)、米国西部 2 (WUS2) でのみ使用できます。

## <a name="configuring-backup"></a>バックアップの構成
次の表は、バックアップの構成に関連しています。

| バックアップの構成 | 回避策または解決策のヒント |
| ------------------ | ----------------------------- |
| Azure ファイル共有のバックアップを構成するストレージ アカウントが見つかりませんでした | <ul><li>検出が完了するまで待ってください。 <li>ストレージ アカウントのファイル共有が既に別の Recovery Services コンテナーによって保護されているかどうかを確認してください。 **メモ**:ストレージ アカウントのすべてのファイル共有は、1 つの Recovery Services コンテナーのみで保護できます。 <li>ファイル共有がサポートされていないストレージ アカウントのいずれにも存在しないようにしてください。|
| ポータルのエラーが、ストレージ アカウントの検出に失敗したことを示しています。 | サブスクリプションがパートナー (CSP 対応) の場合は、このエラーを無視してください。 サブスクリプションが CSP 対応でなく、ストレージ アカウントを検出できない場合は、サポートにお問い合わせください。|
| 選択したストレージ アカウントの検証または登録に失敗しました。| 操作を再試行してください。問題が解決しない場合は、サポートにお問い合わせください。|
| 選択したストレージ アカウントでファイル共有を一覧表示または検索できませんでした。 | <ul><li> ストレージ アカウントがリソース グループに存在する (さらに、コンテナーで最後に検証/登録した後に削除または移動されていない) ことを確認してください。<li>保護しようとしているファイル共有が削除されていないことを確認してください。 <li>ストレージ アカウントが、ファイル共有のバックアップ用にサポートされているストレージ アカウントであることを確認してください。<li>ファイル共有が既に同じ Recovery Services コンテナー内で保護されているかどうかを確認してください。|
| ファイル共有のバックアップの構成 (または保護ポリシーの構成) が失敗しています。 | <ul><li>操作を再試行して、問題が解決していないかどうかを確認してください。 <li> 保護したいファイル共有が削除されていないことを確認してください。 <li> 複数のファイル共有を一度に保護しようとしていて、ファイル共有の一部が失敗している場合は、失敗したファイル共有のバックアップを再度構成してみてください。 |
| ファイル共有の保護を解除した後に Recovery Services コンテナーを削除できません。 | Azure portal で、お使いのコンテナー > **[バックアップ インフラストラクチャ]** > **[ストレージ アカウント]** の順に開き、**[登録解除]** をクリックして、Recovery Services コンテナーからストレージ アカウントを削除してください。|


## <a name="error-messages-for-backup-or-restore-job-failures"></a>バックアップ ジョブまたは復元ジョブの失敗に関するエラー メッセージ

| エラー メッセージ | 回避策または解決策のヒント |
| -------------- | ----------------------------- |
| ファイル共有が見つからないため、操作が失敗しました。 | 保護しようとしているファイル共有が削除されていないことを確認してください。|
| ストレージ アカウントが見つからないか、サポートされていません。 | <ul><li>ストレージ アカウントがリソース グループに存在し、最後の検証後にリソース グループから削除または除外されていないことを確認してください。 <li> ストレージ アカウントが、ファイル共有のバックアップ用にサポートされているストレージ アカウントであることを確認してください。|
| このファイル共有のスナップショットの上限に達しました。以前のものの有効期限が切れると、スナップショットを実行できるようになります。 | <ul><li> このエラーは、1 つのファイルに対してオンデマンド バックアップを複数作成したときに発生する場合があります。 <li> スナップショットには、ファイル共有につき 200 個という上限があります (これには、Azure Backup によって作成されたものも含まれます)。 スケジュールされた古いバックアップ (またはスナップショット) は自動的にクリーンアップされます。 上限に達した場合は、オンデマンド バックアップ (またはスナップショット) を削除する必要があります。<li> Azure Files ポータルからオンデマンド バックアップ (Azure ファイル共有スナップショット) を削除してください。 **メモ**:Azure Backup によって作成されたスナップショットを削除すると、復旧ポイントが失われます。 |
| File share backup or restore failed due to storage service throttling. This may be because the storage service is busy processing other requests for the given storage account. (ストレージ サービスの調整のため、ファイル共有のバックアップまたは復元に失敗しました。その理由として考えられるのは、ストレージ サービスが特定のストレージ アカウントの他の要求が処理中であることです。)| しばらくしてから操作を再試行してください。 |
| Restore failed with Target File Share Not Found. (復元に失敗しました。ターゲット ファイル共有が見つかりません。) | <ul><li>選択したストレージ アカウントが存在し、ターゲット ファイル共有が削除されていないことを確認してください。 <li> ストレージ アカウントが、ファイル共有のバックアップ用にサポートされているストレージ アカウントであることを確認してください。 |
| Azure Backup は、"仮想ネットワーク" が有効になっているストレージ アカウント内の Azure ファイル共有では現在サポートされていません。 | ストレージ アカウントで仮想ネットワークを無効にして、バックアップ操作または復元操作が成功することを確認してください。 |
| Backup or Restore jobs failed due to storage account being in Locked state.(ストレージ アカウントがロック状態のため、バックアップ ジョブまたは復元ジョブに失敗しました。) | ストレージ アカウントのロックを解除するか、読み取りロックではなく削除ロックを使用し、操作を再試行してください。 |
| 失敗したファイルの数がしきい値を超えているため、回復が失敗しました。 | <ul><li> 回復が失敗した理由はファイル (ジョブの詳細で指定されたパス) に示されています。 エラーを解決し、失敗したファイルに対してのみ復元操作を再試行してください。 <li> ファイル復元が失敗した一般的な理由: <br/> - 失敗したファイルが現在使用されていないことを確認します。 <br/> - 失敗したファイルと同じ名前のディレクトリが親ディレクトリに存在します。 |
| 回復は失敗し、ファイルを回復できませんでした。 | <ul><li> 回復が失敗した理由はファイル (ジョブの詳細で指定されたパス) に示されています。 エラーを解決し、失敗したファイルに対してのみ復元操作を再試行してください。 <li> ファイル復元が失敗した一般的な理由: <br/> - 失敗したファイルが現在使用されていないことを確認します。 <br/> - 失敗したファイルと同じ名前のディレクトリが親ディレクトリに存在します。 |
| Restore fails because one of the files in the source does not exist. (ソース内のファイルの 1 つが存在しないため、復元に失敗します。) | <ul><li> 選択した項目は復旧ポイントのデータに存在しません。 ファイルを復旧するには、正しいファイル リストを指定してください。 <li> 復旧ポイントに対応するファイル共有スナップショットは手動で削除されます。 別の復旧ポイントを選択し、復元操作を再試行してください。 |
| 同じ宛先への回復ジョブが処理中です。 | <ul><li>ファイル共有のバックアップでは、同じターゲット ファイル共有への並列復旧がサポートされていません。 <li>既存の回復が完了するのを待ってから、もう一度試してください。 Recovery Services コンテナーに回復ジョブが見つからない場合は、同じサブスクリプション内の他の Recovery Services コンテナーを確認してください。 |
| ターゲット ファイルの共有がいっぱいのため、復元操作に失敗しました。 | 復元データに対応できるようにターゲット ファイル共有のサイズ クォータを引き上げ、操作を再試行してください。 |
| Restore operation failed as an error occurred while performing pre restore operations on File Sync Service resources associated with the target file share. (ターゲット ファイル共有に関連付けられている File Sync Service リソースで復元前の操作を実行しているときにエラーが発生したため復元操作に失敗しました。) | しばらくしてからやり直してください。問題が解消されない場合は、Microsoft サポートにお問い合わせください。 |
| いくつかのファイルを正常に回復できませんでした。 詳しくは、上記のパスにある失敗したファイルの一覧を確認してください。 | <ul> <li> 回復に失敗した理由はファイル (ジョブの詳細で指定されたパス) に示されるため、その理由を解決し、失敗したファイルに対してのみ復元操作を再試行してください。 <li> ファイル復元が失敗する一般的な理由は次のとおりです。 <br/> - 失敗したファイルが現在使用されていないことを確認します。 <br/> - 失敗したファイルと同じ名前のディレクトリが親ディレクトリに存在します。 |

## <a name="see-also"></a>関連項目
Azure ファイル共有のバックアップの詳細については、以下を参照してください。
- [Azure ファイル共有のバックアップ](backup-azure-files.md)
- [Azure ファイル共有のバックアップに関する FAQ](backup-azure-files-faq.md)
