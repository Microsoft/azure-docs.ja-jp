---
title: Azure マネージド ディスクのバックアップ
description: Azure portal から Azure マネージド ディスクをバックアップする方法について学習します。
ms.topic: conceptual
ms.date: 01/07/2021
ms.openlocfilehash: ca86550c4dec4b51c60d9ecdef124e38783a3764
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/19/2021
ms.locfileid: "98738154"
---
# <a name="back-up-azure-managed-disks-in-preview"></a>Azure マネージド ディスクのバックアップ (プレビュー段階)

>[!IMPORTANT]
>Azure ディスク バックアップは、サービス レベル アグリーメントのないプレビュー段階であるため、運用ワークロードにはお勧めできません。 詳しくは、[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)に関するページをご覧ください。 利用可能なリージョンについては、[サポート マトリックス](disk-backup-support-matrix.md)に関するページをご覧ください。
>
>プレビューにサインアップするには、[このフォームに記入](https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR1vE8L51DIpDmziRt_893LVUNFlEWFJBN09PTDhEMjVHS05UWFkxUlUzUS4u)してください。

この記事では、Azure portal から [Azure マネージド ディスク](../virtual-machines/managed-disks-overview.md)をバックアップする方法について説明します。

この記事では、次の方法について学習します。

- バックアップ コンテナーの作成

- バックアップ ポリシーの作成

- Azure ディスクのバックアップを構成する

- オンデマンド バックアップ ジョブを実行する

Azure ディスク バックアップの使用可能なリージョン、サポートされるシナリオ、制限事項については、[サポート マトリックス](disk-backup-support-matrix.md)に関するページをご覧ください。

## <a name="create-a-backup-vault"></a>バックアップ コンテナーの作成

バックアップ コンテナーは、Azure Database for PostgreSQL サーバーや Azure ディスクなど、Azure Backup によってサポートされるさまざまな新しいワークロードのバックアップ データを格納する Azure のストレージ エンティティです。 バックアップ コンテナーを使用すると、管理オーバーヘッドを最小限に抑えながら、バックアップ データを簡単に整理できます。 バックアップ コンテナーは、Azure の Azure Resource Manager モデルに基づいており、強化されたバックアップ データの保護機能を提供します。

1. Azure Portal [https://portal.azure.com](https://portal.azure.com/) にサインインします。
1. 検索ボックスに「**バックアップ センター**」と入力します。
1. **[サービス]** で **[バックアップ センター]** を選択します。
1. **[バックアップ センター]** ページで、 **[コンテナー]** を選択します。

   ![バックアップ センターで [コンテナー] を選択する](./media/backup-managed-disks/backup-center.png)

1. **[開始: コンテナーの作成]** 画面で、 **[バックアップ コンテナー]** 、 **[続行]** の順に選択します。

   ![開始:コンテナーの作成](./media/backup-managed-disks/initiate-create-vault.png)

1. **[基本]** タブで、サブスクリプション、リソース グループ、バックアップ コンテナー名、リージョン、バックアップ ストレージの冗長性を設定します。 **[確認と作成]** を選択して続行します。 詳細については、「[バックアップ コンテナーの作成](./backup-vault-overview.md#create-a-backup-vault)」を参照してください。

   ![コンテナーを確認して作成する](./media/backup-managed-disks/review-and-create.png)

## <a name="create-backup-policy"></a>バックアップ ポリシーを作成する

1. 前の手順で作成した *DemoVault* **バックアップ コンテナー** で、 **[バックアップ ポリシー]** に移動して **[追加]** を選択します。

   ![バックアップ ポリシーを追加する](./media/backup-managed-disks/backup-policies.png)

1. **[基本]** タブで、ポリシー名を入力し、 **[データ ソースの種類]** として **[Azure ディスク]** を選択します。 コンテナーは事前に設定されており、選択したコンテナーのプロパティが表示されます。

   >[!NOTE]
   > 選択したコンテナーにグローバル冗長の設定が含まれる場合がありますが、Azure ディスク バックアップでは現在スナップショット データストアのみがサポートされています。 すべてのバックアップがサブスクリプションのリソース グループに格納され、バックアップ コンテナーのストレージにはコピーされません。

   ![データ ソースの種類を選択する](./media/backup-managed-disks/datasource-type.png)

1. **[バックアップ ポリシー]** タブで、バックアップ スケジュールの頻度を選択します。

   ![バックアップ スケジュールの頻度を選択する](./media/backup-managed-disks/backup-schedule-frequency.png)

   Azure ディスク バックアップでは、1 日に複数のバックアップを作成できます。 頻繁にバックアップを行う必要がある場合は、4、6、8、または 12 時間の間隔でバックアップを作成できる **[時間単位]** のバックアップ頻度を選択します。 **[時間]** で選択した間隔に基づいてバックアップがスケジュールされます。 たとえば、 **[4 時間ごと]** を選択した場合、ほぼ 4 時間ごとにバックアップが作成されるので、バックアップが 1 日のうちで均等に分散されます。 1 日 1 回のバックアップで十分な場合は、 **[日単位]** のバックアップ頻度を選択します。 日単位のバックアップ頻度では、バックアップを作成する時刻を指定できます。 この時刻は、バックアップが完了する時刻ではなく、バックアップの開始時刻を示していることに注意してください。 バックアップ操作を完了するために必要な時間は、ディスクのサイズや連続するバックアップ間のチャーン率など、さまざまな要因によって異なります。 ただし、Azure ディスク バックアップは[増分スナップショット](../virtual-machines/disks-incremental-snapshots.md)を使用するエージェントレス バックアップであり、実稼働アプリのパフォーマンスには影響しません。

1. **[バックアップ ポリシー]** タブで、目標復旧時点 (RPO) の要件を満たすリテンション期間の設定を選択します。

   他の保持規則が存在しない場合は、既定の保持規則が適用されます。 既定の保持規則は、そのリテンション期間を変更できますが、削除できません。 新しい保持規則に追加するには、 **[保持規則の追加]** を選択します。

   ![保持規則を追加する](./media/backup-managed-disks/add-retention-rule.png)

   **最初に正常に作成された日単位または週単位のバックアップ** を選択して、特定のバックアップが削除される前に保持されるリテンション期間を指定できます。 このオプションは、日または週の特定のバックアップを長期間保持するのに便利です。 その他のバックアップについては、保持期間を短くすることができます。

   ![保有期間の設定](./media/backup-managed-disks/retention-settings.png)

   >[!NOTE]
   >マネージド ディスクの Azure Backup では、ディスクあたりのスナップショット数が 200 に制限された増分スナップショットが使用されます。 スケジュールされたバックアップとは別にオンデマンド バックアップを作成するには、バックアップ ポリシーによって合計バックアップ数を 180 に制限します。 詳細については、マネージド ディスクの[増分スナップショット](../virtual-machines/disks-incremental-snapshots.md#restrictions)に関するページをご覧ください。

1. **[確認と作成]** を選択してバックアップ ポリシーの作成を完了します。

## <a name="configure-backup"></a>バックアップの構成

バックアップ コンテナーでは、マネージド ID を使用して他の Azure リソースにアクセスします。 マネージド ディスクのバックアップを構成するには、バックアップ コンテナーのマネージド ID に、スナップショットが作成および管理されるソース ディスクとリソース グループに対する一連のアクセス許可を付与する必要があります。

システム割り当てマネージド ID は、1 つのリソースにつき 1 つに限定されており、このリソースのライフサイクルに関連付けられています。 マネージド ID には、Azure ロールベースのアクセス制御 (Azure RBAC) を使用してアクセス許可を付与できます。 マネージド ID は、Azure リソースでのみ使用できる特殊な種類のサービス プリンシパルです。 [マネージド ID](../active-directory/managed-identities-azure-resources/overview.md) の詳細を確認してください。

マネージド ディスクのバックアップを構成するには、次の前提条件があります。

1. バックアップ コンテナーのマネージド ID に、バックアップするソース ディスクに対する **ディスク バックアップ リーダー** ロールを割り当てます。

   1. バックアップする必要があるディスクに移動します。

   1. **[アクセス制御 (IAM)]** に移動して、 **[ロールの割り当ての追加]** を選択します

   1. 右側のコンテキスト ウィンドウで、 **[ロール]** ドロップダウン リストから **[ディスク バックアップ リーダー]** を選択します。 バックアップ コンテナーのマネージド ID を選択して **[保存]** を選択します。

   >[!TIP]
   >バックアップ コンテナーのマネージド ID を選択するには、コンテナー名を入力します。

   ![ディスク バックアップ リーダー ロールを追加する](./media/backup-managed-disks/disk-backup-reader-role.png)

1. バックアップ コンテナーのマネージド ID に、Azure Backup サービスによってバックアップが作成および管理されるリソース グループに対する **ディスク スナップショット共同作成者** ロールを割り当てます。 ディスクのスナップショットは、サブスクリプション内のリソース グループに格納されます。 Azure Backup サービスでスナップショットを作成、保存、管理できるようにするには、バックアップ コンテナーへのアクセス許可を指定する必要があります。

   **スナップショットを保存および管理するためのリソース グループの選択:**

   - ソース ディスクと同じリソース グループを選択しないでください。

   - ガイドラインとして、Azure Backup サービスで使用されるスナップショット データストアとして専用のリソース グループを作成することをお勧めします。 専用のリソース グループを使用すると、リソース グループに対するアクセス許可を制限できるため、バックアップ データを安全かつ簡単に管理できます。

   - このリソース グループを使用して、バックアップする (またはその予定がある) 複数のディスクにスナップショットを格納できます。  

   - 特定のディスクの増分スナップショットを、そのディスクのサブスクリプションの外部で作成することはできません。 そのため、バックアップするディスクと同じサブスクリプション内のリソース グループを選択してください。 詳細については、マネージド ディスクの[増分スナップショット](../virtual-machines/disks-incremental-snapshots.md#restrictions)に関するページをご覧ください。

   ロールを割り当てるには、次の手順に従います。

   1. リソース グループに移動します。 たとえば、リソース グループが「*SnapshotRG*」で、バックアップするディスクと同じサブスクリプション内にあるとします。

   1. **[アクセス制御 (IAM)]** に移動して、 **[ロールの割り当ての追加]** を選択します。

   1. 右側のコンテキスト ウィンドウで、 **[ロール]** ドロップダウン リストから **[ディスク スナップショット共同作成者]** を選択します。 バックアップ コンテナーのマネージド ID を選択して **[保存]** を選択します。

   >[!TIP]
   >バックアップ コンテナーのマネージド ID を選択するには、コンテナー名を入力します。

   ![ディスク スナップショット共同作成者ロールを追加する](./media/backup-managed-disks/disk-snapshot-contributor-role.png)

1. バックアップ コンテナーのマネージド ID に、スナップショット データストアとして機能するソース ディスクとリソース グループに対する適切なロールが割り当てられていることを確認します。

   1. **バックアップ コンテナーの [ID]** に移動し、 **[Azure でのロールの割り当て]** を選択します。

      ![[Azure でのロールの割り当て] を選択する](./media/backup-managed-disks/azure-role-assignments.png)

   1. ロール、リソース名、リソースの種類が正しく反映されていることを確認します。

      ![ロール、リソース名、リソースの種類を確認する](./media/backup-managed-disks/verify-role.png)

   >[!NOTE]
   >ポータルではロールの割り当てが正しく反映されますが、バックアップ コンテナーのマネージド ID にアクセス許可が適用されるまでに 15 分程度かかります。

1. 前提条件が満たされたら、**バックアップ コンテナーの [概要]** に移動し、 **[バックアップ]** を選択してディスクのバックアップの構成を開始します。

   ![バックアップを選択する](./media/backup-managed-disks/select-backup.png)

1. **[基本]** タブで、データ ソースの種類として **[Azure ディスク]** を選択します。

   ![Azure ディスクを選択する](./media/backup-managed-disks/select-azure-disk.png)

   >[!NOTE]
   >Azure Backup では、マネージド ディスクの[増分スナップショット](../virtual-machines/disks-incremental-snapshots.md#restrictions)が使用されます。これにより、親ディスクのストレージの種類に関係なく、最後のスナップショット以降のディスクの差分変更のみが Standard HDD ストレージに保存されます。 ゾーン冗長ストレージ (ZRS) をサポートするリージョンでは、信頼性を向上させるため、増分スナップショットが既定で ZRS に保存されます。 Azure ディスク バックアップでは現在、バックアップ コンテナー ストレージにバックアップをコピーしないマネージド ディスクの運用バックアップがサポートされています。 そのため、バックアップ コンテナーのバックアップ ストレージの冗長性設定は回復ポイントに適用されません。

1. **[バックアップ ポリシー]** タブで、バックアップ ポリシーを選択します。

   ![バックアップ ポリシーを選択する](./media/backup-managed-disks/choose-backup-policy.png)

1. **[リソース]** タブで、 **[Azure ディスクの選択]** を選択します。 右側のコンテキスト ウィンドウで、バックアップするディスクを選択します。

   ![バックアップするディスクを選択する](./media/backup-managed-disks/select-disks-to-backup.png)

   >[!NOTE]
   >ポータルでは、複数のディスクを選択してバックアップを構成できますが、各ディスクは個別のバックアップ インスタンスです。 Azure ディスク バックアップでは現在、個々のディスクのバックアップのみがサポートされています。 仮想ディスクに接続されている複数のディスクの特定時点のバックアップはサポートされていません。
   >
   >Azure portal を使用する場合は、ディスクの選択が同じサブスクリプション内に限定されます。 バックアップするディスクが複数ある場合、またはディスクが異なるサブスクリプションに分散している場合は、スクリプトを使用して自動化できます。
   >
   >Azure ディスク バックアップの使用可能なリージョン、サポートされるシナリオ、制限事項の詳細については、[サポート マトリックス](disk-backup-support-matrix.md)に関するページをご覧ください。

1. **スナップショットのリソース グループ** を選択し、 **[検証]** を選択します。 これは、Azure Backup サービスによってバックアップ コンテナーの増分スナップショットが作成および管理されるリソース グループです。 マネージド ID は、前提条件の一部として必要なロール アクセス許可によって割り当てられます。

   ![スナップショットのリソース グループを選択する](./media/backup-managed-disks/select-snapshot-resource-group.png)

   >[!NOTE]
   >検証が完了してバックアップの構成ワークフローが完了するまでに、数分かかることがあります。 検証は、次の場合に失敗する可能性があります。
   >
   > - ディスクがサポートされていない。 サポートされないシナリオについては、[サポート マトリックス](disk-backup-support-matrix.md)に関するページをご覧ください。
   > - バックアップ コンテナーのマネージド ID に、バックアップする **ディスク** または増分スナップショットが格納される **スナップショット リソース グループ** に対する有効なロールが割り当てられていない。

1. 検証が正常に完了したら、 **[レビューと構成]** を選択して、選択したディスクのバックアップを構成します。

## <a name="run-an-on-demand-backup"></a>オンデマンド バックアップを実行する

1. 前の手順で作成した *DemoVault* **バックアップ コンテナー** で、 **[バックアップ インスタンス]** に移動してバックアップ インスタンスを選択します。

   ![バックアップ インスタンスを選択する](./media/backup-managed-disks/select-backup-instance.png)

1. **[バックアップ インスタンス]** 画面に、以下が表示されます。

   - ソース ディスク名、増分スナップショットが格納されるスナップショット リソース グループ、バックアップ コンテナー、バックアップ ポリシーなどの **要点**。
   - 過去 7 日間のバックアップおよび復元操作とその状態の概要を示す **ジョブの状態**。
   - 選択された期間の **復元ポイント** の一覧。

1. **[バックアップ]** を選択してオンデマンド バックアップを開始します。

   ![[今すぐバックアップ] の選択](./media/backup-managed-disks/backup-now.png)

1. バックアップ ポリシーに関連付けられている保持規則のいずれかを選択します。 この保持規則によって、このオンデマンド バックアップのリテンション期間が決まります。 **[今すぐバックアップ]** を選択してバックアップを開始します。

   ![バックアップを開始する](./media/backup-managed-disks/initiate-backup.png)

## <a name="track-a-backup-operation"></a>バックアップ操作を追跡する

スケジュールされたバックアップの実行時、またはオンデマンド バックアップ操作をトリガーすると、追跡用のジョブが Azure Backup サービスによって作成されます。 バックアップ ジョブの状態を表示するには、次の手順に従います。

1. **[バックアップ インスタンス]** 画面に移動します。 ここには、過去 7 日間の操作と状態を含むジョブのダッシュボードが表示されます。

   ![ジョブのダッシュボード](./media/backup-managed-disks/jobs-dashboard.png)

1. バックアップ操作の状態を表示するには、 **[すべて表示]** を選択して、このバックアップ インスタンスの進行中および過去のジョブを表示します。

   ![[すべて表示] を選択する](./media/backup-managed-disks/view-all.png)

1. バックアップおよび復元ジョブとそれらの状態の一覧を確認します。 ジョブの一覧からジョブを選択すると、そのジョブの詳細が表示されます。

   ![詳細を表示するジョブを選択する](./media/backup-managed-disks/select-job.png)

## <a name="next-steps"></a>次の手順

- [Azure マネージド ディスクの復元](restore-managed-disks.md)