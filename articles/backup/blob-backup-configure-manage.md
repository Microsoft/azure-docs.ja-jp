---
title: Azure BLOB の運用バックアップの構成
description: Azure BLOB の運用バックアップ (プレビュー段階) を構成および管理する方法について説明します
ms.topic: conceptual
ms.date: 02/16/2021
ms.openlocfilehash: 0dc490842389ba9286799aef5d37c1cf7c1ba64e
ms.sourcegitcommit: f3ec73fb5f8de72fe483995bd4bbad9b74a9cc9f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/04/2021
ms.locfileid: "102051074"
---
# <a name="configure-operational-backup-for-azure-blobs-in-preview"></a>Azure BLOB の運用バックアップの構成 (プレビュー)

Azure Backup を使用すると、ストレージ アカウント内のブロック BLOB を保護するための運用バックアップを簡単に構成できます。 この記事では、Azure portal を使用して 1 つまたは複数のストレージ アカウントでの運用バックアップを構成する方法について説明します。 この記事では、以下について説明します。

- 開始する前の確認事項
- バックアップ コンテナーの作成
- 保護するストレージ アカウントでのバックアップ コンテナーへのアクセス許可の付与
- バックアップ ポリシーの作成
- 1 つまたは複数のストレージ アカウントでの運用バックアップの構成
- バックアップ ストレージ アカウントに対する影響

## <a name="before-you-start"></a>開始する前に

- BLOB の運用バックアップは、ソース ストレージ アカウント自体にデータを指定された期間保持するローカル バックアップ ソリューションです。 このソリューションを使用した場合、コンテナー内にデータの追加コピーは保持されません。
- このソリューションを使用すると、データを復元用に最大 360 日間保持することができます。 ただし、保持期間が長いと、復元操作にかかる時間が長くなる場合があります。
- このソリューションを使用した場合は、ソース ストレージ アカウントにしか復元を実行できず、データが上書きされるおそれがあります。
- Delete Container 操作を呼び出してストレージ アカウントからコンテナーを削除した場合、そのコンテナーは復元操作を使って復元できません。 後で復元が必要になる可能性がある場合は、コンテナー全体を削除するのではなく、個々の BLOB を削除してください。 また、コンテナーの誤削除防止のために、運用バックアップに加えてコンテナーの論理的な削除を有効にすることをお勧めします。
- サポートされているシナリオ、制限、および利用可能性の詳細については、[サポート マトリックス](blob-backup-support-matrix.md)を参照してください。

## <a name="create-a-backup-vault"></a>バックアップ コンテナーの作成

[バックアップ コンテナー](backup-vault-overview.md)は、時間の経過と共に作成された復旧ポイントを格納する管理エンティティであり、バックアップ関連の操作を実行するためのインターフェイスを提供するものです。 たとえば、オンデマンドのバックアップの作成、復元の実行、バックアップ ポリシーの作成などの操作です。 BLOB の運用バックアップはローカル バックアップであり、コンテナーにデータは "格納" されませんが、さまざまな管理操作のためにコンテナーが必要です。

>[!NOTE]
>バックアップ コンテナーは、新しくサポートされたワークロードをバックアップするために使用される新しいリソースであり、既存の Recovery Services コンテナーとは異なります。

バックアップ コンテナーを作成する方法については、[バックアップ コンテナーのドキュメント](backup-vault-overview.md#create-a-backup-vault)を参照してください。

## <a name="grant-permissions-to-the-backup-vault-on-storage-accounts"></a>ストレージ アカウントでのバックアップ コンテナーへのアクセス許可の付与

運用バックアップを使用すると、バックアップ所有の削除ロックを適用することによって、ストレージ アカウント (保護対象の BLOB が含まれている) の誤削除を防止することもできます。 これを行うには、保護する必要があるストレージ アカウントのバックアップ コンテナーに特定のアクセス許可が与えられている必要があります。 便利に使えるように、これらのアクセス許可は、ストレージ アカウント バックアップの共同作成者ロールに統合されています。 保護する必要があるストレージ アカウントについて、次の手順に従ってください。

1. 保護するストレージ アカウントで、左側のナビゲーション ウィンドウにある **[アクセス制御 (IAM)] タブ** に移動します。
1. 必要なロールを割り当てるために、 **[ロールの割り当ての追加]** を選択します。

    ![ロールの割り当てを追加する](./media/blob-backup-configure-manage/add-role-assignments.png)

1. [ロールの割り当ての追加] ペインにおいて:

    1. **[ロール]** で **[ストレージ アカウント バックアップの共同作成者]** を選択します。
    1. **[アクセスの割り当て先]** で、 **[ユーザー、グループ、またはサービス プリンシパル]** を選択します。
    1. このストレージ アカウントの BLOB を保護する **バックアップ コンテナーの名前** を入力し、検索結果から同じものを選択します。
    1. 完了したら、 **[保存]** を選択します。

        ![ロールの割り当てオプション](./media/blob-backup-configure-manage/role-assignment-options.png)

        >[!NOTE]
        >ロールの割り当てが有効になるまでに最大 10 分ほどかかります。

## <a name="create-a-backup-policy"></a>バックアップ ポリシーの作成

通常、バックアップ ポリシーを使用してバックアップの保持期間とスケジュールを制御します。 BLOB の運用バックアップは継続的な性質のものであるため、バックアップを実行するスケジュールは必要ありません。 ポリシーは、基本的に保持期間を指定するために必要です。 バックアップ ポリシーを使用および再利用して、複数のストレージ アカウントのコンテナーへのバックアップを構成できます。

BLOB の運用バックアップのバックアップ ポリシーを作成する手順は、次のとおりです。

1. バックアップ コンテナーで、 **[バックアップ ポリシー]** に移動し、 **[+ 追加]** を選択してバックアップ ポリシーの作成を開始します。

    ![バックアップ ポリシー](./media/blob-backup-configure-manage/backup-policies.png)

1. **[基本]** タブで、バックアップ ポリシーの名前を指定し、データソースの種類として **[Azure BLOB]** を選択します。 選択したコンテナーの詳細を表示することもできます。

    ![バックアップ ポリシーを作成する](./media/blob-backup-configure-manage/create-backup-policy.png)

    >[!NOTE]
    >コンテナーの **[バックアップ ストレージの冗長性]** が表示されますが、実際には、冗長性は BLOB の運用バックアップには適用されません。このバックアップはローカルな性質のものであり、バックアップ コンテナーにデータは格納されないためです。 ここでのバックアップ コンテナーは、ストレージ アカウント内のブロック BLOB の保護を管理するために役立つ管理エンティティです。

1. **[バックアップ ポリシー]** タブで保持期間の詳細を指定します。 保持期間が 30 日の **[既定]** と呼ばれる保持規則が既に存在していることがわかります。 保持期間を編集する場合は、 **[保持規則の編集]** アイコンを使用して編集し、データを保持する期間を指定します。 最大 360 日までの保持期間を指定できます。

    ![[バックアップ ポリシー] タブ](./media/blob-backup-configure-manage/backup-policy-tab.png)

    >[!NOTE]
    >長期間を対象にした復元の場合、復元操作の完了に時間がかかることがあります。 さらに、一連のデータの復元にかかる時間は、復元期間中に行われた書き込みと削除の操作回数に基づきます。 たとえば、100 万オブジェクトを持つアカウントで毎日 3,000 オブジェクトが追加され、毎日 1,000 オブジェクトが削除される場合、過去 30 日間のポイントまで復元するのに約 2 時間必要になります。 過去 90 日間の保有期間と復元は、この変更率のアカウントには推奨されません。

1. **[確認と作成]** ペインでポリシーのすべての詳細を確認し、それができたら、 **[作成]** を選択してポリシーの作成を完了します。 バックアップ ポリシーが作成され、使用できる状態になると、確認の通知が表示されます。

    ![ポリシーの確認と作成](./media/blob-backup-configure-manage/review-create.png)

## <a name="configure-backup"></a>バックアップの構成

BLOB のバックアップは、ストレージ アカウント レベルで構成します。 そのため、ストレージ アカウント内のすべての BLOB が運用バックアップで保護されます。

バックアップの構成を開始するには:

1. 検索バーで「**バックアップ センター**」を検索します。
1. **[概要]**  ->  **[+ バックアップ]** に移動します。

    ![バックアップ センターの概要](./media/blob-backup-configure-manage/backup-center-overview.png)

1. **[開始: バックアップの構成]** タブで、データソースの種類として **[Azure BLOB (Azure Storage)]** を選択します。

    ![[開始: バックアップの構成] タブ](./media/blob-backup-configure-manage/initiate-configure-backup.png)

1. **[基本]** タブで、**データソース** の種類として **[Azure BLOB (Azure Storage)]** を指定し、お使いのストレージ アカウントを関連付けるバックアップ コンテナーを選択します。 選択したコンテナーの詳細をこのペインで確認できます。

    ![[基本] タブ](./media/blob-backup-configure-manage/basics-tab.png)

1. 次に、保持期間の指定に使用するバックアップ ポリシーを選択します。 選択したポリシーの詳細を画面の下部で確認できます。 運用データ ストアの列には、ポリシーで定義されている保持期間が表示されます。 "運用" とは、データがソース ストレージ アカウント自体にローカルに保持されることを意味します。

    ![バックアップ ポリシーを選択する](./media/blob-backup-configure-manage/choose-backup-policy.png)

    新しいバックアップ ポリシーを作成することもできます。 これを行うには、 **[新規作成]** を選択し、以下の手順に従います。

    1. 作成するポリシーの名前を指定します。 他のボックスに正しいデータソースの種類とコンテナー名が確実に表示されているようにします。
    1. **[バックアップ ポリシー]** タブで、[保持規則の編集] アイコンを選択して編集し、データを保持する期間を指定します。 最大 360 日までの保持期間を指定できます。 長期間を対象にした復元の場合、復元操作の完了に時間がかかることがあります。

        ![新しいバックアップ ポリシーの作成](./media/blob-backup-configure-manage/new-backup-policy.png)

    1. 完了したら、 **[確認と作成]** を選択してバックアップ ポリシーを作成します。

1. 次に、BLOB の保護を構成するストレージ アカウントを選択する必要があります。 一度に複数のストレージ アカウントを選択し、 **[選択]** を選択できます。

    ただし、前述の「[ストレージ アカウントでのバックアップ コンテナーへのアクセス許可の付与](#grant-permissions-to-the-backup-vault-on-storage-accounts)」で詳しく説明したように、ストレージ アカウントにバックアップを構成するために必要なアクセス許可が、選択したコンテナーに付与されていることを確認してください。

    ![バックアップするリソースを選択する](./media/blob-backup-configure-manage/select-resources.png)

    選択したストレージ アカウントのバックアップを構成するための十分なアクセス許可がコンテナーにあるかどうかが、Backup によって確認されます。

    ![Backup によるアクセス許可の検証](./media/blob-backup-configure-manage/validate-permissions.png)

    検証結果が (スクリーンショットにあるストレージ アカウントの 1 つと同様に) エラーになった場合は、[ここ](#grant-permissions-to-the-backup-vault-on-storage-accounts)で説明したように、選択したストレージ アカウントにアクセスし、適切なロールを割り当てたうえで、 **[再検証]** を選択します。 新しいロールの割り当ては、反映されるまで最大 10 分ほどかかることがあります。

1. 選択したすべてのストレージ アカウントに対して検証が成功したら、 **[Review and configure]\(確認および構成\)** に進んでバックアップを構成します。 保護の構成の状態とその完了を知らせる通知が表示されます。

## <a name="effects-on-backed-up-storage-accounts"></a>バックアップ対象ストレージ アカウントに対する影響

バックアップを構成すると、ストレージ アカウント内のブロック BLOB に対して行われた変更が追跡され、バックアップ ポリシーに従ってデータが保持されます。 バックアップを構成したストレージ アカウントには、次の変更点があることがわかるでしょう。

- ストレージ アカウントで次の機能が有効になっています。 これらは、ストレージ アカウントの **[データ保護]** タブで確認できます。
  - コンテナーのポイントインタイム リストア: バックアップ ポリシーで指定した保持期間
  - BLOB の論理的な削除: バックアップ ポリシーで指定した保持期間 + 5 日
  - BLOB のバージョン管理
  - BLOB の変更フィード

  バックアップ対象として構成したストレージ アカウントで、**コンテナーのポイントインタイム リストア** または **BLOB の論理的な削除** が (バックアップを構成する前に) 既に有効になっていた場合、Backup によって、少なくともバックアップ ポリシーで定義した保持期間が確保されます。 したがって、プロパティごとに次のようになります。

  - バックアップ ポリシーによる保持期間が、ストレージ アカウントに最初から存在する保持期間よりも長い場合: ストレージ アカウントでの保持期間は、バックアップ ポリシーに従って変更されます。
  - バックアップ ポリシーによる保持期間が、ストレージ アカウントに最初から存在する保持期間よりも短い場合: ストレージ アカウントでの保持期間は変更されず、当初の設定期間のままになります。

  ![[データ保護] タブ](./media/blob-backup-configure-manage/data-protection.png)

- **削除ロック** は、保護されているストレージ アカウントに Backup によって適用されます。 このロックは、ストレージ アカウントの誤削除を防ぐことを目的としています。 これは **[ストレージ アカウント]**  >  **[ロック]** で確認できます。

    ![ロックを削除する](./media/blob-backup-configure-manage/delete-lock.png)

## <a name="manage-operational-backup"></a>運用バックアップの管理

バックアップ センターは、すべてのバックアップを管理するための 1 つのウィンドウとして使用できます。 Azure BLOB の運用バックアップに関しては、バックアップ センターを使用して次のことを実行できます。

- 既に説明したように、これを使用してバックアップのコンテナーとポリシーを作成できます。 また、選択したサブスクリプションのすべてのコンテナーとポリシーを表示することもできます。
- バックアップ センターを使用すると、保護されているストレージ アカウントの保護の状態と、バックアップが現在構成されていないストレージ アカウントを簡単に監視できます。
- **[+ バックアップ]** ボタンを使用して任意のストレージ アカウントのバックアップを構成できます。
- **[復元]** ボタンを使用して復元を開始し、 **[バックアップ ジョブ]** を使用して復元を追跡します。 復元の実行の詳細については、「[Azure BLOB の復元](blob-backup-support-matrix.md)」を参照してください。
- バックアップ レポートを使用してバックアップの使用状況を分析します。

    ![バックアップ センター](./media/blob-backup-configure-manage/backup-center.png)

詳細については、[バックアップ センターの概要](backup-center-overview.md)に関するページを参照してください。

## <a name="next-steps"></a>次のステップ

- [Azure BLOB の復元](blob-restore.md)
