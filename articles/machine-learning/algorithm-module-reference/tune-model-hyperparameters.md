---
title: モデルのハイパーパラメーターの調整
titleSuffix: Azure Machine Learning
description: Azure Machine Learning でモデルのハイパーパラメーターの調整モジュールを使用して、モデルでパラメーター スイープを実行し、最適なパラメーター設定を決定する方法について説明します。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 02/11/2020
ms.openlocfilehash: 112a7f7aa61984b2ce9bd8400c629fe62db55584
ms.sourcegitcommit: b95983c3735233d2163ef2a81d19a67376bfaf15
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/11/2020
ms.locfileid: "77137908"
---
# <a name="tune-model-hyperparameters"></a>モデルのハイパーパラメーターの調整

この記事では、Azure Machine Learning デザイナー (プレビュー) の "モデルのハイパーパラメーターの調整" モジュールの使用方法について説明します。 目標は、機械学習モデルの最適なハイパーパラメーターを特定することです。 このモジュールでは、さまざまに組み合わせた設定を使って複数のモデルをビルドし、テストします。 その後、すべてのモデルについてメトリックを比較し、設定の組み合わせを求めます。 

"*パラメーター*" と "*ハイパーパラメーター*" は混同しやすい用語です。 モデルの "*パラメーター*" は、プロパティ ウィンドウで設定します。 つまり、このモジュールでは、指定されたパラメーター設定に対する "*パラメーター スイープ*" を行います。 デシジョン ツリー、データセット、回帰方法ごとに異なる可能性がある "_ハイパーパラメーター_" の最適なセットを学習します。 最適な構成を見つけるプロセスは、"*チューニング*" と呼ばれることもあります。 

このモジュールは、モデルの最適な設定を見つけるための方法である、"*統合されたトレーニングとチューニング*" に対応しています。 この方法では、使用するパラメーター セットを自分で設定します。 その後、モジュールに複数の組み合わせに対する反復処理を行わせます。 モジュールは、"最適な" モデルが見つかるまで正確性の測定を行います。 ほとんどの学習器モジュールでは、トレーニング プロセス中に変更する必要があるパラメーターと、固定したままにする必要があるパラメーターを選択できます。

チューニング プロセスの実行に掛ける時間しだいで、すべての組み合わせを網羅的にテストすることができます。 また、パラメーターの組み合わせのグリッドを構築し、このパラメーター グリッドからランダムに抽出したサブセットをテストすれば、プロセスを短時間で終えることもできます。

この方法では、再利用のために保存できるトレーニング済みのモデルが生成されます。  

> [!TIP] 
> 関連タスクを実行することをお勧めします。 チューニングを始める前に、特徴選択を適用して、最も高い情報価値を持つ列または変数を特定します。

## <a name="how-to-configure-tune-model-hyperparameters"></a>モデルのハイパーパラメーターの調整を構成する方法  

機械学習モデルに最適なハイパーパラメーターを調査するには、パイプラインを相当数使用する必要があります。

### <a name="train-a-model-by-using-a-parameter-sweep"></a>パラメーター スイープを使用してモデルをトレーニングする  

このセクションでは、"モデルのハイパーパラメーターの調整" モジュールを使用してモデルのトレーニングを行う、基本的なパラメーター スイープの実行方法について説明します。

1.  デザイナーで、"モデルのハイパーパラメーターの調整" モジュールをパイプラインに追加します。

2.  未トレーニングのモデルを左端の入力に接続します。 



4.  トレーニングに使用するデータセットを追加し、[Tune Model Hyperparameters]\(モデルのハイパーパラメーターの調整\) の中間入力に接続します。  

    タグが付けられたデータセットがある場合は、必要に応じて、それを右端の入力ポート (**オプションの検証データセット**) に接続できます。 これにより、トレーニングおよびチューニング中に正確性を測定できます。

5.  [Tune Model Hyperparameters]\(モデルのハイパーパラメーターの調整\) の右側のパネルで、 **[Parameter sweeping mode]\(パラメーターのスイープ モード\)** の値を選択します。 このオプションは、パラメーターの選択方法を制御します。

    - **[Entire grid]/(グリッド全体/)** :このオプションを選択すると、モジュールはシステムによって事前に定義されたグリッドをループし、さまざまな組み合わせを試行して最適な学習器を識別します。 このオプションは、最適なパラメーター設定がわからず、考え得る値の組み合わせすべてを試す必要がある場合に有用です。

    - **[Random sweep]/(ランダム スイープ/)** :このオプションを選択すると、モジュールはシステム定義の範囲からパラメーター値をランダムに選択します。 モジュールで実行する最大実行数を指定する必要があります。 このオプションは、選択したメトリックを使用してモデルのパフォーマンスを向上させながら、コンピューティング リソースを節約したい場合に有用です。    

6.  **[Label column]/(ラベル列/)** では、列セレクターを開いて 1 つのラベル列を選択します。

7.  実行回数を選択します。

    1. **[Maximum number of runs on random sweep]/(ランダム スイープの最大実行数/)** :ランダム スイープを選択した場合、パラメーター値のランダムな組み合わせを使用して、モデルをトレーニングする回数を指定できます。

8.  **[Ranking]\(順位付け\)** で、モデルの順位付けに使用する 1 つのメトリックを選択します。

    パラメーター スイープを実行すると、モデルの種類に適用可能なすべてのメトリックがモジュールによって計算され、 **[Sweep results]/(スイープ結果/)** レポートで返されます。 モジュールでは、回帰モデルと分類モデルに別々のメトリックが使用されます。

    ただし、選択したメトリックによって、モデルの順位付け方法が決まります。 スコアリングに使用するトレーニング済みモデルとして出力されるのは、選択したメトリックによって順位付けされた最上位モデルだけです。

9.  **[Random seed]/(ランダム シード/)** に、パラメーター スイープの開始時に使用する数値を入力します。 

10. パイプラインを実行します。

## <a name="results-of-hyperparameter-tuning"></a>ハイパーパラメーターの調整の結果

トレーニングの完了時:

+ 最適なモデルの一連の正確性メトリックを表示するには、モジュールを右クリックし、 **[視覚化]** を選択します。

    出力には、モデルの種類に適用されるすべての正確性メトリックが含まれますが、どのモデルが "最適" と見なされるかは順位付け用に選択したメトリックによって決まります。

+ トレーニングされたモデルのスナップショットを保存するには、 **[モデルのトレーニング]** モジュールの右側のパネルにある **[出力]** タブを選択します。 **[データセットの登録]** アイコンを選択して、再利用可能なモジュールとしてモデルを保存します。


## <a name="technical-notes"></a>テクニカル ノート

このセクションでは、実装の詳細とヒントを紹介します。

### <a name="how-a-parameter-sweep-works"></a>パラメーター スイープのしくみ

パラメーター スイープの設定時には、検索の範囲を定義します。 検索には、ランダムに選択された有限個のパラメーターを使用できます。 また、定義したパラメーター空間全体で網羅的な検索を行うこともできます。

+ **[Random sweep]/(ランダム スイープ/)** :このオプションでは、設定した反復回数を使用してモデルをトレーニングします。 

  反復処理する値の範囲を指定すると、モジュールはそれらの値からランダムに選択されたサブセットを使用します。 値は置換によって選択されます。つまり、以前にランダムに選択した数値は、使用可能な数値のプールから削除されません。 このため、値が選択される確率は、すべてのパスで同じままとなります。  

+ **[Entire grid]/(グリッド全体/)** :グリッド全体を使用するオプションは、すべての組み合わせがテストされることを意味します。 このオプションは、最も徹底的なものですが、最も時間がかかります。 

### <a name="controlling-the-length-and-complexity-of-training"></a>トレーニングの長さと複雑さの制御

設定の多くの組み合わせに対する反復処理は時間がかかる可能性があるため、このモジュールにはプロセスを制限するいくつかの方法が用意されています。

+ モデルのテストに使用する反復の回数を制限する。
+ パラメーター空間を制限する。
+ 反復の回数とパラメーター空間の両方を制限する。

特定のデータセットとモデルで最も効率的なトレーニング方法を決定するための設定のパイプライン処理をお勧めします。

### <a name="choosing-an-evaluation-metric"></a>評価メトリックの選択

テストの終了時にはモデルごとの正確性が記載されたレポートが表示され、メトリックの結果を確認できます。

- 二項分類モデルにはすべて、一貫したメトリック セットが使用されます。
- 多クラス分類モデルにはすべて、正確性が使用されます。
- 回帰モデルには、さまざまなメトリック セットが使用されます。 

ただし、トレーニング時には、チューニング処理中に生成されるモデルの順位付けに使用する*単一の*メトリックを選択する必要があります。 ビジネス上の問題や、擬陽性および検知漏れのコストに応じて、最適なメトリックが変わってくる可能性があります。

#### <a name="metrics-used-for-binary-classification"></a>二項分類に使用されるメトリック

-   **正確性**は、全事例に対する真の結果の割合を表します。  

-   **精度**は、陽性の結果に対する真の結果の割合を表します。  

-   **再現率**は、すべての結果に対するすべての正しい結果の割合を表します。  

-   **F スコア**は、精度と再現率のバランスを取る尺度を表します。  

-   **AUC** は、偽陽性を x 軸に、真陽性を y 軸にプロットした曲線の下の面積を表す値です。  

-   **平均ログ損失**は、2 つの確率分布 (真の確率分布とモデル内の確率分布) の間の差を表します。  

#### <a name="metrics-used-for-regression"></a>回帰に使用されるメトリック

-   **平均絶対誤差**は、モデル内のすべての誤差を平均したものです。この "*誤差*" は、真の値と予測値との隔たりを示します。 しばしば *MAE* と略記されます。  

-   **二乗平均平方根誤差**は、誤差の二乗の平均を測定し、その値の平方根を取得します。 しばしば *RMSE* と略記されます。  

-   **相対絶対誤差**は、真の値の割合として誤差を表します。  

-   **相対二乗誤差**は、二乗誤差の合計を、予測値の二乗誤差の合計で除算することで正規化したものです。  

-   **決定係数**は、データがモデルにどの程度適合しているかを示す 1 つの数値です。 値が 1 の場合、モデルとデータは完全に一致しています。 値が 0 の場合、データがランダムであるか、モデルに適合させられないことを意味します。 しばしば、*r<sup>2</sup>* や *R<sup>2</sup>* 、"*r の 2 乗*" と呼ばれます。  

### <a name="modules-that-dont-support-a-parameter-sweep"></a>パラメーター スイープがサポートされないモジュール

Azure Machine Learning のほとんどすべての学習器は、統合されたパラメーター スイープを使用したクロス検証をサポートしています。これにより、ユーザーはパイプライン処理するパラメーターを選択できます。 学習器が値の範囲の設定をサポートしていない場合でも、それをクロス検証で使用できます。 この場合、スイープに対して使用できる値の範囲が選択されます。 


## <a name="next-steps"></a>次のステップ

Azure Machine Learning で[使用できる一連のモジュール](module-reference.md)を参照してください。 

