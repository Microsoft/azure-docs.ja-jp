---
title: "航空宇宙業界における Azure による予測メンテナンス - Cortana Intelligence Solution テンプレート | Microsoft Docs"
description: "航空宇宙、公益事業、および輸送業界における予測メンテナンスのための Microsoft Cortana Intelligence による Solution Template。"
services: cortana-analytics
documentationcenter: 
author: fboylu
manager: jhubbard
editor: cgronlun
ms.assetid: 2e8b66db-91eb-432b-b305-6abccca25620
ms.service: cortana-analytics
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/14/2017
ms.author: fboylu
translationtype: Human Translation
ms.sourcegitcommit: c78604783bb21f9162939637e04e60aa8131ce11
ms.openlocfilehash: 1fc824c65e68c70ace589e788a0c470c475e66b4
ms.lasthandoff: 01/25/2017


---
# <a name="cortana-intelligence-solution-template-playbook-for-predictive-maintenance-in-aerospace-and-other-businesses"></a>航空宇宙などの業務における予測メンテナンスのための Cortana Intelligence Solution Template プレイブック
## <a name="executive-summary"></a>概要
予測的なメンテナンスとは、予測分析の最も需要のあるアプリケーションの&1; つで、コストの大幅な節約など、議論の余地のない利点をかなえます。 このプレイブックは、主要なユース ケースに重点を置いた、予測型メンテナンス ソリューションのリファレンスを提供することを目的としています。
これにより、予測メンテナンスの最もよくあるビジネス シナリオ、こうしたソリューションを必要とするビジネス上の問題に対処する際の課題、これらのビジネス上の問題の解決に必要なデータ、このようなデータを使用してソリューションを構築するための予測モデリング手法、また、サンプルのソリューション アーキテクチャでのベスト プラクティスを理解することができます。
また、特徴エンジニアリング、モデルの開発、パフォーマンス評価などの開発された予測モデルの詳細についても説明します。 基本的に、このプレイブックは予測型メンテナンス ソリューションの開発やデプロイの成功に必要なビジネス上および分析のガイドラインをまとめたものです。 これらのガイドラインにより、Cortana Intelligence Suite や中でも Azure Machine Learning を使って、長期的な予測メンテナンス戦略の開始点となる最初のソリューションを作成できるようになります。 Cortana Intelligence Suite や Azure Machine Learning に関するドキュメントは、[Cortana Analytics](http://www.microsoft.com/server-cloud/cortana-analytics-suite/overview.aspx) のページおよび [Azure Machine Learning](https://azure.microsoft.com/services/machine-learning/) のページで入手できます。

> [!TIP]
> このソリューション テンプレートの実装に関する技術ガイドについては、「 [航空宇宙などの業務における予測メンテナンスのための Cortana Intelligence Solution Template に関する技術ガイド](cortana-analytics-technical-guide-predictive-maintenance.md)」をご覧ください。
> 本テンプレートのアーキテクチャの概要を説明した図をダウンロードするには、「 [航空宇宙などの業務における予測メンテナンスのための Cortana Intelligence Solution Template のアーキテクチャ](cortana-analytics-architecture-predictive-maintenance.md)」をご覧ください。
> 
> 

## <a name="playbook-overview-and-target-audience"></a>プレイブックの概要と対象となる読者
このプレイブックは、予測的なメンテナンス分野におけるさまざまな背景や関心を持つ技術者、また技術者以外のユーザーの両方がメリットを得られるよう構成されています。 また、さまざまな種類の予測メンテナンス ソリューションの概要と、その実装方法の詳細の両方について説明します。 内容は、ソリューション領域とアプリケーションの種類のみの理解に関心を持つ読者と、これらのソリューションを実装する必要があるため、技術的な詳細に関心のある読者の両方に対応するよう設計されています。

このプレイブック内の大半の内容では、データ サイエンスの専門知識や技術があることを前提としていません。 ただし、プレイブックの一部では、実装の詳細を理解するために、多少のデータ サイエンスの概念を知っている必要があります。 これらのセクションで用意された資料から最大限の利点を得るには、入門レベルのデータ サイエンス スキルが必要です。

プレイブックの前半では、予測型メンテナンス アプリケーションを紹介し、どのような条件で予測メンテナンス ソリューションを採用できるか、また数々のよくあるユース ケースを用いてビジネス上の問題の詳細、これらのユース ケースにまつわるデータ、これらの予測メンテナンス ソリューションを実装した場合のビジネス上のメリットについて説明します。 これらのセクションでは、予測分析の領域における技術的知識を必要としません。

プレイブックの後半では、予測メンテナンス アプリケーションの予測モデリング手法の種類について説明すると共に、プレイブックの前半で説明したユース ケースからの例を使用してこれらのモデルを実装する方法を説明します。 ここでは、データのラベル付け、特徴エンジニアリング、モデルの選択、トレーニング/テスト、およびパフォーマンス評価のベスト プラクティスなど、データの前処理の手順を追って説明します。 これらのセクションは、テクニカル ユーザーを対象としています。

## <a name="predictive-maintenance-in-iot"></a>IoT での予測メンテナンス
予期しない設備のダウンタイムは、企業に大きなダメージを与えかねません。 使用率やパフォーマンスを最大化するには、またコストのかかる予定外のダウンタイムを最小化するには、現場の設備を稼働し続けることが必須です。 今日のビジネス運営において、障害がただ発生するのを待っているだけの余地はありません。 競争力を維持するために、企業はさまざまなチャネルから収集したデータを活用して、資産のパフォーマンスを最大化する新しい方法を探し求めています。 こうした情報を分析する&1; つの重要な方法は、履歴のパターンを使用して将来の結果を予測する予測分析手法を利用することです。 これらのソリューションの中で最も一般的な手法の&1; つは予測的なメンテナンスと呼ばれるもので、通常これを定義して、資産を監視してエラーを事前に特定したり、エラーが発生する前に対策を講じたりするために、近い将来における資産のエラーの可能性を予測できます。またこの手法の用途は、これだけに限られません。 これらのソリューションではエラーのパターンを見つけ、エラーが最も発生する可能性のある資産を特定します。 このように問題を早期に特定することで、よりコスト効率の高い方法で限られた保守リソースをデプロイし、品質管理やサプライ チェーンのプロセスを向上させることができます。

モノのインターネット (IoT) アプリケーションの台頭に伴い、データ収集および処理テクノロジが成熟し、バッチまたはリアルタイムであらゆる種類のデータを生成、送信、格納、および分析できるようになるにつれ、予測的なメンテナンスは急速に業界の関心を集めています。 こうしたテクノロジは、高度な分析ソリューションや、ほぼ間違いなく最大の恩恵をもたらす予測メンテナンス ソリューションと連携して、エンド ツー エンド ソリューションの容易な開発やデプロイを実現します。

予測メンテナンス領域で扱われるビジネス上の問題の範囲は、予期せぬエラーや複雑なビジネス環境での問題の根本原因に対する限られた分析に起因する高い運用リスクまで多岐にわたります。 こうした問題の大半は、以下のようなビジネス上の疑問に対する回答により分類できます。

* 近い将来、設備に障害が発生する可能性はどのくらいありますか?
* 設備の残耐用日数はどのくらいですか?
* 障害の原因は何ですか? また、それらの問題を解決するために講じる必要のあるメンテナンス対策は何ですか?

予測的なメンテナンスを活用してこれらの疑問に回答することで、企業は以下のことを実現できます。

* 発生する前に障害を特定して、運用リスクを軽減し、資産の投資収益率を向上させる
* 不要な時間ベースのメンテナンス操作やメンテナンスの管理コストを減らす
* ブランド イメージ全体の改善、悪い評判やその結果生じる顧客離れによる売上の低下を排除する
* 再発注点を予測して在庫レベルを減らすことで在庫コストを削減する
* さまざまなメンテナンスの問題に関連付けられたパターンを発見する

予測的なメンテナンス ソリューションは、資産の状態をリアルタイムに監視する正常性スコア、予期される資産の寿命、予測的なメンテナンス アクティビティの推奨事項、部品の交換の予測される注文日など、主要業績評価指標を企業に提供します。

## <a name="qualification-criteria-for-predictive-maintenance"></a>予測メンテナンスの資格基準
すべてのユース ケースまたはビジネス上の問題を予測的なメンテナンスによって効率的に解決できるわけではないことに注意してください。 重要な資格基準には、問題が予測的な性質を持つかどうか、障害の検出時に障害を回避するための対策の明確なパスが事前に存在すること、また、最も重要な点として、ユース ケースをサポートするのに十分な質の高いデータを利用できることなどが挙げられます。 ここでは、予測的なメンテナンス ソリューションを適切に構築するためのデータ要件に注目します。

予測モデルの構築時に履歴データを使ってモデルをトレーニングし、このモデルにより隠されたパターンを認識し、さらに将来のデータでこれらのパターンを特定します。 こうしたモデルは、その特徴や予測の対象によって説明された例によってトレーニングされます。 トレーニングされたモデルは、新しい例の特徴だけを見て、ターゲットに関する予測を立てます。 重要なことには、モデルは特徴と予測の対象間の関係を取得します。 効果的な Machine Learning モデルをトレーニングするには、予測の対象に対して実際に予測力を持つ特徴を含むトレーニング データが必要です。つまり、正確な予測を立てるにはデータが予測目標に関連している必要があります。

たとえば、ターゲットが電車の車輪の故障を予測することであった場合、トレーニング データには車輪に関する特徴 (例: 車輪の正常性状態、走行距離、積載量などを反映したテレメトリ) が含まれる必要があります。 一方、ターゲットが電車のエンジンの故障を予測することである場合、エンジンに関連した特徴を持つ別のトレーニング データのセットが必要になります。 予測モデルを構築する前に、ビジネスの専門家は、データ関連の要件を理解し、分析用の関連するデータのサブセットの選択に必要なその分野の専門知識を提供することが求められます。

ビジネス上の問題が予測的なメンテナンス ソリューションに適しているかどうかを判断するときに調査する必要のある重要なデータ ソースが&3; つあります。

1. 故障の履歴: 通常、予測的なメンテナンス アプリケーションでは、故障イベントは非常に稀です。 とは言え、故障を予測する予測モデルを構築する場合、アルゴリズムはトレーニング プロセスを通じて通常の作動パターンだけでなく、故障のパターンを学習する必要があります。 したがって、これら&2; つの個々のパターンを学習するため、トレーニング データには、この両方のカテゴリの十分な数の例が含まれていることが重要です。 このため、このデータに十分な数の故障イベントを含める必要があります。 故障イベントはメンテナンス記録や部品交換履歴で見つかります。または、トレーニング データ内の異常を分野の専門家が特定した故障として使用することもできます。
2. メンテナンス/修理履歴: 予測的なメンテナンス ソリューションのデータの重要なソースは、資産の詳細なメンテナンス履歴です。これは、交換されたコンポーネントや、実施された予測的なメンテナンス アクティビティに関する情報などを含みます。これらのイベントをキャプチャすることは非常に重要です。これらは劣化パターンに影響し、この情報がない場合は結果が間違った方向に導かれるためです。
3. マシンの状態: マシンが故障するまでの日数 (時間、マイル、トランザクションなど) を予測するために、マシンの正常性状態がその稼働中、徐々に低下するものと仮定します。 そのため、データには時間とともに変化する特徴が含まれる必要があります。これにより、この老朽化パターンや、劣化につながる異常を把握できます。 IoT アプリケーションでは、さまざまなセンサーからのテレメトリ データにより、1 つの優れた例が示されます。 マシンが所定の期間内に故障するかどうかを予測するには、実際の故障が発生する前に、データにより、この期間中の老朽化の傾向を把握することが理想的です。

また、予測の対象となる資産の稼働状態に直接関連するデータも必要です。 対象の特定は、ビジネス ニーズとデータ可用性の両方に基づきます。 電車の車輪に生じる故障の予測を例とすると、"もし車輪が故障したら" または "車両全体が故障したら" と予測できます。 最初の予測はより詳細なコンポーネントを対象とし、2 番目の予測は電車の故障を対象とします。 2 番目の予測はより大まかな問いで、最初の問いよりはるかに多様な方面からのデータを必要とし、モデルの構築もより困難です。 反対に、大まかな電車の状態データを調べるだけで車輪の故障のみを予測しようとすることは実現不可能です。なぜなら、これにはコンポーネント レベルの情報が含まれないためです。 通常、詳細な故障イベントの予測は、全体的な故障の予測より賢明です。

故障履歴データに関してよく聞かれる一般的な質問に、「モデルをトレーニングするために必要な故障イベントの数はどのくらいか、また、"十分" と考えられる数はどのくらいか」というものがあります。 この質問に対する明瞭な回答はありません。なぜなら、多くの予測分析シナリオでは、何が許容できるかを決めるのはデータの質であることが一般的であるためです。 データセットに故障予測に関連する特徴が含まれていなければ、いくら多数の故障イベントがあっても、優れたモデルを構築することは不可能です。 ただし、だいたいの目安として、故障イベントの数が多ければ多いほどモデルは適切になり、必要な故障例の数を大まかに見積もることは、非常にコンテキストやデータに依存した方法であるといえます。 この問題については不均衡なデータセットを扱うセクションで取り上げます。このセクションでは、十分な故障イベントがない問題の対処法を紹介しています。

## <a name="sample-use-cases"></a>サンプル ユース ケース
このセクションには、航空宇宙産業、公共事業、輸送産業など、さまざまな業界の予測的なメンテナンスのユース ケース集を掲載しています。 各サブセクションでは、これらの分野で収集されたユース ケースをドリルダウンし、ビジネス上の問題とそれらの問題に関するデータ、予測的なメンテナンス ソリューションの利点について説明します。

### <a name="aerospace"></a>航空宇宙業界
#### <a name="use-case-1-flight-delay-and-cancellations"></a>ユース ケース 1: フライトの遅延と欠航
##### <a name="business-problem-and-data-sources"></a>*ビジネス上の問題とデータ ソース*
航空会社が直面する主要なビジネス上の問題の&1; つは、機械的な問題によるフライトの遅延に関連付けられた膨大なコストです。 機械の故障を修復できなければ、欠航の可能性が発生します。 これは、遅延により運航計画に問題が発生し、評判が落ち、これに伴うさまざまな問題により顧客満足度が低下するため、膨大なコストがかかります。 航空会社はフライトの遅延や欠航を減らすため、こうした機械の故障を事前に予測することに特に関心を持ちます。 これらのケースでは、予測的なメンテナンス ソリューションの目標は、メンテナンス履歴や飛行経路情報などの関連データ ソースに基づいて、航空機の遅延や欠航の可能性を予測することです。 このユース ケースの&2; つの主要なデータ ソースは、飛行区間とページ ログです。 飛行区間データには、飛行経路の詳細 (フライトの発着日時、出発空港、到着空港など) に関するデータがあります。ページ ログのデータには、メンテナンス担当者が記録した一連の故障コードやメンテナンス コードがあります。

##### <a name="business-value-of-the-predictive-model"></a>*予測モデルのビジネス価値*
利用可能な履歴データを使用して、多クラス分類アルゴリズムにより予測モデルを構築し、今後 24 時間以内にフライトの遅延や欠航を引き起こす機械の問題の種類を予測しました。 この予測を立てることで、必要なメンテナンス対策を講じてリスクを軽減しつつ、航空機サービスの停止や潜在的な遅延または欠航を回避することができます。 Azure Machine Learning Web サービスを使用すると、予測モデルを航空会社の既存の業務プラットフォームとシームレスかつ簡単に統合できます。 

#### <a name="use-case-2-aircraft-component-failure"></a>ユース ケース 2: 航空機コンポーネントの故障
##### <a name="business-problem-and-data-sources"></a>*ビジネス上の問題とデータ ソース*
航空機エンジンは非常に精密かつ高価な装置であり、エンジン部品の交換は航空業界で最も一般的なメンテナンス タスクの&1; つです。 航空会社のメンテナンス ソリューションでは、在庫部品の可用性、輸送、計画の慎重な管理が求められます。 コンポーネントの信頼性に関する情報を収集できることは、投資コストの大幅な削減につながります。 このユース ケースの主要なデータ ソースは、航空機の数多くのセンサーから収集された、航空機の状態に関する情報を提供するテレメトリ データです。 また、メンテナンス レコードを使用して、コンポーネントの故障や交換がいつ発生したかを特定します。

##### <a name="business-value-of-the-predictive-model"></a>予測モデルのビジネス価値
翌月内の特定のコンポーネントによる故障の可能性を予測する多クラス分類モデルを構築しました。 これらのソリューションを採用して、航空会社はコンポーネントの修理コストを削減し、コンポーネント在庫の可用性を向上させ、関連する資産の在庫レベルを削減し、メンテナンス計画を改善することができます。

### <a name="utilities"></a>公共事業
#### <a name="use-case-1-atm-cash-dispense-failure"></a>ユース ケース 1: ATM 現金自動支払の故障
##### <a name="business-problem-and-data-sources"></a>*ビジネス上の問題とデータ ソース*
通常、資産集約型の業界における幹部は、ビジネスの主要な運営リスクは自身の資産の予期せぬ故障であると述べています。 例として、銀行業界の ATM などの機械の故障は、頻繁に発生するよく見られる問題の&1; つです。 この種類の問題では、こうした機械のオペレーターにとって予測メンテナンス ソリューションは理想的です。 このユース ケースでは、予測の問題は ATM 現金引き出し処理がキャッシュ ディスペンサーの故障 (紙詰まり、部品の故障など) により中断される可能性を予測することです。 このケースの主要なデータ ソースは、現金のやり取りが発生するときに計測値を収集するセンサー読み取り値、また長期間にわたり収集されるメンテナンス レコードです。 センサー データにより、完了した各トランザクションごとのセンサー読み取り値と、扱われた各現金ごとのセンサー読み取り値が提供されました。 センサー読み取り値では、現金、厚さ、現金到着までの距離間の差などの計測値が提供されました。メンテナンス データではエラー コードと修理に関する情報が提供されました。 これらの情報を使用して、故障の事例を特定しました。

##### <a name="business-value-of-the-predictive-model"></a>*予測モデルのビジネス価値*
現金支払トランザクションでの故障や、トランザクション中に引き出されたまたは預けられた各現金での故障を予測するために&2; つの予測モデルを構築しました。 トランザクションの故障を事前に予測できるようにすることで、故障の発生を回避するために ATM を先を見越して動作させることができます。 また、現金支払の故障の予測では、現金支払の故障によりトランザクションが完了する前に失敗する可能性がある場合、プロセスを停止し、不完全なトランザクションについて顧客に警告することが最善の策である場合があります。故障が発生した後にメンテナンス サービスが始動するのを待つのでは、顧客の不満をあおる可能性があるためです。

#### <a name="use-case-2-wind-turbine-failures"></a>ユース ケース 2: 風力タービンの故障
##### <a name="business-problem-and-data-sources"></a>*ビジネス上の問題とデータ ソース*
環境に対する意識の向上に伴い、風力タービンは重要な発電源の&1; つとなりました。通常、これらは数百万ドルを要します。 風力タービンの主要コンポーネントの&1; つは発電電動機で、これに搭載された多くのセンサーではタービンの状態やステータスを監視できます。 センサー読み取り値に含まれた有益な情報を使用して予測モデルを構築し、風力タービンのコンポーネントの平均故障時間など、重要な主要業績評価指標 (KPI) を予測できます。 このユース ケースのデータは、3 つの異なる農場に配置された複数の風力タービンから収集されます。 各タービンの 100 個近くのセンサーからの測定値を、1 年間、10 秒おきに記録しました。 これらの読み取り値には、温度、発電機の速度、タービン出力、発電機の風力などの測定値が含まれます。

##### <a name="business-value-of-the-predictive-model"></a>*予測モデルのビジネス価値*
発電機と温度センサーの寿命を見積もるための予測モデルを構築しました。 故障の可能性を予測することで、メンテナンス技術者はすぐに故障しそうなタービンを特定し、時間ベースのメンテナンス体制を敷くことができます。
さらに、予測モデルにより、故障の可能性に対するさまざまな要因の貢献度を分析することで、企業は問題の根本原因に関する理解を深めることができます。

#### <a name="use-case-3-circuit-breaker-failures"></a>ユース ケース 3: ブレーカーの故障
##### <a name="business-problem-and-data-sources"></a>*ビジネス上の問題とデータ ソース*
電気エネルギーの発電、配電、販売を含む電力・ガス事業では、送電が常時稼働し、各世帯にエネルギーが確実に届くようにするために膨大な量のメンテナンスを必要とします。 ここでの操作の失敗は、これが発生した地域の電力の問題によってほぼすべてのエンティティが影響を受けるため致命的です。 ブレーカーは、問題が発生した場合に電流を遮断する装置の一部であり、送電の障害が発生するのを回避する短絡回路であるため、このような操作にとって不可欠です。 このユース ケースのビジネス上の問題は、メンテナンス ログ、コマンド履歴、技術仕様によりブレーカーの故障を予測することです。

この事例の&3; つの主要なデータ ソースは、是正・予防措置や組織的な対策を含むメンテナンス ログ、ブレーカーに送信される自動および手動コマンド (開く操作、閉じる操作など) を含むオペレーショナル データ、および各ブレーカーのプロパティ (製造年、場所、モデルなど) に関する技術仕様データです。

##### <a name="business-value-of-the-predictive-model"></a>*予測モデルのビジネス価値*
予測的なメンテナンス ソリューションにより、修理費用を削減し、ブレーカーなどの機器のライフサイクルを向上させることができます。 また、これらのモデルは事前に警告を出すことで予期しない故障を減らし、サービスの中断を削減するため、電力ネットワークの品質を高めることができます。

#### <a name="use-case-4-elevator-door-failures"></a>ユース ケース 4: エレベーターのドアの故障
##### <a name="business-problem-and-data-sources"></a>*ビジネス上の問題とデータ ソース*
通常、ほとんどの大規模なエレベーター会社は、何百万基ものエレベーターを世界中で稼働させています。 競争力を獲得するため、これらの企業は顧客にとって最も重要である信頼性に重点を置いています。 モノのインターネットの可能性に基づいて、エレベーターをクラウドに接続し、エレベーター センサーやシステムからデータを収集することで、これらの企業はデータを価値あるビジネス インテリジェンスに変え、競合他社がまだ入手していない予測的かつ先制的メンテナンスを提供して、運用を飛躍的に改善できます。 この事例のビジネス要件は、ドア故障の潜在的な原因を予測する知識ベースの予測型アプリケーションを備えることです。 この実装に必要なデータは&3; つの部分で構成されます。エレベーターの静的な特徴 (点検者、外注整備の頻度、ビルの種類など)、使用状況に関する情報 (ドア サイクル数、ドアが閉まっている平均時間など)、故障履歴 (過去の故障レコードとその原因など) の&3; つです。

多クラス ロジスティック回帰モデルを Azure Machine Learning で構築し、予測の問題を解決します。この際、統合された静的特徴、特徴としての使用状況データ、故障の原因履歴レコードをクラス ラベルとして使用します。 この予測モデルを現場技術者が使用するモバイル デバイス上のアプリで使用することで、作業効率の向上を図れます。 エレベーター修理のため現場に出向いたとき、技術者はこのアプリを参照して、その原因や、メンテナンス業務に推奨される最善の対策を調べ、可能な限り早急にエレベーターのドアを修理できます。

### <a name="transportation-and-logistics"></a>輸送と物流
#### <a name="use-case-1-brake-disc-failures"></a>ユース ケース 1: ブレーキ ディスクの故障
##### <a name="business-problem-and-data-sources"></a>*ビジネス上の問題とデータ ソース*
車両の一般的なメンテナンス ポリシーには、是正および予防メンテナンスが含まれます。 是正メンテナンスは故障が発生した後に車両を修理することを意味し、ここでは、不測の機能不全の結果として運転手に重大な不都合がもたらされ、整備士は訪問時に時間を浪費する可能性があります。 ほとんどの車両は予防メンテナンス ポリシーの対象にもなります。ここでは、車両のサブシステムの実際の状態を考慮しないスケジュールで特定の点検を実施する必要があります。 これらの方法のいずれでも、問題を完全に排除することはできません。 ここでの特定のユース ケースは、車のタイヤ システムにインストールされたセンサーを通じて収集したデータに基づいて、ブレーキ ディスクの故障を予測することです。このセンサーは運転パターンの履歴や、車がさらされるその他の状態を追跡します。 このケースの最も重要なデータ ソースは、加速、ブレーキ パターン、走行距離、速度などを測定するセンサー データです。この情報を、車の特徴など、その他の静的な情報と組み合わせることで、予測モデルで使用できる優れた予測変数セットを構築できます。 重要な情報の別のセットは故障データで、これは部品注文データベース (車が販売代理店で販売されたときの予備部品の発注日や量を追跡するために使用) から取得します。

##### <a name="business-value-of-the-predictive-model"></a>*予測モデルのビジネス価値*
ここでの予測手法のビジネス価値は実体です。 予測的なメンテナンス システムにより、予測モデルに基づいてディーラーへの訪問日をスケジュールできます。 モデルの基になるのは、車の現在の状態と運転履歴を示すセンサーの情報です。 この手法では、次回の定期的なメンテナンスの前に発生するかもしれない予期しない故障のリスクを軽減できます。
また、不要な予防的メンテナンスを減らすこともできます。 運転手は、数週間以内に部品の交換が必要になるかもしれないという情報を事前に入手して、その情報をディーラーに提供できます。 ディーラーはその運転手のために個別のメンテナンス パッケージを事前に準備できます。

#### <a name="use-case-2-subway-train-door-failures"></a>ユース ケース 2: 地下鉄電車のドア故障
##### <a name="business-problem-and-data-sources"></a>*ビジネス上の問題とデータ ソース*
地下鉄運営の遅延や問題の主要な理由の&1; つに、電車のドア故障が挙げられます。 車両のドアが故障している可能性があるかどうかを予測するか、次のドア故障までの日数を予測できることが、ここでの極めて重要な予測です。 これにより、車両のドアの機能を最適化し、車両のダウンタイムを削減することができます。

#### <a name="data-sources"></a>データ ソース
このユース ケースのデータ ソースは次の&3; つです。 

* **車両イベント データ**(車両イベントの履歴レコード) 
* **メンテナンス データ** (メンテナンスの種類、整備の種類、優先順位コード)  
* **故障レコード**

##### <a name="business-value-of-the-predictive-model"></a>*予測モデルのビジネス価値*
2 つのモデルは、二項分類を使って故障が次に発生する可能性のある日を予測し、回帰を使って故障までの日数を予測するために構築します。 前のケースと同様、モデルによりサービスの質を向上させ、定期的なメンテナンス対策を敷くことで顧客満足度を大幅に向上させることができます。

## <a name="data-preparation"></a>データの準備
### <a name="data-sources"></a>データ ソース
予測的なメンテナンスの問題の一般的なデータ要素は、次のようにまとめられます。

* 障害の履歴: コンピューターまたはコンピューター内のコンポーネントの障害履歴。
* メンテナンス履歴: コンピューターの修理履歴 (エラー コード、以前のメンテナンス アクティビティまたはコンポーネントの交換など)。
* コンピューターの状態と使用状況: コンピューターの運転状況 (センサーから収集されたデータなど)。
* コンピューターの特徴: コンピューターの特徴 (エンジン サイズ、製造元とモデル、場所など)。
* オペレーターの特徴: オペレーターの特徴 (性別、過去の経験など)。

故障履歴は、特別なエラー コードまたは予備部品の発注日などの形でメンテナンス履歴に含まれているのが一般的です。 このような場合、故障は、メンテナンス データから抽出できます。 さらに、さまざまな業務分野で、ここにまだ挙げていない、故障パターンに影響を与えるさまざまな他のデータ ソースが見つかる場合があります。 これらは、予測モデルを構築するときに、分野の専門家に相談することで特定できます。

ユース ケースからの上のデータ要素の例をいくつか示します。

故障履歴: フライトの遅延日付、航空機コンポーネント故障の日付と種類、ATM 現金引き出しトランザクションのエラー、電車/エレベーターのドア故障、ブレーキ ディスクの交換注文日、風力タービンの故障日およびブレーカーのコマンド エラー。

メンテナンス履歴: フライト エラー ログ、ATM トランザクション エラー ログ、電車のメンテナンス レコード (メンテナンスの種類、簡単な説明など)、ブレーカーのメンテナンス レコード。

マシンの状態と使用状況: フライトの経路と時刻、航空機エンジンから収集したセンサー データ、ATM トランザクションからの読み取り値、電車イベント データ、センサー読み取り値 (風力タービン、エレベーター、連結車両)。

マシンの特徴: ブレーカーの技術仕様 (電圧レベル、位置情報)、車の特徴 (製造元、モデル、エンジン サイズ、タイヤの種類、生産施設など)。

上記のようなデータ ソースでは、予測的なメンテナンス分野に&2; つの主要なデータ タイプがあることがわかります。1 つは一時的なデータで、もう&1; つは静的データです。
故障履歴、マシンの状態、修理履歴、使用状況履歴には通常タイムスタンプがあり、データが収集された時刻が示されています。 一般的に、マシンの特徴とオペレーターの特徴はマシンの技術仕様またはオペレーターのプロパティを通常説明するため、これらのデータは静的です。 これらの特徴は時間の経過と共に変化する可能性があり、その場合、これらのデータはタイムスタンプ ベースのデータ ソースとして処理される必要があります。

### <a name="merging-data-sources"></a>データ ソースのマージ
特徴エンジニアリングやラベル付けなどのプロセスに移る前に、まず、特徴の作成の基となるフォームにデータを準備する必要があります。 最終的な目標は、Machine Learning アルゴリズムに入力する特徴およびラベルを持つ各資産の各時間単位のレコードを生成することです。 このクリーンな最終データ セットを準備するには、いくつかの前処理の手順を実行する必要があります。 最初の手順では、データ コレクションの時間を (各レコードが資産の時間単位に属す) 時間単位に分けます。 また、データ コレクションをアクションなどの他の単位に分割することもできますが、便宜上、残りの説明では時間の単位を使用します。

時間の測定単位はデータ準備の効率性や、時間単位からその分野に固有のその他の因子までの資産の状態に見られる変化に基づいて、秒、分、時間、日、月、サイクル、マイルまたはトランザクションで指定できます。 つまり、時間単位はデータ コレクションの頻度と同じである必要はありません。これは、多くの場合、単位が変わってもデータにそれほどの違いは見られないためです。 たとえば、温度の値を 10 秒おきに収集した場合、分析全体に 10 秒という時間単位を選択すると、追加の情報を指定しない場合に、サンプルの数が急増します。 より良い方法として、1 時間の平均をサンプルとして使用します。

前のセクションで説明した、データ ソースのサンプルの汎用データ スキーマは次のとおりです。

メンテナンス レコード: これらは、実行されたメンテナンス操作のレコードです。 通常、生のメンテナンス データには資産 ID とタイムスタンプのほか、どういったメンテナンス アクティビティがその時間に実行されたかに関する情報が付随します。 このような生データでは、メンテナンス アクティビティをカテゴリ列に変換し、各カテゴリをメンテナンス操作の種類に対応させる必要があります。 メンテナンス レコードの基本的なデータ スキーマには、資産 ID、時刻、およびメンテナンス操作の列が含まれます。

故障レコード: これらは、故障または故障の理由と呼ばれる予測のターゲットに属するレコードです。 これらは、特定のエラー コードまたは特定のビジネス条件で定義された故障のイベントであることが考えられます。 場合によっては、分析対象の故障に対応して、データに複数のエラー コードが含まれる場合があります。 すべてのエラーを予測の対象としないため、他のエラーは、エラーに関連すると思われる特徴を構築するために使用するのが一般的です。 故障レコードの基本的なデータ スキーマには、資産 ID、時刻、および故障 (または該当する場合は故障の理由) の列が含まれます。

マシンの状態: データの動作状態に関するリアルタイムの監視データなどです。 たとえば、ドアの故障の場合、ドアの開閉時刻などを、ドアの現在の状態に関する適切なインジケーターとして使用できます。 マシン状態の基本的なデータ スキーマには、資産 ID、時刻、および条件値の列が含まれます。

マシンおよびオペレーター データ: マシンとオペレーターのデータを&1; つのスキーマにマージして、どの資産をどのオペレーターが操作したかを資産およびオペレーターのプロパティと共に特定できます。 例として一般的に、自動車は年齢、運転経験などの属性を持つ運転手によって所有されます。時間の経過と共にこのデータが変化した場合、このデータには時間列を含めて、特徴の生成用の時間の可変データとして処理する必要があります。 マシン状態の基本的なデータ スキーマには、資産 ID、資産の特徴、オペレーター ID、オペレーターの特徴が含まれます。

ラベル付けや特徴の生成に移る前の最後のテーブルを、資産 ID および時刻フィールドに故障レコードが設定された左結合マシン状態テーブルで生成できます。 このテーブルを資産 ID および時刻フィールドのメンテナンス レコードと結合し、最終的に、資産 ID のマシンおよびオペレーターの特徴と結合できます。 マシンが通常の状態で稼働しているとき、最初の左結合では故障列は null 値になります。通常の運用では、これらをインジケーター値によって補完できます。 この故障列を使用して、予測モデルのラベルを作成します。

### <a name="feature-engineering"></a>特徴エンジニアリング
モデリングの最初の手順は、特徴エンジニアリングです。 特徴の生成の考え方は、該当の時間までに収集した履歴データを使用して、マシンの正常性状態を概念的に説明および要約することです。 次のセクションでは、予測的なメンテナンスに使用できる手法の種類と、各手法でのラベル付けの実行方法の概要を説明します。 どの手法が最も適しているかは、データやビジネス上の問題によって異なります。 ただし、以下で説明する特徴エンジニアリング手法は、特徴の作成のベースラインとして使用できます。 以下では、タイムスタンプを伴うデータ ソースから構成するラグ特徴と、静的データ ソースから作成された静的特徴について説明し、ユース ケースの例を紹介します。

#### <a name="lag-features"></a>ラグ特徴
前述のように、予測的なメンテナンスでは通常、履歴データには、データの各部分の収集時刻を示すタイムスタンプが付随します。 タイムスタンプ付きデータを持つデータから特徴を作成する方法は数多くあります。 このセクションでは、予測的なメンテナンスに使用するいくつかの方法を紹介します。 ただし、方法はこれらに限られません。 特徴エンジニアリングは予測モデリングの最も創造的な分野の&1; つと見なされているため、特徴を作成するには他にも多くの方法が考えられます。 ここでは、一般的な手法をいくつか紹介します。

##### <a name="rolling-aggregates"></a>*ローリング集計*
資産の各レコードについて、集計履歴を計算する時間単位の数である、サイズ W のローリング ウィンドウを選択します。 そのレコードの日付以前の W 期間を使用して、ローリング集計特徴を計算します。 サンプルのローリング集計には、標準偏差、CUSUM 測定値、ウィンドウの最小および最大値に基づいたローリング カウント、平均、標準偏差、外れ値があります。 もう&1; つの注目すべき手法は、変則検出アルゴリズムによりデータ内の異常を検出するアルゴリズムを使用して、傾向の変更、スパイクやレベルの変更をキャプチャすることです。

デモについては、図 1 を参照してください。ここでは、各時間単位ごとに資産に記録されたセンサー値を青い線で示し、t<sub>1</sub> および t<sub>2</sub> のレコードについて W = 3 のローリング平均特徴計算をオレンジおよび緑のグループ化でそれぞれ示しています。

![図 1. ローリング集計の特徴](media/cortana-analytics-playbook-predictive-maintenance/rolling-aggregate-features.png)

図 1. ローリング集計の特徴

たとえば、航空機コンポーネントの故障の場合、先週、過去&3; 日間、前日のセンサー値を使用して、ローリング平均、標準偏差、および合計の特徴を作成しました。 同様に、ATM の故障では、生のセンサー値とローリング平均値の両方、中央値、範囲、標準偏差、3 つの標準偏差の外れ値の数、上限および下限の CUMSUM 特徴を使用しました。

フライト遅延予測では、過去&1; 週間のエラー コード数を使用して、特徴を作成しました。 電車のドアの故障では、前日のイベント数、過去 2 週間のイベント数、過去 15 日間のイベント数の分散を使用してラグ特徴を作成しました。 メンテナンス関連イベントに同じカウントを使用しました。

また、非常に大きい W (年など) を選択することで、 資産の履歴全体 (記録されたすべてのメンテナンス レコード、故障のカウントなど) を 記録期間の最後まで調査できます。 この方法は、過去&3; 年間のブレーカーの故障のカウントに使用しました。 また、電車の故障では、すべてのメンテナンス イベントをカウントして、特徴を作成し、長期にわたるメンテナンスの効果をキャプチャしました。

##### <a name="tumbling-aggregates"></a>*タンブリング集計*
資産のラベル付けされた各レコードについて、サイズ "W-<sub>k</sub>" のウィンドウを選択します。ここで k は、ラグ特徴を作成するサイズ W の数またはウィンドウを表します。 k に大きな数字を選択して長期の老朽化パターンをキャプチャしたり、小さい数字を選択して短期間の効果をキャプチャしたりできます。 次に、k タンブリング ウィンドウ W-<sub>k</sub>、W-<sub>(k-1)</sub>、…、W-<sub>2</sub>、W-<sub>1</sub> を使用して、記録日時以前の期間の集計特徴を作成します (図 2 を参照)。 これらは、図 2 ではキャプチャされていない時間単位のレコード レベルでのローリング ウィンドウでもありますが、考え方は t<sub>2</sub> を使用してローリング効果を示す図 1 と同じです。

![図 2. タンブリング集計の特徴](media/cortana-analytics-playbook-predictive-maintenance/tumbling-aggregate-features.png)

図 2. タンブリング集計の特徴

たとえば、風力タービンの場合、W = 1 および k = 3 か月を使用して、上位および下位の外れ値により過去 3 か月間のラグ特徴を作成しました。

#### <a name="static-features"></a>静的な特徴
これらは、機器の技術仕様 (製造日、モデル番号、場所など) です。通常、ラグ特徴は数値ですが、静的特徴は、モデルでのカテゴリ変数になることが一般的です。 例として、ブレーカー プロパティ (電圧、電流、電力の仕様など) を変圧器の種類、エネルギー源などと共に使用しました。 ブレーキ ディスクの故障では、車輪の種類 (合金、鋼鉄など) を静的特徴の一部として使用しました。

特徴の生成中は、不足した値や正規化の処理など、他のいくつかの重要な手順を実行する必要があります。 欠測値の補完やデータの正規化には多くの方法がありますが、このドキュメントではこれについては扱いません。 ただし、他の方法を試して、予測パフォーマンスが向上するかどうか確認するのも効果的です。

前のセクションで説明した特徴エンジニアリングの手順が完了したら、最終的な特徴テーブルは次の例のデータ スキーマのようになります (時間単位は日)。

| 資産 ID | Time | 特徴の列 | ラベル |
| --- | --- | --- | --- |
| 1 |Day 1 | | |
| 1 |Day 2 | | |
| ... |... | | |
| 2 |Day 1 | | |
| 2 |Day 2 | | |
| ... |... | | |

## <a name="modeling-techniques"></a>モデリング手法
一般的に、予測的なメンテナンスは、さまざまな予測モデリングの角度からアプローチできるビジネス上の疑問を採用した非常に豊かな分野です。 次のセクションでは、予測的なメンテナンス ソリューションを使用して回答できるさまざまなビジネス上の質問をモデル化するために使用される主な技法を紹介します。 類似点はあるものの、各モデルにはラベル構成の独自の方法があり、これについて詳しく説明します。 付属のリソースとして、Azure Machine Learning で支給されるサンプル実験に含まれている予測的なメンテナンス テンプレートを参照できます。 このテンプレートに関するオンライン資料へのリンクはリソース セクションにあります。 前に説明した特徴エンジニアリング手法や、次のセクションで説明するモデリング手法の一部を適用し、Azure Machine Learning を使用してどのように航空機エンジンの故障を予測するかを確認できます。

### <a name="binary-classification-for-predictive-maintenance"></a>予測メンテナンスの二項分類
予測的なメンテナンスの二項分類を使用して、装置が将来的に故障する可能性を予測します。 期間は、ビジネス ルールと手持ちのデータに基づいて決定します。 一般的な期間として、破損する可能性のあるコンポーネントの交換のための予備部品の購入に必要な最小リード タイムや、メンテナンス リソースをデプロイしてメンテナンス ルーチンを実行し、その期間内に発生する可能性のある問題を解決するために必要な時間などを使用できます。 この将来的な期間を「X」と呼びます。

二項分類を使用するには、正および負と呼ぶ&2; 種類の例を特定する必要があります。 各例は、前述の履歴データやその他のデータ ソースを使用して、特徴エンジニアリングを通じて、その時間単位までの運用状態を概念的に説明および要約する、資産の特定の時間単位に属するレコードです。 予測的なメンテナンスの二項分類のコンテキストでは、正の型は故障 (ラベル 1) を表し、負の型は通常の動作 (ラベル = 0) を表します。ここで、ラベルはカテゴリ型です。 目標は、次の X 時間単位の間に故障する、または正常に動作する可能性のあるそれぞれの新しい例を特定するモデルを見つけることです。

#### <a name="label-construction"></a>ラベル構築
「資産が次の X 時間単位までに故障する可能性はどのくらいですか?」という質問に回答する予測モデルを作成するには、資産の故障の前に X 個のレコードを取って、それらを "故障する可能性があるもの" (ラベル = 1) としてラベル付けし、他のすべてのレコードは "正常" (ラベル = 0) としてラベル付けします。 この方法では、ラベルはカテゴリ変数です (図 3 を参照)。

![図 3: Labeling for binary classification](media/cortana-analytics-playbook-predictive-maintenance/labelling-for-binary-classification.png)

図 3: 二項分類のラベル付け

フライトの遅延や欠航では、X に 1 日を選択して、今後 24 時間以内に発生する可能性のある遅延を予測しました。 故障前の 24 時間以内に予定されたすべてのフライトを 1s としてラベル付けしました。 ATM 現金自動支払の故障では、2 つの二項分類モデルを構築して、今後 10 分間のトランザクションでのエラーの確率を予測し、また、発行される今後 100 枚の現金のエラーの確率を予測しました。 故障前の直近の過去 10 分間に発生したすべてのトランザクションを最初のモデルを表す 1 としてラベル付けします。 故障前の 100 枚の現金内で発行されたすべての現金を 2 つめのモデルの 1 としてラベル付けしました。 ブレーカーの故障では、タスクは次のブレーカー コマンドが失敗する可能性を予測することです。ここで、将来的なコマンドの&1; つとして X を選択しました。 電車のドアの故障では、二項分類モデルを構築して、今後 7 日間に発生する可能性のある故障を予測しました。 風力タービンの故障では、X を 3 か月として選択しました。

風力タービンや電車のドアのケースは回帰分析にも使用され、同じデータを使用して装置の寿命を予測します。ただし、次のセクションで説明する別のラベル付け方法を使用します。

### <a name="regression-for-predictive-maintenance"></a>予測メンテナンスのための回帰
予測的なメンテナンスで回帰モデルを使用して資産の残存耐用年数 (RUL) を計算します。これは、次の故障が発生するまでに資産が機能を継続できる期間として定義されます。 二項分類と同様に、各例は、資産の時間単位 Y に属するレコードです。 ただし、回帰のコンテキストでの目標は、新しい各例の残存耐用年数を、連続した数 (故障発生までの残期間) として計算するモデルを見つけることです。 この期間を Y の数倍と呼びます。また、各例には残存耐用年数があり、これは、その例の次の故障までの残り時間を測定することで計算できます。

#### <a name="label-construction"></a>ラベル構築
「設備の残耐用年数はどのくらいですか?」という質問に対して、
故障前の各レコードを使用して、次の故障前の残りの時間単位がどれくらいかを計算して、回帰モデルのラベルを構築できます。 この方法では、ラベルは連続した変数です (図 4 を参照)。

![図 4: Labeling for regression](media/cortana-analytics-playbook-predictive-maintenance/labelling-for-regression.png)

図 4: 回帰のラベル付け

二項分類とは異なり、回帰では、データに故障のない資産はモデリングに使用できません。これは、ラベル付けが故障ポイントに関連して実行され、故障前の資産の耐用年数の情報なしで計算を行えないためです。 この問題には、生存分析と呼ばれる別の統計手法で対処します。
予測的なメンテナンスのユース ケースは時間とともに頻繁に変化するデータを含み、手法を適用する際に複雑性が発生する可能性があるため、このプレイブックでは生存分析について説明しません。

### <a name="multi-class-classification-for-predictive-maintenance"></a>予測メンテナンスの多クラス分類
予測的なメンテナンスの多クラス分類では、2 つの将来の結果を予測できます。 1 つめは、資産を潜在的な複数の期間のいずれかに割り当てて、各資産の故障までの時間の範囲を提供することです。 2 つめは、複数の根本原因のいずれかにより将来、故障が発生する可能性を特定することです。 これにより、この情報を持つメンテナンス担当者は問題に事前に対処できます。 他の多クラス モデリング手法では、想定された故障の根本原因を特定することに重点を置きます。 ここでは、故障を修理するために講じる必要のある上位メンテナンス操作の推奨事項を取得できます。
根本原因とその各々に対する修復作業がランク付けされた一覧になっていれば、  
技術者が故障後にまず行う修理作業がより的確なものになります。

#### <a name="label-construction"></a>ラベル構築
「資産が次の aZ 時間単位までに故障する確率はどのくらいですか (ここで a は期間の数)」と、「問題 P<sub>i</sub> により次の X 時間単位までに資産が故障する確率はどのくらいですか (ここで i は考えられる根本原因の数)」という&2; つの質問に対し、以下の方法でラベル付けを実行します。

最初の質問について、資産の故障前の aZ レコードを使用し、それらを時間のバケット (3Z、2Z、Z) をそのラベルとして使用し、その他のすべてのレコードを "正常" (ラベル =0) としててラベル付けすることでラベル付けを実行します。 この方法では、ラベルはカテゴリ変数です (図 5 を参照)。

![図 5: Labeling for multiclass classification for failure time prediction](media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-failure-time-prediction.png)

図 5: 多クラス分類のラベル付けによる故障の予測

2 番目の質問について、資産の故障前の X レコードを使用し、それらを "問題 P<sub>i</sub> により故障する可能性のあるもの" としてラベル付けし (ラベル = P<sub>i</sub>)、その他のすべてのレコードを "正常" (ラベル =0) としててラベル付けすることでラベル付けを実行します。 この方法では、ラベルはカテゴリ変数です (図 6 を参照)。

![図 6: Labeling for multiclass classification for root cause prediction](media/cortana-analytics-playbook-predictive-maintenance/labelling-for-multiclass-classification-for-root-cause-prediction.png)

図 6: 多クラス分類のラベル付けによる根本原因の予測

このモデルは、各 P<sub>i</sub> により故障する確率と、故障しない確率を割り当てます。 これらの確率を magnitude により並べ替えて、今後最も発生する可能性のある問題を予測できます。 航空機コンポーネント故障のユース ケースは多クラス分類の問題として構築されました。 これにより、翌月に発生する&2; つの異なる圧力弁コンポーネントの故障の確率を予測できます。

故障後の推奨されるメンテナンス操作について、ラベル付けで将来の期間を選択する必要はありません。 これは、モデルが将来的な故障を予測せず、故障が発生したらすぐに最も可能性の高い根本原因のみを予測するためです。 3 番目のケースであるエレベーターのドア故障では、目標は、運転状態に関する履歴データにより故障の原因を予測することです。 次にこのモデルを使用して、故障が発生した後に最も可能性の高い根本原因を予測します。 このモデルの重要な利点の&1; つは、通常なら解決に数年の経験を必要とする問題を、経験の少ない技術者でも簡単に診断して解決できる点です。

## <a name="training-validation-and-testing-methods-in-predictive-maintenance"></a>予測メンテナンスのトレーニング、検証、およびテスト方法
予測的なメンテナンスでは、タイムスタンプ データを含む他のソリューション同様、標準的なトレーニングおよびテスト ルーチンで時間とともに変化する要素を将来の表示されないデータでより適切に汎用化する必要があります。

### <a name="cross-validation"></a>クロス検証
多くの機械学習アルゴリズムは、モデルのパフォーマンスを大幅に変更できるハイパーパラメーターの数に依存します。 これらのハイパーパラメーターの最適値は、モデルのトレーニング時に自動的に計算されず、データ サイエンスの専門家が指定する必要があります。 ハイパーパラメーターの適切な値を検索するいくつかの方法があります。 最も一般的な方法の&1; つは "k フォールド クロス検証" で、ここでは、"k" フォールドに例をランダムに分割します。 ハイパーパラメーター値の各セットについて、学習アルゴリズムを k 回実行します。 各回で、現在のフォールドの例を検証セットとして使用し、残りの例をトレーニング セットとして使用します。 アルゴリズムはトレーニング例を使用してトレーニングを実行し、パフォーマンス メトリックは検証例により計算されます。 ハイパーパラメーター値のセットごとのこのループの最後に、k パフォーマンス メトリック値の平均を計算し、最適な平均パフォーマンスを持つハイパーパラメーター値を選択します。

前述のように、予測的なメンテナンスの問題では、データはいくつかのデータ ソースからのイベントの時系列として記録されます。 これらのレコードをレコードまたは例のラベル付けの時間に従って並べ替えることができます。 そのため、データセットをトレーニング セットと検証セットにランダムに分割すると、トレーニング例の一部が、検証例の一部の後にきます。 これにより、モデルをトレーニングする前に到着したデータに基づいてハイパーパラメーター値の将来のパフォーマンスが予測されます。 これらの予測は、特に時系列が静的ではなく、その動作が時間とともに変化する場合には、過度に楽観的になる場合があります。 結果として、選択されたハイパーパラメーターの値が十分最適化されない可能性があります。

ハイパーパラメーターの適切な値を見つけるより良い方法は、時間に依存した方法 (すべての検証例がすべてのトレーニング例より後の時間にくるように) でトレーニングと検証セットに例を分割することです。 次に、ハイパーパラメーター値のセットごとに、トレーニング セットを使ってアルゴリズムをトレーニングし、同じ検証セットを介してモデルのパフォーマンスを測定し、最高のパフォーマンスを示すハイパーパラメーターの値を選択します。 時系列のデータが静的でなく、時間とともに進化する場合、トレーニング/検証の分割で選択したハイパーパラメーター値のほうが、クロス検証でランダムに選択された値よりも、将来のモデルのパフォーマンスが向上します。

最終的なモデルは、トレーニング/検証分割またはクロス検証を使用して見つかった最適なハイパーパラメーターの値を使用して、データ全体に対して学習アルゴリズムをトレーニングして生成されます。

### <a name="testing-for-model-performance"></a>モデルのパフォーマンスのテスト
モデルを構築した後、新しいデータでその将来のパフォーマンスを評価する必要があります。 最もシンプルな評価として、トレーニング データに対してのモデルのパフォーマンスを評価します。 ただし、この評価は過度に楽観的になります。なぜなら、モデルは、パフォーマンスの評価に使用したデータ向けに調整されているためです。 より適切な評価は、検証セットで計算されたハイパーパラメーター値のパフォーマンス メトリック、または、クロス検証から計算された平均パフォーマンス メトリックを評価することです。 ただし、前の説明での理由同様、ここでも評価は過度に楽観的になります。 モデルのパフォーマンスを測定するには、より現実的なアプローチが引き続き必要です。

1 つの方法は、トレーニング、検証、およびテストの各セットにデータをランダムに分割することです。 トレーニングおよび検証のセットを使用してハイパーパラメーターの値を選択し、それらを使用してモデルをトレーニングします。 モデルのパフォーマンスはテスト セットを介して測定します。

また別の方法は予測的なメンテナンスに関連した方法で、時間に依存した方法 (すべてのテスト例がすべてのトレーニングおよび検証例より後の時間にくるように) でトレーニング、検証、およびテストのセットに例を分割することです。 分割後、前に説明したものと同じ方法で、モデルの生成およびパフォーマンスの測定を実行します。

時系列のデータが静的で、簡単に予測できる場合は、両方のアプローチで将来のパフォーマンスの同様の評価が生成されます。 時系列のデータが静的ではなく、予測が困難な場合は、2 番目のアプローチでは、最初のアプローチよりも将来のパフォーマンスのより現実的な評価が生成されます。

### <a name="time-dependent-split"></a>時間に依存した分割
ベスト プラクティスとして、このセクションでは、時間に依存した分割の実装方法を詳しく見ていきます。 トレーニング セットとテスト セットの間での時間に依存した&2; つの分割方法について説明しますが、トレーニング セットと検証セットの時間に依存した分割にまったく同じ論理を適用する必要があります。

さまざまなセンサーから収集した測定値など、タイムスタンプ付きのイベントのストリームがあるとします。 トレーニング例とテスト例の特徴、およびそのラベルは、複数のイベントが含まれている期間全体に定義されます。
たとえば、二項分類の場合、「特徴エンジニアリング」および「モデリング手法」のセクションで説明したように、特徴は過去のイベントに基づいて作成され、ラベルは、将来の X 時間単位内の将来のイベントに基づいて作成されます。 このため、例のラベル付けの期間は、その特徴の期間より後にきます。 時間に依存した分割では、調整されたハイパーパラメーターを使用してモデルをトレーニングする期間の時点を選択します。ここでは、その時点までの履歴データを使用します。 トレーニング期限を超えた将来のラベルがトレーニング データに混入するのを回避するには、最も最近の期間を選択して、トレーニングの例を、トレーニングの締日より前の X 単位としてラベル付けします。 図 7 の塗りつぶされた各円は、前述の方法に従って特徴およびラベルを計算する最終的な特徴のデータ セット内の行を示しています。 図は、X=2 および W=3 の時間に依存した分割を実装した場合の、トレーニング セットとテスト セットに分割されるレコードを示しています。

![図 7: Time-dependent split for binary classification](media/cortana-analytics-playbook-predictive-maintenance/time-dependent-split-for-binary-classification.png)

図 7: 二項分類の時間に依存した分割

緑の四角は、トレーニングに使用できる各時間単位に属するレコードを表します。 前に説明したように、最終的な特徴テーブル内の各トレーニング例は、トレーニングの締め日前の、特徴の生成の過去 3 期間、およびラベル付けの将来の 2 期間を調べて生成されます。 この例の将来の 2 つの期間の部分がトレーニング締め日を超えている場合、トレーニング セットの例を使用しません。これは、トレーニング締め日以降の期間を表示できないためです。 この制限に従って、黒い例は、トレーニング データ セットで使用できない最終的なラベル付けされたデータセットのレコードを示します。 これらのレコードはトレーニング締め日より前であり、これらのラベル付け期間はトレーニング期間に一部依存する (考えられないケース) ためテスト データで使用しません。これは、トレーニングとテストでラベル付け期間を完全に分けて、ラベル情報の混入を防ぐためです。

この手法では、トレーニング締め日に近いトレーニング例とテスト例間の特徴の生成に使用するデータでの重複が許可されます。 データの利用可能性に応じて、トレーニングの締め日の W 時間単位内のテストセットの任意の例を使用しないで、さらに複雑な分割を実行できます。

マイクロソフトでの研究の結果から、寿命予測に使用される回帰モデルは、リークの問題により深刻な影響を受け、ランダム分割の使用では過剰適合が発生することが分かっています。 同様に回帰の問題では、分割で、トレーニング締め日以前の故障のある資産に属するレコードをトレーニング セットに使用し、締め日以降の故障のある資産に属するレコードをテスト セットに使用する必要があります。

一般的な方法として、トレーニングとテスト用にデータを分割する別の重要なベスト プラクティスは、トレーニングに使用された資産はいずれもテストでは使用されないように資産 ID による分割を使用することです。これは、テストの考え方は、予測を立てるのに新しい資産を確実に使用するためであり、モデルにより現実的な結果が提供されるためです。

### <a name="handling-imbalanced-data"></a>偏ったデータの処理
分類の問題では、1 つのクラスの例が他のクラスよりも多い場合、データが不均衡になるのが一般的です。 トレーニング データ内に、さまざまクラスを区別するのに十分な各クラスの典型が存在することが理想的です。 データの 10% に満たないクラスがある場合、データが偏っていると言えます。これを、典型の不足したデータセットの少数派クラスと呼びます。 多くのケースで急激に、1 つのクラスの典型が他のクラスより大幅に不足している (データ ポイントの 0.001% のみを構成) 不均衡なデータセットが見られるようになりました。 クラスの不均衡は、不正行為の検出、ネットワーク不正侵入、予測的なメンテナンスを含む多くの領域での問題です。ここでは通常、少数派クラスの例を構成する資産の寿命において故障はほとんど発生しません。

クラスの不均衡では、最も標準的な学習アルゴリズムが全体的なエラー率を最小化しようとしたときにそのパフォーマンスが侵害されます。 たとえば、99% の負のクラスの例を持つデータ セットと 1% の正のクラスの例を持つデータ セットでは、すべてのインスタンスを単純に負としてラベル付けすることで 99% の精度を得ることができます。 ただし、これによりすべての正の例が誤って分類されるため、精度メトリックは非常に高いものの、アルゴリズムは役に立ちません。 したがって、エラー率での全体的な精度などの従来の評価メトリックは不均衡な学習では十分ではありません。 正確度、再現率、F1 スコア、コスト調整済み ROC 曲線などのメトリックを、不均衡なデータセットでの評価に使用できます。これについては、評価メトリックのセクションで説明します。

ただし、クラスの不均衡の問題に対処するいくつかの方法があります。 2 つの主要な方法は、サンプリング手法と費用重視型学習です。

#### <a name="sampling-methods"></a>サンプリング メソッド
不均衡な学習でのサンプリング メソッドの使用は、均衡のとれたデータセットを提供するためのいくつかのメカニズムによるデータセットの修正で構成されます。 サンプリング手法は数多くありますが、最も簡単な手法は、ランダムなオーバーサンプリングおよびアンダーサンプリングです。

簡単に言うと、ランダムなオーバーサンプリングでは少数派クラスからランダムなサンプルを選択し、こうした例をレプリケートし、それらをトレーニング データ セットに追加します。 これにより、少数派クラスの例の合計数が増加し、最終的に、異なるクラスの例の数の均衡が保たれます。 オーバーサンプリングが持つ危険性の&1; つとして、特定の例の複数のインスタンスにより、分類子が詳細になりすぎて過剰適合につながる可能性が挙げられます。
これはトレーニングの高い精度につながりますが、目に見えないテスト データのパフォーマンスが大幅に低下します。 反対に、ランダムなアンダーサンプリングでは多数派クラスからランダム サンプルを選択し、それらの例をトレーニング データ セットから削除します。 ただし、多数派クラスから例を削除すると、多数派クラスに関連した重要な概念が分類子で不足する可能性があります。 少数派クラスがオーバーサンプリングされ、同時に多数派クラスがアンダーサンプリングされるハイブリッド サンプリングは、もう&1; つの有効な手法です。 他にもより洗練されたサンプリング手法が多数用意され、クラスの不均衡に対処する効果的なサンプリング方法は、絶えず注目を集め、多くのチャネルからのデータを活用できる人気のある調査分野です。 一般的に、データ サイエンティストは最も効率的な方法を決めるためにさまざまな手法を使用して、調査や実験を重ね、データ プロパティに高度に活用できます。 また、サンプリング メソッドは、テストセットではなく、トレーニング セットにのみ適用することが重要です。

#### <a name="cost-sensitive-learning"></a>費用重視型学習
予測的なメンテナンスでは、多数派クラスを構成するエラーは通常の例よりも注目に値し、このため、エラーに関するアルゴリズムのにパフォーマンスに焦点を当てるのが一般的です。 通常、これを非等分散ロス、またはさまざまなクラスの要素の誤った分類による非対称コストと呼びます。ここでは、正を不適切に予測する一方で、負によりコストが増大し、またその逆も起こりえます。 理想的な分類子は、多数派クラスの正確性を大きく妥協することなく、少数派クラスでの高い予測の精度を実現できる必要があります。

これを実現するためのいくつかの方法があります。 高いコストを少数派クラスの誤分類に割り当て、全体的なコストを最小化しようとすることで、非等分散ロスに効率的に対処できます。 一部の機械学習アルゴリズムは、この考え方を本質的に採用しています (サポート ベクター マシン (SVM) など)。ここでは、正および負の例のコストをトレーニング時に反映できます。 同様に、ブースティング方法では通常、ブースト デシジョン ツリー アルゴリズムなど、不均衡なデータのケースで優れたパフォーマンスが示されます。

## <a name="evaluation-metrics"></a>評価メトリック
前述のように、クラスの不均衡により、アルゴリズムは少数派クラスを犠牲にして多数派クラスの例をより適切に分類する傾向があり、多数派クラスが適切にラベル付けされたときに誤分類の総エラー数が大幅に向上するため、パフォーマンスが低下します。 これにより、企業の誤報のコストが非常に高くなったときに、再現率が低下し、問題が肥大化します。 正確度は、分類子のパフォーマンスを記述するために使用される最も一般的なメトリックです。 ただし、上で説明したように正確度はデータ分散を非常に重視するため非効率的で、分類子の機能の実際のパフォーマンスが反映されません。 代わりに、他の評価メトリックを使用して、不均衡な学習上の問題を評価します。 このような場合、精度、再現率、および F1 スコアは、予測的なメンテナンス モデルのパフォーマンスを評価するときに確認する最初のメトリックとして使用します。 予測的なメンテナンスでは、再現率は、テスト セットでいくつのエラーがモデルによって適切に特定されたかを示します。 再現率の向上は、モデルが真のエラーの把握に成功したことを意味します。 精度メトリックは誤ったアラームの率に関連し、ここでは、精度率が低いほど、誤ったアラームが向上します。 F1 スコアは精度と再現率の両方を考慮します。最高値は 1 で、最低値は 0 です。

さらに、二項分類では、十分位数テーブルおよびリフト チャートはパフォーマンス評価において非常に有益な情報を提供します。 ここでは、正のクラス (故障) にのみ注目し、受信者操作特性 (ROC) 曲線上の修正された操作ポイントを見るだけでわかることよりもさらに複雑なアルゴリズム パフォーマンスの像を提供します。
十分位数テーブルは、しきい値処理をして最終的なラベルで決定する前にモデルが計算した予測された故障の確率に従ってテスト例を並べ替えることで取得します。 順序付けされたサンプルは、十分位数 (つまり、最も高い確率を持つ 10% のサンプル、20%、30%... など) でグループ化されます。 各十分位数の真陽性率とそのランダム ベースライン (つまり 0.1、0.2 ..) 間の率を計算することで、各十分位数でアルゴリズムのパフォーマンスがどのように変化するかを評価できます。 リフト チャートでは、十分位数の真陽性率対ランダムな真陽性率のペアをすべての十分位数についてプロットして、十分位数の値をプロットします。 通常、最初の十分位数で最も取得が高いため、これが結果のフォーカスです。 予測的なメンテナンスを使用した場合、最初の十分位数を「リスクのある」典型として確認することもできます。

## <a name="sample-solution-architecture"></a>サンプル ソリューションのアーキテクチャ
予測的なメンテナンス ソリューションをデプロイするとき、データ取り込みの連続的なサイクル、モデル トレーニング用のデータ ストレージ、特徴の生成、結果の予測と視覚化をアラート生成メカニズム (資産管理ダッシュボード) と共に提供するエンド ツー エンド ソリューションに注目しています。 継続的な自動化された方法で将来の洞察をユーザーに提供するデータ パイプラインが必要です。 IoT データ パイプラインなどの予測的なメンテナンス アーキテクチャの例を以下の図 8 に示します。 アーキテクチャでは、ストリーミング データを格納するイベント ハブでリアルタイムのテレメトリを収集します。 このデータは、特徴の生成などのデータのリアルタイム処理のためのストリーム分析によって取り込まれます。 次に、特徴を使用して、予測モデル Web サービスを呼び出すと、結果がダッシュ ボードに表示されます。 同時に、取り込んだデータも履歴データベースに格納され、オンプレミスのデータベースなどの外部データ ソースにマージされて、モデリング用のトレーニング例を作成します。
一部のデータ ウェアハウスを例のバッチ スコアリングおよび結果の格納に使用できます。また、これを使用して、ダッシュボードに予測レポートを表示できます。

![図 8: 予測的なメンテナンスのサンプル ソリューション アーキテクチャ](media/cortana-analytics-playbook-predictive-maintenance/example-solution-architecture-for-predictive-maintenance.png)

図 8: 予測的なメンテナンスのサンプル ソリューション アーキテクチャ

アーキテクチャの各コンポーネントの詳細については、 [Azure](https://azure.microsoft.com/) のドキュメントを参照してください。


