---
title: "Azure Virtual Network (VNet) の計画と設計ガイド | Microsoft Docs"
description: "分離、接続、場所の要件に基づき、Azure で仮想ネットワークを計画し、設計する方法について学習します。"
services: virtual-network
documentationcenter: na
author: jimdial
manager: carmonm
editor: tysonn
ms.assetid: 3a4a9aea-7608-4d2e-bb3c-40de2e537200
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/08/2016
ms.author: jdial
translationtype: Human Translation
ms.sourcegitcommit: bb1ca3189e6c39b46eaa5151bf0c74dbf4a35228
ms.openlocfilehash: fef61e6155471a0459957ea0c510698cfa787fdc
ms.lasthandoff: 03/18/2017


---
# <a name="plan-and-design-azure-virtual-networks"></a>Azure Virtual Network の計画と設計
試験的に VNet を作成することは簡単ですが、あなたはおそらく、組織の運用ニーズに対応するために、時間の経過と共に複数の VNet をデプロイすることになるでしょう。 ある程度の計画と設計を行うことで、より効率的に VNet をデプロイし、必要なリソースを接続できます。 VNet に慣れていない場合、続行する前に [VNet の概要](virtual-networks-overview.md)と[デプロイ方法](virtual-networks-create-vnet-arm-pportal.md)について学習することが推奨されます。

## <a name="plan"></a>プラン
Azure サブスクリプション、リージョン、ネットワーク リソースについて完全に理解することが成功のために不可欠です。 出発点として以下の考慮事項一覧をご利用ください。 これらの考慮事項を理解すると、ネットワーク設計の要件が決まります。

### <a name="considerations"></a>考慮事項
下の計画に関する質問に答える前に、次の点について検討してください。

* Azure で作成するものはすべて&1; つまたは複数のリソースで構成されます。 仮想マシン (VM) はリソースです。VM で利用されるネットワーク アダプター カード (NIC) はリソースです。NIC で利用されるパブリック IP アドレスはリソースです。NIC の接続先となる VNet はリソースです。
* リソースを [Azure リージョン](https://azure.microsoft.com/regions/#services) とサブスクリプションの内部に作成します。 リソースの接続先となるのは、それが入っているリージョンとサブスクリプションに存在する VNet だけです。
* [VPN Gateway](../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md)を利用し、VNet を互いに接続できます。 この方法で、リージョンとサブスクリプションをまたいで VNet を接続することもできます。
* Azure で利用できる[接続オプション](../vpn-gateway/vpn-gateway-about-vpngateways.md#site-to-site-and-multi-site-ipsecike-vpn-tunnel)のいずれかを利用し、オンプレミス ネットワークに VNet を接続できます。
* 複数のリソースを[リソース グループ](../azure-resource-manager/resource-group-overview.md#resource-groups)にグループ化できます。リソースの単位管理が簡単になります。 リソースが同じサブスクリプションに属する限り、リソース グループには複数のリージョンのリソースを含めることができます。

### <a name="define-requirements"></a>要件の定義
Azure ネットワークを設計するときには、出発点として以下の質問をご利用ください。    

1. どの Azure の場所を VNet のホストに利用しますか。
2. これらの Azure の場所の間で通信を提供する必要がありますか。
3. Azure VNet とオンプレミス データセンターの間で通信を提供する必要はありますか。
4. ソリューションにはいくつの IaaS (サービスとしてのインフラストラクチャ) VM、クラウド サービス ロール、Web アプリが必要ですか。
5. VM のグループ (すなわち、フロントエンド Web サーバーとバックエンド データベース サーバー) に基づいてトラフィックを分離する必要はありますか。
6. 仮想アプライアンスを利用してトラフィック フローを制御する必要がありますか。
7. ユーザーには異なる Azure リソースにアクセスするために異なるアクセス許可セットが必要になりますか。

### <a name="understand-vnet-and-subnet-properties"></a>VNet とサブネットのプロパティを理解する
VNet とサブネット リソースは、Azure で実行するワークロードのセキュリティ境界を定義するときに役立ちます。 VNET は、(CIDR ブロックとして定義される) アドレス空間のコレクションを特徴としています。

> [!NOTE]
> ネットワーク管理者は、CIDR 表記に慣れています。 CIDR に慣れていない場合は、 [詳細を確認してください](http://whatismyipaddress.com/cidr)。
>
>

VNet には、次のプロパティが含まれています。

| プロパティ | Description | 制約 |
| --- | --- | --- |
| **name** |VNet の名前 |最大 80 文字の文字列。 文字、数字、アンダー スコア、ピリオド、ハイフンを使用できます。 先頭は文字か数字にします。 末尾は文字、数字、アンダー スコアのいずれかにします。 大文字または小文字を使用できます。 |
| **location** |Azure の場所 (リージョンとも呼ばれます)。 |有効な Azure の場所にする必要があります。 |
| **addressSpace** |VNet を構成するアドレス プレフィックスのコレクション (CIDR 表記)。 |パブリック IP アドレス範囲を含む、有効な CIDR アドレス ブロックの配列にする必要があります。 |
| **サブネット** |VNet を構成するサブネットのコレクション |次のサブネットのプロパティの表を参照してください。 |
| **dhcpOptions** |「 **dnsServers**」という名前の必須プロパティを&1; つ含むオブジェクト。 | |
| **dnsServers** |VNet で使用される DNS サーバーの配列。 サーバーが指定されていない場合、Azure の内部の名前解決が使用されます。 |IP アドレスによる最大 10 の DNS サーバーの配列にする必要があります。 |

サブネットは、VNet の子リソースで、IP アドレスのプレフィックスを使用して、CIDR ブロック内のアドレス空間のセグメントの定義に役立ちます。 NIC をサブネットに追加し、VM に接続して、さまざまなワークロードへの接続を提供できます。

サブネットには、次のプロパティが含まれています。

| プロパティ | Description | 制約 |
| --- | --- | --- |
| **name** |サブネット名 |最大 80 文字の文字列。 文字、数字、アンダー スコア、ピリオド、ハイフンを使用できます。 先頭は文字か数字にします。 末尾は文字、数字、アンダー スコアのいずれかにします。 大文字または小文字を使用できます。 |
| **location** |Azure の場所 (リージョンとも呼ばれます)。 |有効な Azure の場所にする必要があります。 |
| **addressPrefix** |サブネットを構成する単一のアドレス プレフィックス (CIDR 表記) |VNet のアドレス空間の&1; つに属する&1; つの CIDR ブロックにする必要があります。 |
| **networkSecurityGroup** |サブネットに適用される NSG | |
| **routeTable** |サブネットに適用されるルート テーブル | |
| **ipConfigurations** |サブネットに接続されている NIC で使用される IP 構成オブジェクトのコレクション | |

### <a name="name-resolution"></a>名前解決
既定では、VNet は [ Azure が提供する名前解決](virtual-networks-name-resolution-for-vms-and-role-instances.md)を利用し、VNet 内とパブリック インターネット上で名前を解決します。 ただし、VNet をオンプレミスのデータ センターに接続する場合、 [独自の DNS サーバー](virtual-networks-name-resolution-for-vms-and-role-instances.md) を指定し、ネットワーク間で名前を解決する必要があります。  

### <a name="limits"></a>制限
設計がいずれの制限とも競合していないことを確認するには、[Azure の制限](../azure-subscription-service-limits.md#networking-limits)に関する記事のネットワークの制限をご覧ください。 一部の制限は、サポート チケットを開いて引き上げることができます。

### <a name="role-based-access-control-rbac"></a>ロール ベースのアクセス制御 (RBAC)
[Azure RBAC](../active-directory/role-based-access-built-in-roles.md) を利用し、さまざまなユーザーが Azure のさまざまなリソースにアクセスするために必要なアクセス権のレベルを制御できます。 この方法で、チームが行う作業をチームのニーズに基づいて分離できます。

仮想ネットワークに関する限り、 **ネットワークの共同作業者** ロールのユーザーは Azure リソース マネージャーの仮想ネットワーク リソースを自由に利用できます。 同様に、 **従来のネットワークの共同作業者** ロールのユーザーは従来の仮想ネットワーク リソースを自由に利用できます。

> [!NOTE]
> [独自のロールを作成](../active-directory/role-based-access-control-configure.md) し、管理ニーズを分離することもできます。
>
>

## <a name="design"></a>設計
「 [計画](#Plan) 」セクションの質問に対する回答を用意できたら、VNet を定義する前に、以下を確認します。

### <a name="number-of-subscriptions-and-vnets"></a>サブスクリプションと VNet の数
次のシナリオでは、複数の VNet を作成することを検討します。

* **さまざまな Azure の場所に配置する必要がある VM**。 Azure の VNet はリージョン限定です。 場所をまたがることはできません。 そのため、VM をホストする Azure の場所ごとに VM が少なくとも&1; つ必要になります。
* **互いから完全に分離する必要があるワークロード**。 ワークロードを互いから分離するために別個の VNet を作成できます。別個の VNet は同じ IP アドレス空間を使用することもあります。

上記の制限はリージョン単位であり、サブスクリプション単位です。 つまり、複数のサブスクリプションを使用し、Azure で保持できるリソースの上限を増やすことができます。 サイト間 VPN または ExpressRoute 回線を使用し、異なるサブスクリプションの VNet を接続できます。

### <a name="subscription-and-vnet-design-patterns"></a>サブスクリプションと VNet の設計パターン
次の表は、サブスクリプションと VNet を使用した一般的な設計パターンをいくつかまとめたものです。

| シナリオ | ダイアグラム | 長所 | 短所 |
| --- | --- | --- | --- |
| 1 つのサブスクリプション、アプリごとに&2; つの VNet |![1 つのサブスクリプション](./media/virtual-network-vnet-plan-design-arm/figure1.png) |管理するサブスクリプションは&1; つだけ。 |Azure リージョンごとの VNet の最大数。 それ以上にはサブスクリプションを追加する必要があります。 詳しくは、[Azure の制限](../azure-subscription-service-limits.md#networking-limits)に関する記事をご覧ください。 |
| アプリごとに&1; つのサブスクリプション、アプリごとに&2; つの VNet |![1 つのサブスクリプション](./media/virtual-network-vnet-plan-design-arm/figure2.png) |サブスクリプションあたり&2; つだけ VNet を使用します。 |アプリの数が多すぎると、管理が難しくなります。 |
| 事業単位ごとに&1; つのサブスクリプション、アプリごとに&2; つの VNet |![1 つのサブスクリプション](./media/virtual-network-vnet-plan-design-arm/figure3.png) |サブスクリプションと VNet の数の間のバランス。 |事業単位ごとの VNet の最大数 (サブスクリプション)。 詳しくは、[Azure の制限](../azure-subscription-service-limits.md#networking-limits)に関する記事をご覧ください。 |
| 事業単位ごとに&1; つのサブスクリプション、アプリのグループごとに&2; つの VNet |![1 つのサブスクリプション](./media/virtual-network-vnet-plan-design-arm/figure4.png) |サブスクリプションと VNet の数の間のバランス。 |サブネットと NSG を利用し、アプリを分離する必要があります。 |

### <a name="number-of-subnets"></a>サブネットの数
次のシナリオでは、1 つの VNet で複数のサブネットを作成することを検討します。

* **1 つのサブネットですべての NIC のためのプライベート IP アドレスが足りません**。 サブネット アドレス空間にサブネットの NIC 数に足りる IP アドレスがない場合、複数のサブネットを作成する必要があります。 Azure はサブネットにつき 5 つのプライベート IP アドレスを予約します。アドレス空間の最初のアドレスと最後のアドレス (サブネット アドレスとマルチキャスト) とさらに 3 つのアドレス (DHCP と DNS) が内部で使用されます。
* **セキュリティ**。 サブネットを利用し、複数層の構造を持つワークロードに対して VM のグループを互いから分離し、それらのサブネットに異なる [ネットワーク セキュリティ グループ (NSG)](virtual-networks-nsg.md#subnets) を適用できます。
* **ハイブリッド接続**。 VPN ゲートウェイと ExpressRoute 回線を利用し、VNet を互いに、またはオンプレミスのデータ センターに[接続](../vpn-gateway/vpn-gateway-about-vpngateways.md#site-to-site-and-multi-site-ipsecike-vpn-tunnel)できます。 VPN ゲートウェイと ExpressRoute 回線を利用するには、独自のサブネットを作成する必要があります。
* **仮想アプライアンス**。 ファイアウォール、WAN アクセラレータ、VPN ゲートウェイなどの仮想アプライアンスを Azure VNet で使用できます。 その場合、それらのアプライアンスに [トラフィックを送信](virtual-networks-udr-overview.md) し、独自のサブネットでアプライアンスを分離する必要があります。

### <a name="subnet-and-nsg-design-patterns"></a>サブネットと NSG の設計パターン
次の表は、サブネットを使用した一般的な設計パターンをいくつかまとめたものです。

| シナリオ | ダイアグラム | 長所 | 短所 |
| --- | --- | --- | --- |
| 1 つのサブネット、アプリケーション層ごとに、アプリごとに NSG |![1 つのサブネット](./media/virtual-network-vnet-plan-design-arm/figure5.png) |管理するサブネットは&1; つだけ。 |各アプリケーションを分離するために複数の NSG が必要。 |
| アプリごとに&1; つのサブネット、アプリケーション層ごとに NSG |![アプリごとのサブネット](./media/virtual-network-vnet-plan-design-arm/figure6.png) |管理する NSG が少なくなります。 |複数のサブネットを管理します。 |
| アプリケーション層ごとに&1; つのサブネット、アプリごとに NSG。 |![層ごとのサブネット](./media/virtual-network-vnet-plan-design-arm/figure7.png) |サブネットと NSG の数のバランスが取れます。 |サブスクリプションごとの NSG の最大数。 詳しくは、[Azure の制限](../azure-subscription-service-limits.md#networking-limits)に関する記事をご覧ください。 |
| アプリケーション層ごとに、アプリごとに&1; つのサブネット、サブネットごとに NSG |![層ごとに、アプリごとにサブネット](./media/virtual-network-vnet-plan-design-arm/figure8.png) |潜在的に NSG の数が少なくなります。 |複数のサブネットを管理します。 |

## <a name="sample-design"></a>サンプル設計
この記事の情報の応用例として、次のシナリオを検討してください。

あなたはデータセンターを北米に 2 棟、欧州に 2 棟所有する会社で働いています。 あなたは顧客に利用されている 6 つの異なるアプリケーションが 2 つの異なる事業単位で保守管理されていることを確認しました。あなたは試験的にそのアプリケーションを Azure に移行します。 アプリケーションの基本的なアーキテクチャは次のとおりです。

* App1、App2、App3、App4 は、Ubuntu を実行している Linux サーバーでホストされている Web アプリケーションです。 各アプリケーションは、Linux サーバーで RESTful サービスをホストする個々のアプリケーション サーバーに接続します。 RESTful サービスはバックエンド MySQL データベースに接続します。
* App5 と App6 は、Windows Server 2012 R2 を実行している Windows サーバーでホストされている Web アプリケーションです。 各アプリケーションはバックエンド SQL データベースに接続します。
* 現在、アプリはすべて北米にある会社のデータセンターの&1; つでホストされています。
* オンプレミスのデータ センターでは 10.0.0.0/8 名前空間が使用されます。

次の要件を満たす仮想ネットワーク ソリューションを設計する必要があります。

* いずれの事業単位も他の事業単位のリソース利用の影響を受けないようにする必要があります。
* VNet とサブネットの数を最小限に抑え、管理を簡単にする必要があります。
* いずれの事業単位も、すべてのアプリケーションに&1; つのテスト/開発 VNet を使用する必要があります。
* 各アプリケーションは、大陸 (北米と欧州) ごとに 2 つの異なる Azure データ センターでホストされます。
* 各アプリケーションは互いから完全に分離されます。
* 顧客は HTTP を使用したインターネット経由で各アプリケーションにアクセスできます。
* オンプレミスのデータ センターにアクセスできるユーザーは、暗号化トンネルを利用し、各アプリケーションにアクセスできます。
* オンプレミスのデータ センターへの接続には既存の VPN デバイスを使用する必要があります。
* 会社のネットワーク グループは VNet 構成を自由に利用できます。
* 各事業単位の開発者は既存のサブネットだけに VM をデプロイできるようにする必要があります。
* Azure に移行する場合と同じにすべてのアプリケーションは移行されます (リフトとシフト)。
* 各場所のデータベースは、1 日に&1; 回、他の Azure の場所に複製する必要があります。
* 各アプリケーションで 5 つのフロントエンド Web サーバー、2つのアプリケーション サーバー (必要な場合)、2 つのデータベース サーバーを使用する必要があります。

### <a name="plan"></a>プラン
「 [要件の定義](#Define-requirements) 」セクションの質問に以下のように回答し、設計計画を開始してください。

1. どの Azure の場所を VNet のホストに利用しますか。

    North America の 2 つの場所とヨーロッパでの 2 つの場所。 既存のオンプレミスのデータ センターの物理的場所に基づいて選択してください。 その方法により、物理的場所から Azure への接続で待ち時間が短くなります。
2. これらの Azure の場所の間で通信を提供する必要がありますか。

    はい。 データベースはすべての場所に複製する必要があります。
3. Azure VNet とオンプレミス データセンターの間で通信を提供する必要はありますか。

    はい。 オンプレミスのデータ センターにアクセスできるユーザーは暗号化トンネルを利用してアプリケーションにアクセスできなければならないからです。
4. ソリューションには IaaS VM がいくつ必要ですか。

    200 IaaS VM。 App1、App2、App3 は 5 つの Web サーバー、2 つアプリケーション サーバー、2 つのデータベース サーバーをそれぞれ必要とします。 アプリケーションあたり 9 つの IaaS VM が、合計で 36 の IaaS VM が必要になります。 App5 と App6 は 5 つの Web サーバーと 2 つのデータベース サーバーをそれぞれ必要とします。 アプリケーションあたり 7 つの IaaS VM が、合計で 14 の IaaS VM が必要になります。 そのため、Azure リージョンごとにすべてのアプリケーションのために 50 の IaaS VM が必要になります。 4 つのリージョンを使用する必要があるので、200 の IaaS VM が必要になります。

    また、各 VNet に、あるいはオンプレミスのデータ センターに DNS サーバーを用意し、Azure IaaS VM とオンプレミスのネットワークの間で名前を解決する必要があります。
5. VM のグループ (すなわち、フロントエンド Web サーバーとバックエンド データベース サーバー) に基づいてトラフィックを分離する必要はありますか。

    はい。 各アプリケーションは互いから完全に分離する必要があります。各アプリケーション層も分離する必要があります。
6. 仮想アプライアンスを利用してトラフィック フローを制御する必要がありますか。

    いいえ。 仮想アプライアンスを利用し、詳細なデータ プレーン ロギングなど、トラフィック フローをより細かく制御できます。
7. ユーザーには異なる Azure リソースにアクセスするために異なるアクセス許可セットが必要になりますか。

    はい。 ネットワーク チームは仮想ネットワーク設定を自由に変更できなければなりません。開発者には既存のサブネットに自分の VM をデプロイする権限だけを与えます。

### <a name="design"></a>設計
設計に基づき、サブスクリプション、VNet、サブネット、NSG を指定します。 ここで NSG について説明しますが、設計を完了する前に [NSG](virtual-networks-nsg.md) について詳しく知っておく必要があります。

**サブスクリプションと VNet の数**

次の要件はサブスクリプションと VNet に関連します。

* いずれの事業単位も他の事業単位のリソース利用の影響を受けないようにする必要があります。
* VNet とサブネットの数を最小限に抑える必要があります。
* いずれの事業単位も、すべてのアプリケーションに&1; つのテスト/開発 VNet を使用する必要があります。
* 各アプリケーションは、大陸 (北米と欧州) ごとに 2 つの異なる Azure データ センターでホストされます。

以上の要件に基づき、事業単位ごとにサブスクリプションが必要になります。 そのため、ある事業単位のリソースを利用して他の事業単位の上限に近づくことはありません。 VNet の数を最小限に抑えるのであれば、下のような「 **事業単位ごとに&1; つのサブスクリプション、アプリのグループごとに&2; つの VNet** 」のパターンを利用することを検討してください。

![1 つのサブスクリプション](./media/virtual-network-vnet-plan-design-arm/figure9.png)

VNet ごとにアドレス空間を指定する必要もあります。 オンプレミスのデータ センターと Azure リージョンの間に接続が必要になるため、Azure VNet に使用されるアドレス空間をオンプレミスのネットワークと競合させることはできません。各 VNet で使用されるアドレス空間を他の既存の VNet と競合させることもできません。 下の表のアドレス空間を利用すれば、以上の要件を満たせる場合があります。  

| **サブスクリプション** | **VNet** | **Azure のリージョン** | **アドレス空間** |
| --- | --- | --- | --- |
| BU1 |ProdBU1US1 |米国西部 |172.16.0.0/16 |
| BU1 |ProdBU1US2 |米国東部 |172.17.0.0/16 |
| BU1 |ProdBU1EU1 |北ヨーロッパ |172.18.0.0/16 |
| BU1 |ProdBU1EU2 |西ヨーロッパ |172.19.0.0/16 |
| BU1 |TestDevBU1 |米国西部 |172.20.0.0/16 |
| BU2 |TestDevBU2 |米国西部 |172.21.0.0/16 |
| BU2 |ProdBU2US1 |米国西部 |172.22.0.0/16 |
| BU2 |ProdBU2US2 |米国東部 |172.23.0.0/16 |
| BU2 |ProdBU2EU1 |北ヨーロッパ |172.24.0.0/16 |
| BU2 |ProdBU2EU2 |西ヨーロッパ |172.25.0.0/16 |

**サブネットと NSG の数**

次の要件はサブネットと NSG に関連します。

* VNet とサブネットの数を最小限に抑える必要があります。
* 各アプリケーションは互いから完全に分離されます。
* 顧客は HTTP を使用したインターネット経由で各アプリケーションにアクセスできます。
* オンプレミスのデータ センターにアクセスできるユーザーは、暗号化トンネルを利用し、各アプリケーションにアクセスできます。
* オンプレミスのデータ センターへの接続には既存の VPN デバイスを使用する必要があります。
* 各場所のデータベースは、1 日に&1; 回、他の Azure の場所に複製する必要があります。

以上の要件に基づき、アプリケーション層あたり&1; つのサブネットを利用し、NSG を利用してアプリケーション別にトラフィックをフィルター処理できます。 この方法で、VNet ごとにわずかに 3 つのサブネット (フロントエンド、アプリケーション、データ層) とサブネットごとにたった 1 つの NSG が与えられます。 この場合、「 **アプリケーション層ごとに&1; つのサブネット、アプリごとに NSG** 」の設計パターンを利用することを検討してください。 下の図では、 **ProdBU1US1** VNet を表す設計パターンが使用されています。

![層ごとに&1; つのサブネット、アプリケーションごとに、層ごとに&1; つの NSG](./media/virtual-network-vnet-plan-design-arm/figure11.png)

ただし、VNet とオンプレミスのデータ センターの間の VPN 接続のために追加のサブネットを作成する必要もあります。 また、サブネットごとにアドレス空間を指定する必要があります。 下の図は **ProdBU1US1** VNet のサンプル ソリューションを表しています。 このシナリオを VNet ごとに複製します。 それぞれの色は異なるアプリケーションを表します。

![サンプル VNet](./media/virtual-network-vnet-plan-design-arm/figure10.png)

**Access Control**

次の要件はアクセス制御に関連します。

* 会社のネットワーク グループは VNet 構成を自由に利用できます。
* 各事業単位の開発者は既存のサブネットだけに VM をデプロイできるようにする必要があります。

以上の要件に基づき、ネットワーク チームから各サブスクリプションに組み込まれている **ネットワークの共同作業者** にユーザーを追加し、各サブスクリプションでアプリケーション開発者にカスタム ロールを作成し、既存のサブネットに VM を追加する権限を与えることができます。

## <a name="next-steps"></a>次のステップ
* [仮想ネットワークをデプロイ](virtual-networks-create-vnet-arm-template-click.md) します。
* IaaS VM の[負荷を分散](../load-balancer/load-balancer-overview.md)し、[複数の Azure リージョンでルーティングを管理](../traffic-manager/traffic-manager-overview.md)する方法を理解します。
* [NSG の概要と NSG ソリューションの計画と設計の方法](virtual-networks-nsg.md) について詳しく学習します。
* [プレミス間と VNet の接続オプション](../vpn-gateway/vpn-gateway-about-vpngateways.md#site-to-site-and-multi-site-ipsecike-vpn-tunnel)について詳しく学習します。

