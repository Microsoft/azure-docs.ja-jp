---
title: Web サイトの可用性と応答性の監視 | Microsoft Docs
description: Application Insights で Web テストを設定します。 Web サイトが使用できなくなったり、応答速度が低下したりした場合に、アラートを受け取ります。
ms.topic: conceptual
ms.date: 09/16/2019
ms.reviewer: sdash
ms.openlocfilehash: 6f9c5fa691456195943f97419c1175fd5b586878
ms.sourcegitcommit: a76ff927bd57d2fcc122fa36f7cb21eb22154cfa
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/28/2020
ms.locfileid: "87310278"
---
# <a name="monitor-the-availability-of-any-website"></a>任意の Web サイトの可用性を監視する

お使いの Web アプリ/Web サイトをデプロイした後、繰り返されるテストを設定して、可用性と応答性を監視できます。 [ Application Insights](./app-insights-overview.md) は、世界各地の複数のポイントから定期的にアプリケーションに Web 要求を送信します。 お使いのアプリケーションが応答していない場合、または応答が遅すぎる場合は、アラートを受信できます。

可用性テストは、パブリック インターネットからアクセスできる任意の HTTP または HTTPS エンドポイントに対して設定できます。 テストする Web サイトに対して、何らかの変更を行う必要はありません。 実際には、自分が所有しているサイトである必要もありません。 サービスが依存している REST API の可用性をテストできます。

### <a name="types-of-availability-tests"></a>可用性テストの種類:

可用性テストには、次の 3 種類があります。

* [URL の Ping テスト](#create-a-url-ping-test): Azure Portal で作成できる簡単なテストです。
* [複数ステップ Web テスト](availability-multistep.md):一連の Web 要求の記録であり、さらに複雑なシナリオをテストするために再生できます。 複数ステップ Web テストは Visual Studio Enterprise で作成され、ポータルにアップロードされて実行されます。
* [カスタム可用性追跡テスト](/dotnet/api/microsoft.applicationinsights.telemetryclient.trackavailability?view=azure-dotnet):可用性テストを実行するカスタム アプリケーションを作成する場合は、`TrackAvailability()` メソッドを使用して Application Insights に結果を送信できます。

**Application Insights リソースごとに最大 100 個の可用性テストを作成できます。**

## <a name="create-an-application-insights-resource"></a>Application Insights リソースの作成

可用性テストを作成するためには、まず、Application Insights リソースを作成する必要があります。 リソースが既に作成されている場合は、次のセクションに進んで [URL Ping テストを作成](#create-a-url-ping-test)します。

Azure portal で、 **[リソースの作成]**  >  **[開発者ツール]**  >  **[Application Insights]** を選択し、[Application Insights リソースを作成](create-new-resource.md)します。

## <a name="create-a-url-ping-test"></a>URL の Ping テストを作成する

"URL ping テスト" という名前は、少し間違っています。 誤解のないように言うと、このテストでは、サイトの可用性をチェックするために ICMP (インターネット制御メッセージ プロトコル) は使用されません。 代わりに、より高度な HTTP 要求機能を使用して、エンドポイントが応答しているかどうかが検証されます。 さらに、その応答に関連付けられているパフォーマンスが測定され、依存する要求の解析などの高度な機能と結合されたカスタム成功基準を設定する機能が追加されて、再試行が可能になります。

最初の可用性要求を作成するには、[可用性] ウィンドウを開いて、 **[テストの作成]** を選択します。

![少なくとも自分の Web サイトの URL を入力](./media/monitor-web-app-availability/availability-create-test-001.png)

### <a name="create-a-test"></a>テストを作成する

|設定| 説明
|----|----|----|
|**URL** |  [URL] にはテストする任意の Web ページを指定できますが、パブリック インターネットからアクセス可能である必要があります。 URL にはクエリ文字列を含めることができます。 したがって、たとえば限られた範囲でデータベースを実行できます。 URL が解決されてリダイレクトする場合、それに続いて最大で 10 個リダイレクトを使用できます。|
|**依存する要求の解析**| テストでは、テスト対象の Web ページの一部である画像、スクリプト、スタイル ファイル、およびその他のファイルが要求されます。 記録される応答時間には、これらのファイルの取得にかかる時間が含まれます。 テスト全体のタイムアウト時間内にこれらすべてのリソースを正常にダウンロードできない場合、テストは失敗します。 このオプションがオンになっていない場合、テストからは指定した URL にあるファイルのみが要求されます。 このオプションを有効にすると、より厳密なチェックが行われます。 サイトを手動で参照しているときは気付かないことが原因でテストが失敗する場合があります。
|**再試行を有効にする**|テストが失敗した場合に、少し間を置いてテストを再試行します。 エラーは試行が 3 回連続で失敗した場合にのみ報告されます。 その後、後続のテストが通常のテスト間隔で実行されます。 再試行は、次の成功まで一時的に中断されます。 このルールがテスト場所ごとに独立して適用されます。 **このオプションはオンにすることをお勧めします**。 再試行の際に平均でエラーの約 80% がなくなります。|
|**テスト間隔**| 各テストの場所からテストを実行する頻度を設定します。 既定の間隔が 5 分で、テストの場所が 5 か所の場合、サイトは平均して毎分テストされます。|
|**テストの場所**| 指定の URL にサーバーによって Web 要求が送信される送信元の場所です。 Web サイトの問題とネットワークの問題とを確実に区別するために、**最低でもテストの場所を 5 か所にすることが推奨されます**。 最大 16 個の場所を選択できます。

**パブリック インターネットから指定の URL にアクセスできない場合は、テスト トランザクションのみが通過できるようにお使いのファイアウォールを選択的に開くことを選択できます**。 可用性テスト エージェント用のファイアウォールの例外について詳しくは、[IP アドレス ガイド](./ip-addresses.md#availability-tests)を参照してください。

> [!NOTE]
> 複数の場所 (**少なくとも 5 か所**) からテストを行うことを強くお勧めします。 これにより、特定の場所での一時的な問題による誤検知を防止します。 さらに、**テストの場所の数をアラートの場所のしきい値 + 2** にすると最適な構成になることがわかっています。

### <a name="success-criteria"></a>成功の基準

|設定| 説明
|----|----|----|
| **テストのタイムアウト** |この値を引き下げると、応答が遅い場合に警告されます。 テストは、この期間内にサイトから応答が返されない場合に、エラーとしてカウントされます。 **[従属要求の解析]** をオンにした場合、すべての画像、スタイル ファイル、スクリプト、その他依存するリソースがこの期間内に受信される必要があります。|
| **HTTP 応答** | 成功としてカウントされる、返される状態コード。 200 は、通常の Web ページが返されたことを示すコードです。|
| **コンテンツの一致** | "Welcome!" などの文字列。 それぞれの応答に大文字小文字を区別した完全一致があるかどうかをテストします。 文字列は、(ワイルドカードを含まない) プレーン文字列である必要があります。 ページ コンテンツが変更された場合は、この文字列も更新する必要がある可能性があることに注意してください。 **コンテンツの一致では、英語のみがサポートされています。** |

### <a name="alerts"></a>警告

|設定| 説明
|----|----|----|
|**準リアルタイム (プレビュー)** | 準リアルタイムのアラートを使用することが推奨されます。 この種類のアラートの構成は、可用性テストの作成後に実行されます。  |
|**クラシック** | 新しい可用性テストでクラシック アラートを使用することはもう推奨されていません。|
|**アラートの場所のしきい値**|少なくとも 3/5 の場所にすることをお勧めします。 アラートの場所のしきい値とテストの場所の数の最適な関係は、**アラートの場所のしきい値** = **テストの場所の数** - 2 です。テストの場所は、少なくとも 5 か所にします。|

## <a name="see-your-availability-test-results"></a>可用性テストの結果を表示する

可用性テストの結果は、折れ線グラフと散布図の両方で視覚化できます。

数分後に、 **[更新]** をクリックすると、テスト結果が表示されます。

![折れ線グラフ](./media/monitor-web-app-availability/availability-refresh-002.png)

散布図には、診断テスト手順の詳細が含まれたテスト結果のサンプルが表示されます。 テスト エンジンは、失敗したテストの診断の詳細を格納します。 成功したテストの場合、診断の詳細は実行のサブセットに対して格納されます。 緑色/赤色の点の上にポインターを置くと、テスト、テスト名、および場所が表示されます。

![折れ線グラフ](./media/monitor-web-app-availability/availability-scatter-plot-003.png)

特定のテスト、場所を選択するか、または期間を短くすると、目的の期間に関するより詳細な結果が表示されます。 Search エクスプローラーを使用してすべての実行の結果を表示するか、または分析クエリを使用してこのデータに対してカスタム レポートを実行します。

## <a name="inspect-and-edit-tests"></a>テストを調べて編集する

テストの編集、一時的な無効化、または削除を行うには、テスト名の横の省略記号をクリックします。 変更を行った後、すべてのテスト エージェントに構成の変更が反映されるまで、最大 20 分かかる可能性があります。

![テストの詳細を表示します。 Web テストの編集と無効化](./media/monitor-web-app-availability/edit.png)

サービスに対するメンテナンスを実行している間、関連付けられた可用性テストまたはアラート ルールを無効にすることもできます。

## <a name="if-you-see-failures"></a>エラーが発生した場合

赤い点をクリックします。

![赤い点をクリックします](./media/monitor-web-app-availability/open-instance-3.png)

可用性のテスト結果から、すべてのコンポーネントにわたるトランザクションの詳細を確認できます。 ここで、次のことを行うことができます。

* サーバーから受信した応答を調べる。
* 失敗した可用性テストの処理中に収集された、サーバー側の相関関係を持つテレメトリを使用してエラーを診断する。
* 懸案や作業の項目を Git または Azure Boards に記録して問題を追跡する。 バグには、このイベントへのリンクが含まれます。
* Visual Studio で Web テスト結果を開く。

エンドツーエンドのトランザクションの診断エクスペリエンスの詳細については、[こちら](./transaction-diagnostics.md)を参照してください。

例外の行をクリックすると、代理可用性テストが失敗した原因であるサーバー側の例外の詳細が表示されます。 コード レベルの豊富な診断の [デバッグ スナップショット](./snapshot-debugger.md)を取得することもできます。

![サーバー側診断](./media/monitor-web-app-availability/open-instance-4.png)

生の結果に加えて、[メトリックス エクスプローラー](../platform/metrics-getting-started.md)に 2 つの重要な可用性メトリックを表示することもできます。

1. 可用性:すべてのテスト実行にわたる、成功したテストの割合 (%)。
2. テスト期間:すべてのテスト実行にわたる平均のテスト期間。

## <a name="automation"></a>Automation

* [PowerShell スクリプトを使用して、可用性テストを自動的に設定します](./powershell.md#add-an-availability-test)。
* アラートが発生したときに呼び出される [webhook](../platform/alerts-webhooks.md) を設定する。

## <a name="troubleshooting"></a>トラブルシューティング

専用の[トラブルシューティングに関する記事](troubleshoot-availability.md)をご覧ください。

## <a name="next-steps"></a>次のステップ

* [可用性のアラート](availability-alerts.md)
* [複数ステップ Web テスト](availability-multistep.md)

