---
title: Azure Active Directory B2C でのトークン、セッション、シングル サインオンの構成 | Microsoft Docs
description: Azure Active Directory B2C でのトークン、セッション、シングル サインオンの構成。
services: active-directory-b2c
author: davidmu1
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 11/30/2018
ms.author: davidmu
ms.subservice: B2C
ms.openlocfilehash: d1acdb8b5d0054f1dffd1014a350540b6de40d75
ms.sourcegitcommit: d3200828266321847643f06c65a0698c4d6234da
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/29/2019
ms.locfileid: "55171509"
---
# <a name="token-session-and-single-sign-on-configuration-in-azure-active-directory-b2c"></a>Azure Active Directory B2C でのトークン、セッション、シングル サインオンの構成

この機能を使用すると、[個別のユーザー フローに基づいて](active-directory-b2c-reference-policies.md)、以下の対象をきめ細かく制御することができます。

- Azure Active Directory (Azure AD) B2C が出力するセキュリティ トークンの有効期間。
- Azure AD B2C によって管理される Web アプリケーションのセッションの有効期間。
- Azure AD B2C が出力するセキュリティ トークンの重要な要求の形式。
- Azure AD B2C テナント内の複数のアプリとユーザー フローにまたがるシングル サインオン (SSO) の動作。

この機能は任意の種類のポリシーに対して使用できますが、この例は、この機能をサインアップまたはサインイン ユーザー フローと共に使用する方法を示しています。 ユーザー フローでは、この機能を次のように Azure AD B2C ディレクトリで使用できます。

1. **[User Flows]** をクリックします。
2. ユーザー フローをクリックして開きます。 たとえば、**[B2C_1_SiUpIn]** をクリックします。
3. **[プロパティ]** をクリックします。
4. **[トークンの互換性設定]** で、必要な変更を行います。 後のセクションに、利用できるプロパティの説明があります。
5. メニューの上部で **[保存]** をクリックします。

## <a name="token-lifetimes-configuration"></a>トークンの有効期間の構成

Azure AD B2C は保護されたリソースへの安全なアクセスを実現する [OAuth 2.0 認証プロトコル](active-directory-b2c-reference-protocols.md) をサポートしています。 このサポートを実施するために、Azure AD B2C は各種の [セキュリティ トークン](active-directory-b2c-reference-tokens.md)を発行します。 

次のプロパティは、Azure AD B2C によって出力されたセキュリティ トークンの有効期間を管理するために使用されます。

- **[アクセスと ID トークンの有効期間 (分)]** - 保護されたリソースへのアクセスを取得するために使用される OAuth 2.0 ベアラー トークンの有効期間。
    - 既定値 = 60 分。
    - 最小値 (この値を含む) = 5 分。
    - 最大値 (この値を含む) = 1,440 分。
- **[更新トークンの有効期間 (日)]** - 更新トークンを使用して新しいアクセスまたは ID トークン (およびオプションで、アプリケーションに `offline_access` スコープが付与されている場合は新しい更新トークン) を取得できる最長期間。
    - 既定値 = 14 日。
    - 最小値 (この値を含む) = 1 日。
    - 最大値 (この値を含む) = 90 日。
- **[更新トークンのスライディング ウィンドウの有効期間 (日)]** - この期間が経過すると、アプリケーションによって取得された最新の更新トークンの有効期間には関係なく、ユーザーは強制的に再認証を求められます。 スイッチが **[制限あり]** の場合にのみ、この設定が可能です。 **[Refresh token lifetime (days) (更新トークン有効期間 (日))]** の値以上であることが必要です。 スイッチが **[制限なし]** の場合は、特定の値を設定できません。
    - 既定値 = 90 日。
    - 最小値 (この値を含む) = 1 日。
    - 最大値 (この値を含む) = 365 日。

次のユースケースは、これらのプロパティを使用して有効になります。

- ユーザーがモバイル アプリケーションで継続的にアクティブである限り、そのユーザーがそのアプリケーションへのサインインを無期限に維持できるようにします。 サインイン ユーザー フローで **[更新トークンのスライディング ウィンドウの有効期間 (日)]** を **[Unbounded]\(制限なし\)** に設定できます。
- 適切なアクセス トークン有効期間を設定して、業界のセキュリティ要件やコンプライアンス要件を満たすことができます。

これらの設定は、パスワード リセット ユーザー フローでは使用できません。 

## <a name="token-compatibility-settings"></a>トークンの互換性の設定

次のプロパティは、顧客が必要に応じて選択できます。

- **[発行者 (iss) 要求]** - このプロパティは、トークンを発行した Azure AD B2C テナントを識別します。
    - `https://<domain>/{B2C tenant GUID}/v2.0/` - これが既定値です。
    - `https://<domain>/tfp/{B2C tenant GUID}/{Policy ID}/v2.0/` - この値には、B2C テナントと、トークン要求で使用されるユーザー フローの両方の ID が含まれています。 アプリまたはライブラリで Azure AD B2C を [OpenID Connect Discovery 1.0 仕様](https://openid.net/specs/openid-connect-discovery-1_0.html)に準拠させる必要がある場合は、この値を使用します。
- **[サブジェクト (sub) 要求]** - このプロパティは、トークンが情報をアサートするエンティティを識別します。
    - **[ObjectID]** - このプロパティが既定値です。 ディレクトリ内のユーザーのオブジェクト ID を、トークンの `sub` 要求に設定します。
    - **[サポートされていません]** - このプロパティは下位互換性のためにのみ提供されており、できるだけ早く **[ObjectID]** に切り替えることをお勧めします。
- **[ポリシー ID を表す要求]** - このプロパティは、トークン要求で使用されるポリシー ID に設定される要求の種類を識別します。
    - **[tfp]** - このプロパティが既定値です。
    - **[acr]** - このプロパティは下位互換性のためにのみ提供されています。

## <a name="session-behavior"></a>セッションの動作

Azure AD B2C がサポートしている [OpenID Connect 認証プロトコル](active-directory-b2c-reference-oidc.md) を使用して、Web アプリケーションへの安全なサインインを実現できます。 次のプロパティを使用して、Web アプリケーション セッションを管理できます。

- **[Web アプリのセッションの有効期間 (分)]** - 認証の成功時にユーザーのブラウザーに格納される Azure AD B2C のセッション Cookie の有効期間。
    - 既定値 = 1,440 分。
    - 最小値 (この値を含む) = 15 分。
    - 最大値 (この値を含む) = 1,440 分。
- **[Web アプリのセッション タイムアウト]** - このスイッチが **[絶対]** に設定されている場合は、**[Web アプリのセッションの有効期間 (分)]** によって指定されている期間が経過すると、ユーザーは強制的に再び認証を求められます。 このスイッチを **[ローリング]** (既定値) に設定すると、ユーザーが Web アプリケーションでアクティブな状態を継続している限り、そのユーザーのサインインは継続されます。

次のユースケースは、これらのプロパティを使用して有効になります。

- 適切な Web アプリケーション セッション有効期間を設定して、業界のセキュリティ要件やコンプライアンス要件を満たすことができます。
- ユーザーが Web アプリケーションのセキュリティの高い部分と対話している間に設定された期間が経過すると、強制的に認証を求めます。 

これらの設定は、パスワード リセット ユーザー フローでは使用できません。

## <a name="single-sign-on-sso-configuration"></a>シングル サインオン (SSO) の構成

B2C テナントで複数のアプリケーションやユーザー フローを運用している場合は、**シングル サインオン構成**プロパティを使用して、それらの間でのユーザーの操作を管理できます。 以下のいずれかのプロパティを設定することができます。

- **[テナント]** - この設定が既定値です。 この設定を使用すると、B2C テナント内の複数のアプリケーションとユーザー フローで同じユーザー セッションを共有できます。 たとえば、ユーザーがあるアプリケーションにサインインすると、そのユーザーは別のアプリケーション Contoso Pharmacy にもシームレスにサインインしてアクセスできます。
- **[アプリケーション]** - この設定により、ユーザー セッションをあるアプリケーションに対して、他のアプリケーションとは独立に排他的に維持できます。 たとえば、あるユーザーが既に Contoso Shopping にサインインしている場合でも、そのユーザーが同じ B2C テナント上の別のアプリケーションである Contoso Pharmacy に (同じ資格情報で) サインインするようにできます。 
- **[ポリシー]** - この設定により、ユーザー セッションをあるポリシーに対して、そのユーザー フローを使用するアプリケーションとは独立に排他的に維持できます。 たとえば、あるユーザーが既にサインインし、多要素認証 (MFA) の手順を完了している場合は、ユーザー フローに関連付けられたセッションが期限切れになっていない限り、そのユーザーは複数のアプリケーションのよりセキュリティの高い部分にアクセスできます。
- **[無効]** - この設定は、ユーザー フローを実行するたびに、ユーザーにユーザー体験全体を強制的に実行させます。 これにより、たとえば (共有デスクトップのシナリオで)、1 人のユーザーがアプリケーションへのサインインを終始継続していても、複数のユーザーがそのアプリケーションにサインインすることができます。

これらの設定は、パスワード リセット ユーザー フローでは使用できません。 

