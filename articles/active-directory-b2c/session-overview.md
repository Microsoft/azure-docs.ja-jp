---
title: Azure Active Directory B2C での SSO セッション | Microsoft Docs
description: Azure Active Directory B2C でセッションの動作を構成します。
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 05/07/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: ea8c40faad4ee709ae98f868e36fd42e46501bea
ms.sourcegitcommit: a6d477eb3cb9faebb15ed1bf7334ed0611c72053
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/08/2020
ms.locfileid: "82927039"
---
# <a name="azure-ad-b2c-session"></a>Azure AD B2C のセッション

シングル サインオン (SSO) によって、ユーザーが Azure Active Directory B2C (Azure AD B2C) のアプリケーションにサインインするときのセキュリティと利便性が向上します。 この記事では、Azure AD B2C で使用されるシングル サインオンの方法について説明します。ポリシーを構成するときに最適な SSO 方法を選択するのに役立ちます。

シングル サインオンを使用すると、ユーザーは 1 つのアカウントで 1 回サインインするだけで、複数のアプリケーションにアクセスできます。 アプリケーションは、Web、モバイル、シングル ページのどのアプリケーションでもよく、プラットフォームまたはドメイン名には関係ありません。

ユーザーが初めてアプリケーションにサインインしたときに、Azure AD B2C によって Cookie ベースのセッションが保持されます。 それ以降の認証要求では、Azure AD B2C によって Cookie ベースのセッションが読み取られて検証され、アクセス トークンが発行されます。ユーザーにサインインを求めるメッセージが再び表示されることはありません。 Cookie ベースのセッションが有効期限切れまたは無効になった場合、ユーザーはもう一度サインインするように求められます。  

## <a name="sso-session-types"></a>SSO セッションの種類

Azure AD B2C との統合には、次の 3 種類の SSO セッションが含まれます。

- **Azure AD B2C** - Azure AD B2C によって管理されるセッション
- **フェデレーション ID プロバイダー** - ID プロバイダー (Facebook、Salesforce、Microsoft アカウントなど) によって管理されるセッション
- **アプリケーション** - Web アプリケーション、モバイル アプリケーション、またはシングル ページ アプリケーションによって管理されるセッション

![SSO セッション](media/session-overview/sso-session-types.png)

### <a name="azure-ad-b2c-sso"></a>Azure AD B2C の SSO 

ユーザーがローカル アカウントまたはソーシャル アカウントでの認証に成功すると、Azure AD B2C によって Cookie ベースのセッションがユーザーのブラウザーに保存されます。 Cookie は、Azure AD B2C テナントのドメイン名 (`https://contoso.b2clogin.com` など) の下に格納されます。

ユーザーが最初にフェデレーション アカウントを使用してサインインした後、セッション時間枠 (Time to Live (TTL)) の間に同じアプリまたは別のアプリにサインインすると、Azure AD B2C によってフェデレーション ID プロバイダーから新しいアクセス トークンの取得が試みられます。 フェデレーション ID プロバイダー セッションが有効期限切れまたは無効になった場合、ユーザーはフェデレーション ID プロバイダーから資格情報の入力を求められます。 セッションがまだアクティブになっている場合は (または、ユーザーがフェデレーション アカウントではなくローカル アカウントを使用してサインインしている場合)、Azure AD B2C によってユーザーが承認され、それ以上のプロンプトは表示されません。

セッションの TTL や、Azure AD B2C によりポリシーやアプリケーション間でセッションが共有される方法など、セッションの動作を構成できます。

### <a name="federated-identity-provider-sso"></a>フェデレーション ID プロバイダーの SSO

ソーシャルまたはエンタープライズ ID プロバイダーにより、独自のセッションが管理されます。 Cookie は、ID プロバイダーのドメイン名 (`https://login.salesforce.com` など) の下に格納されます。 Azure AD B2C では、フェデレーション ID プロバイダーのセッションは制御されません。 代わりに、セッションの動作はフェデレーション ID プロバイダーによって決定されます。 

以下のシナリオについて考えてみます。

1. ユーザーが Facebook にサインインして、フィードを確認します。
2. その後、ユーザーがアプリケーションを開き、サインイン プロセスを開始します。 アプリケーションでは、ユーザーを Azure AD B2C にリダイレクトして、サインイン プロセスを完了します。
3. Azure AD B2C のサインアップ ページまたはサインイン ページで、ユーザーは Facebook アカウントでのサインインを選択します。 ユーザーは Facebook にリダイレクトされます。 Facebook にアクティブなセッションがある場合、ユーザーは資格情報の入力を求められることはなく、Facebook のトークンを使用して Azure AD B2C に直ちにリダイレクトされます。

### <a name="application-sso"></a>アプリケーション SSO

Web アプリケーション、モバイル アプリケーション、またはシングル ページ アプリケーションは、OAuth アクセス、ID トークン、または SAML トークンによって保護できます。 ユーザーがアプリの保護されたリソースにアクセスしようとすると、アプリケーション側にアクティブなセッションがあるかどうかが、アプリによって確認されます。 アプリのセッションがない場合、またはセッションの有効期限が切れている場合、アプリによりユーザーは Azure AD B2C のサインイン ページに移動されます。

アプリケーションのセッションは、アプリケーション ドメイン名 (`https://contoso.com` など) の下に格納されている Cookie ベースのセッションでもかまいません。 モバイル アプリケーションでは、セッションの格納方法が異なる場合がありますが、同様のアプローチが使用されます。

## <a name="azure-ad-b2c-session-configuration"></a>Azure AD B2C セッションの構成

### <a name="session-scope"></a>セッション スコープ

Azure AD B2C のセッションは、次のスコープで構成できます。

- **[テナント]** - この設定が既定値です。 この設定を使用すると、B2C テナント内の複数のアプリケーションとユーザー フローで同じユーザー セッションを共有できます。 たとえば、ユーザーがあるアプリケーションにサインインすると、そのユーザーは別のアプリケーションにもシームレスにサインインしてアクセスできます。
- **[アプリケーション]** - この設定により、ユーザー セッションをあるアプリケーションに対して、他のアプリケーションとは独立に排他的に維持できます。 たとえば、ユーザーが Contoso Groceries に既にサインインしているかどうかに関係なく、Contoso Pharmacy にサインインできるようにする場合は、この設定を使用できます。
- **[ポリシー]** - この設定により、ユーザー セッションをあるポリシーに対して、そのユーザー フローを使用するアプリケーションとは独立に排他的に維持できます。 たとえば、あるユーザーが既にサインインし、多要素認証 (MFA) の手順を完了している場合は、ユーザー フローに関連付けられたセッションが期限切れになっていない限り、そのユーザーは複数のアプリケーションのよりセキュリティの高い部分にアクセスできます。
- **[無効]** - この設定は、ユーザー フローを実行するたびに、ユーザーにユーザー体験全体を強制的に実行させます。

### <a name="session-life-time"></a>セッションの有効期間

**セッションの有効期間**は、認証が成功した後で、ユーザーのブラウザーに Azure AD B2C セッション Cookie が格納されている時間の長さです。 セッションの有効期間は、15 から 720 分の範囲の値に設定できます。

### <a name="keep-me-signed-in"></a>サインインしたままにする

[サインインしたままにする](custom-policy-keep-me-signed-in.md)機能を使うと、永続的な Cookie を使用することにより、セッションの有効期間が延長されます。 ユーザーがブラウザーを閉じてから再度開いた後も、セッションはアクティブのままになります。 セッションは、ユーザーがサインアウトしたときにのみ取り消されます。サインインしたままにする機能は、ローカル アカウントでのサインインにのみ適用されます。

サインインしたままにする機能は、セッションの有効期間より優先されます。 サインインしたままにする機能が有効になっていて、ユーザーがそれを選択した場合、この機能によって、セッションの有効期限が指定されます。 

### <a name="session-expiry-type"></a>セッションの有効期限の種類

**セッションの有効期限の種類**では、セッションの有効期間の設定または "サインインしたままにする" 設定によってセッションがどのように拡張されるかが示されます。

- **[ローリング]** - ユーザーが Cookie ベースの認証 (既定) を実行するたびにセッションが延長されることを示します。
- **[絶対]** - 指定した時間が経過した後、再認証がユーザーに強制されることを示します。

## <a name="sign-out"></a>サインアウト

ユーザーをアプリケーションからサインアウトさせるときは、アプリケーションの Cookie を消去する、あるいはユーザーとのセッションを終了するだけでは十分ではありません。 サインアウトさせるには、ユーザーを Azure AD B2C にリダイレクトする必要があります。そうしないと、ユーザーは資格情報を再入力しなくても、アプリケーションに対する再認証を行うことができる場合があります。

サインアウト要求時に、Azure AD B2C では次のことが行われます。

1. Azure AD B2C の Cookie ベースのセッションが無効にされます。
1. フェデレーション ID プロバイダーからのサインアウトが試みられます。
   - OpenID Connect - ID プロバイダーの既知の構成エンドポイントで `end_session_endpoint` の場所が指定されている場合。
   - SAML - ID プロバイダーのメタデータに `SingleLogoutService` の場所が含まれている場合。
1. 必要に応じて、他のアプリケーションからのサインアウトが行われます。 詳しくは、「[シングル サインアウト](#single-sign-out)」セクションをご覧ください。

サインアウトにより、Azure AD B2C でのユーザーのシングル サインオン状態はクリアされますが、ユーザーはソーシャル ID プロバイダーのセッションからサインアウトされない場合があります。 ユーザーは、その後のサインインで同じ ID プロバイダーを選択した場合、資格情報を入力しなくても再び認証される可能性があります。 ユーザーがアプリケーションからサインアウトしようとする場合、そのユーザーは必ずしも自分の Facebook アカウントからサインアウトしようとしているとは限りません。 ただし、ローカル アカウントを使用している場合、ユーザーのセッションは正常に終了します。

### <a name="single-sign-out"></a>シングル サインアウト 


> [!NOTE]
> この機能は [カスタム ポリシー](custom-policy-overview.md)に限定されています。

Azure AD B2C のサインアウト エンドポイントにユーザーをリダイレクトすると (OAuth2 と SAML プロトコルの両方)、Azure AD B2C によってユーザーのセッションがブラウザーからクリアされます。 ただし、ユーザーは認証に Azure AD B2C を使用する他のアプリケーションにサインインしたままになることがあります。 それらのアプリケーションでユーザーを同時にサインアウトできるように、Azure AD B2C では、ユーザーが現在サインインしているすべてのアプリケーションの登録済み `LogoutUrl` に、HTTP GET 要求が送信されます。


アプリケーションは、ユーザーを識別するすべてのセッションを消去し、`200` 応答を返すことで、この要求に応答する必要があります。 アプリケーションでシングル サインアウトをサポートする場合は、アプリケーションのコードで `LogoutUrl` を実装する必要があります。 

## <a name="next-steps"></a>次のステップ

- [ユーザー フローでセッションの動作を構成する](session-behavior.md)方法を学習します。
- [カスタム ポリシーでセッションの動作を構成する](session-behavior-custom-policy.md)方法を学習します。