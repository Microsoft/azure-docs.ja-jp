---
title: Azure AD 属性マッピングのカスタマイズ | Microsoft Docs
description: Azure Active Directory における SaaS アプリの属性マッピングとは何かと、この属性マッピングをビジネス ニーズに合わせて変更する方法について説明します。
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 04/03/2019
ms.author: mimart
ms.collection: M365-identity-device-management
ms.openlocfilehash: ef3d6a47986056925f9964638c9c7192341ca5f9
ms.sourcegitcommit: 824e3d971490b0272e06f2b8b3fe98bbf7bfcb7f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/10/2019
ms.locfileid: "72240989"
---
# <a name="customizing-user-provisioning-attribute-mappings-for-saas-applications-in-azure-active-directory"></a>Azure Active Directory の SaaS アプリケーションに対するユーザー プロビジョニング属性マッピングのカスタマイズ

Microsoft Azure AD では、Salesforce、G Suite、およびその他のサードパーティの SaaS アプリケーションへのユーザー プロビジョニングのサポートを提供します。 サード パーティの SaaS アプリケーションでユーザー プロビジョニングを有効にした場合、Azure portal では属性マッピングによってその属性値を管理します。

Azure AD ユーザー オブジェクトと各 SaaS アプリのユーザー オブジェクトの間には、構成済みの一連の属性と属性マッピングが存在します。 アプリによっては、ユーザーに加えてグループなど他の種類のオブジェクトを管理するものもあります。

既定の属性マッピングをビジネスのニーズに合わせてカスタマイズできます。 そのため、既存の属性マッピングを変更、削除したり、新規の属性マッピングを作成したりすることができます。

## <a name="editing-user-attribute-mappings"></a>ユーザー属性マッピングの編集

次の手順に従って、ユーザー プロビジョニングの**マッピング**機能にアクセスします。

1. [Azure Active Directory portal](https://aad.portal.azure.com) にサインインします。
1. 左側のウィンドウで、 **[エンタープライズ アプリケーション]** を選択します。 ギャラリーから追加されたアプリを含む、構成済みのすべてのアプリの一覧が表示されます。
1. 任意のアプリを選択し、そのアプリの管理ウィンドウを読み込み、そこでレポートを表示したり、アプリの設定を管理したりできます。
1. 選択したアプリのユーザー アカウントのプロビジョニング設定を管理するには、 **[プロビジョニング]** を選択します。
1. **[マッピング]** を展開し、Azure AD とターゲット アプリケーションの間でフローするユーザー属性を表示および編集します。 ターゲット アプリケーションが対応していれば、必要に応じてグループのプロビジョニングとユーザー アカウントをこのセクションで構成することができます。

   ![[マッピング] を使用して、ユーザー属性を表示および編集する](./media/customize-application-attributes/21.png)

1. **[マッピング]** 構成を選択して、関連する **[属性マッピング]** 画面を開きます。 SaaS アプリケーションが正常に機能するために、いくつかの属性マッピングが必要です。 必須の属性の場合は、 **[削除]** 機能を使用できません。

   ![[属性マッピング] を使用して、アプリの属性マッピングを構成する](./media/customize-application-attributes/22.png)

   このスクリーンショットで、Salesforce の管理オブジェクトの **Username** 属性には、リンクされている Azure Active Directory オブジェクトの **userPrincipalName** 値が設定されています。

1. 既存の **[属性マッピング]** を選択し、 **[属性の編集]** 画面を開きます。 ここで、Azure AD とターゲット アプリケーションの間でフローするユーザー属性を表示および編集できます。

   ![[属性の編集] を使用して、ユーザー属性を編集する](./media/customize-application-attributes/23.png)

### <a name="understanding-attribute-mapping-types"></a>属性マッピングの種類の概要

属性マッピングでは、サード パーティの SaaS アプリケーションに属性を設定する方法を管理します。
次の 4 つの異なるマッピングの種類がサポートされます。

- **直接** - ターゲットの属性に、Azure AD でリンクされているオブジェクトの属性値を設定します。
- **定数** – ターゲットの属性に、指定した特定の文字列を設定します。
- **式** - ターゲットの属性を、スクリプトのような式の結果に基づいて設定します。
  詳細については、「[Azure Active Directory における属性マッピングの式の書き方](functions-for-customizing-application-data.md)」を参照してください。
- **なし** - ターゲットの属性を変更しません。 ただし、ターゲットの属性が空の場合は、指定した既定値が設定されます。

これら 4 つの基本的な種類とともに、カスタム属性マッピングではオプションの**既定**値の割り当てという概念をサポートします。 既定値の割り当てでは、Azure AD にもターゲット オブジェクトにも値がない場合にも、ターゲットの属性には必ず値が設定されます。 最も一般的な構成では、これを空白のままにします。

### <a name="understanding-attribute-mapping-properties"></a>属性マッピングのプロパティの概要

前のセクションでは、属性マッピングの種類プロパティについて紹介しました。
属性マッピングは、このプロパティと共に次の属性もサポートしています。

- **ソース属性** - ソース システムのユーザー属性 (例:Azure Active Directory)。
- **対象の属性** - ターゲット システムのユーザー属性 (例:できます。
- **この属性を使用してオブジェクトを照合する** - このマッピングを使用して、ソースとターゲットのシステム間でユーザーを一意に識別するかどうかを示します。 通常、これは Azure AD の userPrincipalName または mail 属性で設定され、一般的にターゲット アプリケーションのユーザー名フィールドにマップされます。
- **照合の優先順位** - 一致させる属性を複数設定できます。 複数の場合は、このフィールドで定義された順序で評価されます。 1 件でも一致が見つかると、一致する属性の評価はそれ以上行われません。
- **このマッピングを適用する**
  - **常に** - このマッピングをユーザーの作成と更新の両方のアクションに適用します。
  - **作成中のみ** - このマッピングをユーザーの作成アクションのみに適用します。

## <a name="editing-group-attribute-mappings"></a>グループ属性マッピングの編集

ServiceNow、Box、G Suite などいくつかのアプリケーションでは、グループ オブジェクトとユーザー オブジェクトをプロビジョニングする機能がサポートされています。 グループ オブジェクトには、グループ メンバーと共に表示名や電子メール別名などのグループ プロパティを含めることができます。

![ServiceNow のプロビジョニング済みグループ オブジェクトとユーザー オブジェクトが表示されている例](./media/customize-application-attributes/24.png)

グループのプロビジョニングは必要に応じて有効と無効を切り替えることができます。これには、 **[属性マッピング]** 画面の **[マッピング]** の下でグループ マッピングを選択し、必要なオプションに **[有効]** を設定します。

グループ オブジェクトの一部としてプロビジョニングされる属性は、前に説明したユーザー オブジェクトの場合と同じ方法でカスタマイズできます。 

> [!TIP]
> グループ オブジェクト (プロパティとメンバー) のプロビジョニングは、アプリケーションへの[グループの割り当て](assign-user-or-group-access-portal.md)とは異なる概念です。 グループをアプリケーションに割り当てることができますが、プロビジョニングできるのはグループに含まれるユーザー オブジェクトのみです。 グループ オブジェクト全体のプロビジョニングは、割り当てでグループを使用するためには必要ありません。

## <a name="editing-the-list-of-supported-attributes"></a>サポートされている属性一覧の編集

特定のアプリケーションでサポートされるユーザー属性は事前に構成されています。 ほとんどのアプリケーションのユーザー管理 API ではスキーマ検出がサポートされていません。 そのため、Azure AD プロビジョニング サービスは、アプリケーションを呼び出して、サポートされる属性の一覧を動的に生成することができません。

ただし、一部のアプリケーションではカスタム属性がサポートされ、Azure AD プロビジョニング サービスではカスタム属性の読み取りと書き込みができます。 それらの定義を Azure portal に入力するには、 **[属性マッピング]** 画面の一番下にある **[詳細オプションの表示]** チェック ボックスを選択し、アプリの **[Edit attribute list for]** (属性リストの編集) を選択します。

属性一覧のカスタマイズをサポートするアプリケーションとシステムには次のものが含まれます。

- Salesforce
- ServiceNow
- Workday
- Azure Active Directory ([Azure AD Graph API の既定の属性](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity)とカスタム ディレクトリ拡張機能がサポートされる)
- [SCIM 2.0](https://tools.ietf.org/html/rfc7643) をサポートするアプリ ([コア スキーマ](https://tools.ietf.org/html/rfc7643)に定義された属性を追加する必要がある)

> [!NOTE]
> サポートされている属性一覧の編集は、アプリケーションとシステムのスキーマをカスタマイズし、カスタム属性がどのように定義されたかを直接知っている管理者のみにお勧めします。 場合によっては、アプリケーションやシステムで提供される API および開発者ツールに慣れている必要があります。

サポートされている属性の一覧を編集するときは、次のプロパティが表示されます。

- **[名前]** - ターゲット オブジェクトのスキーマで定義されている属性のシステム名。
- **[型]** - ターゲット オブジェクトのスキーマで定義されている、属性が格納するデータの型。次のいずれかの型になります。
  - *Binary* - 属性にはバイナリ データが含まれます。
  - *Boolean* - 属性には True または False 値が含まれます。
  - *DateTime* - 属性には日付文字列が含まれます。
  - *Integer* - 属性には整数が含まれます。
  - *Reference* - 属性には、ターゲット アプリケーションの別のテーブルに格納されている値を参照するための ID が含まれます。
  - *String*  - 属性にはテキスト文字列が含まれます。
- **[Primary Key?]\(主キー\)** - ターゲット オブジェクトのスキーマで属性が主キー フィールドとして定義されているかどうか。
- **必須** - ターゲット アプリケーションまたはシステムに属性を移入する必要があるかどうか。
- **[Multi-value?]\(複数値\)** - 属性が複数値をサポートするかどうか。
- **[Exact case?]\(大文字小文字の区別\)** - 大文字と小文字を区別して属性値を評価するかどうか。
- **[API 式]** - 特定のプロビジョニング コネクタ (Workday など) のドキュメントで指示されていない限り、使用しないでください。
- **[Referenced Object Attribute]** (参照オブジェクト属性) - これが Reference 型属性の場合は、このメニューを使用して、この属性に関連付けられている値を含むターゲット アプリケーションのテーブルと属性を選択できます。 たとえば、"Department" という名前の属性があるとき、そこに格納されている値が別の "Departments" テーブルのオブジェクトを参照する場合は、"Departments.Name" を選択します。 特定のアプリケーションでサポートされる参照テーブルとプライマリ ID フィールドは事前に構成されます。現在、Azure portal を使用して編集することはできませんが、[Graph API](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-configure-with-custom-target-attributes) を使用すると編集できます。

新しい属性を追加するには、サポートされる属性一覧の最後までスクロールしてから、提供された入力値を使用して上のフィールドを設定し、 **[属性の追加]** を選択します。 属性の追加が終了したら、 **[保存]** を選択します。 新しい属性を属性マッピング エディターで使用できるようにするには、 **[プロビジョニング]** タブをリロードする必要があります。

## <a name="restoring-the-default-attributes-and-attribute-mappings"></a>既定の属性と属性マッピングの復元

最初からやり直すために、既存のマッピングを既定の状態にリセットする必要がある場合は、 **[既定のマッピングを復元する]** チェック ボックスをオンにして構成を保存します。 そうすると、アプリケーションがアプリケーション ギャラリーから Azure AD テナントに追加された直後のようにすべてのマッピングが設定されます。

このオプションを選択すると、プロビジョニング サービスを実行している際に、すべてのユーザーの再同期が実際に強制されます。

> [!IMPORTANT]
> このオプションを使用する前に、 **[サービス提供の状況]** を **[オフ]** に設定することを強くお勧めします。

## <a name="what-you-should-know"></a>知っておくべきこと

- Microsoft Azure AD では、同期プロセスの効率的な実装を提供します。 初期化された環境では、更新が必要なオブジェクトのみが同期サイクル中に処理されます。
- 属性マッピングの更新は、同期サイクルのパフォーマンスに影響を与えます。 属性マッピングの構成を更新するには、すべての管理オブジェクトを再評価する必要があります。
- 推奨されるベスト プラクティスとして、属性マッピングに対する連続的な変更の回数は最小限に抑えてください。
- 写真を同期する形式は指定できないので、プロビジョニングする写真属性のアプリへの追加は、現在サポートされていません。 [ユーザーの声](https://feedback.azure.com/forums/169401-azure-active-directory)に関するページで機能の要求をお送りください
- IsSoftDeleted 属性は、多くの場合、アプリケーションの既定のマッピングに含まれます。 IsSoftDeleted は 4 つのシナリオ (アプリケーションから割り当てられていないためユーザーがスコープ外になっている、スコープ フィルターを満たしていないためユーザーがスコープ外になっている、Azure AD でユーザーが論理的に削除されている、AccountEnabled プロパティがユーザーに対して false に設定されている) のいずれかで true にすることができます。 
- Azure AD プロビジョニング サービスでは、null 値のプロビジョニングがサポートされていません

## <a name="next-steps"></a>次の手順

- [Azure Active Directory による SaaS アプリへのユーザー プロビジョニングとプロビジョニング解除の自動化](user-provisioning.md)
- [属性マッピングの式の書き方](functions-for-customizing-application-data.md)
- [ユーザーのプロビジョニング用のフィルターのスコープ](define-conditional-rules-for-provisioning-user-accounts.md)
- [SCIM を使用して、Azure Active Directory からアプリケーションへのユーザーとグループの自動プロビジョニングを有効にする](use-scim-to-provision-users-and-groups.md)
- [SaaS アプリと Azure Active Directory を統合する方法に関するチュートリアルの一覧](../saas-apps/tutorial-list.md)
