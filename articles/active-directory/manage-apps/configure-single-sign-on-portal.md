---
title: シングル サインオンの構成 - Azure Active Directory | Microsoft Docs
description: このチュートリアルでは、Azure portal を使って、Azure Active Directory (Azure AD) による SAML ベースのシングル サインオンをアプリケーションに構成します。
services: active-directory
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: tutorial
ms.workload: identity
ms.date: 04/08/2019
ms.author: mimart
ms.reviewer: arvinh,luleon
ms.collection: M365-identity-device-management
ROBOTS: NOINDEX
ms.openlocfilehash: c5e8ed4a78fccce4f3a5c631a99a8729114e5722
ms.sourcegitcommit: 198c3a585dd2d6f6809a1a25b9a732c0ad4a704f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/23/2019
ms.locfileid: "68422606"
---
# <a name="how-to-configure-saml-based-single-sign-on"></a>SAML ベースのシングル サインオンを構成する方法

Azure AD のエンタープライズ アプリケーションにアプリを追加したら、シングル サインオンの設定を構成します。 この記事では、ギャラリー以外のアプリ用に SAML ベースのシングル サインオンを構成する方法について説明します。 

> [!NOTE]
> ギャラリー アプリを追加しますか? 詳細な設定手順は、[SaaS アプリのチュートリアルの一覧](../saas-apps/tutorial-list.md)で探してください。

"*コードの記述なしで*" ギャラリー以外のアプリケーションのシングル サインオンを構成するには、サブスクリプションまたは Azure AD Premium を持っており、アプリケーションが SAML 2.0 をサポートしている必要があります。 Azure AD のバージョンの詳細については、[Azure AD の価格](https://azure.microsoft.com/pricing/details/active-directory/)に関するページを参照してください。

## <a name="before-you-begin"></a>開始する前に

- アプリケーションが Azure AD テナントに追加されていない場合は、[ギャラリー アプリの追加](add-gallery-app.md)に関するページまたは[ギャラリー以外のアプリの追加](add-non-gallery-app.md)に関するページを参照してください。
- お使いのアプリケーションのベンダーに問い合わせて、次の設定について正確な情報を入手してください。

    | [基本的な SAML 構成] の設定 | SP-Initiated | idP-Initiated | 説明 |
    |:--|:--|:--|:--|
    | 識別子 (エンティティ ID) | 一部のアプリでは必須 | 一部のアプリでは必須 | シングル サインオンの構成対象となるアプリケーションを一意に識別します。 Azure AD から ID が SAML トークンの Audience パラメーターとしてアプリケーションに送信されます。 アプリケーションではこの ID を検証する必要があります。 また、この値はアプリケーションによって提供される SAML メタデータ内に Entity ID として表示されます。 "*この値は、アプリケーションから送信された **AuthnRequest** (SAML 要求) の **Issuer** 要素として見つけることができます。* " |
    | [応答 URL] | 省略可能 | 必須 | アプリケーションが SAML トークンを受け取ることになっている場所を指定します。 応答 URL は Assertion Consumer Service (ACS) URL とも呼ばれています。 |
    | [サインオン URL] | 必須 | 指定しません | この URL をユーザーが開くと、サービス プロバイダーは、ユーザーの認証とサインインを行う Azure AD にそのユーザーをリダイレクトします。 Azure AD はその URL を使用して Office 365 または Azure AD アクセス パネルからアプリケーションを起動します。 空白の場合、Azure AD では、ユーザーがアプリケーションを起動したときにシングル サインオンを開始する際、ID プロバイダーが利用されます。|
    | リレー状態 | 省略可能 | 省略可能 | 認証が完了した後にユーザーをリダイレクトする場所をアプリケーションに指示します。 通常、値はアプリケーションで有効な URL です。 ただし、一部のアプリケーションでは、このフィールドを異なる方法で使用します。 詳細については、アプリケーションのベンダーに問い合わせてください。
    | ログアウト URL | 省略可能 | 省略可能 | SAML ログアウト応答をアプリケーションに返送するために使用します。

## <a name="step-1-edit-the-basic-saml-configuration"></a>手順 1. [基本的な SAML 構成] を編集する

1. クラウド アプリケーション管理者か Azure AD テナントのアプリケーション管理者として [Azure portal](https://portal.azure.com) にサインインします。

1. **[Azure Active Directory]**  >  **[エンタープライズ アプリケーション]** に移動し、一覧からアプリケーションを選択します。 
   
   - アプリケーションを検索するには、 **[アプリケーションの種類]** メニューの **[すべてのアプリケーション]** を選択した後、 **[適用]** を選択します。 検索ボックスにアプリケーションの名前を入力し、結果からアプリケーションを選択します。

1. **[管理]** セクションの **[シングル サインオン]** を選択します。 

1. **[SAML]** を選択します。 **[SAML によるシングル サインオンのセットアップ - プレビュー]** ページが表示されます。

1. 基本的な SAML 構成オプションを編集するには、 **[基本的な SAML 構成]** セクションの右上隅にある **[編集]** アイコン (鉛筆) を選択します。

     ![証明書の構成](media/configure-single-sign-on-portal/basic-saml-configuration-edit-icon.png)

1. 該当するフィールドに、「[開始する前に](#before-you-begin)」セクションで説明した情報を入力します。

1. ページの最上部で **[保存]** を選択します。

## <a name="step-2-configure-user-attributes-and-claims"></a>手順 2. ユーザー属性と要求を構成する 

アプリケーションでは、ユーザーのサインイン時に Azure AD から受け取る SAML トークンに特定のユーザー属性または要求を必要とする場合があります。 たとえば、特定の要求 URI または要求値が必要な場合や **Name** に Microsoft ID プラットフォームに格納されているユーザー名以外のものを設定することが必要になる場合があります。 ギャラリー アプリの要件については、[アプリケーション固有のチュートリアル](../saas-apps/tutorial-list.md)で説明しています。または、該当するアプリケーションのベンダーにお問い合わせください。 ユーザー属性と要求を構成するための一般的な手順について以下で説明します。

1. **[ユーザー属性と要求]** セクションの右上隅にある **[編集]** アイコン (鉛筆) を選択します。

1. **[名前識別子の値]** を確認します。 既定値は *user.principalname* です。 アプリケーション内の各ユーザーは、ユーザー識別子によって一意に識別されます。 たとえば、メール アドレスがユーザー名と一意識別子を兼ねている場合、この値を *user.mail* に設定します。

1. **[名前識別子の値]** を変更するには、 **[名前識別子の値]** フィールドの **[編集]** アイコン (鉛筆) を選択します。 必要に応じて、識別子の形式とソースに適切な変更を加えます。 詳細については、「[NameID の編集](https://docs.microsoft.com/azure/active-directory//develop/active-directory-saml-claims-customization#editing-nameid)」を参照してください。 完了したら、変更を保存します。 
 
1. グループ要求を構成するには、 **[要求で返されるグループ]** フィールドの **[編集]** アイコンを選択します。 詳細については、[グループ要求の構成](../hybrid/how-to-connect-fed-group-claims.md)に関するページを参照してください。

3. 要求を追加するには、ページの上部にある **[新しいクレームの追加]** を選択します。 **[名前]** を入力し、適切なソースを選択します。 **[属性]** ソースを選択した場合、使用する**ソース属性**を選択する必要があります。 **[翻訳]** ソースを選択した場合、使用する**変換**と**パラメーター 1** を選択する必要があります。 詳細については、「[アプリケーション固有の要求の追加](https://docs.microsoft.com/azure/active-directory//develop/active-directory-saml-claims-customization#adding-application-specific-claims)」を参照してください。 完了したら、変更を保存します。 

4. **[保存]** を選択します。 新しい要求が表に表示されます。

   > [!NOTE]
   > Azure AD からお使いのアプリケーションへの SAML トークンをカスタマイズするその他の方法については、次のリソースを参照してください。
   >- Azure portal でカスタム ロールを作成するには、[ロール要求の構成](../develop/active-directory-enterprise-app-role-management.md)に関するページを参照してください。
   >- PowerShell を使用して要求をカスタマイズするには、[要求のカスタマイズ (PowerShell)](../develop/active-directory-claims-mapping.md) に関するページを参照してください。
   >- お使いのアプリケーション向けに省略可能な要求を構成するようアプリケーション マニフェストを変更するには、[省略可能な要求の構成](../develop/active-directory-optional-claims.md)に関するページを参照してください。
   >- 更新トークン、アクセス トークン、セッション トークン、ID トークンのトークンの有効期間ポリシーを設定するには、[トークンの有効期間の構成](../develop/active-directory-configurable-token-lifetimes.md)に関するページを参照してください。 また、Azure AD の条件付きアクセスを使用して認証セッションを制限するには、[認証セッションの管理機能](https://go.microsoft.com/fwlink/?linkid=2083106)に関するページを参照してください。

## <a name="step-3-manage-the-saml-signing-certificate"></a>手順 3. SAML 署名証明書を管理する

Azure AD では、アプリケーションに送信する SAML トークンの署名に証明書を使用します。 **[SAML でシングル サインオンをセットアップします]** ページで、アクティブな証明書を表示またはダウンロードできます。 また、証明書を更新、作成、インポートすることもできます。 ギャラリー アプリケーションの場合、証明書の形式の詳細については、そのアプリケーションの SAML ドキュメントで確認できます ([アプリケーション固有のチュートリアル](../saas-apps/tutorial-list.md)を参照)。 

1. **[SAML 署名証明書]** セクションに移動します。 アプリケーションの種類に応じて、証明書を Base64 形式、未加工の形式、またはフェデレーション メタデータ XML でダウンロードするためのオプションが表示されます。 また、Azure AD では、アプリケーション固有のメタデータにアクセスできる**アプリのフェデレーション メタデータ URL** が `https://login.microsoftonline.com/<Directory ID>/federationmetadata/2007-06/federationmetadata.xml?appid=<Application ID>` 形式で提供されます。

1. 証明書を管理、作成、またはインポートするには、 **[SAML 署名証明書]** セクションの右上隅にある **[編集]** アイコン (鉛筆) を選択し、次のいずれかを実行します。

   - 新しい証明書を作成するには、 **[新しい証明書]** を選択し、 **[有効期限]** を選択して、 **[保存]** を選択します。 証明書をアクティブ化するには、コンテキスト メニュー ( **...** ) を選択し、 **[証明書をアクティブにする]** を選択します。
   - 秘密キーと pfx の資格情報を含む証明書をアップロードするには、 **[証明書のインポート]** を選択し、その証明書を参照します。 **[PFX パスワード]** を入力し、 **[追加]** を選択します。  
   - 詳細な証明書署名オプションを構成するには、次のオプションを使用します。 これらのオプションの説明については、[詳細な証明書署名オプション](certificate-signing-options.md)に関する記事を参照してください。
      - **[署名オプション]** ドロップダウン リストで、 **[SAML 応答への署名]** 、 **[SAML アサーションへの署名]** 、または **[SAML 応答とアサーションへの署名]** を選択します。
      - **[署名アルゴリズム]** ドロップダウン リストで、 **[SHA-1]** または **[SHA-256]** を選択します。
   - アクティブな証明書の有効期限が近づいたときに他のユーザーに通知するには、 **[通知の電子メール アドレス]** フィールドにメール アドレスを入力します。

1. **[SAML 署名証明書]** セクションの上部にある **[保存]** を選択します。 

## <a name="step-4-set-up-the-application-to-use-azure-ad"></a>手順 4. Azure AD を使用するようにアプリケーションを設定する

**[\<applicationName> のセットアップ]** セクションには、Azure AD が SAML ID プロバイダーとして使用されるようにアプリケーションで構成する必要のある値の一覧が表示されます。 必要な値は、アプリケーションによって異なります。 詳細については、アプリケーションの SAML ドキュメントを参照してください。

1. **[\<applicationName> のセットアップ]** セクションまで下にスクロールします。 
2. 必要に応じてこのセクションの各行から値をコピーし、アプリケーション固有の手順に従ってその値をアプリケーションに追加します。 ギャラリー アプリの場合は、 **[ステップ バイ ステップの手順を表示]** を選択するとドキュメントを表示できます。 
   - **ログイン URL** と**ログアウト URL** の両方が、同じエンドポイント (Azure AD のインスタンスの SAML 要求処理エンドポイント) に解決されます。 
   - **Azure AD 識別子**は、アプリケーションに発行された SAML トークンでの **[発行者]** の値です。
1. すべての値を適切なフィールドに貼り付けたら、 **[保存]** を選択します。

## <a name="step-5-validate-single-sign-on"></a>手順 5. シングル サインオンを検証する

設定をテストして、シングル サインオンが管理者に対して機能するかどうかを確認する準備ができました。  

1. アプリケーションのシングル サインオン設定を開きます。 
2. **[<applicationName> でシングル サインオンを検証]** セクションまでスクロールします。 このチュートリアルでは、このセクションは **[GitHub-test のセットアップ]** となります。
3. **[テスト]** を選択します。 テストのオプションが表示されます。
4. **[現在のユーザーとしてサインイン]** を選択します。 

サインオンに成功した場合は、SAML アプリケーションにユーザーとグループを割り当てることができます。
エラー メッセージが表示されたら、次の手順を完了してください。

1. 詳細をコピーして **[エラーの説明]** ボックスに貼り付けます。

    ![[エラーの説明] ボックスを使って解決のガイダンスを得る](media/configure-single-sign-on-portal/error-guidance.png)

1. **[解決ガイダンスを入手する]** を選択します。 根本原因と解決ガイダンスが表示されます。  この例では、アプリケーションにユーザーが割り当てられていませんでした。
1. 解決ガイダンスを読み、可能であれば問題を解決します。
1. 成功するまでテストを再実行します。

## <a name="next-steps"></a>次の手順

- [アプリケーションにユーザーまたはグループを割り当てる](methods-for-assigning-users-and-groups.md)
- [自動ユーザー アカウント プロビジョニングを構成する](configure-automatic-user-provisioning-portal.md)
