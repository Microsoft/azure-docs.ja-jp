---
title: "Azure Active Directory アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項 | Microsoft Docs"
description: "Azure AD アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項について説明しています。"
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/12/2017
ms.author: kgremban
translationtype: Human Translation
ms.sourcegitcommit: 4b21bf6bc1be59facd503000a4f83a56189d55d3
ms.openlocfilehash: aea1b35348bec0affe2288ff683e0320e2b0f714
ms.lasthandoff: 02/28/2017


---

# <a name="network-topology-considerations-when-using-azure-active-directory-application-proxy"></a>Azure Active Directory アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項
> [!NOTE]
> アプリケーション プロキシは、Azure Active Directory の Premium または Basic エディションにアップグレードしている場合にのみ利用できる機能です。 詳細については、「 [Azure Active Directory のエディション](active-directory-editions.md)」をご覧ください。
>

この記事では、アプリケーションをリモートで発行およびアクセスするために Azure Active Directory (Azure AD) アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項について説明しています。

## <a name="traffic-flow"></a>トラフィック フロー

アプリケーションが Azure AD アプリケーション プロキシを通じて発行される場合、ユーザーから対象バックエンド アプリケーションへのすべてのトラフィックは、次のホップを経由して送信されます。

* ホップ 1: ユーザーから Azure の Azure AD アプリケーション プロキシ サービスのパブリック エンドポイント
* ホップ 2: アプリケーション プロキシ サービスからコネクタ
* ホップ 3: コネクタから対象アプリケーション

 ![ユーザーから対象アプリケーションへのトラフィック フローを示す図](./media/application-proxy-network-topologies/application-proxy-three-hops.png)

## <a name="tenant-location-and-application-proxy-service"></a>テナントの場所とアプリケーション プロキシ サービス

Azure AD テナントにサインアップするとき、指定した国によってテナントのリージョンが決まります。 アプリケーション プロキシを有効にすると、テナント用のアプリケーション プロキシ サービス インスタンスは、Azure AD テナントと同じリージョン、またはその最寄りのリージョンに表示されます。

たとえば、Azure AD テナントのリージョンが欧州連合 (EU) の場合、すべてのアプリケーション プロキシ コネクタは、EU 内の Azure データセンターにあるサービス インスタンスを使用します。 これは、発行されているアプリケーションにユーザーがアクセスしようとすると、すべてこの場所のアプリケーション プロキシ サービス インスタンスを経由することも意味します。

## <a name="considerations-for-reducing-latency"></a>待機時間を削減するための考慮事項

プロキシ ソリューションでは、ネットワーク接続に必ず待ち時間が発生します。 リモート アクセス ソリューションとして選択したプロキシまたは VPN ソリューションに関係なく、ソリューションには、企業ネットワーク内部に接続できるようにする一連のサーバーが必ず含まれます。

組織では、一般的に、サーバーのエンドポイントを境界ネットワークに含めています。 しかし、Azure AD アプリケーション プロキシでは、境界ネットワークは必要ありません。 これは、トラフィックがクラウドのプロキシ サービス経由で送信されるのに対し、コネクタは企業ネットワーク上に配置されているためです。

### <a name="connector-placement"></a>コネクタの配置

アプリケーション プロキシでは、テナントの場所に基づいてインスタンスの場所が自動的に選択されます。 そのため、コネクタのインストール場所を決定でき、ネットワーク トラフィックの待ち時間特性を定義することができます。

アプリケーション プロキシ サービスを設定する場合は、以下の点を考慮する必要があります。

* アプリケーションの場所はどこか。
* アプリケーションにアクセスする大半のユーザーの場所はどこか。
* アプリケーション プロキシ インスタンスの場所 (テナントに基づきます) はどこか。
* Azure データセンターへの専用のネットワーク接続 (Azure ExpressRoute や類似の VPN など) が既に設定されているかどうか。

コネクタの配置により、(前のセクションで説明した) ホップ 2 とホップ 3 の待ち時間が決まります。 コネクタの配置を評価する際に、次の要因を検討する必要があります。

* コネクタからデータセンターへの通信経路が必要です。 これにより、バックエンド アプリケーションへのシングル サインオン (SSO) を行う際に、コネクタは Kerberos の制約付き委任 (KCD) 操作を実行できます。
* コネクタは、コネクタからアプリケーションまでの時間を短縮するため、通常はアプリケーションに近い場所にインストールされます。

### <a name="general-approach-to-minimize-latency"></a>待機時間を最小限に抑えるための一般的なアプローチ

各ネットワーク ホップを最適化することによってエンド ツー エンドのトラフィック待ち時間を最小化することができます。 各ホップは次の方法で最適化できます。

* ホップの両端間の距離を短縮します。
* 経由する適切なネットワークを選択します。 たとえば、パブリック インターネットではなく、プライベート ネットワークを経由した方が、専用リンクのため高速である可能性があります。

Azure と企業ネットワークの間に専用の VPN または ExpressRoute リンクがある場合は、これを利用することをお勧めします。

## <a name="focus-your-optimizing-strategy"></a>最適化戦略に焦点を合わせる

ユーザーは、インターネット経由でアプリにリモートでアクセスする場合があるため、ホップ 2 およびホップ 3 の最適化に重点を置く必要があります。 取り入れることができる一般的なパターンのいくつかを以下に示します。

### <a name="pattern-1-optimize-hop-3"></a>パターン 1: ホップ 3 の最適化

ホップ 3 を最適化するには、コネクタを顧客のネットワークで対象アプリケーションの近くに配置します。 この利点は、コネクタにはドメイン コントローラーへの通信経路が必要となる可能性が高いことです。 この方法は、ほとんどのシナリオで十分です  (実際、ほとんどの顧客は、このパターンに当てはまります)。

 ![コネクタが対象アプリケーションの近くに配置されている、ホップ 3 の最適化を示す図](./media/application-proxy-network-topologies/application-proxy-hop3.png)


> [!NOTE]
目的の待ち時間特性を得るためにホップ 2 とホップ 3 両方を最適化する必要があるシナリオがいくつかあります。 たとえば、ネットワークと Azure データセンターの間に VPN または ExpressRoute を設定済みの場合、両方のホップを最適化できます。
>

### <a name="pattern-2-take-advantage-of-expressroute-with-public-peering"></a>パターン 2: パブリック ピアリングを使用した ExpressRoute の活用

パブリック ピアリングを使用して ExpressRoute を設定済みの場合、ホップ 2 により高速な ExpressRoute 接続を利用できます  (ホップ 3 は、ネットワーク内のアプリの近くにコネクタを配置することによって既に最適化されています)。

![ExpressRoute 接続を使用したホップ 2 の最適化を示す図](./media/application-proxy-network-topologies/application-proxy-expressroute-public.png)

### <a name="pattern-3-take-advantage-of-expressroute-with-private-peering"></a>パターン 3: プライベート ピアリングを使用した ExpressRoute の活用

Azure と企業ネットワークとの間に、プライベート ピアリングを使用して専用の VPN または ExpressRoute を設定済みの場合、別の選択肢があります。 この構成では、通常、Azure の仮想ネットワークは企業ネットワークの拡張機能と見なされます。 そのため、Azure データセンターにコネクタをインストールする一方で、ホップ 3 のコネクタからアプリの間の接続に関する厳しい待ち時間の要件を満たすことができます。

トラフィックは専用接続を介して送信されるため、待ち時間は損なわれません。 さらに、ホップ 2 の待ち時間特性の改善という追加の利点が得られます。 これは、アプリケーション プロキシ サービスからコネクタへの接続がより短いホップであるためです。 コネクタは、Azure AD テナント (およびアプリケーション プロキシ) の場所に近い Azure データセンターにインストールされます。

![Azure データ センター内にインストールされたコネクタを示す図](./media/application-proxy-network-topologies/application-proxy-expressroute-private.png)

### <a name="other-approaches"></a>その他のアプローチ

この記事ではコネクタの配置を中心に取り上げていますが、アプリケーションの配置を変更して待ち時間特性を改善することもできます。

ホスト環境にネットワークを移動する組織が増えています。 これにより組織は、企業ネットワークの一部でもあり、ドメイン内のままであるホスト環境にアプリを配置できます。 この場合は、前のセクションで説明したパターンをアプリケーションの新しい場所に適用できます。

別々の場所およびネットワーク内にある対象アプリケーションへのコネクタ グループを使用することを検討してください。 このオプションを検討する場合は、[Azure AD Domain Services](https://azure.microsoft.com/services/active-directory-ds) に関するページをご覧ください。

## <a name="common-scenarios"></a>一般的なシナリオ

このセクションでは、いくつかのユース ケースについて説明します。 ここでは、Azure AD テナント (およびそれに伴うプロキシ サービス エンドポイント) が米国 (US) 内にあると仮定しています。 次のユース ケースで説明されている考慮事項は、通常、世界各地の他のリージョンにも当てはまります。

### <a name="use-case-1"></a>ユース ケース 1

アプリは米国内の組織のネットワークにあり、ユーザーは同じリージョン内に存在します。 Azure データセンターと企業ネットワークの間に ExpressRoute または VPN は存在しません。

**推奨事項:** 前のセクションで説明したパターン 1 に従います。 待ち時間を改善するには、必要に応じて ExpressRoute の使用を検討してください。

これは、単純なパターンです。 アプリの近くにコネクタを配置することによって、ホップ 3 を最適化します。 コネクタは、KCD 操作を実行するために、通常、アプリとデータセンターとの通信経路にインストールされるため、これは自然な選択でもあります。

![米国の略図と、このユース ケースでのホップの配置方法を示す図](./media/application-proxy-network-topologies/application-proxy-pattern1.png)

### <a name="use-case-2"></a>ユース ケース 2

アプリは米国内の組織のネットワークにあり、ユーザーはグローバルに分散しています。 Azure データセンターと企業ネットワークの間に ExpressRoute または VPN は存在しません。

**推奨事項:** 前のセクションで説明したパターン 2 に従います。 待ち時間を改善するには、必要に応じて ExpressRoute の使用を検討してください。

繰り返しますが、一般的なパターンはホップ 3 の最適化です。これにより、コネクタはアプリの近くに配置されます。 ホップ 3 は、すべて同じリージョン内にある場合、通常、コストは高くありません。 ただし、すべてのユーザーが米国内のアプリケーション プロキシ インスタンスにアクセスするため、ユーザーの場所によっては、ホップ 1 はコストが高くなる可能性があります。 どのプロキシ ソリューションも、グローバルに分散しているユーザーに関して類似した特性を持つことは注目に値します。

![世界的規模の大陸の略図と、このユース ケースでのホップの配置方法を示す図](./media/application-proxy-network-topologies/application-proxy-pattern2.png)

### <a name="use-case-3"></a>ユース ケース 3

アプリは米国内の組織のネットワークにあります。 パブリック ピアリングを使用した ExpressRoute が、Azure と企業ネットワークの間に存在します。

**推奨事項:** コネクタを可能な限りアプリケーションの近くに配置します。 ホップ 2 には ExpressRoute が自動的に使用されます。 これは、前のセクションで説明したパターン 2 に従います。

ExpressRoute リンクでパブリック ピアリングを使用している場合、プロキシとコネクタの間のトラフィックはそのリンク経由で送信されます。 ホップ 2 の待ち時間が最適化されます。

![米国の略図と、このユース ケースでのホップの配置方法を示す図](./media/application-proxy-network-topologies/application-proxy-pattern3.png)

### <a name="use-case-4"></a>ユース ケース 4

アプリは米国内の組織のネットワークにあります。 プライベート ピアリングを使用した ExpressRoute が、Azure と企業ネットワークの間に存在します。

**推奨事項:** ExpressRoute プライベート ピアリング経由で企業ネットワークに接続されている Azure データセンターにコネクタを配置します。 これは、前のセクションで説明したパターン 3 に従います。

コネクタは、Azure データセンターに配置できます。 プライベート ネットワークを経由しても、コネクタからアプリケーションとデータセンターへの通信経路は保たれるため、ホップ 3 は最適化されたままになります。 加えて、ホップ 2 はさらに最適化されます。

![米国の略図と、このユース ケースでのホップの配置方法を示す図](./media/application-proxy-network-topologies/application-proxy-pattern4.png)

### <a name="use-case-5"></a>ユース ケース 5

アプリは EU 内の組織のネットワークにあり、ほとんどのユーザーは米国内に存在します。

**推奨事項:** コネクタをアプリケーションの近くに配置します。 米国のユーザーは、同じリージョンのアプリケーション プロキシ インスタンスにアクセスしているため、ホップ 1 のコストが高すぎるということはありません。 ホップ 3 は最適化されています。 ただし、このユース ケースでは通常、ホップ 2 のコストが高くなります。

![世界的規模の大陸の略図と、このユース ケースでのホップの配置方法を示す図](./media/application-proxy-network-topologies/application-proxy-pattern5a.png)

パターン 2 と 3 に関する前のセクションで説明したように、ExpressRoute の使用を検討してください。

![世界的規模の大陸の略図と、このユース ケースでのホップの配置方法を示す図](./media/application-proxy-network-topologies/application-proxy-pattern5b.png)

このような状況では、もう&1; つのバリエーションを使用することも検討できます。 組織内のほとんどのユーザーが米国内に存在する場合、ネットワークが米国まで拡張される可能性があります。 その場合は、コネクタを米国内に配置して、EU 内のアプリケーションへの専用の内部企業ネットワーク回線を使用できます。 これにより、ホップ 2 と 3 が最適化されます。

![世界的規模の大陸の略図と、このユース ケースでのホップの配置方法を示す図](./media/application-proxy-network-topologies/application-proxy-pattern5c.png)

## <a name="next-steps"></a>次のステップ
[アプリケーション プロキシを有効にする](active-directory-application-proxy-enable.md)<br>
[シングル サインオンを有効にする](active-directory-application-proxy-sso-using-kcd.md)<br>
[条件付きアクセスを有効にする](active-directory-application-proxy-conditional-access.md)<br>
[アプリケーション プロキシで発生した問題のトラブルシューティングを行う](active-directory-application-proxy-troubleshoot.md)

