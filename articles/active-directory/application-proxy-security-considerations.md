---
title: "Azure AD アプリケーション プロキシを使用したアプリへのリモート アクセス時のセキュリティに関する注意事項 | Microsoft Docs"
description: "Azure AD アプリケーション プロキシを使用する場合のセキュリティに関する注意事項を説明します"
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/12/2017
ms.author: kgremban
translationtype: Human Translation
ms.sourcegitcommit: 5d741836f5defd5d9287b90e53e71aeea439a1df
ms.openlocfilehash: 81a7a57e6b025710660f7d55145ee286b71acf24
ms.lasthandoff: 03/01/2017


---

# <a name="security-considerations-for-accessing-apps-remotely-by-using-azure-ad-application-proxy"></a>Azure AD アプリケーション プロキシを使用したアプリへのリモート アクセス時のセキュリティに関する注意事項

>[!NOTE]
>アプリケーション プロキシ機能は、Azure Active Directory の Premium または Basic エディションにアップグレードした場合にのみ利用できます。 詳細については、「 [Azure Active Directory のエディション](active-directory-editions.md)」をご覧ください。

この記事では、アプリケーションをリモートで発行およびアクセスするための安全なサービスを、Azure Active Directory (Azure AD) アプリケーション プロキシがどのように提供するかを説明しています。

Azure AD アプリケーション プロキシには、次のセキュリティ上の利点があります。

**認証済みアクセス:** ネットワークにアクセスできるのは、認証された接続のみです。

* Azure AD アプリケーション プロキシでは、すべての認証に Azure AD セキュリティ トークン サービス (STS) を使用しています。 事前認証を利用して発行されるアプリケーションでは、有効な STS トークンがないと、トラフィックがアプリケーション プロキシ サービスを通過してお客様の環境に到達することはできません。
* 事前認証はその性質上、多数の匿名の攻撃をブロックします。これは、バックエンド アプリケーションにアクセスできるのが認証された ID のみのためです。

**条件付きアクセス:** ネットワークへの接続が確立される前に、多数のポリシー制御を適用できます。

* 条件付きアクセスを使用すると、バックエンド アプリケーションにアクセスできるトラフィックの制限をより細かく定義できます。 場所、認証の強度、ユーザーのリスク プロファイルに基づいて制限を定義できます。
* この機能によって、攻撃者に対する防御を強化できます。 条件付きアクセスの詳細については、[Azure AD の条件付きアクセスの概要](https://azure.microsoft.com/en-us/documentation/articles/active-directory-conditional-access-azuread-connected-apps)に関する記事を参照してください。

**トラフィックの終了:** すべてのトラフィックがクラウドで終了します。

* Azure AD アプリケーション プロキシはリバース プロキシであるため、バックエンド アプリケーションへのトラフィックはすべて、このサービスで終了します。 バックエンド サーバーでのみ、セッションの再確立が可能です。つまり、HTTP トラフィックを送信するためにバックエンド サーバーが公開されることはありません。 標的型攻撃をより容易に緩和できるということです。

**すべてのアクセスが外向き:** 企業ネットワークへの受信接続を開く必要がありません。

* Azure AD コネクタは、Azure AD アプリケーション プロキシ サービスへの送信接続を維持します。つまり、受信接続用のファイアウォール ポートを開放する必要はありません。
* 従来のアプローチでは、境界ネットワーク ("*DMZ*"、"*非武装地帯*"、"*スクリーン サブネット*" とも呼ばれます) が必要であり、認証されていない接続へのアクセスをネットワーク境界で開く必要がありました。 このシナリオでは、Web アプリケーション ファイアウォール (WAF) 製品に多くの追加投資をしてトラフィックを分析し、環境への保護を追加する必要がありました。 アプリケーション プロキシを使用すると、そのような状況を回避できます。 すべての接続が送信用で、セキュリティで保護されたチャネルを介しているため、境界ネットワークなしの運用を検討することも可能です。

**セキュリティ分析と機械語に基づくインテリジェンス:** 最先端のセキュリティ保護が得られます。

* Azure AD Identity Protection と、機械学習を活用したインテリジェンスとデータは、Microsoft の Digital Crimes Unit および Microsoft セキュリティ レスポンス センターから情報を取得しています。 これらの組織は ID が攻撃されたアカウントを被害の発生前に特定し、危険性の高いサインインが実行されないように、リアルタイムで保護します。 感染したデバイスからのアクセス、匿名ネットワークを経由したアクセス、一般的でない場所や異常な場所からのアクセスなど、多数の要因が考慮されます。
* これらのレポートとイベントの多くは、お客様のセキュリティ情報およびイベント管理 (SIEM) システムとの統合を可能にする API を通じて既に使用可能です。
* 詳細については、[Azure AD Identity Protection](https://azure.microsoft.com/en-us/documentation/articles/active-directory-identityprotection) に関するページを参照してください。

**サービスとしてのリモート アクセス:** オンプレミス サーバーの保守やパッチの適用について心配する必要がありません。

* Azure AD アプリケーション プロキシは Microsoft によるインターネット規模のサービスであるため、常に最新のセキュリティ パッチとアップグレードが適用された状態で利用できます。
* パッチの適用されていないソフトウェアは、依然として多数の攻撃の的となっています。 Microsoft のサービス モデルでは、お客様がエッジ サーバーの管理という重荷を背負う必要はありません。

Azure AD で提供されるリモート アクセス サービスは、[Azure セキュリティ センター](https://azure.microsoft.com/en-us/support/trust-center)で説明されているガイドラインと標準に従って運用されます。

次の図は、Azure AD によってお客様のオンプレミスのアプリケーションへの安全なリモート アクセスが実現されるしくみを示しています。

 ![Azure AD アプリケーション プロキシ経由のセキュリティで保護されたリモート アクセスの図](./media/application-proxy-security-considerations/secure-remote-access.png)

>[!NOTE]
>Azure AD アプリケーション プロキシによって発行されたアプリケーションのセキュリティを強化するために、Web クローラー ロボットによるアプリケーションのインデックス作成およびアーカイブ操作はブロックされます。 Web クローラー ロボットが発行されたアプリのロボット設定を取得しようとするたびに、アプリケーション プロキシは、次のテキストが含まれる robots.txt ファイルで応答します。
>
>_User-agent: *_  
>_Disallow: /_

## <a name="components-of-the-azure-ad-application-proxy-solution"></a>Azure AD アプリケーション プロキシ ソリューションのコンポーネント

Azure AD アプリケーション プロキシは、以下の&2; つで構成されています。

* クラウドベースのサービス: このサービスは、外部のクライアント/ユーザーの接続が作成される場所です。
* Azure AD アプリケーション プロキシ コネクタ: オンプレミスのコンポーネント。コネクタは、Azure AD アプリケーション プロキシ サービスからの要求をリッスンし、内部アプリケーションへの接続を処理します。 サービスには、SSO 向けの Kerberos の制約付き委任 (KCD) などの項目への対応が含まれます。

コネクタとアプリケーション プロキシ サービスの間でフローが確立されるのは以下の場合です。

* コネクタの最初の設定時。
* コネクタがアプリケーション プロキシ サービスから構成情報 (各コネクタがメンバーとなっているコネクタ グループなど) を収集するとき。
* 公開されたアプリケーションにユーザーがアクセスする。

>[!NOTE]
>すべての通信は SSL 経由で発生し、常にコネクタで生成されて、アプリケーション プロキシ サービスに送られます。 このサービスは送信専用です。

コネクタはクライアント証明書を使用して、ほぼすべての呼び出しに対してアプリケーション プロキシ サービスを認証します。 このプロセスの唯一の例外は、クライアント証明書が確立される最初のセットアップ手順です。

### <a name="installing-the-connector"></a>コネクタのインストール

コネクタの初回セットアップ時に、次のフロー イベントが発生します。

1. サービスへのコネクタの登録は、コネクタのインストールの一環として発生します。 現在、ユーザーに Azure AD 管理者の資格情報の入力が求められます。 トークンが取得され、Azure AD アプリケーション プロキシ サービスに提示されます。
2. アプリケーション プロキシはトークンを評価して、そのユーザーが、トークンが発行されたテナント内で、会社の管理者ロールを持つメンバーであることを確認します。 ユーザーが管理者ロールのメンバーでない場合は、プロセスが終了します。
3. コネクタは、クライアント証明書の要求を生成し、その要求とトークンをアプリケーション プロキシ サービスに渡します。アプリケーション プロキシ サービスはトークンを確認して、クライアント証明書の要求に署名します。
4. コネクタはアプリケーション プロキシ サービスとのその後の通信の際に、このクライアント証明書を使用します。
5. コネクタはクライアント証明書を使用して、サービスからのシステム構成データの初回の収集を実行します。これで要求を受け入れる準備が完了します。

### <a name="updating-the-configuration-settings"></a>構成の設定の更新

アプリケーション プロキシ サービスが構成の設定を更新するたびに、次のフロー イベントが発生します。

1. コネクタはクライアント証明書を使用して、アプリケーション プロキシ サービス内の構成のエンドポイントに接続します。
2. クライアント証明書の検証が完了すると、アプリケーション プロキシ サービスはコネクタに構成データ (そのコネクタが含まれている必要があるコネクタ グループなど) を返します。
3. 現在の証明書が 30 日を経過している場合は、コネクタが新しい証明書要求を生成します。このため、30 日ごとに効率よくクライアント証明書が更新されます。

### <a name="accessing-published-applications"></a>発行済みアプリケーションへのアクセス

発行済みアプリケーションにユーザーがアクセスすると、次のフロー イベントが発生します。

1. アプリケーション プロキシ サービスがアプリの構成設定を確認します。 Azure AD で事前認証を使用するようにアプリが構成されている場合は、ユーザーは認証のために Azure AD STS にリダイレクトされます。 パススルーを使用してアプリを発行する場合は、この手順は省略されます。

 a. アプリケーション プロキシが、Azure AD での認証時に、特定のアプリケーションの条件付きアクセス ポリシーの要件を確認します。 これは、ユーザーがアプリケーションに割り当てられていることを確認するための手順です。 多要素認証 (MFA) が必要な場合は、認証シーケンスでユーザーに第&2; 要素認証が要求されます。

 b. すべてのチェックに合格すると、Azure AD STS はアプリケーション向けに署名されたトークンを発行し、ユーザーをアプリケーション プロキシ サービスにリダイレクトします。

 c. アプリケーション プロキシは、そのトークンを検証して、ユーザーがアクセスを要求したアプリケーションに対して発行されたものであるかどうかを確認します。 そのトークンが Azure AD によって署名されたものであるかどうか、まだ有効期間内であるかどうかなど、他の確認も行われます。

 d. アプリケーション プロキシは、暗号化された認証 Cookie (非永続の Cookie など) を設定して、アプリケーションへの認証が実行されたことを示します。 この Cookie には、Azure AD と他のデータ (認証の基になるユーザー名など) からのトークンを基にした有効期限のタイムスタンプが含まれています。 この Cookie は、アプリケーション プロキシ サービスのみで認識される秘密キーを使用して暗号化されます。

 e. アプリケーション プロキシは、最初に要求された URL にユーザーをリダイレクトします。

 >[!NOTE]
 >事前認証の手順の一部が失敗した場合は、ユーザーの要求が拒否され、問題の原因を示すメッセージが表示されます。
 >

2. アプリケーション プロキシは、クライアントからの要求を受け取ると、事前認証の条件が満たされていることと Cookie がまだ有効であること (必要な場合) を確認します。 次に、アプリケーション プロキシは、適切なキューに要求を配置し、オンプレミスのコネクタが処理できるようにします。 

 >[!NOTE]
 >コネクタからの要求はすべて、アプリケーション プロキシ サービスに送信されます。 コネクタでは、アプリケーション プロキシへの送信接続を開いたままにします。 要求を受信すると、アプリケーション プロキシは、開いている接続のいずれかでキューに要求を配置し、コネクタが処理できるようにします。

 * この要求には、アプリケーションからのアイテム (要求ヘッダー、暗号化された Cookie のデータ、要求を作成したユーザー、要求 ID など) が含まれています。 ただし、暗号化された認証 Cookie はコネクタに送信されません。

3. コネクタは、発信用の Long-Lived 接続に基づくキューからの要求を受信します。 アプリケーション プロキシは、要求に基づいて次のいずれかのアクションを実行します。

 * コネクタは、アプリケーションを認識できるかどうかを確認します。 アプリケーションを識別できない場合、コネクタはアプリケーション プロキシ サービスへの接続を確立してそのアプリケーションの詳細を収集し、アプリケーションをローカルにキャッシュします。

 * 要求が単純な操作の場合 (たとえば、本文にデータがない RESTful *GET* 要求) は、コネクタはターゲットの内部リソースへの接続を確立し、応答を待機します。

 * 関連付けられたデータが本文に含まれている要求 (RESTful *POST* 操作など) の場合、コネクタはクライアント証明書を使用して、アプリケーション プロキシのインスタンスへの送信接続を確立します。 この接続は、データを要求し、内部リソースへの接続を開くために確立されます。 アプリケーション プロキシ サービスは、コネクタからの要求を受信すると、ユーザーからのコンテンツの受け入れを開始し、データをコネクタに転送します。 そしてコネクタが内部リソースにデータを転送します。

4. バックエンドへのすべてのコンテンツの要求および送信が完了すると、コネクタは応答を待機します。

5. コネクタは、応答を受け取ると、アプリケーション プロキシ サービスへの送信接続を確立して、ヘッダーの情報を返し、返されるデータのストリーミングを開始します。

6. アプリケーション プロキシは、ユーザーにデータを "ストリーミング" します。 アプリケーションで必要であり、定義されている場合は、ここでヘッダーの処理が発生する場合があります。

クライアントのブラウザーを経由した Azure Web アプリケーションからオンプレミスの Windows 認証簡易オブジェクト アクセス プロトコル (SOAP) エンドポイントへの通信においてサポートが必要な場合は、[Azure Field Notes Blog](http://www.azurefieldnotes.com/2016/12/02/claims-to-windows-identity-translation-solutions-and-its-flaws-when-using-azure-ad-application-proxy) を参照してください。

## <a name="next-steps"></a>次のステップ

[Azure AD アプリケーション プロキシ コネクタについて](application-proxy-understand-connectors.md)

