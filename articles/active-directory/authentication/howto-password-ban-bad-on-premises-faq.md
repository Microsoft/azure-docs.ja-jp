---
title: オンプレミスの Azure AD パスワード保護に関する FAQ
description: オンプレミスの Active Directory Domain Services 環境での Azure AD パスワード保護に関するよく寄せられる質問について確認します
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: how-to
ms.date: 11/21/2019
ms.author: iainfou
author: iainfoulds
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: 3d67dbc0eedba8cc32c188636032d96b31f45adf
ms.sourcegitcommit: 6fc156ceedd0fbbb2eec1e9f5e3c6d0915f65b8e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/21/2020
ms.locfileid: "88717780"
---
# <a name="azure-ad-password-protection-on-premises-frequently-asked-questions"></a>オンプレミスでの Azure AD パスワード保護に関するよく寄せられる質問

このセクションでは、Azure AD パスワード保護に関してよく寄せられる質問への回答を示します。

## <a name="general-questions"></a>一般的な質問

**Q:安全なパスワードを選択する方法に関して、ユーザーにどのようなガイダンスが与えられますか?**

このトピックに関する Microsoft の現在のガイダンスについては、次のリンクを参照してください。

[Microsoft のパスワードのガイダンス](https://www.microsoft.com/research/publication/password-guidance)

**Q:オンプレミスの Azure AD パスワード保護はパブリックでないクラウドでサポートされますか?**

いいえ。オンプレミスの Azure AD パスワード保護は、パブリック クラウドでのみサポートされます。 パブリックでないクラウドの提供開始についての日付は発表されていません。

Azure AD ポータルでは、パブリック クラウド以外の場合でもオンプレミス固有の [Windows Server Active Directory のパスワード保護] 構成を変更できます。このような変更は保存されますが、そうでなければ実行されません。 パブリック クラウド以外の資格情報が使用されたときのオンプレミスのプロキシ エージェントまたはフォレストの登録はサポートされていません。また、そのような登録の試行は常に失敗します。

**Q:どのようにして Azure AD パスワード保護の利点を自分のオンプレミスのユーザーのサブセットに適用できますか?**

サポートされていません。 デプロイして有効にされると、Azure AD パスワード保護では識別を行いません。すべてのユーザーがセキュリティの利点を等しく受け取ります。

**Q:パスワードの変更とパスワードの設定 (またはリセット) の違いは何ですか?**

パスワードの変更は、ユーザーが古いパスワードを知っていることを証明した後に新しいパスワードを選択する場合のアクションです。 パスワードの変更は、たとえば、ユーザーが Windows にログインした後に新しいパスワードを選択するように求められたときに発生します。

パスワードの設定 (パスワードのリセットとも呼ばれます) は、たとえば Active Directory ユーザーとコンピューターの管理ツールを使用して、管理者がアカウントのパスワードを新しいパスワードに置き換える場合のアクションです。 この操作には高いレベルの特権 (通常はドメイン管理者) が必要であり、通常、操作を実行する担当者は古いパスワードを知りません。 ヘルプ デスクのシナリオで、パスワードの設定がよく実行されます。たとえば、パスワードを忘れたユーザーを支援する場合などです。 また、パスワードを指定して新しいユーザー アカウントを初めて作成するときにもパスワードの設定イベントが発生します。

パスワード検証ポリシーは、実行されているのがパスワードの変更か設定かに関係なく同じように動作します。 Azure AD パスワード保護 DC エージェント サービスは、パスワードの変更または設定操作が行われたかどうかをユーザーに通知するために、さまざまなイベントをログに記録します。  「[Azure AD パスワード保護の監視とログ記録](./howto-password-ban-bad-on-premises-monitor.md)」をご覧ください。

**Q:Active Directory ユーザーとコンピューター管理スナップインを利用して弱いパスワードを設定しようとすると、重複パスワード拒否イベントがログに記録されるのはなぜですか。**

Active Directory ユーザーとコンピューター管理スナップインではまず、Kerberos プロトコルを利用して新しいパスワードを設定しようとします。 エラーが発生すると、このスナップインでは次に、レガシ (SAM RPC) プロトコル (使用される特定のプロトコルは重要ではありません) を利用してパスワードを設定しようとします。 新しいパスワードが Azure AD パスワード保護で弱いと見なされると、このスナップイン動作の結果、2 セットのパスワード リセット拒否イベントがログに記録されます。

**Q:Azure AD パスワード保護のパスワード検証イベントが空のユーザー名でログに記録されるのはなぜですか。**

Active Directory では、パスワードをテストして、ドメインの現在のパスワード複雑さ要件が満たされているかどうかを確認する機能がサポートされています (たとえば、[NetValidatePasswordPolicy](/windows/win32/api/lmaccess/nf-lmaccess-netvalidatepasswordpolicy) API を使用して)。 この方法でパスワードが検証されるとき、テストには、Azure AD パスワード保護などのパスワード フィルター DLL ベースの製品による検証も含まれます。ただし、特定のパスワード フィルター DLL に渡されるユーザー名は空になります。 このシナリオの Azure AD パスワード保護でも、現在有効なパスワード ポリシーを使用してパスワードが検証され、結果をキャプチャするためのイベント ログ メッセージが発行されますが、イベント ログ メッセージのユーザー名フィールドは空になります。

**Q:その他のパスワード フィルター ベースの製品とサイド バイ サイドで Azure AD パスワード保護をインストールすることはサポートされていますか?**

はい。 複数の登録されたパスワード フィルター DLL に対するサポートは、コア Windows 機能であり、Azure AD パスワード保護に固有のものではありません。 登録されたパスワード フィルター DLL はすべて、パスワードを受け入れる前に一致している必要があります。

**Q:Azure を使用せずに、Active Directory 環境に Azure AD パスワード保護をデプロイし、構成するにはどうすればよいですか?**

サポートされていません。 Azure AD パスワード保護は、オンプレミスの Active Directory 環境への拡張をサポートする Azure の機能です。

**Q:Active Directory レベルでポリシーの内容を変更するにはどうすればよいですか?**

サポートされていません。 ポリシーを管理するには、Azure AD ポータルを使用する必要があります。 前の質問も参照してください。

**Q:sysvol レプリケーションに DFSR が必要なのはなぜですか?**

FRS (DFSR に対する先行テクノロジ) には、多くの既知の問題があり、より新しいバージョンの Windows Server Active Directory ではまったくサポートされていません。 Azure AD パスワード保護のゼロ テストは、FRS で構成されたドメインで行われます。

詳細については、次の記事を参照してください。

[sysvol レプリケーションを DFSR に移行するケース](/archive/blogs/askds/the-case-for-migrating-sysvol-to-dfsr)

[FRS の終了が近づいています](https://blogs.technet.microsoft.com/filecab/2014/06/25/the-end-is-nigh-for-frs)

ご利用のドメインでまだ DFSR を使用していない場合、Azure AD パスワード保護をインストールする前に DFSR 使用にドメインを移行する必要があります。 詳細については、次のリンクを参照してください。

[SYSVOL レプリケーション移行ガイド: FRS レプリケーションから DFS レプリケーションに移行する](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd640019(v=ws.10))

> [!WARNING]
> Azure AD パスワード保護 DC エージェント ソフトウェアは、現在、sysvol レプリケーションにまだ FRS を使用しているドメインのドメイン コントローラーにインストールされますが、この環境ではソフトウェアは正しく機能しません。 その他のマイナスの副作用としては、個々のファイルを複製できない、sysvol 復元処理が成功したように見えたが、一部のファイルの複製に失敗しており、何のエラーも表示されない、などがあります。 できるだけ早く、DFSR の使用にドメインを移行してください。DFSR に固有のメリットがあるだけでなく、Azure AD パスワード保護のデプロイのブロックを解除します。 今後のバージョンでは、ドメインで依然として FRS を使用している場合、このソフトウェアは自動的に無効になります。

**Q:機能には、ドメイン sysvol 共有にどのくらいのディスク領域が必要ですか?**

正確な領域の使用量は、Microsoft グローバル禁止リストとテナントごとのカスタム リストで禁止されているトークンの数と長さ、および暗号化オーバーヘッドなどの要素に依存するため、さまざまに異なります。 これらのリストの内容は、将来拡大する可能性があります。 このことを念頭に、妥当な予想として、機能には、ドメイン sysvol 共有に最低 5 メガバイトの領域が必要になります。

**Q:DC エージェント ソフトウェアのインストールまたはアップグレードに再起動が必要なのはなぜですか?**

これはコア Windows 動作によって必要になります。

**Q:特定のプロキシ サーバーを使用するように DC エージェントを構成する方法はありますか?**

いいえ。 プロキシ サーバーはステートレスであるため、特定のどのプロキシ サーバーを使用するかは重要ではありません。

**Q:Azure AD Connect などの他のサービスと並行して Azure AD パスワード保護プロキシ サービスをデプロイしても大丈夫ですか?**

はい。 Azure AD パスワード保護プロキシ サービスと Azure AD Connect は、互いに直接競合することはありません。

残念ながら、Azure AD パスワード保護プロキシ ソフトウェアによってインストールされた Microsoft Azure AD Connect エージェント アップデーター サービスのバージョンと、[Azure Active Directory アプリケーション プロキシ](../manage-apps/application-proxy.md) ソフトウェアによってインストールされたサービスのバージョンとの間には互換性がありません。 この非互換性が原因で、エージェント アップデーター サービスがソフトウェアの更新のために Azure に接続できなくなっている可能性があります。 Azure AD パスワード保護プロキシと Azure Active Directory アプリケーション プロキシを同じマシンにインストールすることはお勧めしません。

**Q:DC エージェントとプロキシはどのような順序でインストールして登録する必要がありますか?**

プロキシ エージェントのインストール、DC エージェントのインストール、フォレストの登録、プロキシの登録は、任意の順序での実行がサポートされています。

**Q:この機能のデプロイによって、ドメイン コントローラーに対するパフォーマンスの打撃を懸念する必要がありますか?**

Azure AD パスワード保護 DC エージェント サービスは、既存の正常な Active Directory デプロイにおいてドメイン コントローラーのパフォーマンスに著しく影響を及ぼすことはないはずです。

ほとんどの Active Directory デプロイで、パスワード変更操作は、特定のどのドメイン コントローラーでもワークロード全体のごく一部になります。 たとえば、10000 ユーザー アカウントと 30 日に設定された MaxPasswordAge ポリシーがある Active Directory ドメインを想像してください。 平均で、このドメインでは毎日 10000/30 = 333 回までのパスワード変更操作が発生しますが、これは 1 つのドメイン コントローラーの場合でも少ない操作数です。 可能性のある最悪のケースのシナリオを考えてみます。1 時間に 1 つの DC でこの 333 回までのパスワードの変更が行われたとします。 たとえば、月曜日の朝に多数の従業員が全員出勤してくる場合に、このシナリオが発生する可能性があります。 この場合でも、333 回まで/60 分 = 1 分あたり 6 回のパスワードの変更が発生することになり、これも同様に重大な負荷ではありません。

ただし現在のドメイン コントローラーが既にパフォーマンス制限付きレベルで実行している (たとえば、CPU、ディスク領域、ディスク I/O に関して最大限に達しているなど) 場合は、この機能をデプロイする前に、ドメイン コン ローラーを追加するか、または使用可能なディスク領域を拡張することをお勧めします。 sysvol ディスク領域の使用量に関する上記の質問も参照してください。

**Q:ドメイン内のほんの一部の DC で Azure AD パスワード保護をテストしたいと思います。ユーザー パスワードの変更で、これらの特定の DC を強制的に使用させることはできますか?**

いいえ。 Windows クライアント OS は、ユーザーがパスワードを変更するときに、どのドメイン コントローラーを使用するかを制御します。 ドメイン コントローラーは、Active Directory サイトとサブネット割り当て、環境固有のネットワーク構成などの要素に基づいて選択されます。Azure AD パスワード保護は、これらの要素を制御せず、ユーザーのパスワードを変更するためにどのドメイン コントローラーが選択されるかに影響を与えることはできません。

この目標に部分的に到達する 1 つの方法は、特定の Active Directory サイト内のすべてのドメイン コントローラーに Azure AD パスワード保護をデプロイすることです。 このアプローチは、そのサイトに割り当てられる Windows クライアントに対し、したがってそれらのクライアントにログインし、パスワードを変更するユーザーに対しても、妥当なカバレッジを提供します。

**Q:プライマリ ドメイン コントローラー (PDC) にだけ Azure AD パスワード保護 DC エージェント サービスをインストールした場合、ドメイン内の他のすべてのドメイン コントローラーも保護されますか?**

いいえ。 PDC 以外の特定のドメイン コントローラーで、ユーザーのパスワードが変更された場合、クリアテキスト パスワードは PDC に送信されません (この考えは一般的な誤解です)。 特定の DC で、新しいパスワードが受け入れられると、その DC はそのパスワードを使用して、そのパスワードのさまざまな認証プロトコル固有のハッシュを作成し、ディレクトリでそれらのハッシュを保持します。 クリア テキスト パスワードは保持されません。 更新されたハッシュが、PDC にレプリケートされます。 場合により、ユーザー パスワードは、ネットワーク トポロジや Active Directory サイトの設計などのさまざまな要素に応じて、PDC で直接変更されることがあります。 (前の質問を参照してください。)

まとめると、PDC への Azure AD パスワード保護 DC エージェント サービスのデプロイでは、ドメイン全体で 100% の機能のセキュリティ カバレッジに到達する必要があります。 PDC のみへの機能のデプロイでは、ドメイン内の他の DC に対して、Azure AD パスワード保護のセキュリティ上の利点を提供しません。

**Q:オンプレミスの Active Directory 環境にエージェントをインストールした後でも、カスタム スマート ロックアウトが機能しないのはなぜですか?**

カスタム スマート ロックアウトは Azure AD でのみサポートされています。 エージェントがインストールされていても、オンプレミスの Active Directory 環境では、Azure AD ポータルでカスタム スマート ロックアウトの設定を変更しても環境への影響はありません。

**Q:Azure AD パスワード保護で、System Center Operations Manager 管理パックは使用できますか?**

いいえ。

**Q:ポリシーが監査モードになるよう構成した場合でも Azure AD が依然として脆弱なパスワードを拒否しているのはなぜですか?**

監査モードがサポートされるのは、オンプレミスの Active Directory 環境でのみです。 Azure AD は、パスワードを評価する際、暗黙的に常に "強制" モードになります。

**Q:パスワードが Azure AD パスワード保護によって拒否された場合、ユーザーには従来の Windows エラー メッセージが表示されます。このエラー メッセージをカスタマイズして、実際に発生したことをユーザーに知らせることはできますか?**

いいえ。 ドメイン コントローラーによってパスワードが拒否されたときにユーザーに表示されるエラー メッセージは、ドメイン コントローラーではなく、クライアント コンピューターによって制御されています。 この動作は、パスワードが既定の Active Directory パスワード ポリシーによって拒否されたか、または Azure AD パスワード保護などのパスワード フィルター ベースのソリューションによって拒否されたかにかかわらず、発生します。

## <a name="additional-content"></a>その他のコンテンツ

次のリンクは、主要な Azure AD パスワード保護ドキュメントに含まれませんが、機能の有用な追加の情報源になる場合があります。

[Azure AD Password Protection is now generally available! (Azure AD パスワード保護の一般提供が開始されました)](https://techcommunity.microsoft.com/t5/Azure-Active-Directory-Identity/Azure-AD-Password-Protection-is-now-generally-available/ba-p/377487)

[Email Phishing Protection Guide – Part 15:Implement the Microsoft Azure AD Password Protection Service (for On-Premises too!)](http://kmartins.com/2018/10/14/email-phishing-protection-guide-part-15-implement-the-microsoft-azure-ad-password-protection-service-for-on-premises-too/) (電子メールのフィッシング保護ガイド – パート 15: Microsoft Azure AD パスワード保護サービス (オンプレミスの場合も))

[Azure AD Password Protection and Smart Lockout are now in Public Preview!](https://techcommunity.microsoft.com/t5/Azure-Active-Directory-Identity/Azure-AD-Password-Protection-and-Smart-Lockout-are-now-in-Public/ba-p/245423#M529) (Azure AD パスワード保護およびスマート ロックアウトがパブリック プレビュー段階になりました)

## <a name="microsoft-premierunified-support-training-available"></a>Microsoft Premier\Unified サポート トレーニングの提供開始

Azure AD パスワード保護の詳細と環境へのデプロイに興味がある場合は、Premier または Unified サポート契約のお客様が利用可能なマイクロソフト事前対応型サービスを利用できます。 サービスは、Azure Active Directory:パスワード保護と呼ばれます。 詳細については、テクニカル アカウント マネージャーにお問い合わせください。

## <a name="next-steps"></a>次のステップ

ここでは回答されていないオンプレミスの Azure AD パスワード保護に関するご質問がある場合、以下のフィードバック項目を送信してください。

[Azure AD のパスワード保護をデプロイする](howto-password-ban-bad-on-premises-deploy.md)