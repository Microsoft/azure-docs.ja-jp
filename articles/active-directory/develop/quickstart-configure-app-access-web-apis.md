---
title: クイック スタート:Web API にアクセスするためにアプリを構成する | Azure
titleSuffix: Microsoft identity platform
description: このクイックスタートでは、Web API にアクセスするためのリダイレクト URI、資格情報、またはアクセス許可を含めるように、Microsoft ID プラットフォームに登録されたアプリを構成します。
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: quickstart
ms.workload: identity
ms.date: 08/05/2020
ms.author: ryanwi
ms.custom: aaddev
ms.reviewer: lenalepa, aragra, sureshja
ms.openlocfilehash: 87c21587567ffe3462e4b702985114ac10454886
ms.sourcegitcommit: a2a7746c858eec0f7e93b50a1758a6278504977e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/12/2020
ms.locfileid: "88140804"
---
# <a name="quickstart-configure-a-client-application-to-access-a-web-api"></a>クイック スタート:Web API にアクセスするようにクライアント アプリケーションを構成する

このクイックスタートでは、アプリケーションの Web API にアクセスするためのリダイレクト URI、資格情報、またはアクセス許可を追加します。 Web または機密クライアント アプリケーションでは、認証を必要とする承認付与フローに参加するために、セキュリティで保護された資格情報を確立する必要があります。 Azure portal でサポートされている既定の認証方法は、クライアント ID と秘密鍵の組み合わせです。 このプロセス中にアプリによってアクセス トークンが取得されます。

Microsoft Graph API などのリソース アプリケーションによって公開されている Web API にクライアントがアクセスできるようにするため、先に同意フレームワークによって、クライアントが要求されたアクセス許可に必要なアクセス許可を確実に取得することが保証されます。 既定では、すべてのアプリケーションが Microsoft Graph API にアクセス許可を要求できます。

## <a name="prerequisites"></a>前提条件

* アクティブなサブスクリプションが含まれる Azure アカウント。 [無料でアカウントを作成できます](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)。
* 次の項目の完了: 「[クイックスタート: Web API を公開するようにアプリケーションを構成する](quickstart-configure-app-expose-web-apis.md)」。

## <a name="sign-in-to-the-azure-portal-and-select-the-app"></a>Azure portal にサインインしてアプリを選択する

1. 職場または学校アカウントか、個人の Microsoft アカウントを使用して、[Azure portal](https://portal.azure.com) にサインインします。
1. お使いのアカウントで複数のテナントにアクセスできる場合は、右上隅で自分のアカウントをクリックします。 ポータル セッションを目的の Azure AD テナントに設定します。
1. **Azure Active Directory** を検索して選択します。 **[管理]** の **[アプリの登録]** を選択します。
1. 構成するアプリケーションを探して選択します。 アプリを選択すると、アプリケーションの **[概要]** またはメイン登録ページが表示されます。

Web API にアクセスするようにアプリケーションを構成するには、以下の手順を使用します。

## <a name="add-redirect-uris-to-your-application"></a>リダイレクト URI をアプリケーションに追加する

カスタム リダイレクト URI と推奨されるリダイレクト URI をアプリケーションに追加できます。 Web およびパブリック クライアント アプリケーションにカスタム リダイレクト URI を追加するには:

1. アプリの **[概要]** ページで、 **[認証]** を選択します。
1. **リダイレクト URI** を特定します。 場合によっては、 **[前のエクスペリエンスに切り替える]** を選択する必要があります。
1. ビルドしているアプリケーションの種類を選択します。**Web** または **パブリック クライアント/ネイティブ (モバイルとデスクトップ)** 。
1. アプリケーションのリダイレクト URI を入力します。

   * Web アプリケーションの場合は、アプリケーションのベース URL を指定します。 ローカル コンピューターで実行されている Web アプリケーションの URL であれば、たとえば `http://localhost:31544` のようになります。 ユーザーはこの URL を使用して、Web クライアント アプリケーションにサインインすることになります。
   * パブリック アプリケーションの場合は、トークン応答を返すために Azure AD に使用される URI を指定します。 `https://MyFirstApp` など、ご自分のアプリケーションに固有の値を入力してください。
1. **[保存]** を選択します。

パブリック クライアントに推奨されるリダイレクト URI の中から選択するには:

1. アプリの **[概要]** ページで、 **[認証]** を選択します。
1. **パブリック クライアント (モバイル、デスクトップ) に推奨されるリダイレクト URI** を特定します。 場合によっては、 **[前のエクスペリエンスに切り替える]** を選択する必要があります。
1. アプリケーションのリダイレクト URI を 1 つ以上選択します。 カスタム リダイレクト URI を入力することもできます。 何を使えばよいかわからない場合は、ライブラリのドキュメントを参照してください。
1. **[保存]** を選択します。

リダイレクト URI には、特定の制限が適用されます。 詳細については、「[リダイレクト URI および応答 URL に関する制約と制限](./reply-url.md)」を参照してください。

> [!NOTE]
> 新しい**認証**設定エクスペリエンスを試してみてください。このエクスペリエンスでは、対象とするプラットフォームまたはデバイスに基づいてアプリケーションの設定を構成できます。
>
> このビューを表示するには、 **[認証]** ページで **[新しいエクスペリエンスを試す]** を選択します。
>
> ![[新しいエクスペリエンスを試す] をクリックして、[プラットフォーム構成] ビューを表示する](./media/quickstart-update-azure-ad-app-preview/authentication-try-new-experience-cropped.png)
>
> この操作により、[新しい **[プラットフォーム構成]** ページ](#configure-platform-settings-for-your-application)が表示されます。

### <a name="configure-advanced-settings-for-your-application"></a>アプリケーションの詳細設定を構成する

登録するアプリケーションに応じて、次のようないくつかの追加設定を構成する必要があります。

* **[ログアウト URL]** 。
* シングルページ アプリの場合は、 **[暗黙の付与]** を有効にし、承認エンドポイントによって発行されるトークンを選択できます。
* 統合 Windows 認証、デバイス コード フロー、または **[既定のクライアントの種類]** セクションのユーザー名およびパスワードを使用してトークンを取得しているデスクトップ アプリの場合は、 **[アプリケーションは、パブリック クライアントとして扱います]** 設定を **[はい]** に設定します。
* Live SDK を使用して Microsoft アカウント サービスと統合していたレガシ アプリの場合は、 **[Live SDK サポート]** を構成します。 新しいアプリでは、この設定は必要ありません。
* **既定のクライアントの種類**。
* **サポートされているアカウントの種類**。

### <a name="modify-supported-account-types"></a>サポートされるアカウントの種類を変更する

**[サポートされているアカウントの種類]** では、アプリケーションを使用できるユーザーまたは API にアクセスできるユーザーを指定します。

アプリケーションの登録時にサポートされているアカウントの種類を構成した場合は、次の場合にのみ、アプリケーション マニフェスト エディターを使用してこの設定を変更できます。

* アカウントの種類を **AzureADMyOrg** または **AzureADMultipleOrgs** から **AzureADandPersonalMicrosoftAccount** に、またはその逆に変更する場合。
* アカウントの種類を **AzureADMyOrg** から **AzureADMultipleOrgs** に、またはその逆に変更する場合。

既存のアプリの登録に対して、サポートされているアカウントの種類を変更するには、`signInAudience` キーを更新します。 詳細については、[アプリケーション マニフェストの構成](reference-app-manifest.md#configure-the-app-manifest)に関するページを参照してください。

## <a name="configure-platform-settings-for-your-application"></a>アプリケーションのプラットフォーム設定を構成する

![プラットフォームまたはデバイスに基づいてアプリの設定を構成する](./media/quickstart-update-azure-ad-app-preview/authentication-new-platform-configurations.png)

プラットフォームまたはデバイスに基づいてアプリケーション設定を構成するには、以下のものが対象になります。

1. [**プラットフォーム構成]** ページで、 **[プラットフォームを追加]** を選択し、使用可能なオプションを選択します。

   ![[プラットフォームの構成] ページを表示](./media/quickstart-update-azure-ad-app-preview/authentication-platform-configurations-configure-platforms.png)

1. 選択したプラットフォームに基づいて設定情報を入力します。

   | プラットフォーム                | 構成設定            |
   |-------------------------|-----------------------------------|
   | **Web**              | アプリケーションの**リダイレクト URI** を入力します。 |
   | **iOS / macOS**              | アプリの**バンドル ID** を入力します。これは、Info.plist の XCode または [ビルド設定] で見つけることができます。 バンドル ID を追加すると、アプリケーションのリダイレクト URI が自動的に作成されます。 |
   | **Android**          | アプリの**パッケージ名**を指定します。これは、AndroidManifest.xml ファイルで見つけることができます。<br/>**署名ハッシュ**を生成して入力します。 署名ハッシュを追加すると、アプリケーションのリダイレクト URI が自動的に作成されます。  |
   | **モバイル アプリケーションとデスクトップ アプリケーション**  | 省略可能。 デスクトップとデバイス用のアプリを構築している場合は、 **[推奨されるリダイレクト URI]** でいずれかを選択します。<br/>省略可能。 **カスタム リダイレクト URI** を入力します。これは、Azure AD が認証要求に応答してユーザーをリダイレクトする場所として使用されます。 たとえば、対話が必要な .NET Core アプリケーションの場合、`http://localhost` を使用します。 |

   > [!NOTE]
   > Active Directory フェデレーション サービス (AD FS) および Azure AD B2C では、ポート番号も指定する必要があります。  (例: `http://localhost:1234`)。

   > [!IMPORTANT]
   > 最新の Microsoft Authentication Library (MSAL) を使用していない、またはブローカーを使用していないモバイル アプリケーションでは、これらのアプリケーションのリダイレクト URI を **[デスクトップとデバイス]** で構成する必要があります。

選択したプラットフォームによっては、構成できる追加の設定がある場合があります。 **Web** アプリの場合は、以下のことができます。

* さらにリダイレクト URI を追加する
* **暗黙的な許可**を構成して、次のように、承認エンドポイントによって発行されるトークンを選択する。

  * シングルページ アプリの場合は、 **[アクセス トークン]** と **[ID トークン]** の両方を選択します
  * Web アプリの場合は、 **[ID トークン]** を選択します

## <a name="add-credentials-to-your-web-application"></a>資格情報を Web アプリケーションに追加する

Web アプリケーションに資格情報を追加するには、証明書を追加するか、クライアント シークレットを作成します。 証明書を追加するには:

1. アプリの **[概要]** ページで、 **[証明書とシークレット]** セクションを選択します。
1. **[証明書のアップロード]** を選択します。
1. アップロードするファイルを選択します。 ファイルの種類は .cer、.pem、.crt のいずれかである必要があります。
1. **[追加]** を選択します。

クライアントシークレットを追加するには:

1. アプリの **[概要]** ページで、 **[証明書とシークレット]** セクションを選択します。
1. **[新しいクライアント シークレット]** を選択します。
1. クライアント シークレットの説明を追加します。
1. 期間を選択します。
1. **[追加]** を選択します。

> [!NOTE]
> 構成の変更を保存すると、右端の列にクライアント シークレットの値が格納されます。 クライアント アプリケーションのコードで使用するので、**必ず値をコピーしておいてください**。このページを一度閉じると、値にアクセスできなくなります。

## <a name="add-permissions-to-access-web-apis"></a>Web API にアクセスするためのアクセス許可を追加する

[Graph API のサインインとユーザー プロファイルの読み取りアクセス許可](/graph/permissions-reference#user-permissions)が既定で選択されています。 Web API ごとに [2 種類のアクセス許可](developer-glossary.md#permissions)から選択できます。

* **アプリケーションのアクセス許可**。 クライアント アプリケーションは、アプリケーション自体として (ユーザー コンテキストなしで) Web API に直接アクセスする必要があります。 この種類のアクセス許可には、管理者の同意が必要です。 このアクセス許可は、デスクトップおよびモバイルのクライアント アプリケーションでは使用できません。
* **委任されたアクセス許可**。 クライアント アプリケーションは、サインインしているユーザーとして Web API にアクセスする必要があります。アクセスにあたっては、選択されているアクセス許可に応じて制限が適用されます。 この種類のアクセス許可は、管理者の同意が必要でない限り、ユーザーが付与できます。

  > [!NOTE]
  > 委任されたアクセス許可をアプリケーションに追加しても、テナント内のユーザーに対して自動的に同意が与えられるわけではありません。 管理者がすべてのユーザーに代わって同意を許可しない限り、ユーザーはやはり追加された委任されたアクセス許可に実行時に手動で同意する必要があります。

クライアントからリソース API にアクセスするためのアクセス許可を追加するには:

1. アプリの **[概要]** ページで、 **[API のアクセス許可]** を選択します。
1. **[構成されたアクセス許可]** の下で **[アクセス許可の追加]** を選択します。
1. 既定では、ビューで **[Microsoft API]** から選択することができます。 次の中から、目的の API のセクションを選択します。

    * **Microsoft API**。 Microsoft Graph などの Microsoft API のアクセス許可を選択することができます。
    * **所属する組織で使用している API**。 組織によって公開されている API、または組織が統合した API のアクセス許可を選択することができます。
    * **自分の API**。 自分で公開した API のアクセス許可を選択することができます。

1. API を選択すると、 **[API アクセス許可の要求]** ページが表示されます。 委任されたアクセス許可とアプリケーションのアクセス許可の両方を API が公開している場合は、アプリケーションに必要なアクセス許可の種類を選択します。
1. 完了したら、 **[アクセス許可の追加]** を選択します。

**[API のアクセス許可]** ページに戻ります。 アクセス許可が保存され、テーブルに追加されています。

## <a name="understanding-api-permissions-and-admin-consent-ui"></a>API のアクセス許可および管理者の同意の UI の理解

### <a name="configured-permissions"></a>構成されたアクセス許可

このセクションでは、アプリケーション オブジェクトで明示的に構成されたアクセス許可を示します。 これらのアクセス許可は、アプリの必須リソース アクセス リストの一部です。 この表のアクセス許可を追加または削除できます。 管理者はまた、一連の API のアクセス許可または個々のアクセス許可に管理者の同意を付与したり、取り消したりすることもできます。

### <a name="other-permissions-granted"></a>付与されたその他のアクセス許可

アプリケーションがテナントで登録されている場合は、 **[Other permissions granted for Tenant] (テナントに付与されたその他のアクセス許可)** というタイトルの追加のセクションが表示されることがあります。 このセクションでは、アプリケーション オブジェクトで明示的に構成されていないテナントに付与されたアクセス許可を示します。 これらのアクセス許可は動的に要求され、同意されます。 このセクションは、適用されるアクセス許可が少なくとも 1 つ存在する場合にのみ表示されます。

このセクションに表示される一連の API のアクセス許可または個々のアクセス許可を **[構成されたアクセス許可]** セクションに追加できます。 管理者はまた、このセクションの個々の API またはアクセス許可への管理者の同意を取り消すこともできます。

### <a name="admin-consent-button"></a>管理者の同意のボタン

アプリケーションがテナントで登録されている場合は、 **[Grant admin consent for Tenant]\(テナントに管理者の同意を付与する\)** ボタンが表示されます。 これは、管理者でない場合、またはアプリケーションにアクセス許可が構成されていない場合は無効になります。
管理者は、このボタンを使用して、アプリケーションに対して構成されたアクセス許可に管理者の同意を付与できます。 管理者の同意のボタンをクリックすると、新しいウィンドウが開き、すべての構成されたアクセス許可を示す同意プロンプトが表示されます。

> [!NOTE]
> アクセス許可がアプリケーションに対して構成されてから、同意プロンプトに表示されるまでには遅延が発生します。 同意プロンプトにすべての構成されたアクセス許可が表示されない場合は、それを閉じて再度起動してください。

アクセス許可が付与されていても構成されていない場合、管理者の同意ボタンをクリックすると、これらのアクセス許可を処理するように求められます。 構成されたアクセス許可に追加するか、または削除することができます。

同意プロンプトには、 **[許可]** または **[キャンセル]** のオプションが表示されます。 管理者の同意を付与するには **[同意する]** を選択します。 **[キャンセル]** を選択すると、管理者の同意は付与されません。 同意が拒否されたことを示すエラー メッセージが表示されます。

> [!NOTE]
> 同意プロンプトで **[同意する]** を選択して管理者の同意を付与してから、ポータルに管理者の同意の状態が反映されるまでには遅延が発生します。

## <a name="next-steps"></a>次のステップ

このシリーズの次のクイックスタートに進んで、アプリケーションにアクセスできるアカウントの種類を構成する方法を確認してください。 たとえば、組織内のユーザーのみにアクセスを制限したり (シングルテナント)、他の Azure AD テナントのユーザーを許可したり (マルチテナント)、個人用 Microsoft アカウントを持つユーザーを許可したり (MSA) することができます。

> [!div class="nextstepaction"]
> [アプリケーションによってサポートされるアカウントを変更する](quickstart-modify-supported-accounts.md)