---
title: Azure を通じた SaaS の販売 - API | Microsoft Docs
description: Marketplace API を通じて SaaS オファーを作成する方法について説明します。
services: Azure, Marketplace, Cloud Partner Portal,
documentationcenter: ''
author: v-miclar
manager: Patrick.Butler
editor: ''
ms.assetid: ''
ms.service: marketplace
ms.workload: ''
ms.tgt_pltfrm: ''
ms.devlang: ''
ms.topic: reference
ms.date: 09/17/2018
ms.author: pbutlerm
ms.openlocfilehash: d6ab18d68d6508a18f0b36ab5a39e15fa7c0555a
ms.sourcegitcommit: 90dcc3d427af1264d6ac2b9bde6cdad364ceefcc
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/21/2019
ms.locfileid: "58311664"
---
# <a name="saas-sell-through-azure---apis"></a>Azure を通じた SaaS の販売 - API

この記事では、API を使用して SaaS オファーを作成する方法について説明します。 API は、Azure を通じた販売を選択した場合に、SaaS オファーへのサブスクリプションを許可するために必要です。  この記事は、次の 2 つのセクションに分かれています。

-   SaaS サービスと Azure Marketplace とのサービス間認証
-   API メソッドとエンドポイント

SaaS サービスと Azure の統合を支援するために、以下の API シリーズが用意されています。

-   解決
-   購入
-   Convert
-   サブスクライブ解除

次の図は、新しい顧客のサブスクリプションのフローと、これらの API をいつ使用するかを示しています。

![SaaS オファーの API フロー](./media/saas-offer-publish-api-flow.png)


## <a name="service-to-service-authentication-between-saas-service-and-azure-marketplace"></a>SaaS サービスと Azure Marketplace とのサービス間認証

Azure では、SaaS サービスがそのエンド ユーザーに公開する認証に対して、制約がありません。 ただし、Azure Marketplace API シリーズと通信する SaaS サービスについては、Azure Active Directory (Azure AD) アプリケーションのコンテキストで認証が行われます。

次のセクションでは、Azure AD アプリケーションを作成する方法について説明します。


### <a name="register-an-azure-ad-application"></a>Azure AD アプリケーションの登録

アプリケーションで Azure AD の機能を使用するには、まず Azure AD テナントにそのアプリケーションを登録する必要があります。 この登録プロセスでは、アプリケーションが配置されている URL、ユーザーが認証された後の応答の送信先となる URL、アプリを識別する URI など、アプリケーションの詳細を Azure AD に提供します。

Azure portal を使用して新しいアプリケーションを登録するには、次の手順を実行します。

1. [Azure Portal](https://portal.azure.com/) にサインインします。
2. ご利用のアカウントで複数の Azure AD テナントにアクセスできる場合は、右上隅でアカウントをクリックし、ポータルのセッションを目的のテナントに設定します。
3. 左側のナビゲーション ウィンドウで、**[Azure Active Directory]** サービスをクリックし、**[アプリの登録]**、**[新しいアプリケーションの登録]** の順にクリックします。

   ![SaaS AD のアプリ登録](./media/saas-offer-app-registration.png)

4. 作成\' ページで、アプリケーションの登録情報を入力します。
   - **[名前]**:わかりやすいアプリケーション名を入力します
   - **アプリケーションの種類**: 
     - デバイスのローカルにインストールされている[クライアント アプリケーション](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#client-application)については、**[ネイティブ]** を選択します。 OAuth の public [ネイティブ クライアント](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#native-client)の場合には、この設定を使用します。
     - セキュリティで保護されたサーバーにインストールされている[クライアント アプリケーション](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#client-application)と[リソース/API アプリケーション](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#resource-server)については、**[Web アプリ/API]** を選択します。 OAuth のコンフィデンシャル [Web クライアント](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#web-client)と、パブリック [ユーザーエージェントベース クライアント](https://docs.microsoft.com/azure/active-directory/develop/active-directory-dev-glossary#user-agent-based-client)の場合には、この設定を使用します。
     同じアプリケーションでクライアントとリソース/API を両方とも公開することもできます。
   - **サインオン URL**:Web アプリまたは API アプリケーションの場合は、アプリのベース URL を指定します。 ローカル コンピューターで実行されている Web アプリの URL であれば、たとえば **http:\//localhost:31544** のようになります。 ユーザーはこの URL を使用して、Web クライアント アプリケーションにサインインすることになります。
   - **リダイレクト URI**:ネイティブ アプリケーションの場合は、トークン応答を返すために Azure AD に使用される URI を指定します。 **http:\//MyFirstAADAppなど、ご自分のアプリケーションに固有の値を入力してください。**

     ![SaaS AD アプリの登録](./media/saas-offer-app-registration-2.png) Web アプリケーションまたはネイティブ アプリケーションの具体的な例については、[Azure AD 開発者向けガイド](https://docs.microsoft.com/azure/active-directory/develop/active-directory-developers-guide)に関する記事の開始セクションで利用できるクイック スタート ガイド付きセットアップを確認してください。

5. 完了したら、**[作成]** をクリックします。 Azure AD によってアプリケーションに一意の ID が割り当てられ、アプリケーションのメイン登録ページが表示されます。 アプリケーションが Web アプリケーションとネイティブ アプリケーションのどちらであるかに応じて、アプリケーションに機能を追加するためのさまざまなオプションが表示されます。

   **注:** 既定では、新しく登録されたアプリケーションは、同じテナントのユーザーのみがサインインできる構成になります。

<a name="api-methods-and-endpoints"></a>API メソッドとエンドポイント
-------------------------

以降のセクションでは、SaaS オファーのサブスクリプションを有効にするために使用できる API メソッドとエンドポイントについて説明します。

### <a name="get-a-token-based-on-the-azure-ad-app"></a>Azure AD アプリに基づいたトークンの取得

HTTP メソッド

`GET`

*要求 URL*

**https://login.microsoftonline.com/*{tenantId}*/oauth2/token**

*URI パラメーター*

|  **パラメーター名**  | **必須**  | **説明**                               |
|  ------------------  | ------------- | --------------------------------------------- |
| tenantId             | True          | 登録された AAD アプリケーションのテナント ID   |
|  |  |  |


*要求ヘッダー*

|  **ヘッダー名**  | **必須** |  **説明**                                   |
|  --------------   | ------------ |  ------------------------------------------------- |
|  Content-Type     | True         | 要求に関連付けられたコンテンツの種類。 既定値は `application/x-www-form-urlencoded` です。  |
|  |  |  |


*要求本文*

| **プロパティ名**   | **必須** |  **説明**                                                          |
| -----------------   | -----------  | ------------------------------------------------------------------------- |
|  Grant_type         | True         | 付与タイプ。 既定値は `client_credentials` です。                    |
|  Client_id          | True         |  Azure AD アプリに関連付けられているクライアントまたはアプリの識別子。                  |
|  client_secret      | True         |  Azure AD アプリに関連付けられているパスワード。                               |
|  リソース           | True         |  トークンを要求されたターゲット リソース。 既定値は `62d94f6c-d599-489b-a797-3e10e42fbe22` です。 |
|  |  |  |


*応答*

|  **名前**  | **種類**       |  **説明**    |
| ---------- | -------------  | ------------------- |
| 200 OK    | TokenResponse  | 要求成功   |
|  |  |  |

*TokenResponse*

サンプル応答トークン:

``` json
  {
      "token_type": "Bearer",
      "expires_in": "3600",
      "ext_expires_in": "0",
      "expires_on": "15251…",
      "not_before": "15251…",
      "resource": "62d94f6c-d599-489b-a797-3e10e42fbe22",
      "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6ImlCakwxUmNxemhpeTRmcHhJeGRacW9oTTJZayIsImtpZCI6ImlCakwxUmNxemhpeTRmcHhJeGRacW9oTTJZayJ9…"
  }               
```

### <a name="marketplace-api-endpoint-and-api-version"></a>Marketplace API エンドポイントと API バージョン

Azure Marketplace API のエンドポイントは、`https://marketplaceapi.microsoft.com` です。

現在の API バージョンは、`api-version=2017-04-15` です。


### <a name="resolve-subscription"></a>サブスクリプションの解決

解決エンドポイントでの POST アクションにより、ユーザーはマーケットプレース トークンを永続的なリソース ID に解決できます。  リソース ID は、SAAS サブスクリプションの一意の識別子です。 

ユーザーが ISV の Web サイトにリダイレクトされると、URL に、クエリ パラメーターのトークンが含まれます。 ISV は、このトークンを使用し、それを解決するための要求を行うことが期待されます。 応答には、リソースの一意の SAAS サブスクリプション ID、名前、オファーID、およびプランが含まれます。 このトークンは、1 時間だけ有効です。

*要求*

**POST**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions/resolve?api-version=2017-04-15**

|  **パラメーター名** |     **説明**                                      |
|  ------------------ |     ---------------------------------------------------- |
|  api-version        |  この要求で使用する操作のバージョン。   |
|  |  |


*ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                                                                                                                                                  |
|--------------------|--------------|-----------------------------------------------------------|
| x-ms-requestid     | いいえ            | クライアントからの要求を追跡するための一意の文字列値 (GUID を推奨)。 この値を指定しないと、値が生成され、応答ヘッダーに指定されます。  |
| x-ms-correlationid | いいえ            | クライアントでの操作に対する一意の文字列値。 これによって、クライアント操作からのすべてのイベントがサーバー側のイベントに関連付けられます。 この値を指定しないと、値が生成され、応答ヘッダーに指定されます。 |
| Content-type       | はい          | `application/json`                                        |
| authorization      | はい          | JSON Web トークン (JWT) ベアラー トークン。                    |
| x-ms-marketplace-token| はい| ユーザーが Azure から SaaS ISV の Web サイトにリダイレクトされるときの、URL のトークン クエリ パラメーター。 **注:** このトークンは 1 時間のみ有効です。 また、ブラウザーからのトークン値は、使用前に URL によってデコードされます。|
|  |  |  |
  

*応答本文*

``` json
{
    "id": "",
    "subscriptionName": "",
    "offerId": "",
    "planId": "",
}
```

| **パラメーター名** | **データの種類** | **説明**                       |
|--------------------|---------------|---------------------------------------|
| id                 | String        | SaaS サブスクリプションの ID。          |
| subscriptionName| String| SaaS サービスへのサブスクライブ中に、Azure でユーザーによって設定される SaaS サブスクリプションの名前。|
| OfferId            | String        | ユーザーがサブスクライブするオファー ID。 |
| planId             | String        | ユーザーがサブスクライブするプラン ID。  |
|  |  |  |


*応答コード*

| **HTTP 状態コード** | **エラー コード**     | **説明**                                                                         |
|----------------------|--------------------| --------------------------------------------------------------------------------------- |
| 200                  | `OK`                 | トークンが正常に解決されました。                                                            |
| 400                  | `BadRequest`         | 必須のヘッダーがないか、無効な api-version が指定されています。 トークンが正しくない形式であるか期限切れになっているため、トークンの解決に失敗しました (トークンは生成後 1 時間のみ有効です)。 |
| 403                  | `Forbidden`          | 呼び出し元には、この操作の実行権限がありません。                                 |
| 429                  | `RequestThrottleId`  | サービスが要求の処理でビジー状態になっています。後で再試行してください。                                |
| 503                  | `ServiceUnavailable` | サービスが一時的にダウンしています。後で再試行してください。                                        |
|  |  |  |


*応答ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | はい          | クライアントから受け取った要求 ID。                                                                   |
| x-ms-correlationid | はい          | クライアントから渡される場合は、関連付け ID。そうでない場合は、この値はサーバー関連付け ID。                   |
| x-ms-activityid    | はい          | サービスからの要求を追跡するための一意の文字列値。 これは、任意の調整に使用されます。 |
| Retry-After        | いいえ            | この値は、429 応答に対してのみ設定されます。                                                                   |
|  |  |  |


### <a name="subscribe"></a>購入

サブスクライブ エンドポイントを使用すると、ユーザーは指定したプランの SaaS サービスへのサブスクリプションを開始し、商取引システムで課金を有効にすることができます。

**PUT**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions/*{subscriptionId}*?api-version=2017-04-15**

| **パラメーター名**  | **説明**                                       |
|---------------------|-------------------------------------------------------|
| subscriptionId      | Resolve API を使用してトークンを解決した後に取得される SaaS サブスクリプションの一意の ID。                              |
| api-version         | この要求で使用する操作のバージョン。 |
|  |  |

*ヘッダー*

|  **ヘッダー キー**        | **必須** |  **説明**                                                  |
| ------------------     | ------------ | --------------------------------------------------------------------------------------- |
| x-ms-requestid         |   いいえ          | クライアントからの要求を追跡するための一意の文字列値 (GUID を推奨)。 これを指定しないと、値が生成され、応答ヘッダーに指定されます。 |
| x-ms-correlationid     |   いいえ          | クライアントでの操作に対する一意の文字列値。 この値は、クライアント操作からのすべてのイベントをサーバー側のイベントに関連付けるためのものです。 これを指定しないと、値が生成され、応答ヘッダーに指定されます。 |
| If-Match/If-None-Match |   いいえ          |   強力な検証ツールの ETag 値。                                                          |
| content-type           |   はい        |    `application/json`                                                                   |
|  authorization         |   はい        |    JSON Web トークン (JWT) ベアラー トークン。                                               |
| x-ms-marketplace-session-mode| いいえ  | SaaS オファーへのサブスクライブ中にドライ ラン モードを有効にするフラグ。 設定すると、サブスクリプションは課金されません。 これは、ISV テスト シナリオで役に立ちます。 **"dryrun"** に設定してください|
|  |  |  |

*本文*

``` json
{
    "lanId": "",
}
```

| **要素名** | **データの種類** | **説明**                      |
|------------------|---------------|--------------------------------------|
| planId           | (必須) 文字列        | ユーザーがサブスクライブする SaaS サービスのプラン ID。  |
|  |  |  |

*応答コード*

| **HTTP 状態コード** | **エラー コード**     | **説明**                                                           |
|----------------------|--------------------|---------------------------------------------------------------------------|
| 202                  | `Accepted`           | 指定されたプランに対して受け取った SaaS サブスクリプションのアクティブ化。                   |
| 400                  | `BadRequest`         | 必要なヘッダーがないか、JSON の本体の形式が正しくありません。 |
| 403                  | `Forbidden`          | 呼び出し元には、この操作の実行権限がありません。                   |
| 404                  | `NotFound`           | 指定された ID のサブスクリプションが見つかりません                                  |
| 409                  | `Conflict`           | サブスクリプションで別の操作が進行中です。                     |
| 429                  | `RequestThrottleId`  | サービスが要求の処理でビジー状態になっています。後で再試行してください。                  |
| 503                  | `ServiceUnavailable` | サービスが一時的にダウンしています。後で再試行してください。                          |
|  |  |  |

202 応答の場合は、"Operation-location" ヘッダーで要求操作の状態を追跡します。 認証は、他の Marketplace API と同じです。

*応答ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | はい          | クライアントから受け取った要求 ID。                                                                   |
| x-ms-correlationid | はい          | クライアントから渡される場合は、関連付け ID。そうでない場合は、この値はサーバー関連付け ID。                   |
| x-ms-activityid    | はい          | サービスからの要求を追跡するための一意の文字列値。 この値は、任意の調整に使用されます。 |
| Retry-After        | はい          | クライアントが状態を確認できる間隔。                                                       |
| Operation-Location | はい          | 操作状態を取得するリソースへのリンク。                                                        |
|  |  |  |

### <a name="change-plan-endpoint"></a>変更プラン エンドポイント

変更エンドポイントを使用すると、ユーザーは現在サブスクライブしているプランを新しいプランに変換することができます。

**PATCH**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions/*{subscriptionId}*?api-version=2017-04-15**

| **パラメーター名**  | **説明**                                       |
|---------------------|-------------------------------------------------------|
| subscriptionId      | SaaS サブスクリプションの ID。                              |
| api-version         | この要求で使用する操作のバージョン。 |
|  |  |

*ヘッダー*

| **ヘッダー キー**          | **必須** | **説明**                                                                                                                                                                                                                  |
|-------------------------|--------------|---------------------------------------------------------------------------------------------------------------------|
| x-ms-requestid          | いいえ            | クライアントからの要求を追跡するための一意の文字列値。 GUID をお勧めします。 これを指定しないと、値が生成され、応答ヘッダーに指定されます。   |
| x-ms-correlationid      | いいえ            | クライアントでの操作に対する一意の文字列値。 この値は、クライアント操作からのすべてのイベントをサーバー側のイベントに関連付けるためのものです。 これを指定しないと、値が生成され、応答ヘッダーに指定されます。 |
| If-Match /If-None-Match | いいえ            | 強力な検証ツールの ETag 値。                              |
| content-type            | はい          | `application/json`                                        |
| authorization           | はい          | JSON Web トークン (JWT) ベアラー トークン。                    |
|  |  |  |

*本文*

```json
{
    "planId": ""
}
```

|  **要素名** |  **データの種類**  | **説明**                              |
|  ---------------- | -------------   | --------------------------------------       |
|  planId           |  (必須) 文字列         | ユーザーがサブスクライブする SaaS サービスのプラン ID。          |
|  |  |  |

*応答コード*

| **HTTP 状態コード** | **エラー コード**     | **説明**                                                           |
|----------------------|--------------------|---------------------------------------------------------------------------|
| 202                  | `Accepted`           | 指定されたプランに対して受け取った SaaS サブスクリプションのアクティブ化。                   |
| 400                  | `BadRequest`         | 必要なヘッダーがないか、JSON の本体の形式が正しくありません。 |
| 403                  | `Forbidden`          | 呼び出し元には、この操作の実行権限がありません。                   |
| 404                  | `NotFound`           | 指定された ID のサブスクリプションが見つかりません                                  |
| 409                  | `Conflict`           | サブスクリプションで別の操作が進行中です。                     |
| 429                  | `RequestThrottleId`  | サービスが要求の処理でビジー状態になっています。後で再試行してください。                  |
| 503                  | `ServiceUnavailable` | サービスが一時的にダウンしています。後で再試行してください。                          |
|  |  |  |

*応答ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | はい          | クライアントから受け取った要求 ID。                                                                   |
| x-ms-correlationid | はい          | クライアントから渡される場合は、関連付け ID。そうでない場合は、この値はサーバー関連付け ID。                   |
| x-ms-activityid    | はい          | サービスからの要求を追跡するための一意の文字列値。 この値は、任意の調整に使用されます。 |
| Retry-After        | はい          | クライアントが状態を確認できる間隔。                                                       |
| Operation-Location | はい          | 操作状態を取得するリソースへのリンク。                                                        |
|  |  |  |

### <a name="delete-subscription"></a>サブスクリプションを削除する

サブスクライブ エンドポイントでの DELETE アクションにより、ユーザーは特定の ID のサブスクリプションを削除することができます。

*要求*

**DELETE**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions/*{subscriptionId}*?api-version=2017-04-15**

| **パラメーター名**  | **説明**                                       |
|---------------------|-------------------------------------------------------|
| subscriptionId      | SaaS サブスクリプションの ID。                              |
| api-version         | この要求で使用する操作のバージョン。 |
|  |  |

*ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                                                                                                                                                  |
|--------------------|--------------| ----------------------------------------------------------|
| x-ms-requestid     | いいえ            | クライアントからの要求を追跡するための一意の文字列値。 GUID をお勧めします。 この値を指定しないと、値が生成され、応答ヘッダーに指定されます。                                                           |
| x-ms-correlationid | いいえ            | クライアントでの操作に対する一意の文字列値。 この値は、クライアント操作からのすべてのイベントをサーバー側のイベントに関連付けるためのものです。 これを指定しないと、値が生成され、応答ヘッダーに指定されます。 |
| authorization      | はい          | JSON Web トークン (JWT) ベアラー トークン。                    |
|  |  |  |

*応答コード*

| **HTTP 状態コード** | **エラー コード**     | **説明**                                                           |
|----------------------|--------------------|---------------------------------------------------------------------------|
| 202                  | `Accepted`           | 指定されたプランに対して受け取った SaaS サブスクリプションのアクティブ化。                   |
| 400                  | `BadRequest`         | 必要なヘッダーがないか、JSON の本体の形式が正しくありません。 |
| 403                  | `Forbidden`          | 呼び出し元には、この操作の実行権限がありません。                   |
| 404                  | `NotFound`           | 指定された ID のサブスクリプションが見つかりません                                  |
| 429                  | `RequestThrottleId`  | サービスが要求の処理でビジー状態になっています。後で再試行してください。                  |
| 503                  | `ServiceUnavailable` | サービスが一時的にダウンしています。 後で再試行してください。                          |
|  |  |  |

202 応答の場合は、"Operation-location" ヘッダーで要求操作の状態を追跡します。 認証は、他の Marketplace API と同じです。

*応答ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | はい          | クライアントから受け取った要求 ID。                                                                   |
| x-ms-correlationid | はい          | クライアントから渡される場合は、関連付け ID。そうでない場合は、これはサーバー関連付け ID。                   |
| x-ms-activityid    | はい          | サービスからの要求を追跡するための一意の文字列値。 これは、任意の調整に使用されます。 |
| Retry-After        | はい          | クライアントが状態を確認できる間隔。                                                       |
| Operation-Location | はい          | 操作状態を取得するリソースへのリンク。                                                        |
|   |  |  |

### <a name="get-operation-status"></a>操作状態の取得

このエンドポイントを使用すると、ユーザーはトリガーされた非同期操作 (プランのサブスクライブ、サブスクライブ解除、変更) の状態を追跡できます。

*要求*

**GET**

**https://marketplaceapi.microsoft.com/api/saas/operations/*{operationId}*?api-version=2017-04-15**

| **パラメーター名**  | **説明**                                       |
|---------------------|-------------------------------------------------------|
| operationId         | トリガーされた操作の一意の ID。                |
| api-version         | この要求で使用する操作のバージョン。 |
|  |  |

*ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                                                                                                                                                  |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | いいえ            | クライアントからの要求を追跡するための一意の文字列値。 GUID をお勧めします。 この値を指定しないと、値が生成され、応答ヘッダーに指定されます。   |
| x-ms-correlationid | いいえ            | クライアントでの操作に対する一意の文字列値。 この値は、クライアント操作からのすべてのイベントをサーバー側のイベントに関連付けるためのものです。 この値を指定しないと、値が生成され、応答ヘッダーに指定されます。  |
| authorization      | はい          | JSON Web トークン (JWT) ベアラー トークン。                    |
|  |  |  | 

*応答本文*

```json
{
    "id": "",
    "status": "",
    "resourceLocation": "",
    "created": "",
    "lastModified": ""
}
```

| **パラメーター名** | **データの種類** | **説明**                                                                                                                                               |
|--------------------|---------------|-------------------------------------------------------------------------------------------|
| id                 | String        | 操作の ID。                                                                      |
| status             | 列挙型          | 操作の状態。`In Progress`、`Succeeded`、`Failed` のいずれか。          |
| resourceLocation   | String        | 作成または変更されたサブスクリプションへのリンク。 これは、POST 操作の更新された状態をクライアントが取得するために役立ちます。 この値は、`Unsubscribe` 操作には設定されません。 |
| created            | Datetime      | 操作の作成時刻 (UTC)。                                                           |
| lastModified       | Datetime      | 操作に対する最終更新 (UTC)。                                                      |
|  |  |  |

*応答コード*

| **HTTP 状態コード** | **エラー コード**     | **説明**                                                              |
|----------------------|--------------------|------------------------------------------------------------------------------|
| 200                  | `OK`                 | GET 要求が正常に解決され、本文に応答が含まれています。    |
| 400                  | `BadRequest`         | 必須のヘッダーがないか、無効な api-version が指定されました。 |
| 403                  | `Forbidden`          | 呼び出し元には、この操作の実行権限がありません。                      |
| 404                  | `NotFound`           | 指定された ID のサブスクリプションが見つかりません                                     |
| 429                  | `RequestThrottleId`  | サービスが要求の処理でビジー状態になっています。後で再試行してください。                     |
| 503                  | `ServiceUnavailable` | サービスが一時的にダウンしています。後で再試行してください。                             |
|  |  |  |

*応答ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | はい          | クライアントから受け取った要求 ID。                                                                   |
| x-ms-correlationid | はい          | クライアントから渡される場合は、関連付け ID。そうでない場合は、これはサーバー関連付け ID。                   |
| x-ms-activityid    | はい          | サービスからの要求を追跡するための一意の文字列値。 これは、任意の調整に使用されます。 |
| Retry-After        | はい          | クライアントが状態を確認できる間隔。                                                       |
|  |  |  |

### <a name="get-subscription"></a>サブスクリプションの取得

サブスクライブ エンドポイントでの GET アクションにより、ユーザーは特定のリソース ID のサブスクリプションを取得することができます。

*要求*

**GET**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions/*{subscriptionId}*?api-version=2017-04-15**

| **パラメーター名**  | **説明**                                       |
|---------------------|-------------------------------------------------------|
| subscriptionId      | SaaS サブスクリプションの ID。                              |
| api-version         | この要求で使用する操作のバージョン。 |
|  |  |

*ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                           |
|--------------------|--------------|-----------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | いいえ            | クライアントからの要求を追跡するための一意の文字列値 (GUID を推奨)。 この値を指定しないと、値が生成され、応答ヘッダーに指定されます。                                                           |
| x-ms-correlationid | いいえ            | クライアントでの操作に対する一意の文字列値。 この値は、クライアント操作からのすべてのイベントをサーバー側のイベントに関連付けるためのものです。 この値を指定しないと、値が生成され、応答ヘッダーに指定されます。 |
| authorization      | はい          | JSON Web トークン (JWT) ベアラー トークン。                                                                    |
|  |  |  |

*応答本文*

```json
{
    "id": "",
    "saasSubscriptionName": "",
    "offerId": "",
    "planId": "",
    "saasSubscriptionStatus": "",
    "created": "",
    "lastModified": ""
}
```

| **パラメーター名**     | **データの種類** | **説明**                               |
|------------------------|---------------|-----------------------------------------------|
| id                     | String        | Azure の SaaS サブスクリプション リソースの ID。    |
| offerId                | String        | ユーザーがサブスクライブするオファー ID。         |
| planId                 | String        | ユーザーがサブスクライブするプラン ID。          |
| saasSubscriptionName   | String        | SaaS サブスクリプションの名前。                |
| saasSubscriptionStatus | 列挙型          | 操作の状態。  次のいずれか:  <br/> - `Subscribed`:サブスクリプションがアクティブです。  <br/> - `Pending`:ユーザーがリソースを作成しますが、ISV によってアクティブ化されません。   <br/> - `Unsubscribed`:ユーザーがサブスクライブを解除しました。   <br/> - `Suspended`:ユーザーがサブスクリプションを中断しました。   <br/> - `Deactivated`:Azure サブスクリプションが中断されました。  |
| created                | Datetime      | サブスクリプション作成のタイムスタンプ値 (UTC)。 |
| lastModified           | Datetime      | サブスクリプション変更のタイムスタンプ値 (UTC)。 |
|  |  |  |

*応答コード*

| **HTTP 状態コード** | **エラー コード**     | **説明**                                                              |
|----------------------|--------------------|------------------------------------------------------------------------------|
| 200                  | `OK`                 | GET 要求が正常に解決され、本文に応答が含まれています。    |
| 400                  | `BadRequest`         | 必須のヘッダーがないか、無効な api-version が指定されました。 |
| 403                  | `Forbidden`          | 呼び出し元には、この操作の実行権限がありません。                      |
| 404                  | `NotFound`           | 指定された ID のサブスクリプションが見つかりません                                     |
| 429                  | `RequestThrottleId`  | サービスが要求の処理でビジー状態になっています。後で再試行してください。                     |
| 503                  | `ServiceUnavailable` | サービスが一時的にダウンしています。後で再試行してください。                             |
|  |  |  |

*応答ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | はい          | クライアントから受け取った要求 ID。                                                                   |
| x-ms-correlationid | はい          | クライアントから渡される場合は、関連付け ID。そうでない場合は、これはサーバー関連付け ID。                   |
| x-ms-activityid    | はい          | サービスからの要求を追跡するための一意の文字列値。 これは、任意の調整に使用されます。 |
| Retry-After        | いいえ            | クライアントが状態を確認できる間隔。                                                       |
| eTag               | はい          | 操作状態を取得するリソースへのリンク。                                                        |
|  |  |  |

### <a name="get-subscriptions"></a>サブスクリプションの取得

サブスクリプション エンドポイントでの GET アクションにより、ユーザーはすべてのオファーに関するすべてのサブスクリプションを ISV から取得することができます。

*要求*

**GET**

**https://marketplaceapi.microsoft.com/api/saas/subscriptions?api-version=2017-04-15**

| **パラメーター名**  | **説明**                                       |
|---------------------|-------------------------------------------------------|
| api-version         | この要求で使用する操作のバージョン。 |
|  |  |

*ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                           |
|--------------------|--------------|-----------------------------------------------------------|
| x-ms-requestid     | いいえ            | クライアントからの要求を追跡するための一意の文字列値。 GUID をお勧めします。 この値を指定しないと、値が生成され、応答ヘッダーに指定されます。             |
| x-ms-correlationid | いいえ            | クライアントでの操作に対する一意の文字列値。 この値は、クライアント操作からのすべてのイベントをサーバー側のイベントに関連付けるためのものです。 この値を指定しないと、値が生成され、応答ヘッダーに指定されます。 |
| authorization      | はい          | JSON Web トークン (JWT) ベアラー トークン。                    |
|  |  |  |

*応答本文*

```json
{
    "id": "",
    "saasSubscriptionName": "",
    "offerId": "",
    "planId": "",
    "saasSubscriptionStatus": "",
    "created": "",
    "lastModified": ""
}
```

| **パラメーター名**     | **データの種類** | **説明**                               |
|------------------------|---------------|-----------------------------------------------|
| id                     | String        | Azure の SaaS サブスクリプション リソースの ID。    |
| offerId                | String        | ユーザーがサブスクライブするオファー ID。         |
| planId                 | String        | ユーザーがサブスクライブするプラン ID。          |
| saasSubscriptionName   | String        | SaaS サブスクリプションの名前。                |
| saasSubscriptionStatus | 列挙型          | 操作の状態。  次のいずれか:  <br/> - `Subscribed`:サブスクリプションがアクティブです。  <br/> - `Pending`:ユーザーがリソースを作成しますが、ISV によってアクティブ化されません。   <br/> - `Unsubscribed`:ユーザーがサブスクライブを解除しました。   <br/> - `Suspended`:ユーザーがサブスクリプションを中断しました。   <br/> - `Deactivated`:Azure サブスクリプションが中断されました。  |
| created                | Datetime      | サブスクリプション作成のタイムスタンプ値 (UTC)。 |
| lastModified           | Datetime      | サブスクリプション変更のタイムスタンプ値 (UTC)。 |
|  |  |  |

*応答コード*

| **HTTP 状態コード** | **エラー コード**     | **説明**                                                              |
|----------------------|--------------------|------------------------------------------------------------------------------|
| 200                  | `OK`                 | GET 要求が正常に解決され、本文に応答が含まれています。    |
| 400                  | `BadRequest`         | 必須のヘッダーがないか、無効な api-version が指定されました。 |
| 403                  | `Forbidden`          | 呼び出し元には、この操作の実行権限がありません。                      |
| 404                  | `NotFound`           | 指定された ID のサブスクリプションが見つかりません                                     |
| 429                  | `RequestThrottleId`  | サービスが要求の処理でビジー状態になっています。後で再試行してください。                     |
| 503                  | `ServiceUnavailable` | サービスが一時的にダウンしています。 後で再試行してください。                             |
|  |  |  |

*応答ヘッダー*

| **ヘッダー キー**     | **必須** | **説明**                                                                                        |
|--------------------|--------------|--------------------------------------------------------------------------------------------------------|
| x-ms-requestid     | はい          | クライアントから受け取った要求 ID。                                                                   |
| x-ms-correlationid | はい          | クライアントから渡される場合は、関連付け ID。そうでない場合は、これはサーバー関連付け ID。                   |
| x-ms-activityid    | はい          | サービスからの要求を追跡するための一意の文字列値。 これは、任意の調整に使用されます。 |
| Retry-After        | いいえ            | クライアントが状態を確認できる間隔。                                                       |
|  |  |  |

### <a name="saas-webhook"></a>SaaS Webhook

SaaS の webhook は、SaaS サービスに事前に変更を通知するために使用されます。 この POST API は未認証であることが期待され、Microsoft サービスによって呼び出されます。 SaaS サービスは、webhook 通知のアクションを実行する前に、検証および承認するために API を呼び出すことが期待されます。 

*本文*

``` json
  { 
    "id": "be750acb-00aa-4a02-86bc-476cbe66d7fa",
    "activityId": "be750acb-00aa-4a02-86bc-476cbe66d7fa",
    "subscriptionId":"cd9c6a3a-7576-49f2-b27e-1e5136e57f45",
    "offerId": "sampleSaaSOffer", // Provided with "Update" action
    "publisherId": "contoso", 
    "planId": "silver",     // Provided with "Update" action
    "action": "Activate", // Activate/Delete/Suspend/Reinstate/Update
    "timeStamp": "2018-12-01T00:00:00"
  }
```

| **パラメーター名**     | **データの種類** | **説明**                               |
|------------------------|---------------|-----------------------------------------------|
| id  | String       | トリガーされた操作の一意の ID。                |
| activityId   | String        | サービスからの要求を追跡するための一意の文字列値。 これは、任意の調整に使用されます。               |
| subscriptionId                     | String        | Azure の SaaS サブスクリプション リソースの ID。    |
| offerId                | String        | ユーザーがサブスクライブするオファー ID。 「更新」アクションでのみ指定されます。        |
| publisherId                | String        | SaaS オファーのパブリッシャー ID         |
| planId                 | String        | ユーザーがサブスクライブするプラン ID。 「更新」アクションでのみ指定されます。          |
| action                 | String        | この通知をトリガーするアクション。 指定できる値 - Activate (アクティブ化)、Delete (削除)、Suspend (中断)、Reinstate (再開)、Update (更新)          |
| timeStamp                 | String        | この通知がトリガーされたときのタイムスタンプ値 (UTC)。          |
|  |  |  |
