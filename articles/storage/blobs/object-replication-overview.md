---
title: オブジェクト レプリケーションの概要
titleSuffix: Azure Storage
description: オブジェクト レプリケーションを使用すると、ソース ストレージ アカウントと宛先アカウントの間でブロック BLOB を非同期にコピーできます。 オブジェクト レプリケーションを使用すると、読み取り要求の待機時間を最小化し、コンピューティング ワークロードの効率を高め、データ分散を最適化し、コストを最小限に抑えることができます。
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 02/08/2021
ms.author: tamram
ms.subservice: blobs
ms.custom: devx-track-azurepowershell
ms.openlocfilehash: 391c33e72f45e7c0c0b56128b32a8e73399e417a
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/29/2021
ms.locfileid: "99834325"
---
# <a name="object-replication-for-block-blobs"></a>ブロック BLOB のオブジェクト レプリケーション

オブジェクト レプリケーションを使用すると、ソース ストレージ アカウントと宛先アカウントの間でブロック BLOB を非同期にコピーできます。 オブジェクト レプリケーションでサポートされるシナリオには次のものがあります。

- **待機時間の最小化。** オブジェクト レプリケーションでは、クライアントが物理的に近いリージョンのデータを使用できるようにすることで、読み取り要求の待機時間を短縮できます。
- **コンピューティング ワークロードの効率の向上。** オブジェクト レプリケーションでは、コンピューティングワークロードが同じブロック BLOB セットを複数のリージョンで処理できます。
- **データ分散の最適化。** データを 1 つの場所で処理または分析し、その結果のみを別のリージョンにレプリケートできます。
- **コストの最適化。** データがレプリケートされた後に、ライフ サイクル管理ポリシーを使用してデータをアーカイブ層に移動することで、コストを削減できます。

次の図は、オブジェクト レプリケーションによって、あるリージョンのソース ストレージ アカウントから別の 2 つのリージョンの宛先アカウントにブロック BLOB がレプリケートされる様子を示しています。

:::image type="content" source="media/object-replication-overview/object-replication-diagram.svg" alt-text="オブジェクト レプリケーションのしくみを示す図":::

オブジェクト レプリケーションを構成する方法については、「[オブジェクト レプリケーションの構成](object-replication-configure.md)」をご覧ください。

[!INCLUDE [storage-data-lake-gen2-support](../../../includes/storage-data-lake-gen2-support.md)]

## <a name="prerequisites-for-object-replication"></a>オブジェクト レプリケーションの前提条件

オブジェクト レプリケーションを使用するには、次の Azure Storage 機能が有効になっている必要もあります。

- [変更フィード](storage-blob-change-feed.md):ソース アカウントで有効になっている必要があります。 変更フィードを有効にする方法については、「[変更フィードを有効または無効にする](storage-blob-change-feed.md#enable-and-disable-the-change-feed)」をご覧ください。
- [BLOB のバージョン管理](versioning-overview.md):ソース アカウントと宛先アカウントの両方で有効にする必要があります。 BLOB のバージョン管理を有効にする方法については、「[BLOB のバージョン管理を有効にして管理する](versioning-enable.md)」をご覧ください。

変更フィードと BLOB バージョン管理を有効にすると、追加のコストが発生する場合があります。 詳細については、[Azure Storage の価格](https://azure.microsoft.com/pricing/details/storage/)に関するページを参照してください。

オブジェクト レプリケーションは、汎用 v2 ストレージ アカウントでのみサポートされます。 ソース アカウントと宛先のアカウントの両方が汎用 v2 である必要があります。 

## <a name="how-object-replication-works"></a>オブジェクト レプリケーションのしくみ

オブジェクト レプリケーションは、構成したルールに従って、コンテナー内のブロック BLOB を非同期にコピーします。 BLOB の内容、BLOB に関連付けられているすべてのバージョン、BLOB のメタデータとプロパティはすべて、ソース コンテナーから宛先コンテナーにコピーされます。

> [!IMPORTANT]
> ブロック BLOB データは非同期にレプリケートされるため、ソース アカウントと宛先アカウントはすぐには同期されません。現在、宛先アカウントにデータをレプリケートするための所要時間に関する SLA はありません。 レプリケーションが完了しているかどうかを確認するには、ソース BLOB のレプリケーションの状態を確認します。 詳細については、「[BLOB のレプリケーションの状態を確認する](object-replication-configure.md#check-the-replication-status-of-a-blob)」を参照してください。

### <a name="blob-versioning"></a>BLOB バージョン管理

オブジェクトのレプリケーションでは、ソース アカウントと宛先アカウントの両方で BLOB のバージョン管理が有効になっている必要があります。 ソース アカウントのレプリケート対象 BLOB が変更されると、変更前の BLOB の状態を反映する新しいバージョンの BLOB がソース アカウントに作成されます。 ソース アカウントの現在のバージョン (つまりベース BLOB) には、最新の更新が反映されています。 更新された現在のバージョンと新しい以前のバージョンの両方が、宛先アカウントにレプリケートされます。 書き込み操作が BLOB のバージョンに与える影響の詳細については、「[書き込み操作でのバージョン管理](versioning-overview.md#versioning-on-write-operations)」を参照してください。

ソース アカウントの BLOB が削除される場合、現在のバージョンの BLOB が以前のバージョンにキャプチャされ、その後削除されます。 以前のバージョンの BLOB はすべて、現在のバージョンが削除された後も保持されます。 この状態は、宛先アカウントにレプリケートされます。 削除操作が BLOB のバージョンに与える影響の詳細については、「[削除操作でのバージョン管理](versioning-overview.md#versioning-on-delete-operations)」を参照してください。

### <a name="snapshots"></a>スナップショット

オブジェクトのレプリケーションでは、BLOB のスナップショットはサポートされていません。 ソース アカウントの BLOB のスナップショットは、宛先アカウントにレプリケートされません。

### <a name="blob-tiering"></a>BLOB の階層

オブジェクトのレプリケーションは、ソース アカウントと宛先アカウントがホット層またはクール層にある場合にサポートされます。 ソース アカウントと宛先アカウントが異なる層に存在していてもかまいません。 ただし、ソース アカウントまたは宛先アカウントのどちらかで BLOB がアーカイブ層に移動されている場合、オブジェクトのレプリケーションは失敗します。 BLOB 層の詳細については、「[Azure Blob Storage のアクセス層 - ホット、クール、およびアーカイブ](storage-blob-storage-tiers.md)」を参照してください。

### <a name="immutable-blobs"></a>不変 BLOB

オブジェクトのレプリケーションでは、不変 BLOB はサポートされていません。 ソース コンテナーまたは宛先コンテナーに時間ベースの保有ポリシーまたは訴訟ホールドが設定されている場合、オブジェクトのレプリケーションは失敗します。 不変 BLOB の詳細については、「[不変ストレージを使用してビジネスに不可欠な BLOB データを保存する](storage-blob-immutable-storage.md)」を参照してください。

## <a name="object-replication-policies-and-rules"></a>オブジェクト レプリケーションのポリシーとルール

オブジェクト レプリケーションを構成するときに、ソース ストレージ アカウントと宛先アカウントを指定するレプリケーション ポリシーを作成します。 レプリケーション ポリシーには、ソース コンテナーと宛先コンテナーを指定し、レプリケートするソース コンテナー内のブロック BLOB を示す 1 つ以上のルールが含まれます。

オブジェクト レプリケーションを構成すると、Azure Storage によってソース アカウントの変更フィードが定期的にチェックされ、書き込みまたは削除操作が宛先アカウントに非同期にレプリケートされます。 レプリケーションの待機時間は、レプリケートされるブロック BLOB のサイズによって異なります。

### <a name="replication-policies"></a>レプリケーション ポリシー

オブジェクト レプリケーションを構成すると、Azure Storage リソース プロバイダー経由でソース アカウントと宛先アカウントの両方にレプリケーション ポリシーが作成されます。 レプリケーション ポリシーは、ポリシー ID で識別されます。 レプリケーションを実行するには、ソースと宛先のアカウントのポリシーに、同じポリシー ID が設定されている必要があります。

1 つのストレージ アカウントを、最大 2 つの宛先アカウントのソース アカウントとして使用できます。 ソース アカウントと宛先アカウントが同じリージョンに存在していても、異なるリージョンに存在していてもかまいません。 また、異なるサブスクリプションや異なる Azure Active Directory (Azure AD) テナントに存在していてもかまいません。 ソース アカウントと宛先アカウントのペアごとに作成できるレプリケーション ポリシーは、1 つのみです。

### <a name="replication-rules"></a>レプリケーション ルール

レプリケーション ルールでは、Azure Storage がソース コンテナーから宛先コンテナーにどのように BLOB をレプリケートするかを指定します。 レプリケーション ポリシーごとに最大 10 個のレプリケーション ルールを指定できます。 各レプリケーション ルールではソースと宛先のコンテナーが 1 つずつ定義され、ソースと宛先の各コンテナーは 1 つのルールでのみ使用できます

レプリケーション ルールを作成すると、既定では、その後にソース コンテナーに追加された新しいブロック BLOB のみがコピーされます。 新しいブロック BLOB と既存のブロック BLOB の両方がコピーされるように指定することも、指定した時間以降に作成されたブロック BLOB をコピーするカスタム コピー スコープを定義することもできます。

また、レプリケーション ルールの一部として 1 つ以上のフィルターを指定して、ブロック BLOB をプレフィックスでフィルター処理することもできます。 プレフィックスを指定すると、ソース コンテナー内のそのプレフィックスと一致する BLOB のみが宛先コンテナーにコピーされます。

ルールでソースと宛先のコンテナーを指定する前に、それらの両方が存在している必要があります。 レプリケーション ポリシーを作成した後、宛先コンテナーへの書き込み操作は許可されません。 宛先コンテナーへの書き込みを試みると、エラー コード 409 (競合) で失敗します。 レプリケーション ルールが構成されている宛先コンテナーに書き込むには、そのコンテナーに対して構成されているルールを削除するか、レプリケーション ポリシーを削除する必要があります。 レプリケーション ポリシーがアクティブになっている場合、宛先コンテナーに対する読み取りおよび削除操作は許可されます。

宛先コンテナーの BLOB で [Set Blob Tier](/rest/api/storageservices/set-blob-tier) 操作を呼び出して、それをアーカイブ層に移動できます。 アーカイブ層の詳細については、「[Azure Blob Storage: ホット、クール、アーカイブ ストレージ層](storage-blob-storage-tiers.md#archive-access-tier)」を参照してください。

## <a name="replication-status"></a>レプリケーションの状態

ソース アカウントの BLOB のレプリケーション状態を確認できます。 詳細については、「[BLOB のレプリケーションの状態を確認する](object-replication-configure.md#check-the-replication-status-of-a-blob)」を参照してください。

ソース アカウントの BLOB のレプリケーションの状態が失敗を示している場合は、次の考えられる原因を調査します。

- 宛先アカウントに対してオブジェクト レプリケーション ポリシーが構成されていることを確認します。
- 宛先コンテナーがまだ存在することを確認します。
- 書き込み操作の一部としてカスタマー指定のキーでソース BLOB が暗号化されている場合、オブジェクトのレプリケーションは失敗します。 カスタマー指定のキーの詳細については、「[BLOB ストレージに対する要求で暗号化キーを指定する](encryption-customer-provided-keys.md)」を参照してください。

## <a name="billing"></a>課金

オブジェクト レプリケーションでは、ソース アカウントと宛先アカウントに対する読み取りと書き込みトランザクションに追加コストが発生します。また、ソース アカウントから宛先アカウントへのデータのレプリケーションを行うためのエグレス料金と、変更フィードを処理するための読み取り料金も発生します。

## <a name="next-steps"></a>次の手順

- [オブジェクト レプリケーションの構成](object-replication-configure.md)
- [Azure Blob Storage の変更フィードのサポート](storage-blob-change-feed.md)
- [BLOB のバージョン管理を有効にして管理する](versioning-enable.md)
