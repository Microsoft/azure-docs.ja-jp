---
title: 不変 BLOB ストレージ - Azure Storage
description: Azure Storage では、BLOB (オブジェクト) ストレージの WORM (Write Once Read Many) がサポートされています。これにより、指定された期間、消去および変更できない状態でデータを保存できます。
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 11/18/2019
ms.author: tamram
ms.reviewer: hux
ms.subservice: blobs
ms.openlocfilehash: 54014a0d76130b82788a1ae432e42baec28df2c2
ms.sourcegitcommit: cee72954f4467096b01ba287d30074751bcb7ff4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/30/2020
ms.locfileid: "87448344"
---
# <a name="store-business-critical-blob-data-with-immutable-storage"></a>不変ストレージを使用してビジネスに不可欠な BLOB データを保存する

Azure Blob Storage の不変ストレージを使用すると、ユーザーはビジネスに不可欠なデータ オブジェクトを WORM (Write Once Read Many) 状態で保存できます。 この状態では、ユーザーが指定した期間、データを消去および変更できなくなります。 保持間隔の間、BLOB の作成と読み取りは可能ですが、変更や削除を行うことはできません。 不変ストレージは、すべての Azure リージョン内の汎用 v1、汎用 V2、BlobStorage、および BlockBlobStorage アカウントで使用できます。

Azure portal、PowerShell、または Azure CLI を使用して、訴訟ホールドを設定またはクリアしたり、時間ベースの保持ポリシーを作成したりする方法については、「[BLOB ストレージの不変ポリシーを設定および管理する](storage-blob-immutability-policies-manage.md)」を参照して ください。

[!INCLUDE [storage-multi-protocol-access-preview](../../../includes/storage-multi-protocol-access-preview.md)]

## <a name="about-immutable-blob-storage"></a>不変 BLOB ストレージについて

不変ストレージを使用すると、医療機関、金融機関、および関連する業界 (&mdash;特に、ブローカー ディーラー組織&mdash;) は、データを安全に保存できるようになります。 不変ストレージは、重要なデータを変更や削除から保護するためのどのシナリオでも利用できます。

一般的な用途は次のとおりです。

- **法令遵守**:Azure Blob Storage の不変ストレージは、組織が SEC 17a-4(f)、CFTC 1.31(d)、FINRA などの規制に準拠するのに役立ちます。 不変ストレージがこれらの規制要件にどのように対応しているかについて詳細に示した、Cohasset Associates によるテクニカル ホワイトペーパーをご用意しています。[Microsoft Service Trust Portal](https://aka.ms/AzureWormStorage) からダウンロードしてご利用ください。 [Azure トラスト センター](https://www.microsoft.com/trustcenter/compliance/compliance-overview)では、コンプライアンス関連の Microsoft の認定資格に関する詳しい情報を確認できます。

- **セキュリティ保護されたドキュメント リテンション**:Azure Blob Storage の不変ストレージにより、アカウント管理特権を持つユーザーを含め、どのユーザーもデータを変更したり、削除したりできなくなります。

- **訴訟ホールド**:Azure Blob Storage の不変ストレージを使用すると、ユーザーは訴訟やビジネス用途に不可欠な機密情報を、ホールドが削除されるまでの必要な期間中、改ざん防止状態で保存できます。 この機能は、法的なユース ケースのみに限定されず、イベント トリガーや会社のポリシーに基づいたデータの保護が必要な、イベント ベースのホールドまたはエンタープライズ ロックとして考えることもできます。

不変ストレージは次の機能をサポートします。

- **[時間ベースのリテンション ポリシーのサポート](#time-based-retention-policies)** :ユーザーは、指定した期間、データを保存するポリシーを設定できます。 時間ベースのリテンション ポリシーを設定すると、BLOB の作成と読み取りは可能ですが、変更または削除はできません。 保持期間の期限が切れた後は BLOB を削除できますが、上書きはできません。

- **[訴訟ホールド ポリシーのサポート](#legal-holds)** :保持間隔がわからない場合は、訴訟ホールドを設定することで、訴訟ホールドがクリアされるまで不変データを保存できます。  訴訟ホールド ポリシーを設定すると、BLOB の作成と読み取りは可能ですが、変更または削除はできません。 各訴訟ホールドは、識別子文字列として使用されるユーザー定義の英数字のタグ (事件 ID や事件名など) に関連付けられています。 

- **すべての BLOB 層のサポート:** WORM ポリシーは Azure Blob Storage 層から独立しており、ホット、クール、アーカイブのすべての層に適用されます。 ユーザーは、データの不変性を維持しながら、ワークロードに対応する最もコストが最適化された層にデータを移行できます。

- **コンテナー レベルの構成:** ユーザーは、時間ベースのリテンション ポリシーと訴訟ホールド タグをコンテナー レベルで構成できます。 ユーザーは、コンテナー レベルのシンプルな設定を使用して、時間ベースのリテンション ポリシーの作成とロック、保持間隔の延長、訴訟ホールドの設定とクリアなどを行うことができます。 これらのポリシーは、コンテナー内の既存および新規のすべての BLOB に適用されます。

- **監査ログのサポート**:各コンテナーには、ポリシー監査ログが含まれています。 ロックされている時間ベースのリテンション ポリシーに対して最大 7 つの時間ベースのリテンション コマンドが表示されます。また、ユーザー ID、コマンドの種類、タイム スタンプ、保持間隔が含まれています。 訴訟ホールドの場合、ログにはユーザー ID、コマンドの種類、タイム スタンプ、訴訟ホールド タグが含まれます。 このログは、SEC 17a-4(f) 規制ガイドラインに従い、ポリシーの有効期間の間、保持されます。 コントロール プレーンのすべてのアクティビティに関するより包括的なログは、[Azure アクティビティ ログ](../../azure-monitor/platform/platform-logs-overview.md)に表示されます。有効になっているときは [Azure リソース ログ](../../azure-monitor/platform/platform-logs-overview.md)が保持され、データ プレーン操作が表示されます。 規制や他の目的で必要になる可能性のあるログは、ユーザーが永続的に保存する必要があります。

## <a name="how-it-works"></a>しくみ

Azure Blob Storage の不変ストレージでは、時間ベースのリテンションと訴訟ホールドの 2 種類の WORM (不変) ポリシーがサポートされています。 時間ベースのリテンション ポリシーまたは訴訟ホールドをコンテナーに適用すると、既存のすべての BLOB が 30 秒以内に不変 WORM 状態に移行します。 そのポリシーで保護されたコンテナーにアップロードされるすべての新しい BLOB も不変状態に移行します。 すべての BLOB が不変ストレージに格納されると、不変ポリシーが承認され、不変コンテナー内のすべての上書きまたは削除操作は許可されなくなります。

また、コンテナーおよびストレージ アカウントの削除は、訴訟ホールド ポリシーまたはロック済み時間ベースのポリシーによって保護されている BLOB がコンテナー内にある場合は許可されません。 訴訟ホールド ポリシーでは、BLOB、コンテナー、およびストレージ アカウントが削除に対して保護されます。 ロックされていない時間ベースのポリシーとロック済み時間ベースのポリシーでは、指定された時間について BLOB の削除から保護されます。 ロックされていない時間ベースのポリシーとロック済み時間ベースのポリシーでは、コンテナー内に少なくとも 1 つの BLOB が存在する場合にのみ、コンテナーの削除から保護されます。 "*ロック済み*" 時間ベースのポリシーが設定されたコンテナーのみが、ストレージ アカウントの削除から保護されます。ロックされていない時間ベースのポリシーが設定されたコンテナーは、ストレージ アカウントの削除から保護もコンプライアンスも提供されません。

時間ベースの保持ポリシーを設定およびロックする方法の詳細については、「[BLOB ストレージの不変ポリシーを設定および管理する](storage-blob-immutability-policies-manage.md)」を参照してください。

## <a name="time-based-retention-policies"></a>時間ベースの保持ポリシー

> [!IMPORTANT]
> SEC 17a-4(f) や他の規制を順守するために BLOB を準拠した不変 (書き込みおよび削除禁止) 状態にするには、時間ベースのリテンション ポリシーを*ロック*する必要があります。 適切な期間 (通常は 24 時間未満) ポリシーをロックすることをお勧めします。 適用された時間ベースのリテンション ポリシーの初期状態の*ロックが解除*され、機能をテストし、ポリシーに変更を加えてから、それをロックすることができます。 *ロック解除*状態では不変保護が提供されますが、短期間の機能評価以外の目的で、*ロック解除*状態を使用しないことをお勧めします。 

時間ベースのリテンション ポリシーをコンテナーに適用すると、"*有効な*"リテンション期間中、コンテナー内のすべての BLOB が不変状態のままになります。 BLOB の有効な保持期間は、BLOB の**作成時刻**とユーザーが指定した保持間隔の差になります。 ユーザーは保持間隔を延長できるので、不変ストレージでは、ユーザー指定の保持間隔の最新の値が有効な保有期間の計算に使用されます。

たとえば、ユーザーが、保持間隔が 5 年の時間ベースの保持ポリシーを作成するとします。 そのコンテナー内の既存の BLOB _testblob1_ は 1 年前に作成されました。したがって、_testblob1_ の有効な保持期間は 4 年です。 新しい BLOB である _testblob2_ がコンテナーにアップロードされると、_testblob2_ の有効な保持期間は作成時点から 5 年になります。

ロックされていない時間ベースのリテンション ポリシーは、機能テスト用にのみお勧めしており、SEC 17a-4(f) とその他の規制コンプライアンスに準拠するためには、ポリシーがロックされている必要があります。 時間ベースの保持ポリシーがロックされると、ポリシーを削除できなくなり、有効リテンション期間への最大 5 回の延長が許可されます。

保持ポリシーには次の制限が適用されます。

- ストレージ アカウントで、ロック済み時間ベースの不変ポリシーが適用されたコンテナーの最大数は 10,000 です。
- 最小保持間隔は 1 日です。 最大保持間隔は 146,000 日 (400 年) です。
- コンテナーで、ロック済み時間ベースの不変ポリシーのリテンション期間を延長する編集の最大回数は 5 です。
- コンテナーで、ロックされたポリシーに対して保持される時間ベースのアイテム保持ポリシー監査ログの最大数は 7 です。

### <a name="allow-protected-append-blobs-writes"></a>保護された追加 BLOB の書き込みを許可する

追加 BLOB はデータ ブロックで構成され、監査とログ記録のシナリオで必要なデータ追加操作用に最適化されています。 設計上、追加 BLOB では、BLOB の末尾に新しいブロックを追加することのみが許可されます。 不変性に関係なく、追加 BLOB の既存のブロックの変更や削除は、基本的には許可されていません。 追加 BLOB の詳細については、「[追加 BLOB について](https://docs.microsoft.com/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-append-blobs)」を参照してください。

時間ベースの保持ポリシーのみが持っている `allowProtectedAppendWrites` 設定では、不変性の保護とコンプライアンスを維持しながら、追加 BLOB への新しいブロックの書き込みが許可されます。 この設定を有効にすると、ポリシーで保護されたコンテナー内に追加 BLOB を直接作成し、*AppendBlock* API を使用して、既存の追加 BLOB の末尾に新しいデータ ブロックを追加することができます。 新しいブロックを追加することだけができ、既存のブロックを変更したり削除したりすることはできません。 持続的不変性保護は引き続き適用され、有効な保持期間が経過するまで、追加 BLOB は削除に対して保護されます。 この設定を有効にしても、ブロック BLOB またはページ BLOB の不変性動作には影響しません。

この設定は時間ベースの保持ポリシーの一部なので、"*有効な*" 保持期間中、追加 BLOB は不変状態のままになります。 追加 BLOB の初期作成後に新しいデータを追加できるため、保持期間の決定方法には若干の違いがあります。 有効な保持期間は、追加 BLOB の**最終変更時刻**とユーザーが指定した保持間隔の差になります。 同様に、保持期間が延長されるときは、不変ストレージでは、ユーザー指定の保持間隔の最新の値が有効な保持期間の計算に使用されます。

たとえば、ユーザーが、`allowProtectedAppendWrites` を有効にして、保持間隔が 90 日の時間ベースの保持ポリシーを作成するとします。 追加 BLOB _logblob1_ は今日コンテナーに作成され、今後 10 日間、新しいログが追加 BLOB に追加されます。したがって、_logblob1_ の有効な保持期間は、今日から 100 日 (最後に追加された時刻 + 90 日) です。

ロックされていない時間ベースの保持ポリシーを使用すると、`allowProtectedAppendWrites` の設定をいつでも有効または無効にすることができます。 時間ベースの保持ポリシーがロックされた場合、`allowProtectedAppendWrites` の設定は変更できません。

訴訟ホールドのポリシーでは `allowProtectedAppendWrites` を有効にできません。また、いかなる訴訟ホールドでも、"allowProtectedAppendWrites" プロパティは無効化されません。 `allowProtectedAppendWrites` が有効になっている時間ベースの保持ポリシーに訴訟ホールドが適用されている場合、訴訟ホールドが解除されるまで、*AppendBlock* API は失敗します。

## <a name="legal-holds"></a>訴訟ホールド

訴訟ホールドは、法的調査目的または一般保護ポリシーに使用できる一時的なホールドです。 各訴訟ホールド ポリシーは、1 つまたは複数のタグに関連付ける必要があります。 タグは、ホールドの目的を分類および説明するための名前付き識別子 (ケース ID やイベントなど) として使用されます。

コンテナーには、訴訟ホールドと時間ベースのリテンション ポリシーの両方を同時に適用できます。 有効なリテンション期間が終了していても、すべての訴訟ホールドがクリアされるまで、そのコンテナー内のすべての BLOB が不変状態のままになります。 逆に、すべての訴訟ホールドがクリアされていても、有効なリテンション期間が終了するまで、BLOB は不変状態のままになります。

訴訟ホールドには次の制限が適用されます。

- ストレージ アカウントで、訴訟ホールドが設定されたコンテナーの最大数は 10,000 です。
- コンテナーで、訴訟ホールド タグの最大数は 10 です。
- 訴訟ホールド タグの最短の長さは英数字 3 文字です。 最大長は英数字 23 文字です。
- コンテナーで、ポリシーの有効期間中に保持される訴訟ホールド ポリシー監査ログの最大数は 10 です。

## <a name="scenarios"></a>シナリオ
次の表に、さまざまな不変シナリオで無効になる BLOB ストレージ操作の種類を示します。 詳細については、[Azure Blob Service REST API](https://docs.microsoft.com/rest/api/storageservices/blob-service-rest-api) に関する記事を参照してください。

|シナリオ  |BLOB の状態  |拒否される BLOB 操作  |コンテナーとアカウントの保護
|---------|---------|---------|---------|
|BLOB の有効なリテンション期間がまだ終了していないか、訴訟ホールドが設定されている     |不変: 削除および書き込み禁止         | Put Blob<sup>1</sup>、Put Block<sup>1</sup>、Put Block List<sup>1</sup>、Delete Container、Delete Blob、Set Blob Metadata、Put Page、Set Blob Properties、Snapshot Blob、Incremental Copy Blob、Append Block<sup>2</sup>         |コンテナーの削除は拒否されます。ストレージ アカウントの削除は拒否されます         |
|BLOB の有効な保持期間が終了し、訴訟ホールドが設定されていない    |書き込み禁止のみ (削除操作は可能)         |Put Blob<sup>1</sup>、Put Block<sup>1</sup>、Put Block List<sup>1</sup>、Set Blob Metadata、Put Page、Set Blob Properties、Snapshot Blob、Incremental Copy Blob、Append Block<sup>2</sup>         |保護されたコンテナー内に少なくとも 1 つの BLOB が存在する場合、コンテナーの削除は拒否されます。"*ロックされた*" の時間ベースのポリシーに対してのみ、ストレージ アカウントの削除は拒否されます         |
|WORM ポリシーが適用されていない (時間ベースの保持と訴訟ホールド タグはない)     |変更可能         |なし         |なし         |

<sup>1</sup> BLOB サービスでは、これらの操作で新しい BLOB を 1 回作成することができます。 不変コンテナーの既存の BLOB パスでの以降のすべての上書き操作は、許可されません。

<sup>2</sup> Append Block は、`allowProtectedAppendWrites` プロパティが有効になっている時間ベースの保持ポリシーに対してのみ許可されます。 詳細については、「[保護された追加 BLOB の書き込みを許可する](#allow-protected-append-blobs-writes)」を参照してください。

## <a name="pricing"></a>価格

この機能の使用に対する追加料金はありません。 不変データは、変更可能データと同じ方法で価格が設定されます。 Azure Blob Storage の価格設定の詳細については、[Azure Storage の価格に関するページ](https://azure.microsoft.com/pricing/details/storage/blobs/)を参照してください。

## <a name="faq"></a>よく寄せられる質問

**WORM コンプライアンスについてのドキュメントは提供できますか?**

はい。 コンプライアンスを文書化するために、Microsoft は、記録管理と情報ガバナンスに特化した大手の独立系評価会社である Cohasset Associates を保有して、金融サービス業界に固有の要件に対して、不変 BLOB ストレージとそのコンプライアンスを評価しました。 Cohasset では、不変 BLOB ストレージが、時間ベースの BLOB を WORM 状態に維持するために使用する場合、CFTC Rule 1.31(c)-(d)、FINRA Rule 4511、および 17a-4 の関連ストレージ要件を満たしていることを実証しました。 この一連のルールは金融機関のレコード保有期間に対する最も規範的なガイダンスを世界中に示すものであるため、Microsoft ではこれらのルールを対象としました。 Cohasset レポートは [Microsoft Service Trust Center](https://aka.ms/AzureWormStorage) で入手できます。 WORM 不変性コンプライアンスに関する Microsoft からの構成証明の文書を要求するには、Azure サポートにお問い合わせください。

**この機能が適用されるのはブロック BLOB と追加 BLOB だけですか、またはページ BLOB にも適用されますか?**

コンテナー レベルで設定されている任意の種類の BLOB には不変ストレージを使用できますが、主にブロック BLOB と追加 BLOB を格納するコンテナーには WORM を使用することをお勧めします。 コンテナー内の既存の BLOB は、新しく設定された WORM ポリシーによって保護されます。 ただし、新しいページ BLOB は WORM コンテナーの外部で作成して、コンテナー内にコピーする必要があります。 WORM コンテナーにコピーした後は、ページ BLOB をそれ以上変更することはできなくなります。 アクティブな仮想マシン用の VHD (ページ BLOB) を格納するコンテナーに対して WORM ポリシーを設定することは推奨できません。そのことによって、VM ディスクがロックされるからです。 時間ベースのポリシーをロックする前に、ドキュメントを十分に確認し、シナリオをテストすることをお勧めします。

**この機能を使用するために、新しいストレージ アカウントを作成する必要がありますか?**

いいえ。既存または新しく作成した汎用 v1、汎用 v2、BlobStorage、または BlockBlobStorage アカウントで不変ストレージを使用できます。 汎用 v1 ストレージ アカウントはサポートされていますが、より多くの機能を利用できるように汎用 v2 にアップグレードすることをお勧めします。 既存の汎用 v1 ストレージ アカウントのアップグレードについては、[ストレージ アカウントのアップグレード](../common/storage-account-upgrade.md)に関する記事を参照してください。

**訴訟ホールドと時間ベースのリテンション ポリシーを両方とも適用することはできますか?**

はい。1 つのコンテナーに訴訟ホールドと時間ベースのリテンション ポリシーを同時に含めることはできます。ただし、訴訟ホールドが消去されるまで、"allowProtectedAppendWrites" 設定は適用されません。 有効なリテンション期間が終了していても、すべての訴訟ホールドがクリアされるまで、そのコンテナー内のすべての BLOB が不変状態のままになります。 逆に、すべての訴訟ホールドがクリアされていても、有効なリテンション期間が終了するまで、BLOB は不変状態のままになります。 

**訴訟ホールド ポリシーは訴訟手続き専用ですか? その他の使用のシナリオはありますか?**

いいえ。訴訟ホールドは、時間ベース以外の保持ポリシーに対して使用される一般的な用語にすぎません。 訴訟関連の手続き専用で使用する必要はありません。 訴訟ホールド ポリシーは、保持期間が不明の重要な企業の WORM データを保護するために上書きと削除を無効にする場合に役立ちます。 ミッション クリティカルな WORM ワークロードを保護するための企業のポリシーとして使用することも、カスタムのイベント トリガーで時間ベースのリテンション ポリシーの使用が必要になる前のステージング ポリシーとして使用することもできます。 

**_ロックされた_ 時間ベースのリテンション ポリシーまたは訴訟ホールドを削除できますか?**

コンテナーから削除できるのは、ロックされていない時間ベースのリテンション ポリシーのみです。 時間ベースのリテンション ポリシーがロックされると、削除できず、リテンション有効期間の延長のみが許可されます。 訴訟ホールド タグを削除できます。 有効なすべてのタグが削除されると、訴訟ホールドが削除されます。

**時間ベースの保持ポリシーまたは訴訟ホールドが適用されたコンテナーを削除しようとするとどうなりますか?**

ロック済みまたはロックされていない時間ベースの保持ポリシーが適用されたコンテナー内に少なくとも 1 つの BLOB が存在する場合、またはコンテナーに訴訟ホールドがある場合は、Delete Container 操作は失敗します。 コンテナー内に BLOB が存在せず、訴訟ホールドもない場合にのみ、Delete Container 操作は成功します。 

**時間ベースの保持ポリシーまたは訴訟ホールドが適用されたコンテナーを含むストレージ アカウントを削除しようとするとどうなりますか?**

訴訟ホールドまたは**ロック済み**時間ベースのポリシーが設定されたコンテナーが 1 つ以上ある場合、ストレージ アカウントの削除は失敗します。 ロックされていない時間ベースのポリシーが適用されたコンテナーは、ストレージ アカウントの削除に対して保護されません。 ストレージ アカウントを削除するには、事前にすべての訴訟ホールドとすべての**ロック済み**コンテナーを削除する必要があります。 コンテナーの削除については、前の質問を参照してください。 また、[Azure Resource Manager のロック](../../azure-resource-manager/management/lock-resources.md)を使用して、ストレージ アカウントに追加の削除保護を適用することもできます。

**BLOB が不変状態のときに、異なる BLOB 層 (ホット、クール、アーカイブ) の間でデータを移動できますか?**

はい。データを適合した不変状態に保ちながら、Set Blob Tier コマンドを使用して、BLOB 層の間でデータを移動できます。 不変ストレージは、ホット、クール、アーカイブの各 BLOB 層でサポートされています。

**支払いを怠ったときに、リテンション期間がまだ終了していない場合はどうなりますか?**

未払いの場合、Microsoft との契約条件に明記されているように、通常のデータ保有ポリシーが適用されます。 全般的な情報については、「[Microsoft でのデータ管理](https://www.microsoft.com/en-us/trust-center/privacy/data-management)」を参照してください。 

**機能を試してみるだけの試用期間または猶予期間は設けられていますか?**

はい。 時間ベースのリテンション ポリシーを最初に作成したとき、ポリシーは*ロック解除*状態です。 この状態にある間は、保持間隔に必要な変更 (延長、短縮など) を加えることができ、ポリシーを削除することもできます。 ポリシーがロックされると、保持間隔の期限が切れるまでロックされたままになります。 このロックされたポリシーにより、保持間隔の削除および変更ができなくなります。 "*ロック解除*"状態は試用の目的でのみ使用し、24 時間以内にポリシーをロックすることを強くお勧めします。 この手順により、SEC 17a-4(f) やその他の規制に準拠することができます。

**不変 BLOB ポリシーと共に論理的な削除を使用できますか?**

はい。コンプライアンス要件で論理削除を有効にすることが許可されている場合は可能です。 [Azure BLOB ストレージの論理的な削除](storage-blob-soft-delete.md)は、訴訟ホールドや時間ベースのリテンション ポリシーに関係なく、ストレージ アカウント内のすべてのコンテナーに適用されます。 不変 WORM ポリシーが適用されて承認される前に、保護を強化するために論理的な削除を有効にすることをお勧めします。

## <a name="next-steps"></a>次のステップ

- [BLOB ストレージの不変ポリシーを設定および管理する](storage-blob-immutability-policies-manage.md)
- [ライフサイクル管理を使用して BLOB データを自動的に階層化および削除するルールを設定する](storage-lifecycle-management-concepts.md)
- [Azure Storage Blob の論理的な削除](../blobs/storage-blob-soft-delete.md)
- [Azure Resource Manager のロックを使用してサブスクリプション、リソース グループ、リソースを保護する](../../azure-resource-manager/management/lock-resources.md)。
