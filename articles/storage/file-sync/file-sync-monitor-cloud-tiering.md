---
title: Azure File Sync のクラウドを使った階層化の監視 | Microsoft Docs
description: クラウドを使った階層化ポリシーを監視するために使用するメトリックについて詳しく説明します。
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 04/13/2021
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: cbdde16ff214077d7fe4814c8841d805fe05c37c
ms.sourcegitcommit: 4b0e424f5aa8a11daf0eec32456854542a2f5df0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/20/2021
ms.locfileid: "107795999"
---
# <a name="monitor-cloud-tiering"></a>クラウドの階層化を監視する
クラウドを使った階層化ポリシーを監視するには、サーバー エンドポイントのプロパティ ブレードと Azure Monitor の 2 つの方法があります。

## <a name="monitoring-via-server-endpoint"></a>サーバー エンドポイントを使用した監視

[Azure portal](https://portal.azure.com/) にサインインし、監視するサーバー エンドポイントの **[サーバー エンドポイントのプロパティ]** ブレードに移動して、[クラウドを使った階層化] セクションまで下にスクロールします。 

![[サーバー エンドポイントのプロパティ] の [クラウドを使った階層化] セクションのスクリーンショット。](media/storage-sync-monitoring-cloud-tiering/cloud-tiering-monitoring-5.png)

**[領域の節約]** は、クラウドを使った階層化を有効にすることによって節約される領域の容量です。 ローカル ボリュームのサイズが、すべてのデータを保持するのに十分な大きさである場合、領域の節約は 0% になります。 領域の節約の割合が 0% あるいは低い割合の場合、現在のローカル キャッシュ サイズにとって、クラウドを使った階層化は有益でないことを示している可能性があります。 

**キャッシュ ヒット率** は、ローカル キャッシュで開くファイルの割合です。 キャッシュ ヒット率は、キャッシュから直接開かれたファイルを、開かれているファイルの合計数で割ることで算出されます。 キャッシュ ヒット率が 100% の場合、これは過去 1 時間に開いたすべてのファイルが既にローカル キャッシュに存在していたことを意味します。 エグレスを減らすことが目的の場合、これは現在のポリシーが正常に機能していることを示します。

> [!NOTE]
> 通常、アクセス パターンがランダムなワークロードのキャッシュ ヒット率は低くなります。 

**Total size (cloud) (合計サイズ (クラウド))** は、クラウドに同期されたファイルのサイズです。 

**Cached size (server) (キャッシュ サイズ (サーバー))** は、サーバー上にある、ダウンロードおよび階層化されたファイルの合計サイズです。 このキャッシュ サイズは、場合によりクラウド内のファイルの合計サイズよりも大きくなることがあります。 この原因には、サーバー上のボリュームのクラスター サイズなどの変数が考えられます。 キャッシュ サイズが必要以上に大きい場合は、ボリュームの空き領域ポリシーを増やすことを検討してください。 

**有効なボリューム ポリシー** は、Azure File Sync で、サーバー エンドポイントが配置されているボリュームに残しておく空き領域が決定される際に使用されます。 同じボリューム上に複数のサーバー エンドポイントがある場合、それらのサーバー エンドポイントの最も高いボリューム空き容量ポリシーが、そのボリューム上のすべてのサーバーエンド ポイントに対して有効化されます。 たとえば、同じボリューム上に 2 つのサーバー エンドポイントがあり、一方のボリュームの空き領域が 30%、もう一方のボリュームの空き容量が 50% の場合、どちらのサーバー エンドポイントにも、50% のボリューム空き領域ポリシーが適用されます。

**ボリュームの現在の空き領域** は、オンプレミス サーバーで現在使用可能なボリュームの空き領域です。 エグレスが高いにもかかわらず、ボリュームの空き領域ポリシーが開始される前に使用可能な空き領域が多くある場合は、日付ポリシーを無効にすることを検討してください。 もう 1 つの問題は、現在階層化されているファイルの内、最近アクセスしたファイルが、ポリシーの開始前に残っているボリュームの空き領域よりも大きい場合です。 この場合は、ローカル ボリュームのサイズを大きくすることを検討してください。 

## <a name="monitoring-via-azure-monitor"></a>Azure Monitor を使用した監視

**[ストレージ同期サービス]** に移動し、サイド ナビゲーションから **[メトリック]** を選択します。 

クラウドを使った階層化からのエグレスを監視するために使用できるメトリックには、次の 3 種類があります。

- クラウドを使った階層化の呼び戻しサイズ
    - これは、呼び戻されたデータの合計サイズ (バイト単位) であり、どの程度のデータが呼び戻されているかを識別するために使用できます。
- アプリケーションによるクラウドを使った階層化の呼び戻しサイズ
    - これは、アプリケーションによって呼び戻されたデータの合計サイズ (バイト単位) であり、何によってデータが呼び戻されているかを識別するために使用できます。
- クラウドを使った階層化の呼び戻しスループット
    - これは、データが呼び戻される速度 (バイト単位) を測定し、パフォーマンスに懸念がある場合に使用します。 

グラフに表示する内容を具体的に指定するには、 **[フィルターの追加]** および **[Apply Splitting]\(分割の適用\)** を使用することを検討してください。
 
Azure File Sync のさまざまな種類のメトリックとその使用方法の詳細については、「[Azure File Sync の監視](file-sync-monitoring.md)」を参照してください。

メトリックの使用方法の詳細については、「[Azure メトリックス エクスプローラーの概要](../../azure-monitor/essentials/metrics-getting-started.md)」を参照してください。

クラウドの階層化ポリシーを変更する場合は、「[クラウドを使った階層化ポリシーの選択](file-sync-choose-cloud-tiering-policies.md)」を参照してください。

## <a name="next-steps"></a>次のステップ

* [Azure File Sync のデプロイの計画](file-sync-planning.md)