---
title: 誤削除を防ぐ - Azure ファイル共有
description: Azure ファイル共有の論理的な削除と、それを使用してデータを復旧し、誤削除を防ぐ方法について説明します。
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 05/28/2020
ms.author: rogarana
ms.subservice: files
services: storage
ms.openlocfilehash: 11940a43438b72eb8a2e9391d56806744c4c27fc
ms.sourcegitcommit: 3543d3b4f6c6f496d22ea5f97d8cd2700ac9a481
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/20/2020
ms.locfileid: "86527814"
---
# <a name="prevent-accidental-deletion-of-azure-file-shares"></a>Azure ファイル共有の誤削除を防ぐ

Azure Storage で、ファイル共有の論理的な削除が提供されるようになりました (プレビュー)。 論理的な削除を使用すると、アプリケーションまたは他のストレージ アカウント ユーザーが誤ってファイル共有を削除した場合に、データを回復できます。

## <a name="how-soft-delete-preview-works"></a>論理的な削除 (プレビュー) のしくみ

Azure ファイル共有の論理的な削除が有効になっている場合、ファイル共有が削除されると、完全に消去される代わりに論理的に削除された状態に移行します。 論理的に削除されたデータが完全に削除され、復旧できなくなるまでの時間を構成することができます。この保有期間中はいつでも共有の削除を取り消すことができます。 削除を取り消すと、共有とすべてのコンテンツ (スナップショットを含む) が削除前の状態に復元されます。 論理的な削除はファイル共有レベルでのみ機能します。そのため、削除された個々のファイルは完全に消去されます。

論理的な削除は、新規または既存のファイル共有のいずれかに対して有効にすることができます。 また、論理的な削除には下位互換性があります。論理的な削除の保護を利用するために、アプリケーションを変更する必要はありません。 

有効期限が切れる前に論理的な削除状態のファイル共有を完全に削除するには、共有の削除を取り消し、論理的な削除を無効にしてから、共有を再度削除する必要があります。 その論理的な削除がオフの間に、そのストレージ アカウント内の他のファイル共有が誤って削除される可能性があるため、論理的な削除を再度有効にする必要があります。

論理的に削除された Premium ファイル共有の場合、ファイル共有クォータ (ファイル共有のプロビジョニングされたサイズ) は、論理的に削除された共有の有効期限 (共有が完全に削除されるタイミング) まで、ストレージ アカウント クォータの合計の計算に使用されます。

## <a name="availability"></a>可用性

Azure ファイル共有の論理的な削除 (プレビュー) は、Azure Files を使用できるすべてのストレージ層、すべてのストレージ アカウントの種類、およびすべてのリージョンで使用できます。

## <a name="configuration-settings"></a>構成設定

### <a name="enabling-or-disabling-soft-delete"></a>論理的な削除の有効化または無効化

ファイル共有の論理的な削除はストレージ アカウント レベルで有効です。このため、論理的な削除の設定は、ストレージ アカウント内のすべてのファイル共有に適用されます。 論理的な削除は、いつでも有効または無効にすることができます。 新しいストレージ アカウントを作成すると、ファイル共有の論理的な削除は既定で無効になります。 既存のストレージ アカウントについても、論理的な削除は既定で無効に設定されます。 Azure ファイル共有に対して [Azure ファイル共有のバックアップ](../../backup/azure-file-share-backup-overview.md)を構成してある場合、Azure ファイル共有の論理的な削除は、その共有のストレージ アカウントで自動的に有効になります。

ファイル共有の論理的な削除が有効な状態で、一部のファイル共有を削除してから論理的な削除を無効にしても、その期間に共有が保存されていれば、それらのファイル共有に引き続きアクセスして回復できます。 論理的な削除を有効にするときは、保持期間も構成する必要があります。

### <a name="retention-period"></a>保持期間

保持期間は、論理的に削除されたファイル共有が保存され、回復できる期間です。 明示的に削除されたファイル共有の場合は、データが削除された時点で保持期間のクロックが開始します。 現在、保有期間は 1 日から 365 日の範囲で指定できます。 論理的な削除のリテンション期間はいつでも変更できます。 更新された保持期間は、保持期間が更新された後に削除された共有にのみ適用されます。 保持期間の更新前に削除された共有は、そのデータが削除されたときに構成された保持期間に基づいて期限切れになります。

## <a name="pricing-and-billing"></a>価格と課金

Standard と Premium の両方のファイル共有は、プロビジョニングされた容量ではなく、論理的な削除時の使用済み容量に課金されます。 さらに、Premium ファイル共有には、論理的な削除状態の間、スナップショット レートで課金されます。 Standard ファイル共有は、論理的な削除状態の間、通常のレートで課金されます。 構成されている保有期間の後で完全に削除されたデータについては課金されません。

Azure File Storage の一般的な料金の詳細については、[Azure File Storage の料金ページ](https://azure.microsoft.com/pricing/details/storage/files/)を参照してください。

論理的な削除を初めて有効にするときは、保有期間を短くして、この機能が請求に及ぼす影響をよく理解することをお勧めします。

## <a name="next-steps"></a>次のステップ

論理的な削除を有効にして使用する方法については、[論理的な削除を有効にする](storage-files-enable-soft-delete.md)方法に関する記事を参照してください。
