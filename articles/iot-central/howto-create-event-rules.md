---
title: Azure IoT Central アプリケーションでイベント ルールを作成して管理する | Microsoft Docs
description: Azure IoT Central のイベント ルールを使用すると、ほぼリアルタイムでデバイスを監視し、ルールがトリガーされたときに、電子メールの送信などのアクションを自動的に呼び出すことができます。
author: ankitscribbles
ms.author: ankitgup
ms.date: 08/14/2018
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: af85ff8272853be82bae5c79622295fddfc60ade
ms.sourcegitcommit: edacc2024b78d9c7450aaf7c50095807acf25fb6
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/13/2018
ms.locfileid: "53337276"
---
# <a name="create-an-event-rule-and-set-up-notifications-in-your-azure-iot-central-application"></a>Azure IoT Central アプリケーションでイベント ルールを作成して通知を設定する

*この記事は、オペレーター、ビルダー、および管理者に適用されます。*

Azure IoT Central を使用して、接続されたデバイスをリモートで監視できます。 Azure IoT Central のルールを使用すると、ほぼリアルタイムでデバイスを監視し、電子メールの送信または Microsoft Flow のトリガーなどのアクションを自動的に呼び出すことができます。 数回のクリックで、デバイスのデータを監視する条件を定義したり、対応するアクションを構成したりできます。 この記事では、デバイスから送信されたイベントを監視するルールを作成する方法について説明します。

デバイスはイベントの測定値を使用して、重要または情報のデバイス イベントを送信できます。 イベント ルールは、選択したデバイス イベントがデバイスによってレポートされるとトリガーされます。

## <a name="create-an-event-rule"></a>イベント ルールを作成する

イベント ルールを作成するには、デバイス テンプレートに少なくとも 1 つのイベントの測定値が定義されている必要があります。 この例では、ファン モーターのエラー イベントをレポートする冷蔵の自動販売機を使用します。 ルールは、デバイスによってレポートされるイベントを監視し、イベントがレポートされると電子メールを送信します。

1. Device Explorer を使用して、ルールを追加する対象のデバイス テンプレートに移動します。

1. 選択したテンプレートで、既存のデバイスをクリックします。 

    >[!TIP] 
    >テンプレートにデバイスが何もない場合は、まず新しいデバイスを追加します。

1. まだルールを作成していない場合は、次の画面が表示されます。

    ![ルールがまだありません](media/howto-create-event-rules/Rules_Landing_Page.png)


1. **[ルール]** タブで、**[テンプレートの編集]**、**[+ 新しいルール]** の順にクリックして、作成できるルールの種類を確認します。


1. **[イベント]** タイルをクリックして、イベント監視ルールを作成します。

    ![ルールの種類](media/howto-create-event-rules/Rule_Types.png)

    
1. このデバイス テンプレートでルールを識別するのに役立つ名前を入力します。

1. このテンプレート用に作成されたすべてのデバイスに対してすぐにルールを有効にするには、**[このテンプレートのすべてのデバイスに対してルールを有効にする]** を切り替えます。

    ![ルールの詳細](media/howto-create-event-rules/Rule_Detail.png)

    このルールは、デバイス テンプレートの下にあるすべてのデバイスに自動的に適用されます。

### <a name="configure-the-rule-conditions"></a>ルールの条件を構成する

条件は、ルールによって監視される基準を定義します。

1. **[条件]** の横にある **[+]** をクリックして、新しい条件を追加します。

1. 監視したいイベントを [Measurement]\(測定\) ドロップダウンから選択します。 この例では、**[Fan Motor Error]\(ファン モーターのエラー\)** イベントが選択されています。

   ![条件](media/howto-create-event-rules/Condition_Filled_Out.png) 


1. 必要に応じて、**[カウント]** を **[集計]** に設定し、対応するしきい値を指定することもできます。

    - 集計を選択しない場合、条件を満たすイベント データ ポイントごとにルールがトリガーします。 たとえば、'Fan Motor Error' イベントが発生したときにルールの条件をトリガーするように構成すると、デバイスからそのイベントが報告されるとすぐにルールがトリガーされます。
    - 集計関数として Count が使用されている場合は、条件を評価する必要がある **[しきい値]** と **[Aggregate time window]\(集計期間\)** を指定する必要があります。 この場合、イベント数が集計され、集計されたイベント数がしきい値と一致する場合にのみルールがトリガーされます。
 
    たとえば、5 分以内に発生したデバイス イベント数が 3 を超えたときに警告する場合は、イベントを選択し、集計関数を "count"、演算子を "greater than"、"threshold" を 3 と設定します。 [Aggregate over time]\(集計時間\) を [5 分] に設定します。 このルールは、デバイスから送信されたイベント数が 5 分間で 3 個を超えたときにトリガーされます。 ルールの評価頻度は **[Aggregate time window]\(集計期間\)** と同じです。つまり、この例では、ルールは 5 分ごとに 1 回評価されます。 

    ![イベントの条件を追加する](media/howto-create-event-rules/Aggregate_Condition_Filled_Out.png)

    >[!NOTE] 
    >**[条件]** では、複数のイベント測定値を追加できます。 複数の条件を指定する場合、ルールをトリガーするためにはすべての条件が満たされる必要があります。 各条件は暗黙的に "AND" 句で結合されます。 集計を使用する場合、すべての測定値を集計する必要があります。

### <a name="configure-actions"></a>アクションを構成する

このセクションでは、ルールが起動されたときに実行するアクションを設定する方法を説明します。 アクションは、ルールで指定されたすべての条件が true と評価されたときに呼び出されます。

1. **[アクション]** の横にある **+** を選択します。 使用可能なアクションの一覧が表示されます。 

    ![アクションを追加する](media/howto-create-event-rules/Add_Action.png)

1. **[電子メール]** アクションを選択し、**[宛先]** フィールドに有効な電子メール アドレスを入力して、ルールがトリガーされた際に電子メールの本文に表示されるメモを指定します。

    > [!NOTE]
    > 電子メールは、アプリケーションに追加されており、少なくとも 1 回はログインしているユーザーにのみ送信されます。 Azure IoT Central での[ユーザー管理](howto-administer.md)について詳しくは、こちらをご覧ください。

   ![アクションを構成する](media/howto-create-event-rules/Configure_Action.png)

1. ルールを保存するには、**[保存]** を選択します。 ルールは数分以内に有効になり、アプリケーションに送信されるイベントの監視が開始されます。 ルールで指定した条件に一致すると、構成した電子メールのアクションがトリガーされます。

1. **[完了]** を選択して、**[テンプレートの編集]** モードを終了します。

Microsoft Flow や Webhook などの他のアクションをルールに追加することができます。 ルールごとに最大 5 つのアクションを追加できます。

- [Microsoft Flow アクション](howto-add-microsoft-flow.md): ルールがトリガーされたときに Microsoft Flow でワークフローを開始します 
- [Webhook アクション](howto-create-webhooks.md): ルールがトリガーされたときに他のサービスに通知します

## <a name="parameterize-the-rule"></a>ルールをパラメーター化する

**[デバイス プロパティ]** をパラメーターとして使用して、アクションを構成することもできます。 電子メール アドレスがデバイスのプロパティとして格納されている場合、**[宛先]** アドレスを定義するときにこれを使用できます。

## <a name="delete-a-rule"></a>規則を削除する

ルールが不要になった場合は、ルールを開き、**[削除]** を選択して削除します。 ルールを削除すると、そのルールはデバイス テンプレートと関連付けられているすべてのデバイスから削除されます。

## <a name="enable-or-disable-a-rule-for-a-device-template"></a>デバイス テンプレートのルールを有効または無効にする

デバイスに移動し、有効または無効にするルールを選択します。 **[このテンプレートのすべてのデバイスに対してルールを有効にする]** ボタンを切り替えることで、デバイス テンプレートに関連付けられているすべてのデバイスに対してルールを有効または無効にできます。

## <a name="enable-or-disable-a-rule-for-a-device"></a>デバイスのルールを有効または無効にする

デバイスに移動し、有効または無効にするルールを選択します。 **[Enable rule for this device]\(このデバイスに対してルールを有効にする\)** ボタンを切り替えて、このデバイスに対してルールを有効または無効にします。

## <a name="next-steps"></a>次の手順

ここでは、Azure IoT Central アプリケーションでルールを作成する方法について説明しました。次の手順は以下のとおりです。

- [ルールに Microsoft Flow のアクションを追加する](howto-add-microsoft-flow.md)
- [ルールに Webhook アクションを追加する](howto-create-webhooks.md)
- [デバイスの管理方法](howto-manage-devices.md)
