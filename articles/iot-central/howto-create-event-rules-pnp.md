---
title: Azure IoT Central アプリケーションでイベント ルールを作成して管理する | Microsoft Docs
description: Azure IoT Central のイベント ルールを使用すると、ほぼリアルタイムでデバイスを監視し、ルールがトリガーされたときに、電子メールの送信などのアクションを自動的に呼び出すことができます。
author: dominicbetts
ms.author: dobett
ms.date: 07/23/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: 1a7fc2b38e8354fb29255bb7f9d6b2c03ed53725
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/21/2019
ms.locfileid: "69879047"
---
# <a name="create-an-event-rule-and-set-up-notifications-in-your-azure-iot-central-application-preview-features"></a>Azure IoT Central アプリケーションでイベント ルールを作成して通知を設定する (プレビュー機能)

*この記事は、オペレーター、ビルダー、および管理者に適用されます。*

[!INCLUDE [iot-central-pnp-original](../../includes/iot-central-pnp-original-note.md)]

Azure IoT Central を使用して、接続されたデバイスをリモートで監視できます。 Azure IoT Central のルールを使用すると、ほぼリアルタイムでデバイスを監視し、電子メールの送信などのアクションを自動的に呼び出すことができます。 数回のクリックで、デバイスのデータを監視する条件を定義したり、対応するアクションを構成したりできます。 この記事では、デバイスから送信されたイベントを監視するルールを作成する方法について説明します。

デバイスはイベントの測定値を使用して、重要または情報のデバイス イベントを送信できます。 イベント ルールは、選択したデバイス イベントがデバイスによってレポートされるとトリガーされます。

## <a name="create-an-event-rule"></a>イベント ルールを作成する

イベント ルールを作成するには、デバイス テンプレートに少なくとも 1 つのイベントの測定値が定義されている必要があります。 この例では、ファン モーターのエラー イベントをレポートする冷蔵の自動販売機を使用します。 ルールは、デバイスによってレポートされるイベントを監視し、イベントがレポートされると電子メールを送信します。

1. **[Rules]\(ルール\)** ページに移動します。

1. まだルールを作成していない場合は、次の画面が表示されます。

   ![ルールがまだありません](media/howto-create-event-rules-pnp/rules-landing-page1.png)

1. **[+ New Rule]\(新しいルール\)** を選択して、作成できるルールの種類を確認します。

1. **[Event]\(イベント\)** を選択して、イベント監視ルールを作成します。

   ![ルールの種類](media/howto-create-event-rules-pnp/rule-types1.png)

1. ルールを識別するのに役立つ名前を入力して Enter キーを押します。

1. **[Scopes]\(スコープ\)** セクションで、このルールの適用対象となるデバイス定義を選択します。 この画面では、 **[+ Filter]\(+ フィルター\)** を使用して、ルールが適用されるデバイスをフィルターで絞り込むこともできます。 このルールは、デバイス テンプレートの下にあるすべてのデバイスに自動的に適用されます。 ルールを無効にするには、ヘッダーの **[Disable]\(無効化\)** ボタンを選択します。

### <a name="configure-the-rule-conditions"></a>ルールの条件を構成する

条件は、ルールによって監視される基準を定義します。

1. **[Set aggregation]\(集計の設定\)** をオンにするかオフにするかを選択します。

   - 集計を選択しない場合、条件を満たすイベント データ ポイントごとにルールがトリガーします。 たとえば、**Fan Motor Error** イベントが発生したときにルールの条件をトリガーするように構成すると、デバイスからそのイベントが報告されるとすぐにルールがトリガーされます。
   - 集計関数として **Count** を使用する場合は、条件を評価する際に必要な **[Value]\(値\)** と **[Time window]\(時間枠\)** を指定する必要があります。 この場合、イベント数が集計され、集計されたイベント数が値と一致する場合にのみルールがトリガーされます。

1. 監視するイベントを **[Measurement]\(測定\)** ドロップダウンから選択します。 この例では、 **[Fan Motor Error]\(ファン モーターのエラー\)** イベントが選択されています。

1. 必要に応じて、 **[Count]** を **[Aggregation]\(集計\)** に設定し、ルールがトリガーされる値を指定することもできます。

     たとえば、5 分以内に発生したデバイス イベント数が 3 を超えたときに警告する場合は、イベントを選択し、集計関数を **[Count]** 、演算子を **[greater than]\(より大きい\)** 、 **[Value]\(値\)** を 3 と設定します。 **[Time window]\(時間枠\)** を **[5 minutes]\(5 分\)** に設定します。 このルールは、デバイスから送信されたイベント数が 5 分間で 3 個を超えたときにトリガーされます。 ルールの評価頻度は **[Time window]\(時間枠\)** と同じです。つまり、この例では、ルールは 5 分ごとに 1 回評価されます。

 ![条件](media/howto-create-event-rules-pnp/aggregate-condition-filled-out1.png)

> [!NOTE]
> **[条件]** では、複数のイベント測定値を追加できます。 複数の条件を指定する場合、ルールをトリガーするためにはすべての条件が満たされる必要があります。 各条件は暗黙的に "AND" 句で結合されます。 集計を使用する場合、すべての測定値を集計する必要があります。

### <a name="configure-actions"></a>アクションを構成する

このセクションでは、ルールが起動されたときに実行するアクションを設定する方法を説明します。 アクションは、ルールで指定されたすべての条件が true と評価されたときに呼び出されます。

1. **[Action]\(アクション\)** セクションで **[+ Action]\(+ アクション\)** をクリックします。 使用可能なアクションの一覧が表示されます。  

   ![アクションを追加する](media/howto-create-event-rules-pnp/add-action1.png)

1. **[Email]\(電子メール\)** アクションを選択し、アクションの表示名を入力し、 **[To]\(宛先\)** フィールドに有効な電子メール アドレスを入力して、ルールがトリガーされたときに電子メールの本文に表示される内容を指定します。

   > [!NOTE]
   > 電子メールは、アプリケーションに追加されており、少なくとも 1 回はログインしているユーザーにのみ送信されます。 Azure IoT Central での[ユーザー管理](howto-administer-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json)について詳しくは、こちらをご覧ください。

   ![アクションを構成する](media/howto-create-event-rules-pnp/configure-action1.png)

1. アクションを保存するには、 **[Done]\(完了\)** を選択します。

1. ルールを保存するには、 **[保存]** を選択します。 ルールは数分以内に有効になり、アプリケーションに送信されるイベントの監視が開始されます。 ルールで指定した条件を満たすと、構成した電子メールのアクションがトリガーされます。

## <a name="parameterize-the-rule"></a>ルールをパラメーター化する

ルールでは、 **[デバイスのプロパティ]** から、特定の値をパラメーターとして取得できます。 パラメーターの使用は、イベントのしきい値がデバイスによって異なるシナリオにおいて役立ちます。 ルールを作成する場合は、絶対値 (3 個のイベントなど) を指定する代わりに、しきい値を指定するデバイスのプロパティを選択します ( **[Maximum Ideal Threshold]\(最大理想しきい値\)** など)。 ルールが実行されると、デバイスのイベント数と、デバイスのプロパティに設定された値が照合されます。

パラメーターを使用すると、管理するルールの数を効果的に減らすことができます。

**[デバイス プロパティ]** をパラメーターとして使用して、アクションを構成することもできます。 電子メール アドレスがデバイスのプロパティとして格納されている場合、 **[宛先]** アドレスを定義するときにこれを使用できます。

## <a name="delete-a-rule"></a>規則を削除する

ルールが不要になった場合は、ルールを開き、 **[削除]** を選択して削除します。 ルールを削除すると、そのルールはデバイス テンプレートと関連付けられているすべてのデバイスから削除されます。

## <a name="enable-or-disable-a-rule"></a>ルールを有効または無効にする

有効または無効にするルールを選択します。 ルールの **[Enable]\(有効化\)** ボタンまたは **[Disable]\(無効化\)** ボタンを切り替えて、ルールのスコープ内にあるすべてのデバイスのルールを有効または無効にします。

## <a name="enable-or-disable-a-rule-for-a-device"></a>デバイスのルールを有効または無効にする

有効または無効にするルールを選択します。 **[Scope]\(スコープ\)** セクションにフィルターを追加して、デバイス テンプレートに特定のデバイスを含めたり除外したりします。

## <a name="next-steps"></a>次の手順

ここでは、Azure IoT Central アプリケーションでルールを作成する方法について説明しました。次の手順として、[デバイスを管理する方法](howto-manage-devices-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json)について学習することをお勧めします。
