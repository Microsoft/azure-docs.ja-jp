---
title: Azure IoT Central アプリケーションでデバイス テンプレートを設定する | Microsoft Docs
description: 測定値、設定、プロパティ、ルール、およびダッシュボードを含むデバイス テンプレートを設定する方法を説明します。
author: viv-liu
ms.author: viviali
ms.date: 06/19/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: 63c0a04a6d18d6af850b1492d2efa9df9aa65219
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/21/2019
ms.locfileid: "69877381"
---
# <a name="set-up-a-device-template"></a>デバイス テンプレートを設定する

[!INCLUDE [iot-central-original-pnp](../../includes/iot-central-original-pnp-note.md)]

デバイス テンプレートは、Azure IoT Central アプリケーションに接続するデバイスの種類の、特性と動作を定義するブループリントです。

たとえばビルダーでは、次の機能を持つ、接続されたファン用のデバイス テンプレートを作成できます。

- 温度テレメトリの測定
- 場所の測定
- ファン モーター エラー イベントの測定
- ファン動作状態の測定
- ファン速度の設定
- アラートを送信するルール
- デバイスの全体像を把握できるダッシュボード

オペレーターはこのデバイス テンプレートから、**fan-1** や **fan-2** などの名前で、実際のファン デバイスを作成して接続できます。 これらのファンはすべて、測定、設定、プロパティ、ルール、およびアプリケーションのユーザーが監視と管理を行えるダッシュボードを備えています。

> [!NOTE]
> デバイス テンプレートの作成、編集、および削除が可能なのは、ビルダーと管理者のみです。 **[Device Explorer]** ページの既存のデバイス テンプレートからは、すべてのユーザーがデバイスを作成できます。

## <a name="create-a-device-template"></a>デバイス テンプレートを作成する

1. **[デバイス テンプレート]** ページに移動します。

2. テンプレートを作成するには、 **[+新規]** を選択して開始します。

3. すばやく開始するには、作成済みの既存のテンプレートから選択します。 それ以外の場合は、 **[カスタム]** を選択して名前を入力し、 **[作成]** をクリックして独自のテンプレートを最初から作成します。

   ![デバイス テンプレート ライブラリ](./media/howto-set-up-template/newtemplate.png)

4. カスタム テンプレートの作成時に、新しいデバイス テンプレートの **[デバイスの詳細]** ページが表示されます。 デバイス テンプレートを作成すると、シミュレートされたデバイスが自動的に作成されます。 シミュレートされたデバイスを使用して、実デバイスを接続する前に、アプリケーションの動作をテストできます。

次のセクションでは、 **[デバイス テンプレート]** ページの各タブについて説明します。

## <a name="measurements"></a>測定

測定値は、デバイスから到着するデータです。 デバイスの機能と一致するように、複数の測定値をデバイス テンプレートに追加できます。

- **[Telemetry]\(テレメトリ\)** の測定値は、デバイスが時間の経過と共に収集した数値データ ポイントです。 連続するストリームとして表されます。 たとえば、温度です。
- **[Event]\(イベント\)** の測定値は、デバイス上の何らかの重要性を表す特定の時点のデータです。 重大度は、イベントの重要度を表します。 たとえば、ファン モーターのエラーです。
- **[状態]** の測定値は、一定期間にわたるデバイスまたはそのコンポーネントの状態を表します。 たとえば、**Operating** (動作中) と **Stopped** (停止) という 2 つの状態があるファン モードを定義できます。
- **[場所]** の測定は、ある期間にわたるデバイスの緯度と経度の座標です。 たとえば、ファンをある場所から別の場所に移動できます。

### <a name="create-a-telemetry-measurement"></a>テレメトリの測定を作成する

新しいテレメトリ測定を追加するには、 **[+ 新しい測定]** を選択し、測定タイプとして **[テレメトリ]** を選択して、フォームに詳細を入力します。

> [!NOTE]
> 実デバイスが接続されたときにテレメトリ測定がアプリケーションに表示されるようにするには、デバイス テンプレート内のフィールド名が、対応するデバイス コード内のプロパティ名と一致する必要があります。 下記のセクションでデバイス テンプレートの定義を続行する際には、設定、デバイス プロパティ、およびコマンドの構成時に同じことを行ってください。

たとえば、新しい温度テレメトリ測定を追加できます。

| 表示名        | フィールド名    |  Units    | Min   |max|
| --------------------| ------------- |-----------|-------|---|
| 気温         | temp          |  degC     |  0    |100|

![温度測定の詳細が表示された [Create Telemetry]\(テレメトリの作成\) フォーム](./media/howto-set-up-template/measurementsform.png)

**[Save]\(保存\)** を選択すると、測定の一覧に **[Temperature]\(温度\)** の測定が表示されます。 しばらくすると、シミュレートされたデバイスからの温度データが視覚化されます。

テレメトリを表示するときに、次の集計オプションから選択できます。平均、最小、最大、合計、カウント。 グラフの既定の集計として、 **[平均]** が選択されています。

> [!NOTE]
> テレメトリ測定のデータ型は浮動小数点数です。

### <a name="create-an-event-measurement"></a>イベントの測定を作成する

新しいイベントの測定を追加するには、 **[+ 新しい測定]** を選択し、測定タイプとして **[イベント]** を選択します。 **[イベントの作成]** フォームで詳細を入力します。

イベントの **[Display Name]\(表示名\)** 、 **[Field Name]\(フィールド名\)** 、 **[Severity]\(重大度\)** の詳細を入力します。 次の 3 つの重大度レベルから選択できます: **[エラー]** 、 **[警告]** 、 **[情報]** 。

たとえば、新しい "**Fan Motor Error**" (ファン モーター エラー) イベントを追加できます。

| 表示名        | フィールド名    |  既定の重要度 |
| --------------------| ------------- |-----------|
| Fan Motor Error     | fanmotorerror |  Error    |

![ファン モーター イベントの詳細が表示された [Create Event]\(イベントの作成\) フォーム](./media/howto-set-up-template/eventmeasurementsform.png)

**[Save]\(保存\)** を選択すると、測定の一覧に **[Fan Motor Error]\(ファン モーター エラー\)** の測定が表示されます。 しばらくすると、シミュレートされたデバイスからのイベント データが視覚化されます。

イベントに関する詳細を表示するには、グラフ上のイベント アイコンを選択します。

!["Fan Motor Error" (ファン モーター エラー) イベントの詳細](./media/howto-set-up-template/eventmeasurementsdetail.png)

> [!NOTE]
> イベント測定のデータ型は文字列です。

### <a name="create-a-state-measurement"></a>状態の測定を作成する

新しい状態の測定を追加するには、 **[+ 新しい測定]** ボタンを選択し、測定タイプとして **[状態]** を選択します。 **[状態の作成]** フォームで詳細を入力します。

状態の **[Display Name]\(表示名\)** 、 **[Field Name]\(フィールド名\)** 、および **[Values]\(値\)** の詳細を入力します。 それぞれの値には、グラフやテーブルに値を表示するときに使用される表示名を付けることもできます。

たとえば、デバイスが送信できる **Operating** (動作中) と **Stopped** (停止) という 2 つの値がある新しい "**Fan Mode**" (ファン モード) 状態を追加できます。

| 表示名 | フィールド名    |  値 1   | 表示名 | 値 2    |表示名  |
| -------------| ------------- |----------- | -------------| -----------| -------------|
| Fan Mode     | fanmode       |  1         | 運転中    |     0      | 停止済み      |

![ファン モードの詳細が表示された [Edit State]\(状態の編集\)](./media/howto-set-up-template/statemeasurementsform.png)

**[Save]\(保存\)** を選択すると、測定の一覧に **[Fan Mode]\(ファン モード\)** の状態の測定が表示されます。 しばらくすると、シミュレートされたデバイスからの状態データが視覚化されます。

短期間にデバイスから送信されたデータ ポイントが多すぎる場合、状態の測定は、異なるビジュアルで表示されます。 グラフを選択すると、その期間内のすべてのデータ ポイントが、時系列に表示されます。 時間の範囲を狭くしても、グラフにプロットされる測定を表示できます。

> [!NOTE]
> 状態測定のデータ型は文字列です。

### <a name="create-a-location-measurement"></a>場所の測定を作成する

新しい場所の測定を追加するには、 **[+ 新しい測定]** を選択し、測定の種類として **[場所]** を選択して、 **[Create Measurement]\(測定の作成\)** フォームに詳細を入力します。

たとえば、新しい場所テレメトリ測定を追加できます。

| 表示名        | フィールド名    |
| --------------------| ------------- |
| 資産の場所      |  assetloc     |

![場所の測定の詳細が表示された [Create Location]\(場所の作成\) フォーム](./media/howto-set-up-template/locationmeasurementsform.png)

**[保存]** を選択すると、測定の一覧に **[場所]** の測定が表示されます。 しばらくすると、シミュレートされたデバイスからの場所データが視覚化が表示されます。

場所が表示されるときに、最新の場所と場所の履歴のオプションから選択できます。 **場所の履歴**は、選択した時間範囲にのみ適用されます。

場所の測定のデータ型は、経度、緯度、および省略可能な高度を含むオブジェクトです。 次のスニペットは、JavaScript の構造を示しています。

```javascript
assetloc: {
  lon: floating point number,
  lat: floating point number,
  alt?: floating point number
}
```

実デバイスが接続されると、測定として追加した場所が、デバイスから送信された値で更新されます。 場所の測定を構成したら、[デバイス ダッシュボードでマップを追加して場所を視覚化](#add-a-location-measurement-in-the-dashboard)できます。

## <a name="settings"></a>設定

設定はデバイスを制御します。 これらにより、オペレーターは、デバイスに入力を提供できるようになります。 オペレーターが使用する **[設定]** タブにタイルとして表示されるデバイス テンプレートには、複数の設定を追加できます。 追加できる設定にはさまざまな種類があります (数値、テキスト、日付、トグル、およびセクション ラベル)。

設定は、3 つの状態のいずれかにできます。 デバイスからは次の状態が報告されます。

- **同期済み**:デバイスは設定値を反映するように変わりました。

- **Pending**: デバイスは現在、設定値に変わろうとしています。

- **エラー**: デバイスはエラーを返しました。

たとえば、 **[設定]** を選択し、新しい**数値**設定で次のように入力すれば、新しいファン速度の設定を追加できます。

| 表示名  | フィールド名    |  Units  | 10 進数 |Initial|
| --------------| ------------- |---------| ---------|---- |
| ファン速度     | fanSpeed      | RPM     | 2        | 0   |

![速度設定の詳細が表示された [Configure Number]\(数値の構成\) フォーム](./media/howto-set-up-template/settingsform.png)

**[保存]** を選択すると、**ファン速度**の設定がタイルとして表示されます。 オペレーターは、**Device Explorer** ページの設定を使用して、デバイスのファン速度を変更できます。

## <a name="properties"></a>properties

プロパティは、固定されたデバイスの場所やシリアル番号など、デバイスに関連付けられているメタデータです。 デバイス テンプレートに複数のプロパティを追加すると、 **[プロパティ]** タブのタイルとして表示されます。プロパティは、数値、テキスト、日付、切り替え、デバイス プロパティ、ラベル、固定された場所などの型を持ちます。 オペレーターは、デバイスを作成するときにプロパティの値を指定し、これらの値をいつでも編集できます。 デバイス プロパティは読み取り専用で、デバイスからアプリケーションに送信されます。 オペレーターは、デバイスのプロパティを変更できません。 実デバイスを接続すると、デバイスのプロパティ タイルがアプリケーションで更新されます。

プロパティには 2 つのカテゴリがあります。

- "_デバイス プロパティ_" は、デバイスから IoT Central アプリケーションに報告されます。 デバイス プロパティは、デバイスによって報告される読み取り専用の値であり、実デバイスが接続されたときにアプリケーション内で更新されます。
- "_アプリケーション プロパティ_" は、アプリケーションに保存されるプロパティであり、オペレーターが編集できます。 アプリケーション プロパティは、アプリケーションにのみ格納され、デバイスから見られることはありません。

たとえば、 **[プロパティ]** タブで、デバイスの前回のサービス日を新しい**日付**プロパティ (アプリケーションのプロパティ) として追加できます。

| 表示名  | フィールド名 | 初期値   |
| --------------| -----------|-----------------|
| Last serviced      | lastServiced        | 2019/01/29     |

![[プロパティ] タブの "Last serviced 構成" フォーム](./media/howto-set-up-template/propertiesform.png)

**[保存]** を選択すると、デバイスの最終サービス日がタイルとして表示されます。

タイルの作成後に、**Device Explorer** でアプリケーション プロパティの値を変更できます。

### <a name="create-a-location-property"></a>場所プロパティを作成する

Azure IoT Central 内で場所データに地理的コンテキストを追加し、緯度と経度の座標または番地をマッピングすることができます。 IoT Central の Azure Maps でこの機能を使用できます。

追加できる場所プロパティは 2 種類あります。

- **アプリケーション プロパティとしての場所**は、アプリケーション内に保存されます。 アプリケーション プロパティは、アプリケーションにのみ格納され、デバイスから見られることはありません。
- **デバイス プロパティとしての場所**は、デバイスからアプリケーションに報告されます。 この種類のプロパティは、静的な場所に適しています。

> [!NOTE]
> プロパティとしての場所では、履歴が記録されません。 履歴が必要な場合は、場所の測定を使用します。

#### <a name="add-location-as-an-application-property"></a>場所をアプリケーション プロパティとして追加する

Azure IoT Central アプリケーション内で Azure Maps を使用することで、場所プロパティをアプリケーション プロパティとして作成することができます。 たとえば、デバイスの設置場所の住所を追加できます。

1. **[プロパティ]** タブに移動します。

2. ライブラリで **[場所]** を選択します。

3. 場所の**表示名**、**フィールド名**、および (省略可能) **初期値**を構成します。

    | 表示名  | フィールド名 | 初期値 |
    | --------------| -----------|---------|
    | Installation address | installAddress | Microsoft, 1 Microsoft Way, Redmond, WA 98052   |

   ![場所の詳細が表示された [Configure Location]\(場所の構成\)](./media/howto-set-up-template/locationcloudproperty2.png)

   場所を追加する形式は 2 つあります。
   - **住所としての場所**
   - **座標としての場所**

4. **[保存]** を選択します。 オペレーターは、**Device Explorer** で場所の値を更新できます。

#### <a name="add-location-as-a-device-property"></a>デバイス プロパティとして場所を追加する

場所プロパティは、デバイスから報告されるデバイス プロパティとして作成できます。 たとえば､デバイスの場所を追跡する場合です。

1. **[プロパティ]** タブに移動します。

2. ライブラリから **[Device Property]\(デバイス プロパティ\)** を選択します。

3. 表示名とフィールド名を構成し、データの種類として **[場所]** を選択します。

    | 表示名  | フィールド名 | データ型 |
    | --------------| -----------|-----------|
    | デバイスの場所 | deviceLocation | location  |

   > [!NOTE]
   > フィールド名は、対応するデバイス コード内のプロパティ名と一致する必要があります

   ![場所の詳細が表示された [Configure Device Properties]\(デバイス プロパティの構成\) フォーム](./media/howto-set-up-template/locationdeviceproperty2.png)

実デバイスが接続されると、デバイス プロパティとして追加した場所が、デバイスから送信された値で更新されます。 場所プロパティを構成すると、[デバイス ダッシュボードでマップを追加して場所を視覚化](#add-a-location-property-in-the-dashboard)できます。

## <a name="commands"></a>command

コマンドは、デバイスのリモート管理に使用されます。 オペレーターは、デバイスに対してコマンドを実行できます。 オペレーターが使用する **[Commands]\(コマンド\)** タブにタイルとして表示されるデバイス テンプレートには、複数のコマンドを追加できます。 デバイスのビルダーは、要件に応じて柔軟にコマンドを定義できます。

コマンドと設定の違いは次のとおりです。

- **設定**:設定は、デバイスに適用する構成です。 変更するまで、構成はデバイスで保持されます。 たとえば、フリーザーの温度を設定して、フリーザーを再起動してもその設定を維持する場合があります。

- **コマンド**:コマンドは、IoT Central からリモートでデバイスに対してすぐにコマンドを実行する場合に使用します。 デバイスが接続されていない場合、コマンドはタイムアウトして失敗します。 たとえば、デバイスを再起動するとします。

たとえば、 **[コマンド]** タブを選択し、 **[+ 新しいコマンド]** を選択して、新しいコマンドの詳細を入力することで、新しい **Echo** コマンドを追加できます。

| 表示名  | フィールド名 | [Default Timeout]\(既定のタイムアウト\) | データ型 |
| --------------| -----------|---------------- | --------- |
| Echo Command  | echo       |  30             | text      |

![Echo の詳細が表示された [Configure Command]\(コマンドの構成\) フォーム](./media/howto-set-up-template/commandsecho1.png)

**[保存]** を選択すると、**Echo** コマンドがタイルとして表示されて、実デバイスを接続すると **Device Explorer** から使用できる状態になります。 コマンドを正常に実行するには、コマンドのフィールド名が、対応するデバイス コード内のプロパティ名と一致する必要があります。

[サンプル C デバイス コードのリンクはこちらです。](https://github.com/Azure/iot-central-firmware/blob/ad40358906aeb8f2040a822ba5292df866692c16/MXCHIP/mxchip_advanced/src/AzureIOTClient.cpp#L34)

## <a name="rules"></a>ルール

オペレーターはルールによって、ほぼリアルタイムにデバイスを監視できます。 ルールは、ルールがトリガーされたときに電子メールを送信するなどのアクションを自動的に呼び出します。 現在使用できるルールの種類は 1 つです。

- **テレメトリ ルール**は、選択したデバイスのテレメトリが、指定したしきい値を超えたときにトリガーされます。 テレメトリ ルールの詳細については、[こちら](howto-create-telemetry-rules.md)を参照してください。

## <a name="dashboard"></a>ダッシュボード

ダッシュボードは、オペレーターがアクセスして、デバイスに関する情報を参照する場所です。 ビルダーは、デバイスがどのように動作しているかをオペレーターが理解する助けになるタイルをこのページに追加します。 追加できるダッシュボード タイルにはさまざまな種類があります (画像、折れ線グラフ、棒グラフ、主要業績評価指標 (KPI)、設定、プロパティ、およびラベル)。

たとえば、 **[ダッシュボード]** タブを選択してライブラリからタイルを選択することで、 **[設定とプロパティ]** タイルを追加して、設定とプロパティの現在の値の選択を表示できます。

![設定とプロパティの詳細が表示された [Configure Device Details]\(デバイスの詳細の構成\) フォーム](./media/howto-set-up-template/dashboardsettingsandpropertiesform1.png)

**Device Explorer** でダッシュボードを表示すると、タイルを表示できるようになります。

### <a name="add-a-location-measurement-in-the-dashboard"></a>ダッシュボードで場所の測定を追加する

場所の測定を構成した場合、デバイス ダッシュボードのマップを使用して場所を視覚化することができます。 場所の測定には、場所の履歴をプロットするオプションがあります。

1. **[ダッシュボード]** タブに移動します。

1. デバイス ダッシュボードでライブラリから **[Map]\(マップ\)** を選択します。

1. マップのタイトルを設定します。 次の例には、**Device Current Location** (デバイスの現在位置) というタイトルが付けられています。 次に、前に **[測定]** タブで構成した場所の測定を選択します。次の例では、**資産の場所**の測定が選択されています。

   ![タイトルとプロパティの詳細が表示された [Configure Map]\(マップの構成\) フォーム](./media/howto-set-up-template/locationcloudproperty5map.png)

1. **[保存]** を選択します。 [Map]\(マップ\) タイルに選択した場所が表示されるようになりました。

マップ タイルのサイズを変更することができます。 オペレーターが **Device Explorer** でダッシュボードを表示すると、場所マップを含め、構成したすべてのダッシュボード タイルを見ることができます。

### <a name="add-a-location-property-in-the-dashboard"></a>ダッシュボードで場所のプロパティを追加する

場所のプロパティを構成した場合は、デバイス ダッシュボードのマップを使用して場所を視覚化できます。

1. **[ダッシュボード]** タブに移動します。

1. デバイス ダッシュボードでライブラリから **[Map]\(マップ\)** を選択します。

1. マップのタイトルを設定します。 次の例には、**Device Current Location** (デバイスの現在位置) というタイトルが付けられています。 次に、前に **[プロパティ]** タブで構成した場所プロパティを選択します。次の例では、**デバイスの場所**の測定が選択されています。

   ![タイトルとプロパティの詳細が表示された [Configure Map]\(マップの構成\) フォーム](./media/howto-set-up-template/locationcloudproperty6map.png)

1. **[保存]** を選択します。 [Map]\(マップ\) タイルに選択した場所が表示されるようになりました。

マップ タイルのサイズを変更することができます。 オペレーターが **Device Explorer** でダッシュボードを表示すると、場所マップを含め、構成したすべてのダッシュボード タイルを見ることができます。

Azure IoT Central でタイルを使用する方法の詳細については、「[ダッシュボード タイルの使用](howto-use-tiles.md)」を参照してください。

## <a name="next-steps"></a>次の手順

ここでは、Azure IoT Central アプリケーションでデバイス テンプレートを設定する方法について説明しました。次の手順に進むことができます。

- [デバイス テンプレートの新しいバージョンを作成する](howto-version-device-template.md)
- [MXChip IoT DevKit デバイスを Azure IoT Central アプリケーションに接続する](howto-connect-devkit.md)
- [汎用のクライアント アプリケーションを Azure IoT Central アプリケーションに接続する (Node.js)](howto-connect-nodejs.md)
