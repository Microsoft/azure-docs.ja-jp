---
title: Azure IoT Central で新しいデバイスの種類を定義する | Microsoft Docs
description: このチュートリアルでは、作成者向けに、Azure IoT Central アプリケーションで新しいデバイスの種類を作成する方法について説明します。 種類に対して、テレメトリ、状態、プロパティ、コマンドを定義します。
author: dominicbetts
ms.author: dobett
ms.date: 08/06/2019
ms.topic: tutorial
ms.service: iot-central
services: iot-central
ms.custom: mvc
manager: philmea
ms.openlocfilehash: 660b2ead146695657ae13444cb7936eff8224f3a
ms.sourcegitcommit: 44e85b95baf7dfb9e92fb38f03c2a1bc31765415
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/28/2019
ms.locfileid: "70099513"
---
# <a name="tutorial-define-a-new-device-type-in-your-azure-iot-central-application-preview-features"></a>チュートリアル:Azure IoT Central アプリケーションで新しいデバイスの種類を定義する (プレビュー機能)

[!INCLUDE [iot-central-pnp-original](../../includes/iot-central-pnp-original-note.md)]

このチュートリアルでは、作成者向けに、デバイス テンプレートを使用して、Microsoft Azure IoT Central アプリケーションでデバイスの新しい種類を定義する方法について説明します。 デバイス テンプレートとは、デバイスの機能を定義するものです。 機能には、デバイスが送信するテレメトリ、デバイスのプロパティ、デバイスが反応するコマンドなどがあります。

このチュートリアルでは、**環境センサー**のデバイス テンプレートを作成します。 環境センサー デバイス:

* 温度などのテレメトリを送信する。
* 輝度など、デバイス固有のプロパティをレポートする。
* 電源オンやオフなどのコマンドに反応する。
* ファームウェア バージョンやシリアル番号など、一般的なデバイス プロパティをレポートする。

このチュートリアルでは、以下の内容を学習します。

> [!div class="checklist"]
> * 新しいデバイス テンプレートの作成。
> * デバイス機能モデルのインポート。
> * クラウド プロパティの作成。
> * デバイス テレメトリの視覚化の定義。
> * デバイス テンプレートの公開。
> * デバイス テンプレートに対応した、シミュレートされたデバイスの作成。
> * シミュレートされたデバイスの表示。

## <a name="prerequisites"></a>前提条件

このチュートリアルを完了するには、Azure IoT Central アプリケーションが必要です。 「[Azure IoT Central アプリケーションの作成](quick-deploy-iot-central-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json)」クイック スタートを完了している場合は、そのクイック スタートで作成したアプリケーションを再利用できます。 それ以外の場合は、次の手順を実行して、空の Azure IoT Central アプリケーションを作成してください。

1. [Azure IoT Central のアプリケーション マネージャー](https://aka.ms/iotcentral) Web サイトに移動します。

1. Azure サブスクリプションを持っている場合は、そのサブスクリプションへのアクセス用の資格情報を使用してサインインします。持っていない場合は、Microsoft アカウントを使用してサインインします。

    ![所属組織のアカウントを入力](./media/tutorial-define-device-type-pnp/sign-in.png)

1. 新しい Azure IoT Central アプリケーションの作成を開始するには、 **[New Application]\(新しいアプリケーション\)** を選択します。

IoT プラグ アンド プレイなどのプレビュー機能を搭載した新しい Azure IoT Central アプリケーションを作成するには:

1. **[Trial]\(試用版\)** を選択します。 試用版アプリケーションを作成するのに Azure サブスクリプションは必要ありません。

    ディレクトリとサブスクリプションの詳細については、[アプリケーションの作成のクイック スタート](quick-deploy-iot-central-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json)に関するページを参照してください。

1. **[アプリケーションのプレビュー]** を選択します。

1. 必要に応じて、わかりやすいアプリケーション名を選択することもできます (**Contoso Air Conditioners** など)。 Azure IoT Central によって、一意の URL プレフィックスが自動的に生成されます。 この URL プレフィックスは、もっと覚えやすいものに変更することができます。

1. 試用版アプリケーションを作成する場合は、連絡先の詳細を入力する必要があります。

1. **作成** を選択します。

    ![Azure IoT Central の [Create Application]\(アプリケーションの作成\) ページ](./media/tutorial-define-device-type-pnp/iotcentralcreate.png)

    詳細については、[アプリケーションの作成のクイック スタート](quick-deploy-iot-central-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json)に関するページをご覧ください。

また、[IoT プラグ アンド プレイ](../iot-pnp/overview-iot-plug-and-play.md) デバイス機能モデルが記載されている **EnvironmentalSensorInline.capabilitymodel.json** ファイルのローカル コピーが必要です。 [ここ](https://raw.githubusercontent.com/Azure/IoTPlugandPlay/master/samples/EnvironmentalSensorInline.capabilitymodel.json)からダウンロードできます。 ページ上で右クリックして、 **[名前を付けて保存]** を選択します。

ファイルをダウンロードしたら、テキスト エディターで開き、2 つある `<YOUR_COMPANY_NAME_HERE>` を自分の名前で置き換えます。 英数字 (a から z、A から Z、0 から 9) とアンダースコアのみを使用してください。

## <a name="create-a-template"></a>テンプレートの作成

作成者は、アプリケーションでデバイス テンプレートを作成および編集できます。 デバイス テンプレートを公開した後で、シミュレートされたデバイスの生成や、デバイス テンプレートが実装された実デバイスの接続を行えます。 シミュレートされたデバイスを使用すると、実デバイスを接続する前にアプリケーションの動作をテストできます。

新しいデバイス テンプレートをアプリケーションに追加するには、 **[デバイス テンプレート]** ページに移動します。 そのために、左側のナビゲーション メニューで **[デバイス テンプレート]** タブを選択します。

![[デバイス テンプレート] ページ](./media/tutorial-define-device-type-pnp/devicedefinitions.png)

### <a name="add-a-device-capability-model"></a>デバイス機能モデルを追加する

IoT Central でデバイス機能モデルを作成する場合、選択肢は複数あります。 カスタム モデルをゼロから作成する方法、ファイルからインポートする方法、デバイス カタログから選択する方法、デバイス機能モデルをパブリック リポジトリに公開したときのデバイス優先接続を使用して IoT プラグ アンド プレイ デバイスを接続する方法から選べます。 このチュートリアルでは、ファイルからデバイス機能モデルをインポートします。

以下の手順で、**環境センサー** デバイスの機能モデルをインポートする方法について説明します。 これらのデバイスは、温度などのテレメトリをアプリケーションに送信します。

1. 新しいデバイス テンプレートを追加するために、 **[デバイス テンプレート]** ページで **[+ 新規]** を選択します。

1. テンプレートの一覧から **[カスタム]** を選択します。

1. デバイス テンプレートの名前として、「**Environmental Sensor**」と入力します。

1. **[機能モデルのインポート]** を選択して、JSON ファイルから新しいデバイス機能モデルを作成します。 ローカル コンピューター上にある、**EnvironmentalSensorInline.capabilitymodel.json** ファイルを保存したフォルダーを参照します。 **EnvironmentalSensorInline.capabilitymodel.json** ファイルを選択して、 **[開く]** を選択します。 環境センサーの機能モデルには、**環境センサー** インターフェイスと**デバイス情報**インターフェイスが含まれています。

    ![環境センサー デバイスの機能モデル](./media/tutorial-define-device-type-pnp/newdevicecapabilitymodel.png)

    これらのインターフェイスにより、**環境センサー** デバイスの機能が定義されます。 機能には、デバイスが送信するテレメトリ、デバイスがレポートするプロパティ、デバイスが反応するコマンドなどがあります。

### <a name="add-cloud-properties"></a>クラウド プロパティを追加する

デバイス テンプレートにはクラウド プロパティを含めることができます。 クラウド プロパティは IoT Central アプリケーション内のみに存在しており、デバイスとの間で送受信されることはありません。

1. **[クラウド プロパティ]** 、 **[+ クラウド プロパティの追加]** の順に選択します。 下表の情報に従って、デバイス テンプレートにクラウド プロパティを追加します。

    | 表示名      | セマンティックの種類 | スキーマ |
    | ----------------- | ------------- | ------ |
    | Last Service Date | なし          | Date   |
    | お客様名     | なし          | string |

1. **[保存]** を選択して変更を保存します。

    ![クラウド プロパティ](media/tutorial-define-device-type-pnp/cloudproperties.png)

### <a name="add-customizations"></a>カスタマイズを追加する

インターフェイスを変更する必要がある場合や、デバイス機能モデルのバージョン管理が不要な機能に IoT Central 固有の機能を追加する場合は、カスタマイズを利用します。 機能モデルがドラフト状態か公開済み状態であるときに、フィールドをカスタマイズできます。 カスタマイズできるのは、インターフェイスの互換性を損なうことのないフィールドのみです。 たとえば、次のようなことができます。

- 機能の表示名やユニットをカスタマイズする。
- グラフ上での値の表示時に使用する既定の色を追加する。
- プロパティの初期値、最小値、最大値を指定する。

機能名と機能の種類をカスタマイズすることはできません。


## <a name="create-views"></a>ビューの作成

作成者は、環境センサー デバイスの関連情報がオペレーターに表示されるよう、アプリケーションをカスタマイズできます。 カスタマイズを行うことで、オペレーターがアプリケーションに接続された環境センサー デバイスを管理できるようになります。 オペレーター向けのデバイス操作用のビューを 2 種類作成できます。

* デバイス プロパティとクラウド プロパティを表示および編集するためのフォーム。
* デバイスを視覚化するためのダッシュボード。

### <a name="generate-default-views"></a>既定のビューを生成する

重要なデバイス情報の視覚化をすぐに始める方法は、既定のビューを生成することです。 デバイス テンプレートごとに生成できる既定のビューは、最大で 3 つです。

* **[コマンド]** ビューでは、オペレーターがデバイスにコマンドを送信できます。
* **[概要]** ビューでは、グラフとメトリックを利用してデバイスのテレメトリが表示されます。
* **[詳細]** ビューには、デバイスのプロパティが表示されます。

**[Generate default views]\(既定のビューの生成\)** を選択すると、デバイス テンプレートの **[ビュー]** セクションにそれらが自動的に追加されます。

### <a name="configure-a-view-to-visualize-devices"></a>ビューを構成してデバイスを視覚化する

オペレーターは、デバイス ダッシュボードでグラフやメトリックを利用してデバイスを視覚化できます。 作成者はデバイス ダッシュボードに表示される情報を定義できます。 デバイスに対し、複数のダッシュボードを定義することができます。 環境センサーのテレメトリを視覚化するダッシュボードを作成するために、 **[ビュー]** 、 **[デバイスの視覚化]** の順に選択します。

1. **[プロパティ]** に、すべてのデバイス プロパティ、クラウド プロパティ、テレメトリ、および静的オプションの一覧が表示されます。 これらの項目はいずれもビューにドラッグ アンド ドロップできます。 **[明るさのレベル]** プロパティをビューにドラッグします。 タイルは、歯車アイコンを使用して構成できます。

1. テレメトリをプロットするグラフを追加するために、 **[湿度]** と **[温度]** を選択してから **[結合]** を選択します。 このグラフを円グラフや横棒グラフなどの別の形式で表示するには、タイル上部にある **[ビジュアル化の変更]** ボタンを選択します。

1. **[保存]** を選択してビューを保存します。

別のプロパティやテレメトリ値を表示するタイルをさらに追加できます。 また、静的テキストやリンク、画像も追加できます。 ダッシュボード上のタイルを移動したり、そのサイズを変更したりするには、そのタイルの上にマウス ポインターを移動して、タイルを新しい場所にドラッグするか、そのサイズを変更します。

### <a name="add-a-device-form"></a>デバイス フォームを追加する

デバイス フォームでは、オペレーターが、書き込み可能なデバイス プロパティとクラウド プロパティを編集できます。 作成者は複数のフォームを定義し、各フォームに表示するデバイス プロパティとクラウド プロパティを選択することができます。 フォームには、読み取り専用のデバイス プロパティを表示することもできます。

環境センサーのプロパティを確認および編集するためのビューを作成には:

1. **[環境センサー]** テンプレートの **[ビュー]** に移動します。 **[デバイスとクラウドのデータの編集]** タイルを選択し、新しいビューを追加します。

1. フォーム名として「**環境センサーのプロパティ**」と入力します。

1. **[顧客名]** と **[Last service date]\(前回点検日\)** の各クラウド プロパティを、フォームの既存のセクションにドラッグします。

1. **[Brightness Level]\(輝度\)** と **[デバイスの状態]** の各デバイス プロパティを選択します。 次に、 **[セクションの追加]** を選択します。 セクションのタイトルを編集して、**センサーのプロパティ**に変更します。 **[適用]** を選択します。

1. **[デバイス モデル]** 、 **[ソフトウェア バージョン]** 、 **[製造元]** 、および **[プロセッサの製造元]** の各デバイス プロパティを選択します。 次に、 **[セクションの追加]** を選択します。 セクションのタイトルを編集して、**デバイスのプロパティ**に変更します。 **[適用]** を選択します。

1. **[保存]** を選択してビューを保存します。

## <a name="publish-device-template"></a>デバイス テンプレートの公開

シミュレートされた環境センサーの作成や、実物の環境センサーの接続を行うには、デバイス テンプレートを公開する必要があります。

デバイス テンプレートを公開するには:

1. **[デバイス テンプレート]** ページで、作成したデバイス テンプレートに移動します。

1. **[発行]** を選択します。

1. **[Publish a Device Template]\(デバイス テンプレートの公開\)** ダイアログで、 **[公開]** を選択します。

    ![モデルの公開](media/tutorial-define-device-type-pnp/publishedmodel.png)

デバイス テンプレートを公開すると、 **[デバイス]** ページに表示され、オペレーターが確認できるようになります。 公開済みのデバイス テンプレートで、新しいバージョンを作成せずにデバイス機能モデルを編集することはできません。 ただし、公開済みのデバイス テンプレートでも、クラウド プロパティ、カスタマイズ、ビューについては、新バージョンを作成することなく更新できます。 変更完了後に **[公開]** を選択すると、変更内容がオペレーターにプッシュされます。

## <a name="next-steps"></a>次の手順

このチュートリアルでは、以下の内容を学習しました。

* 新しいデバイス テンプレートの作成
* デバイス機能モデルのインポート。
* クラウド プロパティの作成。
* カスタマイズの作成。
* デバイス テレメトリの視覚化の定義。
* デバイス テンプレートの公開。

ここでは、Azure IoT Central アプリケーションでデバイス テンプレートを作成しました。推奨される次の手順は以下のとおりです。

> [!div class="nextstepaction"]
> [デバイスの追加](tutorial-add-device-pnp.md?toc=/azure/iot-central-pnp/toc.json&bc=/azure/iot-central-pnp/breadcrumb/toc.json)
