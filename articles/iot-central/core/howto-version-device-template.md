---
title: Azure IoT Central アプリのデバイス テンプレートのバージョン管理について | Microsoft Docs
description: 新しいバージョンを作成することで、ライブ接続されたデバイスに影響を与えずにデバイス テンプレートを反復処理します
author: dominicbetts
ms.author: dobett
ms.date: 11/06/2020
ms.topic: how-to
ms.service: iot-central
services: iot-central
ms.custom: device-developer
ms.openlocfilehash: 93545c63013c95e3db498b079061da3d9b189efd
ms.sourcegitcommit: a43a59e44c14d349d597c3d2fd2bc779989c71d7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/25/2020
ms.locfileid: "95995762"
---
# <a name="create-a-new-device-template-version"></a>デバイス テンプレートの新しいバージョンを作成する

"*この記事は、ソリューション ビルダーおよびデバイス開発者を対象としています。* "

デバイス テンプレートには、デバイスが IoT Central とどのようにやり取りするかを記述するスキーマが含まれています。 これらのやり取りには、テレメトリ、プロパティ、コマンドが含まれます。 デバイスと IoT Central アプリケーションは両方とも、このスキーマの解釈を共有することよって情報を交換します。 コントラクトを破棄しなければ、スキーマに対して限定的な変更しかできません。そのため、ほとんどのスキーマ変更には新しいバージョンのデバイス テンプレートが必要になります。 デバイス テンプレートのバージョン管理により、古いデバイスは、理解しているスキーマのバージョンを引き続き使用できるようになります。一方、新しいデバイスや更新されたデバイスでは、より新しいバージョンのスキーマが使用できます。

デバイス テンプレートのスキーマは、デバイス モデルとそのインターフェイスで定義されています。 デバイス テンプレートには、クラウドのプロパティ、表示のカスタマイズ、ビューなどの他の情報が含まれています。 デバイスが IoT Central とデータを交換する方法が定義されていないデバイス テンプレートの部分を変更した場合は、テンプレートのバージョンを作成する必要はありません。

オペレーターが使用できるようにする前に、必ず更新されたデバイス テンプレートを発行する必要があります。 IoT Central は、テンプレートのバージョン管理を行わずに、デバイス テンプレートに重大な変更を公開できないようにします。

> [!NOTE]
> デバイス テンプレートを作成する方法について詳しくは、[デバイス テンプレートの設定と管理](howto-set-up-template.md)に関する記事をご覧ください

## <a name="versioning-rules"></a>バージョン管理ルール

このセクションでは、デバイス テンプレートに適用されるバージョン管理ルールの概要を示します。 デバイス モデルとインターフェイスの両方にバージョン番号があります。 次のスニペットは、あるサーモスタット デバイスのデバイス モデルを示しています。 デバイス モデルに、1 つのインターフェイスがあります。 `@id` フィールドの末尾にバージョン番号が表示されます。

```json
{
  "@context": "dtmi:dtdl:context;2",
  "@id": "dtmi:com:example:Thermostat;1",
  "@type": "Interface",
  "displayName": "Thermostat",
  "description": "Reports current temperature and provides desired temperature control.",
  "contents": [
    // ...
  ]
}
```

IoT Central UI でこの情報を表示するには、デバイス テンプレート エディターで **[ID の表示]** を選択します。

:::image type="content" source="media/howto-version-device-template/view-identity.png" alt-text="インターフェイスの ID を表示してバージョン番号を確認する":::

次の一覧に、新しいバージョンをいつ作成する必要があるかを定めるルールを示します。

* デバイス モデルが公開された後は、新しいバージョンのデバイス テンプレートであっても、インターフェイスを削除することはできません。
* デバイス モデルが公開された後は、新しいバージョンのデバイス テンプレートを作成すればインターフェイスを追加できます。
* デバイス モデルが公開された後、新しいバージョンのデバイス テンプレートを作成すればインターフェイスを新しいバージョンに置き換えることができます。 たとえば、sensor v1 のデバイス テンプレートで、thermostat v1 インターフェイスが使用されている場合は、thermostat v2 インターフェイスを使用する sensor v2 デバイス テンプレートを作成できます。
* DCM が公開された後は、新しいバージョンのデバイス テンプレートであっても、インターフェイスのコンテンツを削除することはできません。
* インターフェイスを公開した後、インターフェイスとデバイス テンプレートの新しいバージョンを作成すると、インターフェイスのコンテンツに項目を追加できます。 インターフェイスに追加できる項目には、テレメトリ、プロパティ、コマンドなどがあります。
* インターフェイスを公開した後、インターフェイスとデバイス テンプレートの新しいバージョンを作成すると、インターフェイスの既存コンテンツに非スキーマの変更を加えられます。 インターフェイス項目の非スキーマ部分には、表示名とセマンティック型が含まれます。 変更できないインターフェイス項目のスキーマ部分には、名前、機能の種類、およびスキーマがあります。

以下のセクションでは、IoT Central でデバイス テンプレートを変更する例をいくつか紹介します。

## <a name="customize-the-device-template-without-versioning"></a>バージョン更新を行わずにデバイス テンプレートをカスタマイズする

デバイス機能の一部の要素については、デバイス テンプレートやインターフェイスのバージョンを更新することなく編集できます。 こうしたフィールドの例としては、表示名、セマンティックの種類、最小値、最大値、小数点以下桁数、色、単位、表示単位、コメント、説明などがあります。 これらのカスタマイズのいずれかを追加するには、次の手順に従います。

1. **[デバイス テンプレート]** ページに移動します。
1. カスタマイズするデバイス テンプレートを選択します。
1. **[カスタマイズ]** タブを選択します。
1. ここには、デバイス モデルで定義されているすべての機能の一覧が表示されています。 デバイス テンプレートのバージョンを更新することなく、これらのフィールドのすべてを編集、保存、および使用することができます。 読み取り専用のフィールドを編集する場合は、変更にあたって新しいバージョンのデバイス テンプレートを作成する必要があります。 編集するフィールドを選択して、新しい値を入力します。
1. **[保存]** を選択します。 デバイス テンプレートにもともと保存されていた値が、これらの値でオーバーライドされます。以後は、新しい値がアプリケーション全体で使用されるようになります。

## <a name="version-a-device-template"></a>デバイス テンプレートのバージョンを更新する

デバイス テンプレートの新しいバージョンを作成すると、テンプレートのドラフト バージョンが作成されます。このバージョンで、デバイス モデルを編集できます。 公開済みのインターフェイスは、個別に新バージョンが作成されるまで公開済みのままになります。 公開されたインターフェイスを変更するには、まず新しいデバイス テンプレートのバージョンを作成する必要があります。

デバイス テンプレートのバージョン更新は、デバイス モデルの要素のうち、[カスタマイズ] セクションでは編集不可能なものを編集する場合にのみ、行うようにしてください。

デバイス テンプレートのバージョンを更新するには次を行います。

1. **[デバイス テンプレート]** ページに移動します。
1. バージョンを更新するデバイス テンプレートを選択します。
1. ページ上部にある **[バージョン]** ボタンを選択して、テンプレートに新しい名前を付けます。 IoT Central が新しい名前を提案します。この名前は編集できます。
1. **[作成]** を選択します。
1. これで、デバイス テンプレートがドラフト モードになります。 インターフェイスがまだロックされていることを確認できます。 変更するインターフェイスをバージョン更新します。

## <a name="version-an-interface"></a>インターフェイスのバージョンを更新する

インターフェイスのバージョンを更新すると、作成済みのインターフェイス内にある機能を追加、更新、削除できます。

インターフェイスのバージョンを更新するには次を行います。

1. **[デバイス テンプレート]** ページに移動します。
1. ドラフト モードになっているデバイス テンプレートを選択します。
1. バージョンを更新して編集する、公開済みモードのインターフェイスを選択します。
1. インターフェイス ページの上部にある **[バージョン]** ボタンを選択します。
1. **[作成]** を選択します。
1. これで、インターフェイスがドラフト モードになります。 既存のカスタマイズやビューを損なうことなく、インターフェイスの機能を追加および編集できます。

## <a name="migrate-a-device-across-versions"></a>デバイスを複数のバージョンに移行する

複数のバージョンのデバイス テンプレートを作成できます。 時間の経過と共に、接続された複数のデバイスがこれらのデバイス テンプレートを使用するようになります。 デバイス テンプレートの 1 つのバージョンから、別のバージョンに、デバイスを移行できます。 次の手順では、デバイスを移行する方法について説明します。

1. **[デバイス]** ページに移動します。
1. 別のバージョンに移行する必要があるデバイスを選択します。
1. **[移行]** を選択します。:::image type="content" source="media/howto-version-device-template/migrate-device.png" alt-text="デバイスの移行を開始するオプションを選択する":::
1. デバイスの移行先のバージョン番号が設定されているデバイス テンプレートを選択して、 **[移行]** を選択します。

## <a name="next-steps"></a>次のステップ

オペレーターまたはソリューション ビルダーの場合は、次の手順として、[デバイスを管理する方法](./howto-manage-devices.md)を学習することをお勧めします。

デバイス開発者にお勧めする次の手順は、[Azure IoT Edge デバイスと Azure IoT Central](./concepts-iot-edge.md) に関する記事を読むことです。
