---
title: クイックスタート - シミュレートされたデバイスを Azure IoT Central に追加する
description: このクイックスタートでは、デバイス テンプレートを作成し、IoT Central アプリケーションにシミュレートされたデバイスを追加する方法を紹介します。
author: dominicbetts
ms.author: dobett
ms.date: 11/16/2020
ms.topic: quickstart
ms.service: iot-central
services: iot-central
ms.custom: mvc
ms.openlocfilehash: 4c7925c1bc397e15d8b6e0f2f21d5e9147109b83
ms.sourcegitcommit: 73fb48074c4c91c3511d5bcdffd6e40854fb46e5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/31/2021
ms.locfileid: "106064853"
---
# <a name="quickstart-add-a-simulated-device-to-your-iot-central-application"></a>クイック スタート:IoT Central アプリケーションにシミュレートされたデバイスを追加する

*この記事は、オペレーター、ビルダー、および管理者に適用されます。*

デバイス テンプレートは、IoT Central アプリケーションに接続するデバイスの機能を定義します。 機能には、デバイスが送信するテレメトリ、デバイスのプロパティ、デバイスが反応するコマンドなどがあります。 デバイス テンプレートから、ビルダーまたはオペレーターは、実際のデバイスとシミュレートされたデバイスの両方をアプリケーションに追加できます。 シミュレートされたデバイスは、実際のデバイスを接続する前に、IoT Central アプリケーションの動作をテストするのに役立ちます。

このクイックスタートでは、ESP32-Azure IoT Kit 開発ボードのデバイス テンプレートを追加し、シミュレートされたデバイスを作成します。 このクイックスタートを完了するために、実際のデバイスは必要ありません。デバイスのシミュレーションを使用します。 ESP32 デバイスは次のことを行います。

* 温度などのテレメトリを送信する。
* デバイスが再起動してからの最高温度など、デバイス固有のプロパティをレポートする。
* 再起動などのコマンドに応答する。
* ファームウェア バージョンやシリアル番号など、一般的なデバイス プロパティをレポートする。

## <a name="prerequisites"></a>前提条件

**[カスタム アプリ] > [カスタム アプリケーション]** テンプレートを使用して IoT Central アプリケーションを作成するには、「[Azure IoT Central アプリケーションの作成](./quick-deploy-iot-central.md)」クイックスタートを完了します。

## <a name="create-a-device-template"></a>デバイス テンプレートを作成します

ビルダーは、IoT Central アプリケーションでデバイス テンプレートを作成および編集できます。 デバイス テンプレートを発行した後は、デバイス テンプレートからシミュレートされたデバイスを生成したり、実際のデバイスを接続したりできます。 シミュレートされたデバイスを使用すると、実デバイスを接続する前にアプリケーションの動作をテストできます。

新しいデバイス テンプレートをアプリケーションに追加するには、左ペインで **[デバイス テンプレート]** タブを選択します。

:::image type="content" source="media/quick-create-simulated-device/device-definitions.png" alt-text="デバイス テンプレートの空の一覧を示すスクリーンショット":::

デバイス テンプレートには、以下を定義するデバイス モデルが含まれます。

* デバイスが送信するテレメトリ。
* デバイスのプロパティ:
* デバイスが応答するコマンド。

### <a name="add-a-device-template"></a>デバイス テンプレートの追加

IoT Central アプリケーションにデバイス モデルを追加する場合、いくつかのオプションがあります。 モデルをゼロから作成することも、ファイルからモデルをインポートすることも、デバイス カタログからデバイスを選択することもできます。 IoT Central では、"*デバイス優先*" アプローチもサポートされています。このアプローチでは、実際のデバイスが初めて接続したときに、アプリケーションによってリポジトリからモデルが自動的にインポートされます。

このクイックスタートでは、デバイス カタログからデバイスを選択してデバイス テンプレートを作成します。

次の手順は、デバイス カタログを使用して、**ESP32** デバイスのモデルをインポートする方法を示しています。 これらのデバイスは、温度などのテレメトリをアプリケーションに送信します。

1. 新しいデバイス テンプレートを追加するには、 **[デバイス テンプレート]** ページで **[+ 新規]** を選択します。

1. **[種類の選択]** ページの **[Use a preconfigured device template]\(構成済みのデバイス テンプレートを使用する\)** セクションで、 **[ESP32-Azure IoT Kit]** タイルが表示されるまで下にスクロールします。

1. **[ESP32-Azure IoT Kit]** タイルを選択し、 **[Next: Review]\(次へ: 確認\)** をクリックします。

1. **[Review]\(レビュー\)** ページで、 **[Create]\(作成\)** を選択します。

1. 数秒後に、新しいデバイス テンプレートが表示されます。

    :::image type="content" source="media/quick-create-simulated-device/devkit-template.png" alt-text="ESP32 デバイスのデバイス テンプレートを示すスクリーンショット":::

    テンプレートの名前は **Sensor Controller** です。 このモデルには、**Sensor Controller**、**SensorTemp**、**Device Information interface** などのコンポーネントが含まれています。 コンポーネントによって、ESP32 デバイスの機能が定義されます。 機能には、テレメトリ、プロパティ、コマンドが含まれます。

### <a name="add-cloud-properties"></a>クラウド プロパティを追加する

デバイス テンプレートにはクラウド プロパティを含めることができます。 クラウド プロパティは IoT Central アプリケーション内のみに存在しており、デバイスとの間で送受信されることはありません。 2 つのクラウド プロパティを追加するには、次の手順に従います。

1. **[クラウド プロパティ]** 、 **[+ クラウド プロパティの追加]** の順に選択します。 下表の情報に従って、デバイス テンプレートに 2 つのクラウド プロパティを追加します。

    | 表示名      | セマンティックの種類 | スキーマ |
    | ----------------- | ------------- | ------ |
    | Last Service Date | なし          | Date   |
    | Customer Name     | なし          | String |

1. **[保存]** を選択して変更を保存します。

    :::image type="content" source="media/quick-create-simulated-device/cloud-properties.png" alt-text="2 つのクラウド プロパティを示すスクリーンショット":::

## <a name="views"></a>ビュー

ビルダーは、アプリケーションをカスタマイズして、デバイスの関連情報がオペレーターに表示されるようにすることができます。 カスタマイズを行うことで、オペレーターがアプリケーションに接続されたデバイスを管理できるようになります。 オペレーター向けのデバイス操作用のビューを 2 種類作成できます。

* デバイス プロパティとクラウド プロパティを表示および編集するためのフォーム。
* デバイスとデバイスから送信されたテレメトリスを視覚化するダッシュボード。

### <a name="default-views"></a>既定のビュー

既定のビューを使用すると、重要なデバイス情報の視覚化をすばやく開始できます。 デバイス テンプレートごとに生成できる既定のビューは、最大で 3 つです。

* **[コマンド]** ビューでは、オペレーターがデバイスにコマンドを送信できます。
* **[概要]** ビューでは、グラフとメトリックを利用してデバイスのテレメトリが表示されます。
* **[詳細]** ビューには、デバイスのプロパティが表示されます。

デバイス テンプレートで **[ビュー]** ノードを選択します。 テンプレートを追加すると、IoT Central によって **[概要]** および **[詳細]** ビューが自動的に生成されます。

オペレーターがデバイスを管理するために使用できる新しい **[デバイスの管理]** フォームを追加するには、次のようにします。

1. **[ビュー]** ノードを選択し、 **[デバイスとクラウドのデータの編集]** タイルを選択して新しいビューを追加します。

1. フォーム名を「**デバイスの管理**」に変更します。

1. **[顧客名]** および **[Last Service Date]\(前回点検日\)** クラウド プロパティと、 **[Target Temperature]\(目標温度\)** プロパティを選択します。 次に、 **[セクションの追加]** を選択します。

    :::image type="content" source="media/quick-create-simulated-device/new-form.png" alt-text="デバイス テンプレートに追加された新しいフォームを示すスクリーンショット":::

1. **[保存]** を選択して新しいフォームを保存します。

## <a name="publish-device-template"></a>デバイス テンプレートの公開

シミュレートされたデバイスを作成したり、実物のデバイスを接続したりする前に、デバイス テンプレートを発行する必要があります。 最初に作成したテンプレートは IoT Central によって発行されましたが、更新したバージョンを発行する必要があります。

デバイス テンプレートを公開するには:

1. **[デバイス テンプレート]** ページで、 **[Sensor Controller]** デバイス テンプレートに移動します。

1. **[発行]** を選択します。

    :::image type="content" source="media/quick-create-simulated-device/published-model.png" alt-text="[発行] アイコンの場所を示すスクリーンショット":::

1. **[このデバイス テンプレートのアプリケーションへの発行]** ダイアログで、 **[発行]** を選択します。

デバイス テンプレートを発行すると、 **[デバイス]** ページに表示されます。 発行済みのデバイス テンプレートでは、新しいバージョンを作成せずにデバイス モデルを編集することはできません。 ただし、クラウド プロパティ、カスタマイズ、ビューは、バージョン管理を行わなくても、発行済みのデバイス テンプレートで変更できます。 変更完了後に **[公開]** を選択すると、変更内容がオペレーターにプッシュされます。

## <a name="add-a-simulated-device"></a>シミュレートされたデバイスの追加

シミュレートされたデバイスをアプリケーションに追加するには、作成した **ESP32** デバイス テンプレートを使用します。

1. オペレーターが新しいデバイスを追加するには、左側のウィンドウで **[デバイス]** を選択します。 **[デバイス]** タブには、 **[すべてのデバイス]** と ESP32 デバイスの **[Sensor Controller]** デバイス テンプレートが表示されます。 **[Sensor Controller]** を選択します。

1. シミュレートされた DevKit デバイスを追加するには、 **[+ 新規]** を選択します。 推奨される **デバイス ID** を使用するか、独自のデバイス ID を入力します。 デバイス ID には、文字、数字、および `-` 文字を含めることができます。 新しいデバイスの名前を入力することもできます。 **[Simulate this device]\(このデバイスをシミュレートする\)** が **[はい]** に設定されていることを確認し、 **[作成]** を選択します。

    :::image type="content" source="media/quick-create-simulated-device/simulated-device.png" alt-text="シミュレートされた Sensor Controller デバイスを示すスクリーンショット":::

これで、ビルダーがデバイス テンプレート用に作成したビューを、シミュレートされたデータを使用して操作できるようになりました。

1. **[デバイス]** ページで、シミュレートされたデバイスを選択します

    * **[概要]** ビューには、シミュレートされたテレメトリのプロットが表示されます。

        :::image type="content" source="media/quick-create-simulated-device/simulated-telemetry.png" alt-text="シミュレートされたデバイスの概要ページを示すスクリーンショット":::

    * **[詳細]** ビューには、プロパティ値が表示されます。

    * **[コマンド]** ビューでは、デバイスで **再起動** などのコマンドを実行できます。

    * **[デバイスの管理]** ビューは、オペレーターがデバイスを管理できるようにするために作成したフォームです。

    * **[生データ]** ビューには、デバイスから送信されてきた未加工のテレメトリ値とプロパティ値を表示できます。 このビューは、デバイスのデバッグに役立ちます。

## <a name="use-a-simulated-device-to-improve-views"></a>シミュレートされたデバイスを使用してビューを改善する

新しいシミュレートされたデバイスを作成した後、作成者はこのデバイスを使用して、デバイス テンプレートのビューを引き続き改善し、構築することができます。

1. 左ペインで **[デバイス テンプレート]** を選択し、 **[Sensor Controller]** テンプレートを選択します。

1. **[概要]** など、編集するビューを選択するか、新しいビューを作成します。 **[Configure preview device]\(プレビュー デバイスの構成\)** 、 **[Select from a running device]\(実行中のデバイスから選択する\)** の順に選択します。 ここでは、プレビュー デバイスを使用しないか、テスト用に構成された実際のデバイスを使用するか、IoT Central に追加した既存のデバイスを使用するかを選択できます。

1. 一覧からシミュレートされたデバイスを選択します。 次に、 **[適用]** を選択します。 これで、デバイス テンプレート ビューの作成エクスペリエンスで、同じシミュレートされたデバイスを確認できるようになりました。 このビューは、グラフやその他の視覚化に役立ちます。

    :::image type="content" source="media/quick-create-simulated-device/configure-preview.png" alt-text="構成済みのプレビュー デバイスを示すスクリーンショット":::

## <a name="clean-up-resources"></a>リソースをクリーンアップする

[!INCLUDE [iot-central-clean-up-resources](../../../includes/iot-central-clean-up-resources.md)]

## <a name="next-steps"></a>次のステップ

このクイックスタートでは、ESP32 デバイスの **Sensor Controller** デバイス テンプレートを作成し、シミュレートされたデバイスをアプリケーションに追加する方法について説明しました。

アプリケーションに接続されているデバイスの監視の詳細については、以下のクイックスタートをご覧ください。

> [!div class="nextstepaction"]
> [規則とアクションを構成する](./quick-configure-rules.md)
