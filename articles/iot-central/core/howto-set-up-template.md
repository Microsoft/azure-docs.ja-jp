---
title: Azure IoT Central で新しい IoT デバイスの種類を定義する | Microsoft Docs
description: この記事では、ソリューション ビルダーとして、Azure IoT Central アプリケーションで新しい Azure IoT デバイス テンプレートを作成する方法を示します。 種類に対して、テレメトリ、状態、プロパティ、コマンドを定義します。
author: dominicbetts
ms.author: dobett
ms.date: 12/06/2019
ms.topic: how-to
ms.service: iot-central
services: iot-central
ms.custom:
- contperf-fy21q1
- device-developer
ms.openlocfilehash: 22e948a0100f23dbddef8fc138576bb4b9372c77
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/14/2021
ms.locfileid: "100363204"
---
# <a name="define-a-new-iot-device-type-in-your-azure-iot-central-application"></a>Azure IoT Central アプリケーションで新しい IoT デバイスの種類を定義する

"*この記事は、ソリューション ビルダーおよびデバイス開発者を対象としています。* "

デバイス テンプレートは、[Azure IoT Central アプリケーション](concepts-app-templates.md)に接続するデバイスの種類の、特性と動作を定義するブループリントです。

たとえばビルダーでは、次の機能を持つ、接続されたファン用のデバイス テンプレートを作成できます。

- 温度テレメトリを送信する
- 場所プロパティを送信する
- ファン モーター エラー イベントを送信する
- ファンの動作状態を送信する
- 書き込み可能なファン速度プロパティを提供する
- デバイスを再起動するコマンドを提供する
- ビューを使用してデバイスの全体像を示す

オペレーターはこのデバイス テンプレートから、実際のファン デバイスを作成して接続できます。 これらのすべてのファンには、オペレーターがそれらを監視および管理するために使用する測定値、プロパティ、およびコマンドがあります。 オペレーターは、[デバイスのビュー](#add-views)とフォームを使用して、ファン デバイスを操作します。 デバイス開発者は、テンプレートを使用して、デバイスがアプリケーションとどのようにやり取りするかを解釈します。 詳細については、「[テレメトリ、プロパティ、およびコマンドのペイロード](concepts-telemetry-properties-commands.md)」を参照してください。

> [!NOTE]
> デバイス テンプレートの作成、編集、および削除が可能なのは、ビルダーと管理者のみです。 すべてのユーザーは、 **[Device]\(デバイス\)** ページで既存のデバイス テンプレートからデバイスを作成できます。

IoT Central アプリケーションでは、デバイス テンプレートはデバイス モデルを使用して、デバイスの機能を記述します。 ビルダーは、デバイス テンプレートを作成する場合、次に示すいくつかのオプションを利用できます。

- IoT Central でデバイス テンプレートを設計し、[そのデバイス モデルをデバイス コードに実装します](concepts-telemetry-properties-commands.md)。
- [Azure Certified for IoT デバイス カタログ](https://aka.ms/iotdevcat)からデバイス テンプレートをインポートします。 IoT Central の要件に合わせてデバイス テンプレートをカスタマイズします。
> [!NOTE]
> IoT Central には、同じファイル内のすべての参照先インターフェイスを含む完全なモデルが必要です。モデル リポジトリからモデルをインポートする場合は、キーワード "expanded" を使用して完全なバージョンを取得してください。
次に例を示します。 https://devicemodels.azure.com/dtmi/com/example/thermostat-1.expanded.json

- [Digital Twins Definition Language (DTDL) バージョン 2](https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md) を使用して、デバイス モデルを作成します。 Visual Studio Code には、DTDL モデルの作成をサポートする拡張機能が用意されています。 詳細については、「[DTDL オーサリング ツールをインストールして使用する](../../iot-pnp/howto-use-dtdl-authoring-tools.md)」を参照してください。 次に、そのモデルをパブリック モデル リポジトリに発行します。 詳細については、「[デバイス モデル リポジトリ](../../iot-pnp/concepts-model-repository.md)」を参照してください。 モデルからデバイス コードを実装し、実際のデバイスを IoT Central アプリケーションに接続します。 IoT Central は、パブリック リポジトリからデバイス モデルを検索してインポートし、デバイス テンプレートを生成します。 その後、ご利用の IoT Central アプリケーションに必要なクラウド プロパティ、カスタマイズ、ビューをデバイス テンプレートに追加できます。
- DTDL を使用してデバイス モデルを作成します。 ご利用のデバイス コードをモデルから実装します。 ご利用の IoT Central アプリケーションにデバイス モデルを手動でインポートし、IoT Central アプリケーションに必要なクラウド プロパティ、カスタマイズ、ビューを追加します。

> [!TIP]
> IoT Central には、同じファイル内のすべての参照先インターフェイスを含む完全なモデルが必要です。 モデル リポジトリからモデルをインポートする場合は、キーワード *expanded* を使用して完全なバージョンを取得してください。
> たとえば、[https://devicemodels.azure.com/dtmi/com/example/thermostat-1.expanded.json](https://devicemodels.azure.com/dtmi/com/example/thermostat-1.expanded.json) です。

また、[REST API](/learn/modules/manage-iot-central-apps-with-rest-api/) または [CLI](howto-manage-iot-central-from-cli.md) を使用して、IoT Central アプリケーションにデバイス テンプレートを追加することもできます。

一部の[アプリケーション テンプレート](concepts-app-templates.md)には、アプリケーション テンプレートでサポートされるシナリオで役に立つデバイス テンプレートが既に含まれてます。 例については、「[ストア内の分析のアーキテクチャ](../retail/store-analytics-architecture.md)」を参照してください。

## <a name="create-a-device-template-from-the-device-catalog"></a>デバイス カタログからデバイス テンプレートを作成する

ビルダーは、認定デバイスを使用してソリューションの構築をすぐに開始できます。 [Azure IoT デバイス カタログ](https://catalog.azureiotsolutions.com/alldevices)で一覧を参照してください。 IoT Central はデバイス カタログと統合されているため、これらのどの認定デバイスからでもデバイス モデルをインポートすることができます。 IoT Central でこれらのデバイスのいずれかからデバイス テンプレートを作成するには、次の手順を実行します。

1. IoT Central アプリケーションの **[デバイス テンプレート]** ページに移動します。
1. **[+ 新規]** を選択し、カタログから任意の認定デバイスを選択します。 IoT Central は、このデバイス モデルに基づいてデバイス テンプレートを作成します。
1. クラウド プロパティ、カスタマイズ、またはビューをデバイス テンプレートに追加します。
1. **[Publish]\(発行\)** を選択して、オペレーターがテンプレートを使用してデバイスを表示および接続できるようにします。

## <a name="create-a-device-template-from-scratch"></a>デバイス テンプレートを最初から作成する

デバイス テンプレートには次のものが含まれています。

- デバイスが実装するテレメトリ、プロパティ、およびコマンドを指定する _デバイス モデル_。 これらの機能は、1 つ以上のコンポーネントに編成されています。
- IoT Central アプリケーションがデバイスについて格納する情報を定義する _クラウド プロパティ_。 たとえば、クラウド プロパティでは、デバイスが最後に点検されたデータを記録できます。 この情報は、デバイスと共有されることはありません。
- _カスタマイズ_ を使用すると、ビルダーはデバイス モデルの定義の一部をオーバーライドできます。 たとえば、ビルダーはデバイス プロパティの名前をオーバーライドできます。 プロパティ名は IoT Central のビューとフォームに表示されます。
- "_ビューとフォーム_" を使用すると、アプリケーションに接続されているデバイスをオペレーターが監視および管理できるようにする UI をビルダーで作成できます。

IoT Central でデバイス テンプレートを作成するには、次の手順を実行します。

1. IoT Central アプリケーションの **[Device Templates]\(デバイス テンプレート\)** ページに移動します。
1. **[+ 新規]**  >  **[IoT デバイス]** を選択します。 次に、 **[次のステップ: カスタマイズ]** を選択します。
1. 「**Thermostat**」など、テンプレートの名前を入力します。 次に、 **[次のステップ: レビュー]** を選択し、 **[作成]** を選択します。
1. IoT Central によって空のデバイス テンプレートが作成され、カスタム モデルを最初から作成するか、DTDL モデルをインポートするかを選択できます。

## <a name="manage-a-device-template"></a>デバイス テンプレートを管理する

テンプレートのホーム ページから、テンプレートの名前変更や削除を行えます。

デバイス モデルをテンプレートに追加したら、発行できます。 テンプレートを発行するまでは、このテンプレートに基づいてデバイスを接続し、オペレーターがそれを **[Devices]\(デバイス\)** ページで表示することはできません。

## <a name="create-a-capability-model"></a>機能モデルを作成する

デバイス モデルを作成するには、以下の手順を実行できます。

- IoT Central を使用して、最初からカスタム モデルを作成する。
- JSON ファイルから DTDL モデルをインポートする。 デバイス ビルダーが Visual Studio Code を使用して、アプリケーションのデバイス モデルを作成している場合があります。
- デバイス カタログからいずれかのデバイスを選択する。 このオプションでは、製造元がこのデバイスのために発行したデバイス モデルをインポートします。 このようにインポートされたデバイス モデルは、自動的に発行されます。

## <a name="manage-a-capability-model"></a>機能モデルを管理する

デバイス モデルを作成した後、以下の手順を実行できます。

- コンポーネントをモデルに追加する。 モデルには、少なくとも 1 つのコンポーネントが必要です。
- モデルのメタデータ (ID、名前空間、名前など) を編集する。
- モデルを削除する。

## <a name="create-a-component"></a>コンポーネントを作成する

デバイス モデルには、少なくとも 1 つの既定のコンポーネントが必要です。 コンポーネントは、再利用可能な機能のコレクションです。

コンポーネントを作成するには、以下の手順を実行できます。

1. デバイス モデルに移動し、 **[+ コンポーネントの追加]** を選択します。

1. **[コンポーネント インターフェイスの追加]** ページでは、次のことができます。

    - カスタムコンポーネントを最初から作成する。
    - DTDL ファイルから既存のコンポーネントをインポートする。 デバイス ビルダーが Visual Studio Code を使用して、デバイスのコンポーネント インターフェイスを作成している場合があります。

1. インターフェイスを作成したら、 **[ID の編集]** を選択して、コンポーネントの表示名を変更します。

1. カスタム コンポーネントを最初から作成することを選択した場合は、デバイスの機能を追加できます。 デバイスの機能は、テレメトリ、プロパティ、およびコマンドです。

### <a name="telemetry"></a>テレメトリ

テレメトリは、デバイスから (通常はセンサーから) 送信される値のストリームです。 たとえば、センサーから気温が報告される場合があります。

テレメトリ機能の構成設定を次の表に示します。

| フィールド | [説明] |
| ----- | ----------- |
| 表示名 | ビューとフォームで使用されるテレメトリ値の表示名。 |
| 名前 | テレメトリ メッセージ内のフィールドの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 このフィールドは英数字である必要があります。 |
| 機能の種類 | テレメトリ。 |
| セマンティックの種類 | テレメトリのセマンティックの種類 (温度、状態、イベントなど)。 セマンティックの種類の選択によって、次のどのフィールドを使用できるかが決まります。 |
| スキーマ | テレメトリのデータ型 (double、string、vector など)。 使用できる選択肢は、セマンティックの種類によって決まります。 スキーマは、イベントおよび状態のセマンティックの種類には使用できません。 |
| 重大度 | イベントのセマンティックの種類にのみ使用できます。 重大度は、**エラー**、**情報**、または **警告** です。 |
| 状態の値 | 状態のセマンティックの種類にのみ使用できます。 考えられる状態の値を定義します。それぞれに表示名、名前、列挙型、および値があります。 |
| ユニット | テレメトリ値の単位 (**mph**、 **%** 、または **&deg;C** など)。 |
| 表示単位 | ビューとフォームで使用する表示単位。 |
| 解説 | テレメトリ機能に関するコメント。 |
| 説明 | テレメトリ機能の説明。 |

### <a name="properties"></a>Properties

プロパティは、特定の時点の値を表します。 たとえば、デバイスはプロパティを使用して、到達しようとしているターゲット温度を報告できます。 IoT Central から、書き込み可能なプロパティを設定できます。

プロパティ機能の構成設定を次の表に示します。

| フィールド | [説明] |
| ----- | ----------- |
| 表示名 | ビューとフォームで使用されるプロパティ値の表示名。 |
| 名前 | プロパティの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 このフィールドは英数字である必要があります。 |
| 機能の種類 | プロパティ。 |
| セマンティックの種類 | テレメトリのセマンティックの種類 (温度、状態、イベントなど)。 セマンティックの種類の選択によって、次のどのフィールドを使用できるかが決まります。 |
| スキーマ | プロパティのデータ型 (double、string、vector など)。 使用できる選択肢は、セマンティックの種類によって決まります。 スキーマは、イベントおよび状態のセマンティックの種類には使用できません。 |
| 書き込み可能 | プロパティが書き込み可能でない場合、デバイスはプロパティ値を IoT Central に報告できます。 プロパティが書き込み可能な場合、デバイスはプロパティ値を IoT Central に報告し、IoT Central がプロパティの更新をデバイスに送信できます。
| 重大度 | イベントのセマンティックの種類にのみ使用できます。 重大度は、**エラー**、**情報**、または **警告** です。 |
| 状態の値 | 状態のセマンティックの種類にのみ使用できます。 考えられる状態の値を定義します。それぞれに表示名、名前、列挙型、および値があります。 |
| ユニット | プロパティ値の単位 (**mph**、 **%** 、または **&deg;C** など)。 |
| 表示単位 | ビューとフォームで使用する表示単位。 |
| 解説 | プロパティ機能に関するコメント。 |
| 説明 | プロパティ機能の説明。 |

### <a name="commands"></a>コマンド

IoT Central からデバイス コマンドを呼び出すことができます。 コマンドは、必要に応じて、デバイスにパラメーターを渡し、デバイスから応答を受け取ります。 たとえば、10 秒でデバイスを再起動するコマンドを呼び出すことができます。

コマンド機能の構成設定を次の表に示します。

| フィールド | [説明] |
| ----- | ----------- |
| 表示名 | ビューとフォームで使用されるコマンドの表示名。 |
| 名前 | コマンドの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 このフィールドは英数字である必要があります。 |
| 機能の種類 | コマンド。 |
| 解説 | コマンド機能に関するコメント。 |
| 説明 | コマンド機能の説明。 |
| Request | 有効になっている場合、名前、表示名、スキーマ、単位、および表示単位を含む要求パラメーターの定義。 |
| Response | 有効になっている場合、名前、表示名、スキーマ、単位、および表示単位を含むコマンド応答の定義。 |

デバイスでコマンドを実装する方法の詳細については、[「テレメトリ、プロパティ、およびコマンドペイロード」の「コマンド」および「実行時間の長いコマンド」](concepts-telemetry-properties-commands.md#commands)を参照してください。

#### <a name="offline-commands"></a>オフライン コマンド

デバイス テンプレートでコマンドの **[Queue if offline]\(オフラインの場合にキュー\)** オプションを有効にすることで、デバイスが現在オフラインになっている場合にキュー コマンドを選択できます。

このオプションによって、IoT Hub cloud-to-device メッセージが使用され、通知がデバイスに送信されます。 詳細については、[cloud-to-device メッセージの送信](../../iot-hub/iot-hub-devguide-messages-c2d.md)に関する IoT Hub 記事を参照してください。

cloud-to-device メッセージ:

- ご利用のソリューションからデバイスへの一方向通知です。
- 少なくとも 1 回のメッセージ配信が保証されます。 IoT Hub によって cloud-to-device メッセージはデバイス別キューに保持されます。接続とデバイスの障害に対する回復性が保証されます。
- cloud-to-device メッセージを処理するため、メッセージ ハンドラーを実装することがデバイスに求められます。

> [!NOTE]
> このオプションは、IoT Central Web UI でのみ使用できます。 この設定は、デバイス テンプレートからモデルまたはコンポーネントをエクスポートする場合は含まれません。

## <a name="manage-a-component"></a>コンポーネントを管理する

コンポーネントを発行していない場合は、コンポーネントによって定義されている機能を編集できます。 コンポーネントを発行した後、変更を行う場合は、デバイス テンプレートの新しいバージョンを作成し、[コンポーネントのバージョンを管理する](howto-version-device-template.md)必要があります。 バージョン管理を必要としない変更 (表示名や単位など) は、 **[Customize]\(カスタマイズ\)** セクションで行うことができます。

別の機能モデルで再利用する場合は、コンポーネントを JSON ファイルとしてエクスポートすることもできます。

## <a name="add-cloud-properties"></a>クラウド プロパティを追加する

クラウド プロパティを使用して、デバイスに関する情報を IoT Central に格納します。 クラウド プロパティがデバイスに送信されることはありません。 たとえば、クラウド プロパティを使用して、デバイスをインストールした顧客の名前、またはデバイスの前回の点検日を格納できます。

クラウド プロパティの構成設定を次の表に示します。

| フィールド | [説明] |
| ----- | ----------- |
| 表示名 | ビューとフォームで使用されるクラウド プロパティ値の表示名。 |
| 名前 | クラウド プロパティの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 |
| セマンティックの種類 | テレメトリのセマンティックの種類 (温度、状態、イベントなど)。 セマンティックの種類の選択によって、次のどのフィールドを使用できるかが決まります。 |
| スキーマ | クラウド プロパティのデータ型 (double、string、vector など)。 使用できる選択肢は、セマンティックの種類によって決まります。 |

## <a name="add-customizations"></a>カスタマイズを追加する

インポートしたコンポーネントを変更したり、機能に IoT Central 固有の機能を追加したりする必要がある場合は、カスタマイズを利用します。 カスタマイズできるのは、コンポーネントの互換性を損なうことのないフィールドのみです。 たとえば、次のように操作できます。

- 機能の表示名や単位をカスタマイズする。
- グラフに値が表示されるときに使用する既定の色を追加する。
- プロパティの初期値、最小値、最大値を指定する。

機能名や機能の種類をカスタマイズすることはできません。 **[カスタマイズ]** セクションで変更できない変更がある場合は、デバイス テンプレートとコンポーネントのバージョンを管理して機能を変更する必要があります。

### <a name="generate-default-views"></a>既定のビューを生成する

既定のビューを生成すると、重要なデバイス情報をすばやく視覚化することができます。 デバイス テンプレートに対して生成される既定のビューは、最大で 3 つです。

- **コマンド**:デバイス コマンドを含むビューを提供し、オペレーターがデバイスにコマンドをディスパッチできるようにします。
- **概要**:デバイス テレメトリを含むビューを提供し、グラフとメトリックを表示します。
- **詳細情報**:デバイス情報を含むビューを提供し、デバイス プロパティを表示します。

**[既定のビューの生成]** を選択した後、デバイス テンプレートの **[ビュー]** セクションにそれらが自動的に追加されているのを確認できます。

## <a name="add-views"></a>ビューを追加する

ビューをデバイス テンプレートに追加して、オペレーターがグラフとメトリックを使ってデバイスを視覚化できるようにします。 1 つのデバイス テンプレートに対して複数のビューを持つことができます。

デバイス テンプレートにビューを追加するには:

1. デバイス テンプレートにアクセスし、 **[Views]\(ビュー\)** を選択します。
1. **[Visualizing the Device]\(デバイスの視覚化\)** を選択します。
1. **[ビュー名]** にビューの名前を入力します。
1. 静的、プロパティ、クラウド プロパティ、テレメトリ、およびコマンドのタイルの一覧から、ビューにタイルを追加します。 ビューに追加するタイルをドラッグ アンド ドロップします。
1. 1 つのグラフ タイルに複数のテレメトリ値をプロットするには、テレメトリ値を選択してから、 **[Combine]\(結合\)** を選択します。
1. 追加する各タイルを構成して、データの表示方法をカスタマイズします。 このオプションにアクセスするには、歯車アイコンを選択するか、グラフ タイルで **[構成の変更]** を選択します。
1. ビューにタイルを配置し、サイズを変更します。
1. 変更を保存します。

### <a name="configure-preview-device-to-view"></a>ビューを表示するようにプレビュー デバイスを構成する

ビューを表示してテストするには、 **[プレビュー デバイスの構成]** を選択します。 この機能により、発行後にオペレーターに対して表示されるビューを確認できます。 この機能は、ビューに正しいデータが表示されているかどうかを検証するために使用します。 次のオプションから選択できます。

- プレビュー デバイスなし。
- デバイス テンプレート用に構成した実際のテスト デバイス。
- デバイス ID を使用した、アプリケーション内の既存のデバイス。

## <a name="add-forms"></a>フォームを追加する

デバイス テンプレートにフォームを追加して、オペレーターがプロパティを表示および設定することによってデバイスを管理できるようにします。 オペレーターが編集できるのは、クラウド プロパティと書き込み可能なデバイス プロパティのみです。 1 つのデバイス テンプレートに対して複数のフォームを持つことができます。

デバイス テンプレートにフォームを追加するには、次の手順を実行します。

1. デバイス テンプレートにアクセスし、 **[Views]\(ビュー\)** を選択します。
1. **[Editing Device and Cloud data]\(デバイスとクラウドのデータの編集\)** を選択します。
1. **[Form Name]\(フォーム名\)** にフォームの名前を入力します。
1. フォームのレイアウトに使用する列の数を選択します。
1. フォームの既存のセクションにプロパティを追加するか、プロパティを選択して、 **[Add Section]\(セクションの追加\)** を選択します。 セクションを使用して、フォーム上でプロパティをグループ化します。 セクションにタイトルを追加できます。
1. フォームの各プロパティを構成して、動作をカスタマイズします。
1. フォームでプロパティを調整します。
1. 変更を保存します。

## <a name="publish-a-device-template"></a>デバイス テンプレートを発行する

デバイス モデルを実装するデバイスを接続する前に、デバイス テンプレートを発行する必要があります。

デバイス テンプレートを発行した後は、デバイス モデルに対して限られた変更のみを行うことができます。 コンポーネントを変更するには、[新しいバージョンを作成して発行する](./howto-version-device-template.md)必要があります。

デバイス テンプレートを発行するには、デバイス テンプレートにアクセスし、 **[Publish]\(発行\)** を選択します。

デバイス テンプレートを発行すると、オペレーターは **[Devices]\(デバイス\)** ページに移動して、デバイス テンプレートを使用する実際のデバイスまたはシミュレートされたデバイスを追加できます。 変更を行っている間は、引き続きデバイス テンプレートを変更して保存できます。 これらの変更をオペレーターにプッシュして、 **[Devices]\(デバイス\)** ページで表示する場合は、毎回、 **[Publish]\(発行\)** を選択する必要があります。

## <a name="next-steps"></a>次のステップ

デバイス開発者にお勧めする次の手順は、[デバイス テンプレートのバージョン管理](./howto-version-device-template.md)に関する記事を読むことです。
