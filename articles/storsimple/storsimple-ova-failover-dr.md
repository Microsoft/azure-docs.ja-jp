---
title: "StorSimple Virtual Array の障害復旧とデバイス フェールオーバー | Microsoft Docs"
description: "StorSimple Virtual Array をフェールオーバーする方法の詳細を確認します。"
services: storsimple
documentationcenter: NA
author: alkohli
manager: carmonm
editor: 
ms.assetid: 94a8c3db-8e47-4e9a-917a-29b14a9263aa
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/07/2016
ms.author: alkohli
translationtype: Human Translation
ms.sourcegitcommit: 78daa5a75b3414e2761333ea6ad91945596553c8
ms.openlocfilehash: 2017fcdc7a5c36c7c00d8bcef5be973ed60e3f82


---
# <a name="disaster-recovery-and-device-failover-for-your-storsimple-virtual-array"></a>StorSimple Virtual Array の障害復旧とデバイスのフェールオーバー
## <a name="overview"></a>概要
この記事では、Microsoft Azure StorSimple Virtual Array (StorSimple オンプレミス仮想デバイスとも呼ばれます) の障害復旧について説明します。また、障害が発生した場合に別の仮想デバイスにフェールオーバーするための詳細な手順も紹介します。 フェールオーバーにより、データをデータセンターの*ソース* デバイスから、同じ場所または別の場所にある*ターゲット* デバイスに移行できます。 デバイスのフェールオーバーは、デバイス全体に対して行われます。 フェールオーバーの間、ソース デバイスのクラウド データの所有権はターゲット デバイスに移ります。

デバイスのフェールオーバーは障害復旧 (DR) 機能によって調整され、 **[デバイス]** ページから開始されます。 このページには、StorSimple Manager サービスに接続されているすべての StorSimple デバイスの一覧が表示されます。 デバイスごとに、表示名、状態、プロビジョニング容量と最大容量、種類、およびモデルが表示されます。

![](./media/storsimple-ova-failover-dr/image15.png)

この記事は、StorSimple Virtual Array にのみ適用されます。 8000 シリーズのデバイスのフェールオーバーについては、「 [StorSimple デバイスのフェールオーバーと障害復旧](storsimple-device-failover-disaster-recovery.md)」を参照してください。

## <a name="what-is-disaster-recovery"></a>障害復旧とは
障害復旧 (DR) シナリオでは、プライマリ デバイスの機能が停止します。 この場合、プライマリ デバイスを*ソース*として使用し、別のデバイスを*ターゲット*に指定することにより、障害が発生したデバイスに関連付けられているクラウドのデータを別のデバイスに移動できます。 このプロセスを *フェールオーバー*といいます。 フェールオーバー時には、ソース デバイスのすべてのボリュームまたは共有の所有権がターゲット デバイスに移ります。 データのフィルター処理はできません。

DR は、ヒート マップをベースとした階層化と追跡を使用して、デバイスの完全な復元としてモデル化されます。 ヒート マップは、読み取りと書き込みのパターンに基づいてデータにヒート値を割り当てることで定義されます。 ヒート マップによって、まずヒート値が最も低いデータ チャンクがクラウドに階層化され、ヒート値が高い (よく使用される) データ チャンクはローカル層に保持されます。 DR 時には、このヒート マップを使ってクラウドからデータを復元します。 デバイスが (内部で決められたとおりに) 最新のバックアップ内のボリューム/共有をすべてフェッチし、そのバックアップからの復元を実行します。 DR の全プロセスはデバイスによって調整されます。

## <a name="prerequisites-for-device-failover"></a>デバイスのフェールオーバーに関する前提条件
### <a name="prerequisites"></a>前提条件
デバイスのフェールオーバーでは、次の前提条件が満たされている必要があります。

* ソース デバイスが **"非アクティブ"** の状態にある必要があります。
* Azure クラシック ポータルでターゲット デバイスが "**アクティブ**" として表示されている必要があります。 ソース デバイスと同等以上の容量を持つターゲット仮想デバイスをプロビジョニングした後、 ローカル Web UI を使用してその仮想デバイスを構成し、正常に登録する必要があります。
  
  > [!IMPORTANT]
  > 登録した仮想デバイスをサービスによって ( **[デバイスのセットアップの完了]**をクリックして) 構成しないでください。 デバイスの構成はサービスによって行うべきではありません。
  > 
  > 
* ソース デバイスとターゲット デバイスの種類が同じである必要があります。 ファイル サーバーとして構成されている仮想デバイスは、別のファイル サーバーにしかフェールオーバーできません。 これは iSCSI サーバーの場合も同様です。
* ファイル サーバーの DR の場合は、共有のアクセス許可が自動的に解決されるよう、ソース デバイスと同じドメインにターゲット デバイスを参加させることをお勧めします。 このリリースでは、同じドメイン内のターゲット デバイスへのフェールオーバーのみがサポートされます。

### <a name="other-considerations"></a>その他の考慮事項
* ソース デバイスのすべてのボリューム/共有をオフラインにすることをお勧めします。
* 計画的なフェールオーバーの場合は、データの損失を最小限に抑えるため、デバイスのバックアップを作成してからフェールオーバーすることをお勧めします。 計画外のフェールオーバーの場合、デバイスの復元には最新のバックアップが使用されます。
* DR に使用できるターゲット デバイスは、ソース デバイスと同等以上の容量があるデバイスです。 サービスに接続されていても、十分な空き領域の条件を満たしていないデバイスは、ターゲット デバイスとして使用できません。

### <a name="dr-prechecks"></a>DR 事前チェック
DR が始まる前に、デバイスの事前チェックが実行されます。 事前チェックによって、DR 開始後のエラーを防ぐことができます。 事前チェックの内容:

* ストレージ アカウントを検証する
* Azure へのクラウド接続を確認する
* ターゲット デバイスの空き領域を確認する
* iSCSI サーバーのソース デバイスでボリュームに有効な ACR 名、IQN (最大 220 文字)、および CHAP パスワード (12 ～ 16 文字) が関連付けられていることを確認する

上記の事前チェックのいずれかに問題があった場合、DR は続行できません。 問題を解決してから DR を再試行してください。

DR が正常に完了すると、ソース デバイスのクラウド データの所有権がターゲット デバイスに移ります。 また、ソース デバイスはポータルで使用できなくなります。 ソース デバイスのすべてのボリューム/共有へのアクセスがブロックされ、ターゲット デバイスがアクティブになります。

> [!IMPORTANT]
> デバイスは使用できなくなりますが、ホスト システムにプロビジョニングした仮想マシンは引き続きリソースを消費します。 DR が正常に完了したら、ホスト システムからこの仮想マシンを削除できます。
> 
> 

## <a name="fail-over-to-a-virtual-array"></a>仮想アレイへのフェールオーバー
この手順を実行する前に、ローカル Web UI を使用して他の StorSimple 仮想アレイをプロビジョニングして構成し、StorSimple Manager サービスに登録しておくことをお勧めします。

> [!IMPORTANT]
> * StorSimple 8000 シリーズのデバイスから 1200 仮想デバイスにフェールオーバーすることはできません。
> * Government ポータルでデプロイした連邦情報処理標準 (FIPS) が有効な仮想デバイスから、Azure クラシック ポータルの仮想デバイスにフェールオーバーすることはできます。 その逆のフェールオーバーも可能です。
> 
> 

ターゲットの StorSimple 仮想デバイスにデバイスを復元するには、次の手順を実行します。

1. ホスト上のボリューム/共有をオフラインにします。 ホスト上のボリューム/共有をオフラインにする方法については、オペレーティング システムに固有の手順を参照してください。 まだオフラインにしていない場合は、**[デバイス] > [共有]** (または **[デバイス] > [ボリューム]**) に移動して、デバイスのすべてのボリューム/共有をオフラインにする必要があります。 ページの下部で共有またはボリュームを選択し、 **[オフラインにする]** をクリックします。 確認を求められたら、 **[はい]**をクリックします。 デバイスのすべての共有/ボリュームでこの手順を繰り返します。
2. **[デバイス]** ページでフェールオーバーするソース デバイスを選択し、**[非アクティブ化]** をクリックします。 
    ![](./media/storsimple-ova-failover-dr/image16.png)
3. 確認を求められます。 デバイスの非アクティブ化は永続的な操作であるため、元に戻すことはできません。 ホスト上の共有/ボリュームもオフラインにするよう通知されます。
   
    ![](./media/storsimple-ova-failover-dr/image18.png)
4. 確認が完了したら、非アクティブ化が開始されます。 非アクティブ化が正常に完了すると、通知が表示されます。
   
    ![](./media/storsimple-ova-failover-dr/image19.png)
5. **[デバイス]** ページで、デバイスの状態が "**非アクティブ**" に変わります。
   
    ![](./media/storsimple-ova-failover-dr/image20.png)
6. 非アクティブ化されたデバイスを選択し、ページの下部で **[フェールオーバー]**をクリックします。
7. [フェールオーバーの確認] が表示されたら、次の操作を行います。
   
   1. 使用可能なデバイスの一覧で、**ターゲット デバイス**を選択します。 十分な容量があるデバイスのみが一覧に表示されます。
   2. デバイス名、合計容量、フェールオーバーされる共有の名前など、ソース デバイスに関連付けられている詳細を確認します。
      
       ![](./media/storsimple-ova-failover-dr/image21.png)
8. **[フェールオーバーが恒久的な操作であり、フェールオーバーが正常に完了するとソース デバイスが削除されることに同意します]**チェック ボックスをオンにします。
9. チェック マーク アイコン ![](./media/storsimple-ova-failover-dr/image1.png)をクリックします。
10. フェールオーバー ジョブが開始され、通知が表示されます。 **[ジョブの表示]** をクリックすると、フェールオーバーを監視できます。
    
     ![](./media/storsimple-ova-failover-dr/image22.png)
11. **[ジョブ]** ページに、ソース デバイス用に作成されたフェールオーバー ジョブが表示されます。 このジョブによって DR 事前チェックが実行されます。
    
    ![](./media/storsimple-ova-failover-dr/image23.png)
    
     DR 事前チェックが正常に完了したら、フェールオーバー ジョブによって、ソース デバイス上に存在する各共有またはボリュームの復元ジョブが生成されます。
    
    ![](./media/storsimple-ova-failover-dr/image24.png)
12. フェールオーバーが完了したら、 **[デバイス]** ページに移動します。
    
    a. フェールオーバー プロセスのターゲット デバイスとして使用された StorSimple 仮想デバイスを選択します。
    
    b. **[共有]** (iSCSI サーバーの場合は **[ボリューム]**) ページに移動します。 古いデバイス上のすべての共有 (ボリューム) が表示されます。
    
    ![](./media/storsimple-ova-failover-dr/image25.png)

![](./media/storsimple-ova-failover-dr/video_icon.png) **ビデオ**

このビデオでは、StorSimple オンプレミス仮想デバイスを別の仮想デバイスにフェールオーバーする方法について説明しています。

> [!VIDEO https://channel9.msdn.com/Blogs/Azure/StorSimple-Virtual-Array-Disaster-Recovery/player]
> 
> 

## <a name="business-continuity-disaster-recovery-bcdr"></a>ビジネス継続性障害復旧 (BCDR)
ビジネス継続性障害復旧 (BCDR) シナリオは、Azure データセンター全体が機能を停止したときに発生します。 このような状況が発生すると、StorSimple Manager サービスと関連する StorSimple デバイスに影響が及ぶ可能性があります。

障害が発生する直前に登録された StorSimple デバイスがある場合は、これらの StorSimple デバイスの削除が必要になることがあります。 障害復旧後、これらのデバイスを再作成して構成できます。

## <a name="errors-during-dr"></a>DR 時のエラー
**DR 時にクラウドの接続が切断される**

DR が開始された後、デバイスの復元が完了する前にクラウドの接続が切断されると、DR が失敗して通知が表示されます。 DR に使用されたターゲット デバイスは "*使用不可*" としてマークされます。 同じターゲット デバイスを今後の DR に使用することはできません。

**互換性のあるターゲット デバイスがない**

使用可能なターゲット デバイスに十分な空き領域がない場合は、互換性のあるターゲット デバイスがないというエラーが表示されます。

**事前チェックの失敗**

事前チェックのいずれかに問題があると、エラーが表示されます。

## <a name="next-steps"></a>次のステップ
[ローカル Web UI を使用して StorSimple Virtual Array を管理する](storsimple-ova-web-ui-admin.md)方法の詳細を確認します。




<!--HONumber=Jan17_HO5-->


