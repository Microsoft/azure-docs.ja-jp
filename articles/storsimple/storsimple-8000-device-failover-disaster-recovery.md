---
title: StorSimple 8000 シリーズ デバイスのフェールオーバーとディザスター リカバリー
description: StorSimple デバイスを、そのデバイス自体、別の物理デバイス、またはクラウド アプライアンスにフェールオーバーする方法について説明します。
services: storsimple
documentationcenter: ''
author: alkohli
manager: timlt
editor: ''
ms.assetid: ''
ms.service: storsimple
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/03/2017
ms.author: alkohli
ms.openlocfilehash: c1acc084d5abe3385fe311873dfd64c9009e83f2
ms.sourcegitcommit: 64def2a06d4004343ec3396e7c600af6af5b12bb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/19/2020
ms.locfileid: "77468594"
---
# <a name="failover-and-disaster-recovery-for-your-storsimple-8000-series-device"></a>StorSimple 8000 シリーズ デバイスのフェールオーバーとディザスター リカバリー

## <a name="overview"></a>概要

この記事では、StorSimple 8000 シリーズ デバイスのデバイス フェールオーバー機能について説明し、障害が発生した場合に、どのようにこの機能を使用すれば StorSimple デバイスを復旧できるかを説明します。 StorSimple は、デバイス フェールオーバーを使用して、データセンター内のソース デバイスから別のターゲット デバイスにデータを移行します。 この記事のガイダンスは、StorSimple 8000 シリーズ物理デバイスやソフトウェア バージョン Update 3 以降を実行しているクラウド アプライアンスに適用されます。

障害が発生した場合、StorSimple は**デバイス** ブレードを使用してデバイス フェールオーバー機能を開始します。 このブレードには、StorSimple デバイス マネージャー サービスに接続されているすべての StorSimple デバイスの一覧が表示されます。

![[デバイス] ブレード](./media/storsimple-8000-device-failover-disaster-recovery/failover-phy-dev1.png)


## <a name="disaster-recovery-dr-and-device-failover"></a>ディザスター リカバリー (DR) とデバイスのフェールオーバー

ディザスター リカバリー (DR) シナリオでは、プライマリ デバイスの機能が停止します。 StorSimple はプライマリ デバイスを _ソース_ として使用し、関連付けられているクラウド データを別の _ターゲット_ デバイスに移動します。 このプロセスを *フェールオーバー*といいます。 次の図は、フェールオーバーのプロセスを示しています。

![デバイスのフェールオーバーでは何が起きるか](./media/storsimple-8000-device-failover-disaster-recovery/failover-dr-flow.png)

フェールオーバーのターゲット デバイスは、物理デバイスにすることも、クラウド アプライアンスにすることもできます。 ターゲット デバイスは、ソース デバイスと地理的に同じ場所または別の場所に配置できます。

フェールオーバー時には、移行用のボリューム コンテナーを選択できます。 StorSimple は次に、これらのボリューム コンテナーの所有権を、ソース デバイスからターゲット デバイスに変更します。 所有権が変更されたボリューム コンテナーは、StorSimple によってソース デバイスから削除されます。 削除が完了すると、ターゲット デバイスをフェールバックできます。 _フェールバック_ によって、所有権が元のソース デバイスに転送されます。

### <a name="cloud-snapshot-used-during-device-failover"></a>デバイスのフェールオーバー時に使用されるクラウド スナップショット

DR に引き続き、最新のクラウド バックアップを使用してターゲット デバイスにデータが復元されます。 クラウド スナップショットの詳細については、StorSimple デバイス マネージャー サービスを使用した「[手動バックアップの取得](storsimple-8000-manage-backup-policies-u2.md#take-a-manual-backup)」を参照してください。

StorSimple 8000 シリーズでは、バックアップ ポリシーはバックアップに関連付けられます。 同じボリュームに複数のバックアップ ポリシーがある場合、ボリュームの数が最も多いバックアップ ポリシーが選択されます。 StorSimple は次に、選択したバックアップ ポリシーの最新のバックアップを使用して、ターゲット デバイス上にデータを復元します。

*defaultPol* と *customPol* という 2 つのバックアップ ポリシーがあるとします。

* *defaultPol*: 1 つのボリューム (*vol1*) が午後 10:30 から毎日実行されます。
* *customPol*: 4 つのボリューム (*vol1*、*vol2*、*vol3*、*vol4*) が午後 10:00 から毎日実行されます。

この場合 StorSimple は、クラッシュ整合性のために優先度を付けて、ボリューム数が多い *customPol* を使用します。 このポリシーの最新のバックアップを使用してデータが復元されます。 バックアップ ポリシーを作成して管理する方法の詳細については、「[Azure ポータルで StorSimple デバイス マネージャー サービスを使用してバックアップ ポリシーを管理する](storsimple-8000-manage-backup-policies-u2.md)」を参照してください。

## <a name="common-considerations-for-device-failover"></a>デバイスのフェールオーバーに関する一般的考慮事項

デバイスをフェールオーバーする前に、次の情報を確認します。

* デバイスのフェールオーバーが始まる前に、ボリューム コンテナー内のすべてのボリュームがオフラインになっている必要があります。 計画されていないフェールオーバーでは、StotSimple ボリュームは自動的にオフラインになります。 しかし、計画したフェールオーバーを実行する (DR をテストする) 場合は、すべてのボリュームをオフラインにする必要があります。
* DR の場合は、関連付けられたクラウド スナップショットがあるボリューム コンテナーのみが表示されます。 データを復旧するには、関連付けられたクラウド スナップショットがあるボリューム コンテナーが少なくとも 1 つ存在する必要があります。
* 複数のボリューム コンテナーにまたがるクラウド スナップショットが存在する場合、StorSimple はこれらのボリューム コンテナーをセットとしてフェールオーバーします。 複数のボリューム コンテナーにわたって存在するのがローカル スナップショットだけで、関連付けられているクラウド スナップショットはそうでないというまれな場合には、StorSimple はローカル スナップショットをフェールオーバーし、ローカル データは DR 後に失われます。
* DR に使用できるターゲット デバイスは、選択したボリューム コンテナーに対応できるだけの十分な領域があるデバイスです。 十分な領域がないデバイスは、ターゲット デバイスとして一覧に表示されません。
* DR の後 (の一定期間中)、データ アクセス パフォーマンスが重大な影響を受ける可能性があります。デバイスがクラウドのデータにアクセスしてローカルに保存する必要があるためです。

#### <a name="device-failover-across-software-versions"></a>ソフトウェアのバージョン間でのデバイスのフェールオーバー

デプロイ中の StorSimple デバイス マネージャー サービスに物理デバイスとクラウド デバイスの両方があり、それぞれが実行しているソフトウェアのバージョンが異なっている場合があります。

次の表を使用して、異なるバージョンのソフトウェアを実行中のデバイスに対するフェールオーバーまたはフェールバックの可否と、DR 中に各種のボリュームがどのように動作するかを確認してください。

#### <a name="failover-and-failback-across-software-versions"></a>異なるソフトウェア バージョン間でのフェールオーバーおよびフェールバック

| フェールオーバー/フェールバックの方向 | 物理デバイス | クラウド アプライアンス |
| --- | --- | --- |
| Update 3 から Update 4 へ |階層化ボリュームは階層化された状態でフェールオーバーします。 <br></br>ローカル固定ボリュームは、ローカルに固定された状態でフェールオーバーします。 <br></br> Update 4 デバイスでスナップショットを取得するときにはフェールオーバーに続いて、[ヒートマップ ベースの追跡](storsimple-update4-release-notes.md#whats-new-in-update-4)が開始されます。 |ローカル固定ボリュームは階層化された状態でフェールオーバーします。 |
| Update 4 から Update 3 へ |階層化ボリュームは階層化された状態でフェールオーバーします。 <br></br>ローカル固定ボリュームは、ローカルに固定された状態でフェールオーバーします。 <br></br> 復元に使用されるバックアップのヒートマップ メタデータは保持されます。 <br></br>フェールバック後の Update 3 ではヒートマップ ベースの追跡を使用できません。 |ローカル固定ボリュームは階層化された状態でフェールオーバーします。 |


## <a name="device-failover-scenarios"></a>デバイスのフェールオーバーのシナリオ

障害が発生した場合、StorSimple デバイスを次のデバイスに対してフェールオーバーできます。

* [物理デバイス](storsimple-8000-device-failover-physical-device.md)。
* [StorSimple デバイス自体](storsimple-8000-device-failover-same-device.md)。
* [クラウド アプライアンス](storsimple-8000-device-failover-cloud-appliance.md)。

上記の記事では、前述したフェールオーバーのそれぞれの場合について、詳細な手順を説明しています。


## <a name="failback"></a>フェールバック

Update 3 以降のバージョンの場合、StorSimple ではフェールバックもサポートされます。 フェールバックは、単純にフェールオーバーの逆の動作で、ターゲットがソースになります。フェールオーバー時の元のソース デバイスが、今回はターゲット デバイスになります。 

フェールバック時に StorSimple は、プライマリの場所にデータを再同期し、I/O とアプリケーションのアクティビティを停止して、元の場所に遷移して戻ります。

フェールオーバーが完了すると、StorSimple は次のアクションを実行します。

* フェールオーバーされたボリューム コンテナーを、ソース デバイスから削除します。
* ソース デバイスで (フェールオーバーされた) ボリューム コンテナーごとのバックグラウンド ジョブを開始します。 ジョブの実行中にフェールバックしようとすると、その影響に関する通知が表示されます。 ジョブが完了するまで待機し、フェールバックを開始してください。
* ボリューム コンテナーの削除が完了するまでにかかる時間は、データ量、データの経過時間、バックアップの数、および操作に使用可能なネットワーク帯域幅などのさまざまな要因によって異なります。

フェールオーバーやテスト フェールバックを計画している場合は、データの少ない (GB) ボリューム コンテナーをテストすることをお勧めします。 通常は、フェールオーバーが完了した 24 時間後に、フェールバックを開始できます。

## <a name="frequently-asked-questions"></a>よく寄せられる質問

Q. **DR が失敗したり、部分的に成功した場合はどうなりますか?**

A. DR が失敗した場合、もう一度試してみることをお勧めします。 2 回目のデバイス フェールオーバー ジョブでは、最初のジョブの進行状況が認識されており、その時点から先へジョブが進められます。

Q. **デバイスのフェールオーバーが進行中にデバイスを削除することはできますか?**

A. DR の進行中にデバイスを削除することはできません。 DR の完了後にのみデバイスを削除できます。 デバイス フェールオーバー ジョブの進行状況は、 **[ジョブ]** ブレードで監視できます。

Q. **ソース デバイス上のローカル データを削除するために、ソース デバイスでガベージ コレクションが開始されるのはいつですか?**

A. デバイスが完全に削除された後でのみ、ソース デバイスでガベージ コレクションが有効になります。 クリーンアップには、ソース デバイスからフェールオーバーされたオブジェクト (ボリューム、バックアップ オブジェクト (データではない)、ボリューム コンテナー、ポリシーなど) のクリーンアップも含まれます。

Q. **ソース デバイスのボリューム コンテナーに関連付けられた削除ジョブが失敗するとどうなりますか?**

A.  削除ジョブが失敗した場合は、ボリューム コンテナーを手動で削除できます。 **[デバイス]** ブレードで、目的のソース デバイスを選択し、 **[ボリューム コンテナー]** をクリックします。 フェールオーバーしたボリューム コンテナーを選択し、ブレード下部の **[削除]** をクリックします。 ソース デバイスで、フェールオーバーしたすべてのボリューム コンテナーを削除したら、フェールバックを開始できます。 詳細については、「[ボリューム コンテナーを削除する](storsimple-8000-manage-volume-containers.md#delete-a-volume-container)」を参照してください。

## <a name="business-continuity-disaster-recovery-bcdr"></a>ビジネス継続性ディザスター リカバリー (BCDR)

ビジネス継続性ディザスター リカバリー (BCDR) シナリオは、Azure データセンター全体が機能を停止したときに発生します。 このシナリオは、StorSimple デバイス マネージャー サービスと、関連する StorSimple デバイスに影響を及ぼす可能性があります。

障害が発生する直前に StorSimple デバイスが登録された場合は、このデバイスを工場出荷時の設定に戻す必要が生じることがあります。 障害発生後、こうした StorSimple デバイスは Azure Portal でオフラインとして表示されます。 このデバイスはポータルから削除する必要があります。 デバイスを工場出荷時の設定にリセットし、もう一度サービスに登録します。

## <a name="next-steps"></a>次のステップ

デバイスのフェールオーバーを実行する準備ができたら、次のシナリオのいずれかを選択し、詳細な手順を参照してください。

- [別の物理デバイスにフェールオーバーする](storsimple-8000-device-failover-physical-device.md)
- [同じデバイスにフェールオーバーする](storsimple-8000-device-failover-same-device.md)
- [StorSimple Cloud Appliance にフェールオーバーする](storsimple-8000-device-failover-cloud-appliance.md)

デバイスをフェールオーバーした場合は、次のいずれかのオプションを選択します。

* [StorSimple デバイスの非アクティブ化または削除を行う](storsimple-8000-deactivate-and-delete-device.md)。
* [StorSimple デバイス マネージャー サービスを使用して StorSimple デバイスを管理する](storsimple-8000-manager-service-administration.md)。

