---
title: StorSimple 8000 シリーズ デバイスのコントローラーを交換する | Microsoft Docs
description: StorSimple 8000 シリーズ デバイスの一方または両方のコントローラー モジュールを取り外して交換する方法について説明します。
services: storsimple
documentationcenter: ''
author: alkohli
manager: timlt
editor: ''
ms.assetid: ''
ms.service: storsimple
ms.devlang: NA
ms.topic: troubleshooting
ms.tgt_pltfrm: NA
ms.workload: TBD
ms.date: 06/05/2017
ms.author: alkohli
ms.openlocfilehash: 9d8b75c48da2bb13d843258ead378d3e849da951
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/02/2020
ms.locfileid: "85514080"
---
# <a name="replace-a-controller-module-on-your-storsimple-device"></a>StorSimple デバイスのコントローラー モジュールを交換する
## <a name="overview"></a>概要
このチュートリアルでは、StorSimple デバイスの一方または両方のコントローラー モジュールを取り外して交換する方法について説明します。 また、シングルまたはデュアル コントローラーの交換シナリオの基になるロジックも説明します。

> [!NOTE]
> コントローラーの交換を実行する前に、コントローラーのファームウェアを最新バージョンに更新することを常にお勧めします。
> 
> StorSimple デバイスの損傷を防ぐため、LED が次のいずれかを示すまで、コントローラーを取り出さないでください。
> 
> * すべてのライトが OFF。
> * LED 3、![緑のチェック マーク アイコン](./media/storsimple-controller-replacement/HCS_GreenCheckIcon.png)、および ![赤の十字アイコン](./media/storsimple-controller-replacement/HCS_RedCrossIcon.png) が点滅し、LED 0 および LED 7 が **ON**。


次の表では、サポートされているコントローラー交換シナリオを示します。

| ケース | 交換シナリオ | 適用される手順 |
|:--- |:--- |:--- |
| 1 |1 つのコントローラーは障害状態で、他のコントローラーは正常でアクティブです。 |[シングル コントローラー交換](#replace-a-single-controller)。[シングル コントローラー交換の背景にあるロジック](#single-controller-replacement-logic)と、[交換手順](#single-controller-replacement-steps)について説明します。 |
| 2 |両方のコントローラーが障害状態で交換が必要です。 シャーシ、ディスク、ディスク エンクロージャは正常です。 |[デュアル コントローラー交換](#replace-both-controllers)。[デュアル コントローラー交換の背景にあるロジック](#dual-controller-replacement-logic)と、[交換手順](#dual-controller-replacement-steps)について説明します。 |
| 3 |同じデバイスまたは異なるデバイスのコントローラーをスワップします。 シャーシ、ディスク、ディスク エンクロージャは正常です。 |スロット不一致の警告メッセージが表示されます。 |
| 4 |1 つのコントローラーはなく、他のコントローラーは障害状態です。 |[デュアル コントローラー交換](#replace-both-controllers)。[デュアル コントローラー交換の背景にあるロジック](#dual-controller-replacement-logic)と、[交換手順](#dual-controller-replacement-steps)について説明します。 |
| 5 |1 つまたは両方のコントローラーが障害状態です。 シリアル コンソールまたは Windows PowerShell リモート処理でデバイスにアクセスできません。 |[Microsoft サポートに問い合わせて](storsimple-8000-contact-microsoft-support.md) 手動コントローラー交換手順を確認します。 |
| 6 |以下が原因でコントローラーのビルド バージョンが異なります。<ul><li>コントローラーのソフトウェア バージョンが異なります。</li><li>コントローラーのファームウェア バージョンが異なります。</li></ul> |コントローラーのソフトウェア バージョンが異なる場合は、交換ロジックがそれを検出し、交換用コントローラーのソフトウェア バージョンを更新します。<br><br>コントローラーのファームウェア バージョンが異なり、前のファームウェア バージョンが自動アップグレード可能では**ない**場合は、Azure Portal に警告メッセージが表示されます。 更新プログラムをスキャンして、ファームウェアの更新プログラムをインストールする必要があります。</br></br>コントローラーのファームウェア バージョンが異なり、古いファームウェア バージョンが自動アップグレード可能である場合は、コントローラー交換ロジックがこれを検出して、コントローラー起動後にファームウェアを自動的に更新します。 |

障害がある場合はコントローラー モジュールを取り外す必要があります。 一方または両方のコントローラー モジュールが故障する可能性があり、シングル コントローラー交換またはデュアル コントローラー交換が発生する場合があります。 交換手順と背景のロジックについては、以下を参照してください。

* [1 台のコントローラーを交換する](#replace-a-single-controller)
* [両方のコントローラーを交換する](#replace-both-controllers)
* [コントローラーを取り外す](#remove-a-controller)
* [コントローラーを挿入する](#insert-a-controller)
* [デバイスのアクティブなコントローラーを識別する](#identify-the-active-controller-on-your-device)

> [!IMPORTANT]
> コントローラーを取り外して交換する前に、「 [StorSimple ハードウェア コンポーネントの交換](storsimple-8000-hardware-component-replacement.md)」の安全に関する情報を再確認してください。
> 
> 

## <a name="replace-a-single-controller"></a>1 台のコントローラーを交換する
Microsoft Azure StorSimple デバイスの 2 台のコントローラーの一方が故障した場合、異常動作する場合、または存在しない場合は、1 台のコントローラーを交換する必要があります。

### <a name="single-controller-replacement-logic"></a>シングル コントローラー交換ロジック
シングル コントローラー交換では、最初に故障したコントローラーを取り外す必要があります (デバイスの残りのコントローラーはアクティブなコントローラーです)。交換したコントローラーを挿入すると、次の操作が行われます。

1. 交換したコントローラーはすぐに StorSimple デバイスとの通信を開始します。
2. アクティブなコントローラーの仮想ハード ドライブ (VHD) のスナップショットが、交換したコントローラーにコピーされます。
3. スナップショットは、交換したコントローラーがこの VHD から起動されるときはスタンバイ コントローラーとして認識されるように変更されます。
4. 変更が完了すると、交換したコントローラーはスタンバイ コントローラーとして起動します。
5. 両方のコントローラーが稼動すると、クラスターがオンラインになります。

### <a name="single-controller-replacement-steps"></a>シングル コントローラー交換手順
Microsoft Azure StorSimple デバイスのコントローラーの一方が故障した場合は、次の手順を実行します (他のコントローラーはアクティブで実行している必要があります。 両方のコントローラーが故障または動作不良になった場合は、「[デュアル コントローラー交換手順](#dual-controller-replacement-steps)」をご覧ください)。

> [!NOTE]
> コントローラーが再起動して、シングル コントローラー交換手順から完全に復旧するまでに 30 ～ 45 分かかることがあります。 ケーブルの接続を含む手順全体の合計時間は、およそ 2 時間です。


#### <a name="to-remove-a-single-failed-controller-module"></a>故障した 1 台のコントローラー モジュールを取り外すには
1. Azure Portal で StorSimple デバイス マネージャー サービスに移動し、 **[デバイス]** をクリックして、監視対象デバイスの名前をクリックします。
2. **[モニター]、[ハードウェアの正常性]** の順に移動します。 コントローラー 0 またはコントローラー 1 のいずれかの状態が赤で故障を示している必要があります。
   
   > [!NOTE]
   > シングル コントローラー交換では故障したコントローラーは常にスタンバイ コントローラーです。
   
3. 図 1 と次の表を使用して、故障したコントローラー モジュールを特定します。
   
    ![デバイスの主エンクロージャ モジュールのバックプレーン](./media/storsimple-controller-replacement/IC740994.png)
   
    **図 1** StorSimple デバイスの背面
   
   | Label | 説明 |
   |:--- |:--- |
   | 1 |PCM 0 |
   | 2 |PCM 1 |
   | 3 |コントローラー 0 |
   | 4 |コントローラー 1 |
4. 故障したコントローラーで、接続されているすべてのネットワーク ケーブルをデータ ポートから外します。 8600 モデルを使用している場合は、コントローラーを EBOD コントローラーに接続している SAS ケーブルも外します。
5. 「 [コントローラーを取り外す](#remove-a-controller) 」の手順に従い、故障したコントローラーを取り外します。
6. 故障したコントローラーを取り外した同じスロットに、ファクトリ交換品を取り付けます。 これにより、シングル コントローラー交換ロジックが開始します。 詳細については、「 [シングル コントローラー交換ロジック](#single-controller-replacement-logic)」をご覧ください。
7. シングル コントローラー交換ロジックがバックグラウンドで進行している間に、ケーブルを再接続します。 交換前の接続とまったく同じようにすべてのケーブルを接続するように注意してください。
8. コントローラーが再起動した後、Azure Portal で **[コントローラーの状態]** と **[クラスターの状態]** を調べて、コントローラーが正常な状態に戻ってスタンバイ モードになっていることを確認します。

> [!NOTE]
> シリアル コンソールでデバイスを監視している場合は、交換手順からコントローラーが復旧している間に再起動が複数回表示される可能性があります。 シリアル コンソール メニューが表示されると、交換が完了したことがわかります。 コントローラーの交換を開始してから 2 時間以内にメニューが表示されない場合は、 [マイクロソフトのサポートに問い合わせて](storsimple-8000-contact-microsoft-support.md)ください。
>
> Update 4 以降は、デバイスの Windows PowerShell インターフェイスでコマンドレット `Get-HCSControllerReplacementStatus` を使用して、コントローラーの交換プロセスの状態を監視することもできます。
> 

## <a name="replace-both-controllers"></a>両方のコントローラーを交換する
Microsoft Azure StorSimple デバイスの両方のコントローラーが故障した場合、異常動作する場合、または存在しない場合は、両方のコントローラーを交換する必要があります。 

### <a name="dual-controller-replacement-logic"></a>デュアル コントローラー交換ロジック
デュアル コントローラー交換では、最初に故障した両方のコントローラーを取り外した後、交換用コントローラーを挿入します。 2 台の交換用コントローラーを挿入すると、次の操作が行われます。

1. スロット 0 の交換したコントローラーで、次の項目が確認されます。
   
   1. 最新バージョンのファームウェアおよびソフトウェアを使用しているか。
   2. クラスターの一部か。
   3. ピア コントローラーは稼動していて、クラスター化されているか。
      
      いずれの項目も当てはまらない場合、コントローラーは最新の日次バックアップを検索します (ドライブ S の **nonDOMstorage** にあります)。 コントローラーは、バックアップから VHD の最新のスナップショットをコピーします。
2. スロット 0 のコントローラーは、スナップショットを使用して自分のイメージを作成します。
3. 一方、スロット 1 のコントローラーは、コントローラー 0 がイメージの作成を完了して開始するのを待ちます。
4. コントローラー 0 が起動した後、コントローラー 1 はコントローラー 0 によって作成されたクラスターを検出し、シングル コントローラー交換ロジックをトリガーします。 詳細については、「 [シングル コントローラー交換ロジック](#single-controller-replacement-logic)」をご覧ください。
5. その後、両方のコントローラーが稼動して、クラスターがオンラインになります。

> [!IMPORTANT]
> デュアル コントローラー交換に続き、StorSimple デバイスを構成した後で、必ず手動でデバイスのバックアップを作成します。 24 時間経過するまで、デバイス構成の日次バックアップはトリガーされません。 [マイクロソフトのサポート](storsimple-8000-contact-microsoft-support.md) と協力して、手動でデバイスのバックアップを作成します。


### <a name="dual-controller-replacement-steps"></a>デュアル コントローラー交換手順
Microsoft Azure StorSimple デバイスの両方のコントローラーが故障した場合、このワークフローが必要です。 このようなことは、データセンターで冷却システムが停止し、その結果、短時間で両方のコントローラーが故障した場合に、発生する可能性があります。 StorSimple デバイスがオフかオンか、および 8600 モデルと 8100 モデルのどちらを使用しているかにより、異なる手順が必要です。

> [!IMPORTANT]
> コントローラーが再起動して、デュアル コントローラー交換手順から完全に復旧するまでに 45 分～ 1 時間かかることがあります。 ケーブルの接続を含む手順全体の合計時間は、およそ 2.5 時間です。

#### <a name="to-replace-both-controller-modules"></a>両方のコントローラー モジュールを交換するには
1. デバイスがオフの場合は、この手順をスキップして、次の手順に進みます。 デバイスがオンの場合はオフにします。
   
   1. 8600 モデルを使用している場合は、最初に主エンクロージャをオフにしてから、EBOD エンクロージャをオフにします。
   2. デバイスが完全にシャットダウンするまで待ちます。 デバイスの背面にあるすべての LED がオフになります。
2. データ ポートに接続されているすべてのネットワーク ケーブルを外します。 8600 モデルを使用している場合は、主エンクロージャを EBOD エンクロージャに接続している SAS ケーブルもすべて外します。
3. 両方のコントローラーを StorSimple デバイスから取り外します。 詳細については、「 [コントローラーを取り外す](#remove-a-controller)」をご覧ください。
4. 最初にコントローラー 0 のファクトリ交換品を挿入し、次にコントローラー 1 を挿入します。 詳細については、「 [コントローラーを挿入する](#insert-a-controller)」をご覧ください。 これにより、デュアル コントローラー交換ロジックが開始します。 詳細については、「 [デュアル コントローラー交換ロジック](#dual-controller-replacement-logic)」をご覧ください。
5. コントローラー交換ロジックがバックグラウンドで進行している間に、ケーブルを再接続します。 交換前の接続とまったく同じようにすべてのケーブルを接続するように注意してください。 モデルごとの詳しい手順については、[StorSimple 8100 デバイスの取り付け](storsimple-8100-hardware-installation.md)または [StorSimple 8600 デバイスの取り付け](storsimple-8600-hardware-installation.md)に関する記事のケーブルの接続に関するセクションをご覧ください。
6. StorSimple デバイスをオンにします。 8600 モデルを使用している場合:
   
   1. 最初に、EBOD エンクロージャがオンになっていることを確認します。
   2. EBOD エンクロージャが動作するまで待機します。
   3. 主エンクロージャをオンにします。
   4. 最初のコントローラーが再起動して正常な状態になった後、システムが実行されます。
      
      > [!NOTE]
      > シリアル コンソールでデバイスを監視している場合は、交換手順からコントローラーが復旧している間に再起動が複数回表示される可能性があります。 シリアル コンソール メニューが表示されると、交換が完了したことがわかります。 コントローラーの交換を開始してから 2.5 時間以内にメニューが表示されない場合は、 [マイクロソフトのサポートに問い合わせて](storsimple-8000-contact-microsoft-support.md)ください。
     
## <a name="remove-a-controller"></a>コントローラーを取り外す
故障したコントローラー モジュールを StorSimple デバイスから取り外すには、次の手順を使用します。

> [!NOTE]
> 次の図はコントローラー 0 の場合です。 コントローラー 1 の場合は逆になります。


#### <a name="to-remove-a-controller-module"></a>コントローラー モジュールを取り外すには
1. 親指と人差し指でモジュールのラッチをはさみます。
2. 親指と人差し指にゆっくり力を加えて、コントローラーのラッチを外します。
   
    ![コントローラーのラッチを解放する](./media/storsimple-controller-replacement/IC741047.png)
   
    **図 2** コントローラーのラッチを解放する
3. ラッチをハンドルとして使用し、コントローラーをシャーシの外までスライドさせます。
   
    ![コントローラーをシャーシの外にスライドさせる](./media/storsimple-controller-replacement/IC741048.png)
   
    **図 3** コントローラーをシャーシの外までスライドさせる

## <a name="insert-a-controller"></a>コントローラーを挿入する
故障したモジュールを StorSimple デバイスから取り外した後、次の手順を使用して、ファクトリ供給コントローラー モジュールを取り付けます。

#### <a name="to-install-a-controller-module"></a>コントローラー モジュールを取り付けるには
1. インターフェイス コネクタに損傷がないかどうかを確認します。 いずれかのコネクタ ピンが損傷したり曲がっている場合は、モジュールを取り付けないでください。
2. ラッチを完全に解放した状態で、コントローラー モジュールをシャーシの中にスライドします。
   
    ![コントローラーをシャーシの中にスライドさせる](./media/storsimple-controller-replacement/IC741053.png)
   
    **図 4** シャーシ内にコントローラーをスライドさせる
3. コントローラー モジュールを挿入したら、コントローラー モジュールをシャーシに押しつけながら、ラッチを閉じる操作を開始します。 ラッチがはまって所定の位置にコントローラーをガイドします。
   
    ![コントローラーのラッチを閉じる](./media/storsimple-controller-replacement/IC741054.png)
   
    **図 5** コントローラーのラッチを閉じる
4. ラッチが所定の位置にはまれば終了です。 **OK** LED が点灯するはずです。
   
   > [!NOTE]
   > コントローラーと LED がアクティブになるまでに最大で 5 分かかります。
  
5. 交換が正常に完了したことを確認するには、Azure Portal で、デバイスに移動してから **[モニター]**  >  **[ハードウェアの正常性]** に移動し、コントローラー 0 とコントローラー 1 の両方が正常であることを確認します (状態が緑)。

## <a name="identify-the-active-controller-on-your-device"></a>デバイスのアクティブなコントローラーを識別する
初めてのデバイス登録時やコントローラーの交換時など、StorSimple デバイスでアクティブなコントローラーを確認することが必要になる場合が多くあります。 アクティブなコントローラーは、すべてのディスク ファームウェアとネットワーク操作を処理します。 次のいずれかの方法を使用して、アクティブなコントローラーを識別できます。

* [Azure Portal を使用してアクティブなコントローラーを識別する](#use-the-azure-portal-to-identify-the-active-controller)
* [StorSimple 用の Windows PowerShell を使用してアクティブなコントローラーを識別する](#use-windows-powershell-for-storsimple-to-identify-the-active-controller)
* [物理デバイスを調べてアクティブなコントローラーを識別する](#check-the-physical-device-to-identify-the-active-controller)

次に、これらの手順について説明します。

### <a name="use-the-azure-portal-to-identify-the-active-controller"></a>Azure Portal を使用してアクティブなコントローラーを識別する
Azure Portal で、デバイスに移動してから **[モニター]**  >  **[ハードウェアの正常性]** に移動し、 **[コントローラー]** セクションにスクロールします。 ここで、どのコントローラーがアクティブかを確認できます。

![Azure Portal でアクティブなコントローラーを識別する](./media/storsimple-controller-replacement/IC752072.png)

**図 6** アクティブなコントローラーを示す Azure Portal

### <a name="use-windows-powershell-for-storsimple-to-identify-the-active-controller"></a>StorSimple 用の Windows PowerShell を使用してアクティブなコントローラーを識別する
シリアル コンソールでデバイスにアクセスしているときは、バナー メッセージが表示されます。 バナー メッセージには、モデル、名前、インストールされているソフトウェアのバージョン、アクセス中のコントローラーの状態などのデバイスの基本情報が含まれます。 次の図に、バナー メッセージの例を示します。

![シリアル バナー メッセージ](./media/storsimple-controller-replacement/IC741098.png)

**図 7** コントローラー 0 がアクティブと表示されているバナー メッセージ

バナー メッセージを使用して、接続中のコントローラーの状態 (アクティブまたはパッシブ) を特定できます。

### <a name="check-the-physical-device-to-identify-the-active-controller"></a>物理デバイスを調べてアクティブなコントローラーを識別する
デバイスでアクティブなコントローラーを識別するには、主エンクロージャの背面の DATA 5 ポートの上にある青い LED に注目します。

この LED が点滅している場合、そのコントローラーがアクティブであり、他のコントローラーはスタンバイ モードです。 次の図と表を参考にしてください。

![デバイスの主エンクロージャのバックプレーンとデータポート](./media/storsimple-controller-replacement/IC741055.png)

**図 8** 主エンクロージャ背面のデータ ポートと監視 LED

| Label | 説明 |
|:--- |:--- |
| 1 ～ 6 |DATA 0 ～ 5 のネットワーク ポート |
| 7 |青い LED |

## <a name="next-steps"></a>次のステップ
「 [StorSimple ハードウェア コンポーネントの交換](storsimple-8000-hardware-component-replacement.md)」の説明を参照してください。

