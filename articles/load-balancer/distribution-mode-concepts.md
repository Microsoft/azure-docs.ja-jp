---
title: Azure Load Balancer 分散モード
description: Azure Load Balancer のさまざまな分散モードについての学習を開始します。
author: asudbring
ms.author: allensu
ms.service: load-balancer
ms.topic: article
ms.date: 02/04/2021
ms.custom: template-concept
ms.openlocfilehash: fcea2e962722773f59e73df898e0188c3f6454b6
ms.sourcegitcommit: 5b926f173fe52f92fcd882d86707df8315b28667
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/04/2021
ms.locfileid: "99551116"
---
# <a name="azure-load-balancer-distribution-modes"></a>Azure Load Balancer 分散モード

Azure Load Balancer では、負荷分散されたアプリケーションへの接続をルーティングするために、2 つの分散モードがサポートされています。

* ハッシュベース
* 発信元 IP アフィニティ

## <a name="hash-based"></a>ハッシュベース

Azure Load Balancer の既定の分散モードは、5 タプル ハッシュです。 

タプルは、次のもので構成されます。
* **発信元 IP**
* **ソース ポート**
* **宛先 IP**
* **宛先ポート**
* **プロトコルの種類**

ハッシュは、使用可能なサーバーにトラフィックをマップするために使用されます。 アルゴリズムでは、トランスポート セッション内でのみ持続性が提供されます。 同じセッション内のパケットは、負荷分散されたエンドポイントの背後にある同じデータセンターの IP アドレスに送信されます。 クライアントが同じソース IP アドレスから新しいセッションを開始すると、接続元ポートが変更され、そのトラフィックは別のデータセンター エンドポイントに送信されます。

![5 タプルのハッシュベースの分散モード](./media/distribution-mode-concepts/load-balancer-distribution.png)

ハッシュベース モードには、次の 1 つの構成の種類があります。

* **[None (hash-based)]\(なし (ハッシュベース)\)** - 同じクライアントからの連続した要求が、任意の仮想マシンによって処理できることを指定します。

## <a name="source-ip-affinity"></a>発信元 IP アフィニティ

この分散モードは、セッション アフィニティまたはクライアント IP アフィニティとも呼ばれます。 このモードは 2 タプル (ソース IP と接続先 IP) または 3 タプル (ソース IP、接続先 IP、プロトコルの種類) のハッシュを使用して、使用可能なサーバーにトラフィックをマップします。 

ソース IP アフィニティを使用すると、同じクライアント コンピューターから開始された接続は、同じデータセンター エンドポイントに送られます。

次の図は 2 タプルの構成を示しています。 2 タプルの場合に、どのように接続がロード バランサーを通過して仮想マシン 1 (VM1) に向かうかに注目してください。 その後、VM1 は VM2 と VM3 でバックアップされます。

![2 タプルのセッション アフィニティ分散モード](./media/load-balancer-distribution-mode/load-balancer-session-affinity.png)

ソース IP アフィニティ モードには、次の 2 つの構成の種類があります。

* **[Client IP (source IP affinity 2-tuple)]\(クライアント IP (ソース IP アフィニティ 2 タプル)\)** - 同じクライアント IP アドレスからの連続する要求が、同じ仮想マシンによって処理されることを指定します。
* **[Client IP and protocol (source IP affinity 3-tuple)]\(クライアント IP とプロトコル (ソース IP アフィニティ 3 タプル)\)** - 同じクライアント IP アドレスとプロトコルの組み合わせからの連続する要求が、同じ仮想マシンによって処理されることを指定します。

## <a name="use-cases"></a>ユース ケース

クライアント IP とプロトコルによるソース IP アフィニティ (ソース IP アフィニティ 3 タプル) は、Azure Load Balancer とリモート デスクトップ ゲートウェイ (RD ゲートウェイ) 間の非互換性を解決します。 

もう 1 つの使用シナリオは、メディア アップロードです。 データのアップロードを UDP 経由で行い、コントロール プレーンは TCP 経由で実現します。

* クライアントで、負荷分散されたパブリック アドレスに対する TCP セッションが開始され、特定の DIP に送られます。 チャネルは、接続の正常性を監視するためにアクティブのままになります。
* 同じクライアント コンピューターからの新しい UDP セッションが、負荷分散された同じパブリック エンドポイントに対して開始されます。 接続先は前回の TCP 接続と同じ DIP エンドポイントになります。 コントロール チャネルは TCP 経由で維持しつつ、メディア アップロードを高スループットで実行できます。

> [!NOTE]
> 負荷分散されたセットが仮想マシンの削除や追加で変更されると、クライアント要求の分散が再計算されます。 最終的に同じサーバーに接続する既存のクライアントからの新しい接続に依存することはできません。 また、ソース IP アフィニティ分散モードを使用すると、トラフィックが均等に分散されない可能性があります。 プロキシの背後で実行しているクライアントは、1 つの固有のクライアント アプリケーションと見なすことができます。


## <a name="next-steps"></a>次のステップ

Azure Load Balancer の分散モードを構成する方法の詳細については、「[Azure Load Balancer の分散モードを構成する](load-balancer-distribution-mode.md)」を参照してください。

