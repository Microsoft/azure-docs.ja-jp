---
title: 送信専用のロード バランサーの構成
titleSuffix: Azure Load Balancer
description: この記事では、アウトバウンド NAT を使用して内部ロード バランサーを作成する方法について説明します
services: load-balancer
documentationcenter: na
author: asudbring
ms.custom: seodec18
ms.service: load-balancer
ms.devlang: na
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/07/2020
ms.author: allensu
ms.openlocfilehash: b44f626546b313299701687157b37b7df021bd61
ms.sourcegitcommit: bfeae16fa5db56c1ec1fe75e0597d8194522b396
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/10/2020
ms.locfileid: "88038146"
---
# <a name="outbound-only-load-balancer-configuration"></a>送信専用のロード バランサーの構成

内部ロード バランサーの背後にある VM のアウトバウンド接続を作成するには、内部および外部の標準ロードバランサーを組み合わせて使用します。 

この構成は、内部ロード バランサー シナリオ用にアウトバウンド NAT を提供し、バックエンド プールの "エグレス専用" セットアップを生成します。


<p align="center">
  <img src="./media/egress-only/load-balancer-egress-only.png" alt="Figure depicts a egress only load balancer configuration." width="500" title="Virtual Network NAT">
</p>


<!-- 
:::image type="content" source="./media/egress-only/load-balancer-egress-only.png" alt-text="Figure depicts a egress only load balancer configuration" border="true":::
-->


*図:エグレス専用のロード バランサーの構成*

必要な手順は次のとおりです。

1. 要塞ホストで仮想ネットワークを作成します。
2. プライベート IP のみで仮想マシンを作成します。
3. 内部およびパブリックの両方の標準ロード バランサーを作成します。
4. バックエンド プールを両方のロード バランサーに追加し、VM を各プールに配置します。
5. 要塞ホスト経由で VM に接続し、さらに、
    1. アウトバウンド接続をテストします。 
    2. パブリック ロード バランサーのアウトバウンド規則を構成します。
    3. アウトバウンド接続を再テストします。

## <a name="create-virtual-network-and-virtual-machine"></a>仮想ネットワークと仮想マシンの作成

2 つのサブネットから成る仮想ネットワークを作成します。

* プライマリ サブネット
* 要塞サブネット

新しい仮想ネットワークに仮想マシンを作成します。

### <a name="create-the-virtual-network"></a>仮想ネットワークの作成

1. Azure portal に[サインイン](https://portal.azure.com)します。

2. 画面の左上で、 **[リソースの作成] > [ネットワーク] > [仮想ネットワーク]** の順に選択するか、検索ボックスで **Virtual network** を検索します。

2. **[仮想ネットワークの作成]** の **[基本]** タブで次の情報を入力または選択します。

    | **設定**          | **Value**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **プロジェクトの詳細**  |                                                                 |
    | サブスクリプション     | Azure サブスクリプションを選択します。                                  |
    | リソース グループ   | **[新規作成]** を選択します。 </br> 「**myResourceGroupLB**」と入力します。 </br> **[OK]** を選択します。 |
    | **インスタンスの詳細** |                                                                 |
    | 名前             | 「**myVNet**」と入力します                                    |
    | リージョン           | **[米国東部 2]** を選択します |

3. **[IP アドレス]** タブを選択するか、ページの下部にある **[Next: IP Addresses]\(次へ: IP アドレス\)** ボタンを選択します。

4. **[IP アドレス]** タブで、次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | IPv4 アドレス空間 | 「**10.1.0.0/16**」と入力します。 |

5. **[サブネット名]** で、 **[default]\(既定\)** という単語を選択します。

6. **[サブネットの編集]** に次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | サブネット名 | 「**myBackendSubnet**」と入力します |
    | サブネットのアドレス範囲 | 「**10.1.0.0/24**」と入力します。 |

7. **[保存]** を選択します。

8. **[セキュリティ]** タブをクリックします。

9. **[BastionHost]** で **[有効にする]** を選択します。 次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | 要塞名 | 「**myBastionHost**」と入力します |
    | AzureBastionSubnet のアドレス空間 | 「**10.1.1.0/24**」と入力します |
    | パブリック IP アドレス | **[新規作成]** を選択します。 </br> **[名前]** に「**myBastionIP**」と入力します。 </br> **[OK]** を選択します。 |


8. **[確認と作成]** タブを選択するか、 **[確認と作成]** ボタンを選択します。

9. **［作成］** を選択します

### <a name="create-a-virtual-machine"></a>仮想マシンの作成

1. ポータルの左上で、 **[リソースの作成]**  >  **[Compute]**  >  **[仮想マシン]** を選択します。 
   
2. **[仮想マシンの作成]** の **[Basic]** タブに、値を入力するか選択します。

    | 設定 | 値                                          |
    |-----------------------|----------------------------------|
    | **プロジェクトの詳細** |  |
    | サブスクリプション | Azure サブスクリプションを選択します。 |
    | リソース グループ | **[myResourceGroupLB]** を選択します |
    | **インスタンスの詳細** |  |
    | 仮想マシン名 | 「**myVM**」と入力します |
    | リージョン | **[米国東部 2]** を選択します |
    | 可用性オプション | **[インフラストラクチャ冗長は必要ありません]** を選択します |
    | Image | **[Windows Server 2019 Datacenter]** を選択します |
    | Azure Spot インスタンス | **[いいえ]**  を選択します |
    | サイズ | VM サイズを選択するか、既定の設定を使用します |
    | **管理者アカウント** |  |
    | ユーザー名 | ユーザー名を入力します |
    | Password | [パスワード] を入力します |
    | [パスワードの確認入力] | パスワードを再入力します |
    | **受信ポートの規則** |  |
    | パブリック受信ポート | **[選択したポートを許可する]** を選択します |
    | 受信ポートの選択 | **[RDP (3389)]** を選択します |

3. **[ネットワーク]** タブまたは **[次へ: ディスク]** を選択してから **[次へ: ネットワーク]** を選択します。
  
4. [ネットワーク] タブで、次を選択または入力します。

    | 設定 | 値 |
    |-----|------------|
    | **ネットワーク インターフェイス** |  |
    | 仮想ネットワーク | **myVNet** |
    | Subnet | **myBackendSubnet** |
    | パブリック IP | **[なし]** を選択します。 |
    | NIC ネットワーク セキュリティ グループ | **[なし]** を選択します|
    | この仮想マシンを既存の負荷分散ソリューションの後ろに配置しますか? | **[いいえ]**  を選択します |
   
5. **[管理]** タブまたは **[次へ]**  >  **[管理]** を選択します。

6. **[管理]** タブで、次を選択または入力します。
    
    | 設定 | 値 |
    |-|-|
    | **Monitoring** |  |
    | ブート診断 | **[オフ]** を選択します |
   
7. **[Review + create]\(レビュー + 作成\)** を選択します。 
  
8. 設定を確認し、 **[作成]** を選択します。

## <a name="create-load-balancers-and-test-connectivity"></a>ロード バランサーの作成と接続のテスト

Azure portal を使用して、次を作成します。

* 内部ロード バランサー
* パブリック ロード バランサー
 
作成した VM をそれぞれのバックエンド プールに追加します。  次に、VM からのアウトバウンド接続のみを許可するように構成を設定し、前後にテストします。

### <a name="create-internal-load-balancer"></a>内部ロード バランサーを作成する

1. 画面の左上で、 **[リソースの作成]**  >  **[ネットワーク]**  >  **[Load Balancer]** を選択します。

2. **[ロード バランサーの作成]** ページの **[基本]** タブで、次の情報を入力または選択します。 

    | 設定                 | 値                                              |
    | ---                     | ---                                                |
    | サブスクリプション               | サブスクリプションを選択します。    |    
    | Resource group         | 前のステップで作成した **myResourceGroupLB** を選択します。|
    | 名前                   | 「**myInternalLoadBalancer**」と入力します                                   |
    | リージョン         | **[米国東部 2]** を選択します。                                        |
    | Type          | **[内部]** を選択します。                                        |
    | SKU           | **[Standard]** を選択します。 |
    | 仮想ネットワーク | 前のステップで作成した **myVNet** を選択します。 |
    | Subnet  | 前のステップで作成した **myBackendSubnet** を選択します。 |
    | IP アドレスの割り当て | **[動的]** を選択します。 |

3. 残りの設定は既定値をそのまま使用し、 **[確認と作成]** を選択します。

4. **[確認および作成]** タブで、 **[作成]** を選択します。   

### <a name="create-public-load-balancer"></a>パブリック ロード バランサーの作成

1. 画面の左上で、 **[リソースの作成]**  >  **[ネットワーク]**  >  **[Load Balancer]** を選択します。

2. **[ロード バランサーの作成]** ページの **[基本]** タブで、次の情報を入力または選択します。 

    | 設定                 | 値                                              |
    | ---                     | ---                                                |
    | サブスクリプション               | サブスクリプションを選択します。    |    
    | Resource group         | **[新規作成]** を選択し、テキスト ボックスに「**myResourceGroupLB**」と入力します。|
    | 名前                   | 「**myPublicLoadBalancer**」と入力します                                   |
    | リージョン         | **[米国東部 2]** を選択します。                                        |
    | Type          | **[パブリック]** を選択します。                                        |
    | SKU           | **[Standard]** を選択します。 |
    | パブリック IP アドレス | **[新規作成]** を選択します。 |
    | パブリック IP アドレス名 | テキスト ボックスに「**myFrontendIP**」と入力します。|
    | 可用性ゾーン | **[ゾーン冗長]** を選択します |
    | パブリック IPv6 アドレスを追加する | このため、 **[いいえ]** を選択します。 |

3. 残りの設定は既定値をそのまま使用し、 **[確認と作成]** を選択します。

4. **[確認および作成]** タブで、 **[作成]** を選択します。   
   
### <a name="create-internal-backend-address-pool"></a>内部バックエンド アドレス プールの作成

バックエンド アドレス プール **myInternalBackendPool** を作成します。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myInternalLoadBalancer]** を選択します。

2. **[設定]** で、 **[バックエンド プール]** 、 **[追加]** の順に選択します。

3. **[バックエンド プールの追加]** ページで、名前に、バックエンド プールの名前として「**myInternalBackendPool**」と入力します。
 
4. **[仮想ネットワーク]** で **[myVNet]** を選択します。

5. **[仮想マシン]** で、 **[追加]** を選択し、 **[myVM]** を選択します。
 
6. **[追加]** を選択します。

### <a name="create-public-backend-address-pool"></a>パブリック バックエンド アドレス プールの作成

バックエンド アドレス プール **myPublicBackendPool** を作成します。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myPublicLoadBalancer]** を選択します。

2. **[設定]** で、 **[バックエンド プール]** 、 **[追加]** の順に選択します。

3. **[バックエンド プールの追加]** ページで、名前に、バックエンド プールの名前として「**myPublicBackendPool**」と入力します。

4. **[仮想ネットワーク]** で **[myVNet]** を選択します。
 
5. **[仮想マシン]** で、 **[追加]** を選択し、 **[myVM]** を選択します。
 
6. **[追加]** を選択します。

### <a name="test-connectivity-before-outbound-rule"></a>アウトバウンド規則の前の接続のテスト

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myResourceGroupLB]** リソース グループにある **[myVM]** を選択します。

2. **[概要]** ページで **[接続]** 、 **[要塞]** の順に選択します。

4. VM 作成時に入力したユーザー名とパスワードを入力します。

5. **[接続]** を選択します。

6. Internet Explorer を開きます。

7. アドレス バーに「 **https://whatsmyip.org** 」と入力します。

8. 接続は失敗するはずです。 既定で、標準のパブリック ロード バランサーでは[定義されたアウトバウンド規則を使用しないアウトバウンド トラフィックが許可されません](load-balancer-overview.md#securebydefault)。
 
### <a name="create-a-public-load-balancer-outbound-rule"></a>パブリック ロード バランサーのアウトバウンド規則の作成

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myPublicLoadBalancer]** を選択します。

2. **[設定]** で、 **[アウトバウンド規則]** 、 **[追加]** の順に選択します。

3. アウトバウンド規則の構成には、以下の値を使用します。

    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | 「**myOutboundRule**」と入力します。 |
    | フロントエンド IP アドレス | **[LoadBalancerFrontEnd]** を選択します。|
    | アイドル タイムアウト (分) | スライダーを **15 分**に移動します。|
    | TCP リセット | **[Enabled]** を選択します。|
    | バックエンド プール | **[myPublicBackendPool]** を選択します。| |
    | [ポートの割り当て] -> [ポートの割り当て] | **[送信ポートの既定の数を使用する]** を選択します |

4. **[追加]** を選択します。

### <a name="test-connectivity-after-outbound-rule"></a>アウトバウンド規則の後の接続のテスト

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myResourceGroupLB]** リソース グループにある **[myVM]** を選択します。

2. **[概要]** ページで **[接続]** 、 **[要塞]** の順に選択します。

4. VM 作成時に入力したユーザー名とパスワードを入力します。

5. **[接続]** を選択します。

6. Internet Explorer を開きます。

7. アドレス バーに「 **https://whatsmyip.org** 」と入力します。

8. 接続は成功するはずです。

9. 表示される IP アドレスは **myPublicLoadBalancer** のフロントエンド IP アドレスであるはずです。

## <a name="clean-up-resources"></a>リソースをクリーンアップする

リソース グループ、ロード バランサー、VM、および関連するすべてのリソースは、不要になったら削除します。 

それを行うには、リソース グループ **[myResourceGroupLB]** を選択してから **[削除]** を選択します。

## <a name="next-steps"></a>次の手順

このチュートリアルでは、パブリックと内部のロード バランサーの組み合わせで、"エグレス専用" の構成を作成しました。  

この構成により、受信する内部トラフィックをバックエンド プールに負荷分散すると同時に、引き続きパブリック インバウンド接続を防ぐことができます。

- [Azure Load Balancer](load-balancer-overview.md) について確認します。
- [Azure でのアウトバウンド接続](load-balancer-outbound-connections.md)について確認します。
- ロード バランサーの [FAQ](load-balancer-faqs.md)。
- [Azure Bastion](https://docs.microsoft.com/azure/bastion/bastion-overview) について確認します
