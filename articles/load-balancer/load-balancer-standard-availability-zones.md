---
title: Azure Standard Load Balancer と可用性ゾーン
titlesuffix: Azure Load Balancer
description: Standard Load Balancer と可用性ゾーン
services: load-balancer
documentationcenter: na
author: KumudD
ms.custom: seodec18
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/08/2018
ms.author: kumud
ms.openlocfilehash: 2c4503b6ff065e98c49fe3f4e06b63cbeb7d1770
ms.sourcegitcommit: e68df5b9c04b11c8f24d616f4e687fe4e773253c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/20/2018
ms.locfileid: "53652746"
---
# <a name="standard-load-balancer-and-availability-zones"></a>Standard Load Balancer と可用性ゾーン

Azure Load Balancer の Standard SKU は、[可用性ゾーン](../availability-zones/az-overview.md)のシナリオをサポートしています。 Standard Load Balancer では複数の新しい概念を利用でき、リソースをゾーンに一致させて、複数のゾーンに分散させることにより、エンド ツー エンドのシナリオで可用性を最適化させることができます。  可用性ゾーンとは何か、現在可用性ゾーンをサポートしているリージョン、その他の関連する概念と製品については、[可用性ゾーン](../availability-zones/az-overview.md)に関する記事をご覧ください。 可用性ゾーンと Standard Load Balancer の組み合わせは、さまざまなシナリオを作成できる拡張性と柔軟性の高い機能セットです。  このドキュメントを読んで、これらの[概念](#concepts)と基本的なシナリオの[設計ガイダンス](#design)を理解してください。

>[!NOTE]
>その他の関連トピックについては、[可用性ゾーン](https://aka.ms/availabilityzones)に関するページを参照してください。 

## <a name="concepts"></a> Load Balancer に適用される可用性ゾーンの概念

Load Balancer のリソースと実際のインフラストラクチャの間に直接的な関係はありません。Load Balancer を作成しても、インスタンスは作成されません。 Load Balancer のリソースはオブジェクトであり、その中では、ユーザーが作成したいシナリオを実現するために Azure がその構築済みマルチ テナント インフラストラクチャをプログラミングする方法を表すことができます。  これは、1 つの Load Balancer リソースで複数の可用性ゾーンのインフラストラクチャのプログラミングを制御でき、一方でゾーン冗長サービスは顧客の観点からは 1 つのリソースに見えるので、ゾーンの可用性のコンテキストでは重要なことです。

Load Balancer リソースの機能は、フロントエンド、ルール、正常性プローブ、およびバックエンド プール定義として表されます。

可用性ゾーンのコンテキストでは、Load Balancer リソースの動作とプロパティは、ゾーン冗長またはゾーン ベースとして記述されます。  ゾーン冗長とゾーン ベースは、プロパティのゾーン性を記述します。  Load Balancer のコンテキストでは、ゾーン冗長は常に "*すべてのゾーン*" を意味し、ゾーン ベースはサービスを "*単一のゾーン*" に対して保証することを意味します。

パブリックと内部のどちらの Load Balancer も、ゾーン冗長とゾーン ベースのシナリオをサポートし、必要に応じて、ゾーン間でトラフィックを受け渡しできます ("*ゾーン間負荷分散*")。

Load Balancer リソース自体はリージョン ベースであり、ゾーン ベースではありません。  また、VNet とサブネットも常にリージョン ベースであり、ゾーン ベースではありません。

### <a name="frontend"></a>フロントエンド

Load Balancer のフロントエンドは、仮想ネットワーク リソースのサブネット内のパブリック IP アドレス リソースまたはプライベート IP アドレスのいずれかを参照するフロントエンド IP 構成です。  サービスが公開される負荷分散されたエンドポイントを形成します。

Load Balancer リソースは、ゾーン ベースとゾーン冗長の両方のフロントエンドを同時に含むことができます。 

パブリック IP リソースがゾーンに対して保証されている場合、ゾーン性 (またはその欠如) は変更できません。  パブリック IP フロントエンドのゾーン性を変更または省略する必要がある場合は、適切なゾーンでパブリック IP を再作成する必要があります。  

フロントエンドを削除して作成し直し、ゾーン性を変更または省略することにより、内部 Load Balancer のフロントエンドのゾーン性を変更できます。

複数のフロントエンドを使う場合は、「[Azure Load Balancer の複数フロントエンド](load-balancer-multivip-overview.md)」で重要な考慮事項を確認してください。

#### <a name="zone-redundant-by-default"></a>既定で冗長なゾーン

可用性ゾーンのあるリージョンでは、Standard Load Balancer のフロントエンドは既定でゾーン冗長になります。  1 つのフロントエンド IP アドレスがゾーンの障害を切り抜けて、ゾーンに関係なくすべてのバックエンド プール メンバーへのアクセスに使用できます。 これはヒットレス データ パスを意味するものではなく、すべての再試行または再確立が成功します。 DNS の冗長性スキームは必要ありません。 フロントエンドの単一の IP アドレスは、複数の可用性ゾーンで複数の独立したインフラストラクチャ展開によって同時に処理されます。  ゾーン冗長とは、すべての受信フローまたは送信フローが、1 つの IP アドレスを使って、リージョン内の複数の可用性ゾーンにより同時に処理されることを意味します。

1 つまたは複数の可用性ゾーンで障害が発生しても大丈夫であり、リージョン内に正常なゾーンが 1 つでも残っていれば、データ パスは存続します。 ゾーン冗長の構成は既定の構成であり、追加のアクションは必要ありません。  リージョンが可用性ゾーンをサポートするようになると、既存のフロントエンドは自動的にゾーン冗長になります。

内部 Standard Load Balancer に対してゾーン冗長のパブリック IP アドレスを作成するには、次のスクリプトを使います。 構成で既存の Resource Manager テンプレートを使用している場合は、これらのテンプレートに **sku** セクションを追加してください。

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
```

内部 Standard Load Balancer に対してゾーン冗長のフロントエンド IP アドレスを作成するには、次のスクリプトを使います。 構成で既存の Resource Manager テンプレートを使用している場合は、これらのテンプレートに **sku** セクションを追加してください。

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zone_redundant_frontend",
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

#### <a name="optional-zone-guarantee"></a>省略可能なゾーンの保証

単一ゾーンを保証されたフロントエンドにすることができます。これは、"*ゾーン ベースのフロントエンド*" と呼ばれます。  これは、すべての受信または送信フローが、リージョン内の 1 つのゾーンによって処理されることを意味します。  フロントエンドは、ゾーンの正常性に左右されます。  データ パスは、それが保証されたゾーン以外のゾーンのエラーによっては影響を受けません。 ゾーン ベースのフロントエンドを使って、可用性ゾーンごとに IP アドレスを公開することができます。  また、ゾーン ベースのフロントエンドを直接使うことも、フロントエンドがパブリック IP アドレスで構成されている場合は、それを [Traffic Manager](../traffic-manager/traffic-manager-overview.md) などの DNS 負荷分散製品と統合して、単一の DNS 名を使うこともできます。その場合、クライアントは複数のゾーン ベースの IP アドレスに解決されます。  これを使ってゾーンごとに負荷分散されたエンドポイントを公開し、各ゾーンを個別に監視することもできます。  これらの概念を組み合わせる (同じバックエンドでゾーン冗長とゾーン ベースを使う) 場合は、[Azure Load Balancer での複数のフロントエンド](load-balancer-multivip-overview.md)に関するページをご覧ください。

パブリック Load Balancer フロントエンドの場合は、フロントエンド IP 構成によって参照されるパブリック IP に *zones* パラメーターを追加します。  

内部 Load Balancer フロントエンドの場合は、内部 Load Balancer のフロントエンド IP 構成に *zones* パラメーターを追加します。 ゾーン ベースのフロントエンドでは、Load Balancer は特定のゾーンに対してサブネット内の IP アドレスを保証します。

可用性ゾーン 1 にゾーン ベースの Standard パブリック IP アドレスを作成するには、次のスクリプトを使います。 構成で既存の Resource Manager テンプレートを使用している場合は、これらのテンプレートに **sku** セクションを追加してください。

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "zones": [ "1" ],
            "sku":
            {
                "name": "Standard"
            },
```

可用性ゾーン 1 に内部 Standard Load Balancer フロントエンドを作成するには、次のスクリプトを使います。

構成で既存の Resource Manager テンプレートを使用している場合は、これらのテンプレートに **sku** セクションを追加してください。 また、子リソースのフロントエンド IP 構成で **zones** プロパティを定義します。

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zonal_frontend_in_az1",
                        "zones": [ "1" ],
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

### <a name="cross-zone-load-balancing"></a>クロスゾーン負荷分散

クロスゾーンの負荷分散は、任意のゾーン内のバックエンド エンドポイントに到達する Load Balancer の機能であり、フロントエンドおよびそのゾーン性からは独立しています。

単一のゾーン内で展開を揃え、保証する場合は、ゾーン ベースのフロントエンド リソースとゾーン ベースのバックエンド リソースを同じゾーンに揃えます。 ユーザーによる対処は不要です。

### <a name="backend"></a>バックエンド

Load Balancer は Virtual Machines で動作します。  ゾーンに対して保証されていたかどうか、またはどのゾーンが保証対象であったかに関係なく、単一の VNet 内の任意の VM が、バックエンド プールの一部になることができます。

フロントエンドとバックエンドを 1 つのゾーンに揃えて保証する場合は、同じゾーン内の VM をそれぞれのバックエンド プールに配置するだけです。

複数のゾーンの VM に対応したい場合は、単に複数のゾーンからの VM を同じバックエンド プールに配置します。  仮想マシン スケール セットを使っているときは、1 つまたは複数の仮想マシン スケール セットを同じバックエンド プールに配置できます。  また、これらの各仮想マシン スケール セットを 1 つまたは複数のゾーンに配置できます。

### <a name="outbound-connections"></a>送信接続

[送信接続](load-balancer-outbound-connections.md)は、すべてのゾーンによって提供され、仮想マシンがパブリック Load Balancer およびゾーン冗長フロントエンドに関連付けられているときは、可用性ゾーンのあるリージョン内では自動的にゾーン冗長になります。  送信接続の SNAT ポートの割り当ては、ゾーンで障害が発生しても存続します。  

さらに、VM がパブリック Load Balancer およびゾーン ベースのフロントエンドに関連付けられている場合は、送信接続が 1 つのゾーンによって提供されることが保証されます。  送信接続は、対応するゾーンの正常性に依存します。

SNAT ポートの事前割り当てとアルゴリズムは、ゾーンがあってもなくても同じです。

### <a name="health-probes"></a>正常性プローブ

既存の正常性プローブの定義は、可用性ゾーンがない場合でも同じです。  ただし、正常性モデルはインフラストラクチャ レベルで拡張されています。 

ゾーン冗長のフロントエンドを使うと、Load Balancer の内部正常性モデルは、各可用性ゾーンからの VM の到達可能性を独立してプローブし、障害が発生した可能性のあるゾーンとのパスをユーザーの介入なしにシャットダウンするように、拡張されます。  あるゾーンの Load Balancer インフラストラクチャから別のゾーン内の VM への特定のパスを使用できない場合、Load Balancer はこの障害を検出して回避することができます。 この VM に到達できる他のゾーンは、それぞれのフロントエンドから VM の処理を続けることができます。  その結果、障害が発生している間は、エンド ツー エンドのサービスの全体的な正常性を保護するために、各ゾーンのフロー ディストリビューションが若干異なる可能性があります。

## <a name="design"></a> 設計上の考慮事項

Load Balancer は、可用性ゾーンのコンテキストにおいて柔軟性を持つように意図されています。 ゾーンに一致させることも、ゾーン冗長にすることもできます。  可用性を高めると複雑さが増す可能性があり、パフォーマンスが最適になるように可用性を設計する必要があります。  以下では、設計に関する重要な考慮事項を示します。

### <a name="automatic-zone-redundancy"></a>自動ゾーン冗長性

Load Balancer を使うと、ゾーン冗長フロントエンドとして 1 つの IP アドレスを簡単に持つことができます。 ゾーン冗長 IP アドレスは、任意のゾーンでゾーン ベースのリソースを安全に提供でき、リージョン内に正常なゾーンが 1 つでも残っている限り、1 つまたは複数のゾーンで障害があっても存続できます。 逆に、ゾーン ベースのフロントエンドは、単一のゾーンへのサービスの縮小であり、対応するゾーンの正常性に依存します。

ゾーンの冗長性は、ヒットレス データパスまたは制御プレーンを意味するものではなく、データ プレーンを明示します。 ゾーン冗長なフローは任意のゾーンを使うことができ、ユーザーのフローはリージョン内で正常なすべてのゾーンを使います。 ゾーンで障害が発生すると、その時点で正常なゾーンを使っているトラフィック フローは影響を受けません。  ゾーンで障害が発生したときにゾーンを使っているトラフィック フローは影響を受ける可能性がありますが、アプリケーションは復旧でき、Azure がゾーンの障害を収束すると、再送信または再確立のときにリージョン内に残っている正常なゾーンでフローは続行できます。

### <a name="xzonedesign"></a> ゾーンの境界を越える

エンド ツー エンドのサービスがゾーンを越えるときは常に、1 つのゾーンではなく複数のゾーンの正常性に依存する可能性があることを理解しておくことが重要です。  その結果、エンド ツー エンドのサービスは、ゾーン ベースではない展開より可用性が高くならない可能性があります。

可用性ゾーンを使ったときの可用性のメリットがなくなる意図しないクロスゾーンの依存関係が発生しないようにします。  アプリケーションが複数のコンポーネントで構成されていて、ゾーンの障害に対する回復力が必要な場合は、ゾーンで障害が発生したときに十分な数の重要なコンポーネントが存続するように注意する必要があります。  たとえば、アプリケーションの 1 つの重要なコンポーネントが、障害を存続できなかったゾーンに存在していた場合、アプリケーション全体に影響する可能性があります。  さらに、ゾーンの復元とアプリケーションの収束方法についても検討します。 以下で確認する重要な点を、特定のシナリオについて考えるときの質問の参考にしてください。

- アプリケーションに 2 つのコンポーネント (たとえば、IP アドレスと、マネージド ディスクを含む VM) があり、ゾーン 1 とゾーン 2 で保証されている場合、ゾーン 1 で障害が発生すると、エンド ツー エンド サービスは存続できません。  潜在的に危険性のある障害モードを作成していることをよく理解していない限り、ゾーンを越えないようにしてください。

- アプリケーションに 2 つのコンポーネント (たとえば、IP アドレスと、マネージド ディスクを含む VM) があり、それぞれでゾーン冗長とゾーン 1 が保証されている場合、ゾーン 1 さえ正常であれば、ゾーン 2 とゾーン 3 のどちらか一方または両方で障害が発生しても、エンド ツー エンドのサービスは存続できます。  ただし、フロントエンドの到達可能性だけを観察している場合は、サービスの正常性を判断する機能が若干失われます。  さらに広範な正常性と容量のモデルの開発を検討します。  ゾーン冗長とゾーン ベースの概念を組み合わせて、洞察と管理容易性を拡張する場合があります。

- アプリケーションの 2 つのコンポーネント (たとえば、ゾーン冗長な Load Balancer フロントエンドと、クロスゾーンの仮想マシン スケール セット) が 3 つのゾーンに存在している場合、障害の影響を受けないゾーンのリソースは使用できますが、エンド ツー エンド サービスの容量はゾーン障害の間に低下する可能性があります。 インフラストラクチャの観点からは、1 つ以上のゾーンで障害が発生しても展開は存続することができ、これにより次のような質問が発生します。
  - このような障害および容量低下をアプリケーションが判断する方法を理解していますか。
  - サービスには、必要に応じてリージョン ペアに強制的にフェールオーバーする安全策が必要ですか。
  - どのような方法で、このようなシナリオを監視、検出、軽減しますか。 Standard Load Balancer の診断機能を使って、エンド ツー エンド サービスのパフォーマンスの監視を強化できる場合があります。 使用可能なもの、および全体像のために拡張が必要なものを検討します。

- ゾーンを使うと、障害の把握と阻止が容易になる可能性があります。  ただし、タイムアウト、再試行、バックオフ アルゴリズムなどの概念に関しては、ゾーンの障害も他の障害と違いはありません。 Azure Load Balancer がゾーン冗長なパスを提供し、迅速な復旧を試みる場合であっても、リアルタイムのパケット レベルでは、障害が発生すると再送信または再確立が行われる可能性があり、アプリケーションが障害に対処する方法を理解しておくことが重要です。 負荷分散スキームは存続しますが、次のことを計画する必要があります。
  - ゾーンで障害が発生した場合、エンド ツー エンド サービスはそれを認識しますか。また、状態が失われた場合、どのようにして復旧しますか。
  - ゾーンが復帰したとき、アプリケーションは安全に収束する方法を認識しますか。

### <a name="zonalityguidance"></a> ゾーン冗長とゾーン ベースの比較

ゾーン冗長は、ゾーンへの非依存性を提供するのと同時に、サービスに対する単一の IP アドレスにより回復力のあるオプションも提供します。  さらに、複雑さを低下させることができます。  ゾーン冗長は、ゾーンを越えて移動することもでき、任意のゾーンのリソースで安全に使用できます。  また、可用性ゾーンのないリージョンでも将来的に保証されており、リージョンで可用性ゾーンを利用できるようになったときに必要な変更を制限できます。  ゾーン冗長の IP アドレスまたはフロントエンドの構成構文は、可用性ゾーンがないリージョンも含めて、すべてのリージョンで成功します。

ゾーン ベースは、1 つのゾーンに対する明示的な保証を提供し、そのゾーンの正常性に依存します。 ゾーン ベースの IP アドレスまたはゾーン ベースの Load Balancer フロントエンドの関連付けは、アタッチされているリソースが同じゾーン内のゾーン ベースの VM である場合は特に、望ましい、または妥当な属性である可能性があります。  そうでなければおそらく、アプリケーションはリソースが存在するゾーンを明確に知る必要があり、別のゾーンの可用性を明示的に判別する必要があります。  複数のゾーンに分散されているエンド ツー エンド サービスに対し、複数のゾーン ベースのフロントエンドを公開することもできます (つまり、複数のゾーン ベースの仮想マシン スケール セットに対して、ゾーンごとのゾーン ベースのフロントエンド)。  また、ゾーン ベースのフロントエンドがパブリック IP アドレスである場合は、これらの複数のゾーン ベースのフロントエンドを使って、[Traffic Manager](../traffic-manager/traffic-manager-overview.md) でサービスを公開することができます。  または、複数のゾーン ベースのフロントエンドを使うと、サード パーティ製の監視ソリューションによりゾーンごとの正常性とパフォーマンスの洞察を取得でき、ゾーン冗長なフロントエンドでサービス全体を公開することができます。 ゾーン ベースのリソースの提供は、同じゾーンに揃えられたゾーン ベースのフロントエンドでのみ行う必要があり、ゾーン ベースのリソースに対して潜在的に危険なクロスゾーン シナリオは回避する必要があります。  ゾーン ベースのリソースは、可用性ゾーンが存在するリージョンにのみ存在します。

サービス アーキテクチャを理解することなく、選択肢の優劣を判断するための一般的なガイダンスはありません。

## <a name="limitations"></a>制限事項

- データ プレーンは完全にゾーン冗長ですが (ゾーン ベースの保証が指定されていない場合)、制御プレーンの動作は完全にゾーン冗長ではありません。

## <a name="next-steps"></a>次の手順
- [可用性ゾーン](../availability-zones/az-overview.md)の詳細を確認する
- [Standard Load Balancer](load-balancer-standard-overview.md) の詳細を確認する
- [ゾーン フロントエンドによる Standard Load Balancer を使用した単一のゾーン内での VM の負荷分散](load-balancer-standard-public-zonal-cli.md)を確認する
- [ゾーン冗長フロントエンドによる Standard Load Balancer を使用したゾーン間での VM の負荷分散](load-balancer-standard-public-zone-redundant-cli.md)を確認する
