---
title: Azure Standard Load Balancer と可用性ゾーン
titleSuffix: Azure Load Balancer
description: このラーニング パスを使用して、Azure Standard Load Balancer と Availability Zones の使用を開始します。
services: load-balancer
documentationcenter: na
author: asudbring
ms.custom: seodec18
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/07/2020
ms.author: allensu
ms.openlocfilehash: 55a86eeee4f819955e3f8adfcc0f55f24d58bed0
ms.sourcegitcommit: e71da24cc108efc2c194007f976f74dd596ab013
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/29/2020
ms.locfileid: "87420313"
---
# <a name="standard-load-balancer-and-availability-zones"></a>Standard Load Balancer と可用性ゾーン

Azure Standard Load Balancer は、可用性ゾーンのシナリオをサポートしています。 標準のロード バランサーを使用することで、リソースをゾーンに一致させて、複数のゾーンに分散させることにより、シナリオ全体の可用性を向上させることができます。 可用性ゾーンと標準のロード バランサーの組み合わせは、さまざまなシナリオを作成できる拡張性と柔軟性の高い機能セットです。  このドキュメントを読んで、これらの[概念](#concepts)と基本的なシナリオの[設計ガイダンス](#design)を理解してください。

## <a name="availability-zones-concepts-applied-to-load-balancer"></a><a name="concepts"></a> Load Balancer に適用される可用性ゾーンの概念

ロード バランサーは、そのコンポーネントからゾーン構成を継承します。 

* フロントエンド
* ルール
* バックエンド プールの定義

可用性ゾーンのコンテキストでは、ロード バランサー規則の動作とプロパティは、ゾーン冗長またはゾーン ベースとして記述されます。  ロード バランサーのコンテキストでは、ゾーン冗長は常に "**ゾーン**" を意味し、ゾーン ベースはサービスを "**単一のゾーン**" に分離することを意味します。 Azure Load Balancer には、パブリック型と内部型の 2 つの型があります。 どちらの型のロード バランサーでも、ゾーン冗長性とゾーン デプロイがサポートされています。  どちらの型のロード バランサーでも、必要に応じて複数のゾーンにまたがってトラフィックを転送できます。

## <a name="frontend"></a>フロントエンド

ロード バランサーのフロントエンドは、仮想ネットワークのサブネット内のパブリック IP アドレスまたはプライベート IP アドレスのいずれかを参照するフロントエンド IP 構成です。 サービスが公開される負荷分散されたエンドポイントを形成します。

ロード バランサー リソースは、ゾーン ベースのフロントエンドとゾーン冗長のフロントエンドの規則を同時に含めることができます。 パブリック IP またはプライベート IP がゾーンに対して保証されている場合、ゾーン性 (またはその欠如) は変更できません。 パブリックまたはプライベートの IP アドレスのフロントエンドのゾーン性を変更または省略するには、適切なゾーンで IP を再作成します。 

可用性ゾーンでは、複数のフロントエンドの制約は変更されません。 この機能の詳細については、[Load Balancer の複数のフロントエンド](load-balancer-multivip-overview.md)に関するページをご確認ください。

### <a name="zone-redundant"></a>ゾーン冗長 

可用性ゾーンのあるリージョンでは、標準のロード バランサーのフロントエンドをゾーン冗長にすることができます。 複数のゾーンが 1 つのリージョンの受信または送信に対応することができます。 このトラフィックは、1 つの IP アドレスによって行われます。 DNS の冗長性スキームは必要ありません。 

単一のフロントエンド IP アドレスは、ゾーンの障害が発生した後も存続します。 フロントエンド IP は、ゾーンに関係なく、すべての (影響を受けない) バックエンド プール メンバーに到達するために使用できます。 1 つまたは複数の可用性ゾーンで障害が発生しても対応可能であり、リージョン内に正常なゾーンが 1 つでも残っていれば、データ パスは存続します。 

フロントエンドの IP アドレスは、複数の可用性ゾーンで複数の独立したインフラストラクチャ展開によって同時に処理されます。 再試行または再確立は、ゾーンの障害による影響を受けない他のゾーンで成功します。 

<p align="center">
  <img src="./media/az-zonal/zone-redundant-lb-1.svg" alt="Figure depicts a zone-redundant standard load balancer directing traffic in three different zones to three different subnets in a zone redundant configuration." width="512" title="Virtual Network NAT">
</p>

*図:ゾーン冗長ロード バランサー*

### <a name="zonal"></a>ゾーン ベース

単一ゾーンを保証されたフロントエンドにすることができます。これは、"*ゾーン ベースのフロントエンド*" と呼ばれます。  このシナリオは、すべての受信または送信フローが、リージョン内の 1 つのゾーンによって処理されることを意味します。  フロントエンドは、ゾーンの正常性に左右されます。  データ パスは、それが保証されたゾーン以外のゾーンのエラーによっては影響を受けません。 ゾーン ベースのフロントエンドを使って、可用性ゾーンごとに IP アドレスを公開することができます。  

さらに、各ゾーン内の負荷分散されたエンドポイントに対して、ゾーン フロントエンドを直接使用することもできます。 この構成を使ってゾーンごとに負荷分散されたエンドポイントを公開し、各ゾーンを個別に監視することができます。 パブリック エンドポイントの場合は、これらを [Traffic Manager](../traffic-manager/traffic-manager-overview.md) などの DNS 負荷分散製品と統合して、1 つの DNS 名を使用できます。


<p align="center">
  <img src="./media/az-zonal/zonal-lb-1.svg" alt="Figure depicts three zonal standard load balancers each directing traffic in a zone to three different subnets in a zonal configuration." width="512" title="Virtual Network NAT">
</p>

*図:ゾーン冗長ロード バランサー*

これらの概念を組み合わせる (同じバックエンドでゾーン冗長とゾーン ベースを使う) 場合は、[Azure Load Balancer での複数のフロントエンド](load-balancer-multivip-overview.md)に関するページをご覧ください。

パブリック ロード バランサー フロントエンドの場合は、パブリック IP に **zones** パラメーターを追加します。 このパブリック IP は、それぞれの規則で使用されるフロントエンド IP 構成によって参照されます。

内部ロード バランサー フロントエンドの場合は、内部ロード バランサーのフロントエンド IP 構成に **zones** パラメーターを追加します。 ゾーン フロントエンドは、サブネット内の IP アドレスを特定のゾーンに対して保証します。

## <a name="backend"></a>バックエンド

Azure Load Balancer は仮想マシン インスタンスで動作します。 これらのインスタンスは、スタンドアロン、可用性セット、または仮想マシン スケール セットです。 1 つの仮想ネットワーク内の任意の仮想マシンをバックエンド プールに含めることができます。仮想マシンが保証されているすべてのゾーンが対象となります。

フロントエンドとバックエンドを 1 つのゾーンに配置して保証するには、同じゾーン内の仮想マシンのみを対応するバックエンド プールに配置します。

複数のゾーンにまたがる仮想マシンに対応するには、複数のゾーンからの仮想マシンを同じバックエンド プールに配置します。 

仮想マシン スケール セットを使っているときは、1 つまたは複数の仮想マシン スケール セットを同じバックエンド プールに配置します。 スケール セットは、1 つまたは複数のゾーンに配置できます。

## <a name="outbound-connections"></a>送信接続

ゾーン冗長およびゾーンは、[送信接続](load-balancer-outbound-connections.md)に適用されます。 送信接続に使用されるゾーン冗長パブリック IP アドレスは、すべてのゾーンによって処理されます。 ゾーン ベースのパブリック IP アドレスは、それが保証されているゾーンによってのみ処理されます。 

送信接続 SNAT ポートの割り当ては、ゾーンの障害でも維持され、ゾーンの障害による影響を受けていない場合、このシナリオでは引き続き送信 SNAT 接続が提供されます。 影響を受けたゾーンによってトラフィックが処理された場合、ゾーン冗長のシナリオでは、ゾーンの障害には接続の再確立が必要になることがあります。 影響を受けるゾーン以外のゾーン内のフローは、影響を受けません。

SNAT ポートの事前割り当てアルゴリズムは、可用性ゾーンがあってもなくても同じです。

## <a name="health-probes"></a>正常性プローブ

既存の正常性プローブの定義は、可用性ゾーンがない場合でも同じです。 ただし、正常性モデルはインフラストラクチャ レベルで拡張されています。 

ゾーン冗長フロントエンドを使用すると、ロード バランサーによって内部の正常性チェックが拡張されます。 ロード バランサーは、各ゾーンからの仮想マシンの可用性を個別にプローブし、介入なしに失敗したゾーン間でパスをシャットダウンします。  

この VM に到達できる他のゾーンは、それぞれのフロントエンドから VM の処理を続けることができます。 障害が発生している間は、サービスの全体的な正常性を保護するために、各ゾーンで新しいフローのディストリビューションが異なる可能性があります。

## <a name="design-considerations"></a><a name="design"></a> 設計上の考慮事項

ロード バランサーは、可用性ゾーンという観点から柔軟性があります。 ゾーンに一致させることも、規則ごとにゾーン冗長にすることもできます。 可用性の向上には、複雑さが増すという代償が伴います。 最適なパフォーマンスを実現するために、可用性を設計します。

### <a name="zone-redundancy"></a>ゾーンの冗長性

Load Balancer を使うと、ゾーン冗長フロントエンドとして 1 つの IP アドレスを簡単に持つことができます。 ゾーン冗長 IP アドレスは、任意のゾーンでゾーンのリソースを提供できます。  IP は、リージョン内に正常なゾーンが 1 つでも残っている限り、1 つまたは複数のゾーンで障害があっても存続できます。  その代わりに、ゾーンのフロントエンドは、単一のゾーンへのサービスの縮小であり、対応するゾーンの正常性に依存します。

ゾーンの冗長性は、ヒットレス データパスまたは制御プレーンを意味するものではなく、データ プレーンを意味します。 ゾーン冗長なフローは任意のゾーンを使うことができ、ユーザーのフローはリージョン内で正常なすべてのゾーンを使います。 ゾーンで障害が発生した場合、正常なゾーンを使用しているトラフィック フローは影響を受けません。 

ゾーンで障害が発生したときにゾーンを使用しているトラフィック フローは影響を受ける可能性がありますが、アプリケーションは復旧できます。 Azure がゾーンの障害に対して収束した場合、トラフィックは、再送信時にリージョン内の正常なゾーンで継続されます。

### <a name="cross-zone-boundaries"></a><a name="xzonedesign"></a> ゾーンの境界を越える

サービスがゾーンを越えるときは常に、1 つのゾーンではなく複数のゾーンの正常性に依存する可能性があることを理解しておくことが重要です。 その結果、サービスは、非ゾーンのデプロイより可用性が高くならない可能性があります。

可用性ゾーンを使ったときの可用性のメリットがなくなる、意図しないクロスゾーンの依存関係が発生しないようにします。 アプリケーションに複数の重要なコンポーネントが含まれている場合は、ゾーンで障害が発生しても確実に存続できるようにします。

アプリケーションの 1 つの重要なコンポーネントが、存続できなかったゾーンに存在していた場合、アプリケーション全体に影響する可能性があります。 ゾーンの復元とアプリケーションの収束方法について検討します。 アプリケーションがその一部の障害にどのように応答するかを理解します。 重要な点を確認し、特定のシナリオについて考えるときの質問に使用します。

- アプリケーションに 2 つのコンポーネントがある場合:

    * IP アドレス
    * マネージド ディスクを使用した仮想マシン

これらはゾーン 1 とゾーン 2 で構成されています。 ゾーン 1 で障害が発生すると、サービスは存続できません。 潜在的に危険性のある障害モードを作成していることをよく理解していない限り、ゾーン ベースのシナリオでゾーンを超えないようにしてください。 このシナリオでは柔軟性を提供できます。

- アプリケーションに 2 つのコンポーネントがある場合:

    * IP アドレス
    * マネージド ディスクを使用した仮想マシン

これらはゾーン冗長とゾーン 1 になるように構成されています。 ゾーン 1 で障害が発生していない限り、ゾーン 2、ゾーン 3、またはその両方のゾーンで障害が発生してもサービスは存続します。 ただし、フロントエンドの到達可能性だけを観察している場合は、サービスの正常性を判断する機能が若干失われます。  さらに広範な正常性と容量のモデルの開発を検討します。  ゾーン冗長とゾーン ベースの概念を組み合わせて、洞察と管理容易性を拡張する場合があります。

- アプリケーションに 2 つのコンポーネントがある場合:

    * ゾーン冗長ロード バランサー フロントエンド
    * 3 つのゾーンのクロスゾーン仮想マシン スケール セット

障害の影響を受けていないゾーン内のリソースが使用できるようになります。 障害が発生すると、サービスの容量が低下する可能性があります。 インフラストラクチャの観点からは、1 つ以上のゾーンで障害が発生してもデプロイは存続することができます。 このシナリオでは、次の質問が発生します。

  - 障害および容量低下にアプリケーションが対応する方法をご存じですか。
  - サービスには、必要に応じてリージョン ペアに強制的にフェールオーバーする安全策が必要ですか。
  - どのような方法で、このようなシナリオを監視、検出、軽減しますか。 標準のロード バランサーの診断機能を使って、サービスのパフォーマンスの監視を強化できます。 使用可能なものと強化が必要なものを検討します。

- ゾーンを使うと、障害の把握と阻止が容易になる可能性があります。 タイムアウト、再試行、バックオフ アルゴリズムに関しては、ゾーンの障害も他の障害と違いはありません。 Azure Load Balancer では、ゾーン冗長パスが提供されます。 ロード バランサーは、リアルタイムでパケット レベルで迅速に復旧を試みます。 障害が発生すると、再送信または再構築が行われる場合があります。 アプリケーションが障害に対処する方法を理解しておくことが重要です。 負荷分散スキームは存続しますが、次の質問に対する計画を立てる必要があります。

  - ゾーンで障害が発生した場合、サービスではこの障害が認識されますか。また、状態が失われた場合、どのようにして復旧しますか。
  - ゾーンが復帰したとき、アプリケーションは安全に収束する方法を認識しますか。

障害シナリオに対するアプリケーションの回復性を向上させるには、[Azure クラウド設計パターン](https://docs.microsoft.com/azure/architecture/patterns/)に関する記事を参照してください。

## <a name="next-steps"></a>次のステップ
- [可用性ゾーン](../availability-zones/az-overview.md)の詳細を確認する
- [Standard Load Balancer](load-balancer-standard-overview.md) の詳細を確認する
- [ゾーン フロントエンドによる Standard Load Balancer を使用した単一のゾーン内での VM の負荷分散](load-balancer-standard-public-zonal-cli.md)を確認する
- [ゾーン冗長フロントエンドによる Standard Load Balancer を使用したゾーン間での VM の負荷分散](load-balancer-standard-public-zone-redundant-cli.md)を確認する
- 障害シナリオに対するアプリケーションの回復性を向上させるために、[Azure クラウド設計パターン](https://docs.microsoft.com/azure/architecture/patterns/)についての記事を確認する。
