---
title: クイック スタート:内部ロード バランサーの作成 - Azure portal
titleSuffix: Azure Load Balancer
description: このクイックスタートでは、Azure portal を使用して内部ロード バランサーを作成する方法について説明します。
services: load-balancer
documentationcenter: na
author: asudbring
manager: KumudD
Customer intent: I want to create a internal load balancer so that I can load balance internal traffic to VMs.
ms.service: load-balancer
ms.devlang: na
ms.topic: quickstart
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/30/2020
ms.author: allensu
ms.custom: mvc
ms.openlocfilehash: 1a7511ed0e7bb1d9032331efa87f0d61a99cf5dc
ms.sourcegitcommit: d8b8768d62672e9c287a04f2578383d0eb857950
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/11/2020
ms.locfileid: "88065235"
---
# <a name="quickstart-create-an-internal-load-balancer-to-load-balance-vms-using-the-azure-portal"></a>クイック スタート:Azure portal を使用して VM の負荷を分散する内部ロード バランサーを作成する

Azure portal を使用して内部ロード バランサーと 2 つの仮想マシンを作成することにより、Azure Load Balancer の使用を開始します。

## <a name="prerequisites"></a>前提条件

- アクティブなサブスクリプションが含まれる Azure アカウント。 [無料でアカウントを作成できます](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)。

## <a name="sign-in-to-azure"></a>Azure へのサインイン

Azure Portal ([https://portal.azure.com](https://portal.azure.com)) にサインインします。

---

# <a name="option-1-default-create-a-internal-load-balancer-standard-sku"></a>[オプション 1 (既定): 内部ロード バランサー (Standard SKU) を作成する](#tab/option-1-create-internal-load-balancer-standard)

>[!NOTE]
>運用環境のワークロードには、Standard SKU ロード バランサーをお勧めします。  SKU の詳細については、「 **[Azure Load Balancer の SKU](skus.md)** 」を参照してください。

このセクションでは、仮想マシンの負荷分散を行うロード バランサーを作成します。 

パブリック ロード バランサーまたは内部ロード バランサーを作成できます。 

内部ロード バランサーを作成すると、仮想ネットワークがロード バランサー用のネットワークとして構成されます。 

仮想ネットワーク内のプライベート IP アドレスは、ロード バランサー用のフロントエンドとして構成されます (既定の名前は **LoadBalancerFrontend**)。 

フロントエンド IP アドレスは、**静的**でも**動的**でもかまいません。

## <a name="create-the-virtual-network"></a>仮想ネットワークの作成

このセクションでは、仮想ネットワークとサブネットを作成します。

1. 画面の左上で、 **[リソースの作成] > [ネットワーク] > [仮想ネットワーク]** の順に選択するか、検索ボックスで **Virtual network** を検索します。

2. **[仮想ネットワークの作成]** の **[基本]** タブで次の情報を入力または選択します。

    | **設定**          | **Value**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **プロジェクトの詳細**  |                                                                 |
    | サブスクリプション     | Azure サブスクリプションを選択します。                                  |
    | リソース グループ   | **[myResourceGroupLB]** を選択します |
    | **インスタンスの詳細** |                                                                 |
    | 名前             | 「**myVNet**」と入力します                                    |
    | リージョン           | **[西ヨーロッパ]** を選択します |

3. **[IP アドレス]** タブを選択するか、ページの下部にある **[Next: IP Addresses]\(次へ: IP アドレス\)** ボタンを選択します。

4. **[IP アドレス]** タブで、次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | IPv4 アドレス空間 | 「**10.1.0.0/16**」と入力します。 |

5. **[サブネット名]** で、 **[default]\(既定\)** という単語を選択します。

6. **[サブネットの編集]** に次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | サブネット名 | 「**myBackendSubnet**」と入力します |
    | サブネットのアドレス範囲 | 「**10.1.0.0/24**」と入力します。 |

7. **[保存]** を選択します。

8. **[セキュリティ]** タブをクリックします。

9. **[BastionHost]** で **[有効にする]** を選択します。 この情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | 要塞名 | 「**myBastionHost**」と入力します |
    | AzureBastionSubnet のアドレス空間 | 「**10.1.1.0/24**」と入力します |
    | パブリック IP アドレス | **[新規作成]** を選択します。 </br> **[名前]** に「**myBastionIP**」と入力します。 </br> **[OK]** を選択します。 |


8. **[確認と作成]** タブを選択するか、 **[確認と作成]** ボタンを選択します。

9. **［作成］** を選択します

## <a name="create-load-balancer"></a>ロード バランサーの作成

1. 画面の左上で、 **[リソースの作成]**  >  **[ネットワーク]**  >  **[Load Balancer]** を選択します。

2. **[ロード バランサーの作成]** ページの **[基本]** タブで、次の情報を入力または選択します。 

    | 設定                 | 値                                              |
    | ---                     | ---                                                |
    | サブスクリプション               | サブスクリプションを選択します。    |    
    | Resource group         | 前のステップで作成した **myResourceGroupLB** を選択します。|
    | 名前                   | 「**myLoadBalancer**」と入力します                                   |
    | リージョン         | **[西ヨーロッパ]** を選択します。                                        |
    | Type          | **[内部]** を選択します。                                        |
    | SKU           | **[Standard]** を選択します。 |
    | 仮想ネットワーク | 前のステップで作成した **myVNet** を選択します。 |
    | Subnet  | 前のステップで作成した **myBackendSubnet** を選択します。 |
    | IP アドレスの割り当て | **[動的]** を選択します。 |
    | 可用性ゾーン | **[ゾーン冗長]** を選択します |

3. 残りの設定は既定値をそのまま使用し、 **[確認と作成]** を選択します。

4. **[確認および作成]** タブで、 **[作成]** を選択します。   
    
    :::image type="content" source="./media/quickstart-load-balancer-standard-internal-portal/create-standard-internal-load-balancer.png" alt-text="標準の内部ロード バランサーを作成する" border="true":::
 
## <a name="create-load-balancer-resources"></a>ロード バランサーのリソースを作成する

このセクションでは、次の構成を行います。

* ロード バランサーのバックエンド アドレス プールの設定。
* 正常性プローブ。
* ロード バランサー規則。

### <a name="create-a-backend-pool"></a>バックエンド プールの作成

バックエンド アドレス プールには、ロード バランサーに接続された仮想 NIC の IP アドレスが含まれています。 

バックエンド アドレス プール **myBackendPool** を作成し、インターネット トラフィックを負荷分散するために仮想マシンを含めます。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。

2. **[設定]** で、 **[バックエンド プール]** 、 **[追加]** の順に選択します。

3. **[バックエンド プールの追加]** ページ上で、バックエンド プールの名前として「**myBackendPool**」と入力し、 **[追加]** を選択します。

### <a name="create-a-health-probe"></a>正常性プローブの作成

ロード バランサーは、正常性プローブを使用してアプリの状態を監視します。 

正常性プローブは、正常性チェックへの応答に基づいて、ロード バランサーに含める VM を追加したり削除したりします。 

**myHealthProbe** という正常性プローブを作成し、VM の正常性を監視します。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。

2. **[設定]** で、 **[正常性プローブ]** 、 **[追加]** の順に選択します。
    
    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | 「**myHealthProbe**」と入力します。 |
    | Protocol | **[HTTP]** を選択します。 |
    | Port | 「**80**」と入力します。|
    | Interval | プローブの試行の**間隔**を示す秒数として、「**15**」を入力します。 |
    | 異常のしきい値 | **異常しきい値**またはプローブの連続する失敗の回数として **[2]** を選択します。この回数を超えると、VM は異常と見なされます。|
    | | |

3. 残りの部分は既定値のままにし、 **[OK]** を選択します。

### <a name="create-a-load-balancer-rule"></a>ロード バランサー規則の作成

ロード バランサー規則の目的は、一連の VM に対するトラフィックの分散方法を定義することです。 着信トラフィック用のフロントエンド IP 構成と、トラフィックを受信するためのバックエンド IP プールを定義します。 送信元と送信先のポートは、この規則で定義します。 

このセクションでは、ロード バランサー規則を作成します。

* 「**myHTTPRule**」という名前を付けます。
* フロントエンドには、「**LoadBalancerFrontEnd**」という名前を付けます。
* **ポート 80** でリッスンします。
* 負荷分散されたトラフィックを、**ポート 80** の **myBackendPool** という名前のバックエンドに送信します。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。

2. **[設定]** で、 **[負荷分散規則]** 、 **[追加]** の順に選択します。

3. 負荷分散規則の構成には、以下の値を使用します。
    
    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | 「**myHTTPRule**」と入力します。 |
    | IP バージョン | **[IPv4]** を選択します |
    | フロントエンド IP アドレス | **[LoadBalancerFrontEnd]** を選択します |
    | Protocol | **[TCP]** を選択します。 |
    | Port | 「**80**」と入力します。|
    | バックエンド ポート | 「**80**」と入力します。 |
    | バックエンド プール | **[myBackendPool]** を選択します。|
    | 正常性プローブ | **[myHealthProbe]** を選択します。 |
    | 暗黙的なアウトバウンド規則の作成 | このため、 **[いいえ]** を選択します。

4. 残りの部分は既定値のままにし、次に **[OK]** を選択します。

>[!NOTE]
>バックエンド プール内の仮想マシンは、この構成ではアウトバウンド インターネット接続を持ちません。 </br> アウトバウンド接続の提供の詳細については、以下を参照してください。 </br> **[Azure の送信接続](load-balancer-outbound-connections.md)**</br> 接続を提供するためのオプション: </br> **[送信専用のロード バランサーの構成](egress-only.md)** </br> **[Virtual Network NAT とは](https://docs.microsoft.com/azure/virtual-network/nat-overview)**

## <a name="create-backend-servers"></a>バックエンド サーバーの作成

このセクションでは、次の作業を行います。

* ロード バランサーのバックエンド プール用に 2 つの仮想マシンを作成します。
* 仮想マシンに IIS をインストールし、ロード バランサーをテストします。

### <a name="create-virtual-machines"></a>仮想マシンを作成する

このセクションでは、2 つのゾーン (**ゾーン 1** と**ゾーン 2**) の標準のパブリック IP アドレスを使用して、2 つの VM (**myVM1** と **myVM2**) を作成します。 

これらの VM を、前に作成したロード バランサーのバックエンド プールに追加します。

1. ポータルの左上で、 **[リソースの作成]**  >  **[Compute]**  >  **[仮想マシン]** を選択します。 
   
2. **[仮想マシンの作成]** の **[Basic]** タブに、値を入力するか選択します。

    | 設定 | 値                                          |
    |-----------------------|----------------------------------|
    | **プロジェクトの詳細** |  |
    | サブスクリプション | Azure サブスクリプションを選択します。 |
    | リソース グループ | **[myResourceGroupLB]** を選択します |
    | **インスタンスの詳細** |  |
    | 仮想マシン名 | 「**myVM1**」と入力します |
    | リージョン | **[西ヨーロッパ]** を選択します |
    | 可用性オプション | **[可用性ゾーン]** を選択します |
    | 可用性ゾーン | **[1]** を選択します |
    | Image | **[Windows Server 2019 Datacenter]** を選択します |
    | Azure Spot インスタンス | **[いいえ]**  を選択します |
    | サイズ | VM サイズを選択するか、既定の設定を使用します |
    | **管理者アカウント** |  |
    | ユーザー名 | ユーザー名を入力します |
    | Password | [パスワード] を入力します |
    | [パスワードの確認入力] | パスワードを再入力します |

3. **[ネットワーク]** タブまたは **[次へ: ディスク]** を選択してから **[次へ: ネットワーク]** を選択します。
  
4. [ネットワーク] タブで、次を選択または入力します。

    | 設定 | 値 |
    |-|-|
    | **ネットワーク インターフェイス** |  |
    | 仮想ネットワーク | **myVNet** |
    | Subnet | **myBackendSubnet** |
    | パブリック IP | 既定値の **[myVM-ip]** をそのまま使用します。 </br> IP は自動的に、ゾーン 1 の Standard SKU IP になります。 |
    | NIC ネットワーク セキュリティ グループ | **[Advanced] \(詳細設定)** を選択します|
    | ネットワーク セキュリティ グループを構成する | **[新規作成]** を選択します。 </br> **[ネットワーク セキュリティ グループの作成]** で、 **[名前]** に「**myNSG**」と入力します。 </br> **[OK]** を選択します。 |
    | **負荷分散**  |
    | この仮想マシンを既存の負荷分散ソリューションの後ろに配置しますか? | **[はい]** を選択します |
    | **ロード バランサーの設定** |
    | 負荷分散のオプション | **[Azure load balancing]\(Azure 負荷分散\)** を選択します |
    | ロード バランサーを選択する | **[myLoadBalancer]** を選択します  |
    | バックエンド プールを選択する | **[myBackendPool]** を選択します |

5. **[管理]** タブまたは **[次へ]**  >  **[管理]** を選択します。

6. **[管理]** タブで、次を選択または入力します。
    
    | 設定 | 値 |
    |-|-|
    | **Monitoring** |  |
    | ブート診断 | **[オフ]** を選択します |
   
7. **[Review + create]\(レビュー + 作成\)** を選択します。 
  
8. 設定を確認し、 **[作成]** を選択します。

9. 手順 1 から 8 のようにして、次の値を持つ 1 つの追加の VM を作成します。他の設定はすべて **myVM1** と同じにします。

    | 設定 | VM 2|
    | ------- | ----- |
    | 名前 |  **myVM2** |
    | 可用性ゾーン | **2** |
    | ネットワーク セキュリティ グループ | 既存の **[myNSG]** を選択します|


# <a name="option-2-create-a-internal-load-balancer-basic-sku"></a>[オプション 2: 内部ロード バランサーを作成する (Basic SKU)](#tab/option-1-create-internal-load-balancer-basic)

>[!NOTE]
>運用環境のワークロードには、Standard SKU ロード バランサーをお勧めします。  SKU の詳細については、「 **[Azure Load Balancer の SKU](skus.md)** 」を参照してください。

このセクションでは、仮想マシンの負荷分散を行うロード バランサーを作成します。 

パブリック ロード バランサーまたは内部ロード バランサーを作成できます。 

内部ロード バランサーを作成すると、仮想ネットワークがロード バランサー用のネットワークとして構成されます。 

仮想ネットワーク内のプライベート IP アドレスは、ロード バランサー用のフロントエンドとして構成されます (既定の名前は **LoadBalancerFrontend**)。 

フロントエンド IP アドレスは、**静的**でも**動的**でもかまいません。

## <a name="create-the-virtual-network"></a>仮想ネットワークの作成

このセクションでは、仮想ネットワークとサブネットを作成します。

1. 画面の左上で、 **[リソースの作成] > [ネットワーク] > [仮想ネットワーク]** の順に選択するか、検索ボックスで **Virtual network** を検索します。

2. **[仮想ネットワークの作成]** の **[基本]** タブで次の情報を入力または選択します。

    | **設定**          | **Value**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **プロジェクトの詳細**  |                                                                 |
    | サブスクリプション     | Azure サブスクリプションを選択します。                                  |
    | リソース グループ   | **[myResourceGroupLB]** を選択します |
    | **インスタンスの詳細** |                                                                 |
    | 名前             | 「**myVNet**」と入力します                                    |
    | リージョン           | **[西ヨーロッパ]** を選択します |

3. **[IP アドレス]** タブを選択するか、ページの下部にある **[Next: IP Addresses]\(次へ: IP アドレス\)** ボタンを選択します。

4. **[IP アドレス]** タブで、次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | IPv4 アドレス空間 | 「**10.1.0.0/16**」と入力します。 |

5. **[サブネット名]** で、 **[default]\(既定\)** という単語を選択します。

6. **[サブネットの編集]** に次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | サブネット名 | 「**myBackendSubnet**」と入力します |
    | サブネットのアドレス範囲 | 「**10.1.0.0/24**」と入力します。 |

7. **[保存]** を選択します。

8. **[セキュリティ]** タブをクリックします。

9. **[BastionHost]** で **[有効にする]** を選択します。 この情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | 要塞名 | 「**myBastionHost**」と入力します |
    | AzureBastionSubnet のアドレス空間 | 「**10.1.1.0/24**」と入力します |
    | パブリック IP アドレス | **[新規作成]** を選択します。 </br> **[名前]** に「**myBastionIP**」と入力します。 </br> **[OK]** を選択します。 |


8. **[確認と作成]** タブを選択するか、 **[確認と作成]** ボタンを選択します。

9. **［作成］** を選択します

## <a name="create-load-balancer"></a>ロード バランサーの作成

1. 画面の左上で、 **[リソースの作成]**  >  **[ネットワーク]**  >  **[Load Balancer]** を選択します。

2. **[ロード バランサーの作成]** ページの **[基本]** タブで、次の情報を入力または選択します。 

    | 設定                 | 値                                              |
    | ---                     | ---                                                |
    | サブスクリプション               | サブスクリプションを選択します。    |    
    | Resource group         | 前のステップで作成した **myResourceGroupLB** を選択します。|
    | 名前                   | 「**myLoadBalancer**」と入力します                                   |
    | リージョン         | **[西ヨーロッパ]** を選択します。                                        |
    | Type          | **[内部]** を選択します。                                        |
    | SKU           | **[Basic]** を選択します |
    | 仮想ネットワーク | 前のステップで作成した **myVNet** を選択します。 |
    | Subnet  | 前のステップで作成した **myBackendSubnet** を選択します。 |
    | IP アドレスの割り当て | **[動的]** を選択します。 |

3. 残りの設定は既定値をそのまま使用し、 **[確認と作成]** を選択します。

4. **[確認および作成]** タブで、 **[作成]** を選択します。   

    :::image type="content" source="./media/quickstart-load-balancer-standard-internal-portal/create-basic-internal-load-balancer.png" alt-text="標準の内部ロード バランサーを作成する" border="true":::

## <a name="create-load-balancer-resources"></a>ロード バランサーのリソースを作成する

このセクションでは、次の構成を行います。

* ロード バランサーのバックエンド アドレス プールの設定。
* 正常性プローブ。
* ロード バランサー規則。

### <a name="create-a-backend-pool"></a>バックエンド プールの作成

バックエンド アドレス プールには、ロード バランサーに接続された仮想 NIC の IP アドレスが含まれています。 

バックエンド アドレス プール **myBackendPool** を作成し、インターネット トラフィックを負荷分散するために仮想マシンを含めます。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。

2. **[設定]** で、 **[バックエンド プール]** 、 **[追加]** の順に選択します。

3. **[バックエンド プールの追加]** ページで、次を入力または選択します。
    
    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | 「**myBackendPool**」と入力します。 |
    | 仮想ネットワーク | **[myVNet]** を選択します。 |
    | 関連付け先 | **[仮想マシン]** を選択します |

4. **[追加]** を選択します。

### <a name="create-a-health-probe"></a>正常性プローブの作成

ロード バランサーは、正常性プローブを使用してアプリの状態を監視します。 

正常性プローブは、正常性チェックへの応答に基づいて、ロード バランサーに含める VM を追加したり削除したりします。 

**myHealthProbe** という正常性プローブを作成し、VM の正常性を監視します。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。

2. **[設定]** で、 **[正常性プローブ]** 、 **[追加]** の順に選択します。
    
    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | 「**myHealthProbe**」と入力します。 |
    | Protocol | **[HTTP]** を選択します。 |
    | Port | 「**80**」と入力します。|
    | Path | 「 **/** 」と入力します。 |
    | Interval | プローブの試行の**間隔**を示す秒数として、「**15**」を入力します。 |
    | 異常のしきい値 | **異常しきい値**またはプローブの連続する失敗の回数として **[2]** を選択します。この回数を超えると、VM は異常と見なされます。|

3. **[OK]** を選択します。

### <a name="create-a-load-balancer-rule"></a>ロード バランサー規則の作成

ロード バランサー規則の目的は、一連の VM に対するトラフィックの分散方法を定義することです。 着信トラフィック用のフロントエンド IP 構成と、トラフィックを受信するためのバックエンド IP プールを定義します。 送信元と送信先のポートは、この規則で定義します。 

このセクションでは、ロード バランサー規則を作成します。

* 「**myHTTPRule**」という名前を付けます。
* フロントエンドには、「**LoadBalancerFrontEnd**」という名前を付けます。
* **ポート 80** でリッスンします。
* 負荷分散されたトラフィックを、**ポート 80** の **myBackendPool** という名前のバックエンドに送信します。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。

2. **[設定]** で、 **[負荷分散規則]** 、 **[追加]** の順に選択します。

3. 負荷分散規則の構成には、以下の値を使用します。
    
    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | 「**myHTTPRule**」と入力します。 |
    | IP バージョン | **[IPv4]** を選択します |
    | フロントエンド IP アドレス | **[LoadBalancerFrontEnd]** を選択します |
    | Protocol | **[TCP]** を選択します。 |
    | Port | 「**80**」と入力します。|
    | バックエンド ポート | 「**80**」と入力します。 |
    | バックエンド プール | **[myBackendPool]** を選択します。|
    | 正常性プローブ | **[myHealthProbe]** を選択します。 |
 
4. 残りの部分は既定値のままにし、次に **[OK]** を選択します。

## <a name="create-backend-servers"></a>バックエンド サーバーの作成

このセクションでは、次の作業を行います。

* ロード バランサーのバックエンド プール用に 2 つの仮想マシンを作成します。
* 仮想マシンの可用性セットを作成します。
* 仮想マシンに IIS をインストールし、ロード バランサーをテストします。

### <a name="create-virtual-machines"></a>仮想マシンを作成する

パブリック IP の SKU とロード バランサーの SKU が一致している必要があります。 Basic ロード バランサーには、バックエンド プール内の Basic IP アドレスを持つ VM を使用します。 

このセクションでは、基本的なパブリック IP アドレスを使用して、2 つの VM (**myVM1** と **myVM2**) を作成します。  

2 つの VM は **myAvailabilitySet** という名前の可用性セットに追加します。

これらの VM を、前に作成したロード バランサーのバックエンド プールに追加します。

1. ポータルの左上で、 **[リソースの作成]**  >  **[Compute]**  >  **[仮想マシン]** を選択します。 
   
2. **[仮想マシンの作成]** の **[Basic]** タブに、値を入力するか選択します。

    | 設定 | 値                                          |
    |-----------------------|----------------------------------|
    | **プロジェクトの詳細** |  |
    | サブスクリプション | Azure サブスクリプションを選択します。 |
    | リソース グループ | **[myResourceGroupLB]** を選択します |
    | **インスタンスの詳細** |  |
    | 仮想マシン名 | 「**myVM1**」と入力します |
    | リージョン | **[西ヨーロッパ]** を選択します |
    | 可用性オプション | **[可用性セット]** を選択します |
    | 可用性セット | **[新規作成]** を選択します。 </br> **[名前]** に「**myAvailabilitySet**」と入力します。 </br> **[OK]** を選択します。 |
    | Image | **Windows Server 2019 Datacenter** |
    | Azure Spot インスタンス | **[いいえ]**  を選択します |
    | サイズ | VM サイズを選択するか、既定の設定を使用します |
    | **管理者アカウント** |  |
    | ユーザー名 | ユーザー名を入力します |
    | Password | [パスワード] を入力します |
    | [パスワードの確認入力] | パスワードを再入力します |

3. **[ネットワーク]** タブまたは **[次へ: ディスク]** を選択してから **[次へ: ネットワーク]** を選択します。
  
4. [ネットワーク] タブで、次を選択または入力します。

    | 設定 | 値 |
    |-|-|
    | **ネットワーク インターフェイス** |  |
    | 仮想ネットワーク | **[myVNet]** を選択します |
    | Subnet | **[myBackendSubnet]** を選択します |
    | パブリック IP | **[なし]** を選択します |
    | NIC ネットワーク セキュリティ グループ | **[Advanced] \(詳細設定)** を選択します|
    | ネットワーク セキュリティ グループを構成する | **[新規作成]** を選択します。 </br> **[ネットワーク セキュリティ グループの作成]** で、 **[名前]** に「**myNSG**」と入力します。 </br> **[OK]** を選択します。 |
    | **負荷分散**  |
    | この仮想マシンを既存の負荷分散ソリューションの後ろに配置しますか? | **[いいえ]**  を選択します |
 
5. **[管理]** タブまたは **[次へ]**  >  **[管理]** を選択します。

6. **[管理]** タブで、次を選択または入力します。
    
    | 設定 | 値 |
    |-|-|
    | **Monitoring** |  |
    | ブート診断 | **[オフ]** を選択します |

7. **[Review + create]\(レビュー + 作成\)** を選択します。 
  
8. 設定を確認し、 **[作成]** を選択します。

9. 手順 1 から 8 のようにして、次の値を持つ 1 つの追加の VM を作成します。他の設定はすべて **myVM1** と同じにします。

    | 設定 | VM 2 |
    | ------- | ----- |
    | 名前 |  **myVM2** |
    | 可用性セット| **[myAvailabilitySet]** を選択します |
    | ネットワーク セキュリティ グループ | 既存の **[myNSG]** を選択します|

### <a name="add-virtual-machines-to-the-backend-pool"></a>仮想マシンをバックエンド プールに追加する

前のステップで作成した VM を **myLoadBalancer** のバックエンドプールに追加する必要があります。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。

2. **[設定]** で、 **[バックエンド プール]** を選択し、**myBackendPool** を選択します。

3. **[関連付け先]** で **[仮想マシン]** を選択します。

4. **[仮想マシン]** セクションで、 **[+ 追加]** を選択します。

5. **myVM1** と **myVM2** の横にあるチェック ボックスをオンにします。

6. **[追加]** を選択します。

7. **[保存]** を選択します。
---

## <a name="create-test-virtual-machine"></a>テスト用の仮想マシンを作成する

このセクションでは、**myTestVM** という名前の VM を作成します。  この VM を使用して、ロード バランサーの構成をテストします。

1. ポータルの左上で、 **[リソースの作成]**  >  **[Compute]**  >  **[仮想マシン]** を選択します。 
   
2. **[仮想マシンの作成]** の **[Basic]** タブに、値を入力するか選択します。

    | 設定 | 値                                          |
    |-----------------------|----------------------------------|
    | **プロジェクトの詳細** |  |
    | サブスクリプション | Azure サブスクリプションを選択します。 |
    | リソース グループ | **[myResourceGroupLB]** を選択します |
    | **インスタンスの詳細** |  |
    | 仮想マシン名 | 「**myTestVM**」と入力します |
    | リージョン | **[西ヨーロッパ]** を選択します |
    | 可用性オプション | **[インフラストラクチャ冗長は必要ありません]** を選択します |
    | Image | **[Windows Server 2019 Datacenter]** を選択します |
    | Azure Spot インスタンス | **[いいえ]**  を選択します |
    | サイズ | VM サイズを選択するか、既定の設定を使用します |
    | **管理者アカウント** |  |
    | ユーザー名 | ユーザー名を入力します |
    | Password | [パスワード] を入力します |
    | [パスワードの確認入力] | パスワードを再入力します |

3. **[ネットワーク]** タブまたは **[次へ: ディスク]** を選択してから **[次へ: ネットワーク]** を選択します。
  
4. [ネットワーク] タブで、次を選択または入力します。

    | 設定 | 値 |
    |-|-|
    | **ネットワーク インターフェイス** |  |
    | 仮想ネットワーク | **myVNet** |
    | Subnet | **myBackendSubnet** |
    | パブリック IP | **[なし]** を選択します。 |
    | NIC ネットワーク セキュリティ グループ | **[Advanced] \(詳細設定)** を選択します|
    | ネットワーク セキュリティ グループを構成する | 前のステップで作成した **MyNSG** を選択します。|
    
5. **[管理]** タブまたは **[次へ]**  >  **[管理]** を選択します。

6. **[管理]** タブで、次を選択または入力します。
    
    | 設定 | 値 |
    |-|-|
    | **Monitoring** |  |
    | ブート診断 | **[オフ]** を選択します |
   
7. **[Review + create]\(レビュー + 作成\)** を選択します。 
  
8. 設定を確認し、 **[作成]** を選択します。

## <a name="install-iis"></a>IIS のインストール

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myResourceGroupLB]** リソース グループにある **[myVM1]** を選択します。

2. **[概要]** ページで **[接続]** 、 **[要塞]** の順に選択します。

4. VM 作成時に入力したユーザー名とパスワードを入力します。

5. **[接続]** を選択します。

6. サーバーのデスクトップで、 **[Windows 管理ツール]**  >  **[Windows PowerShell]** の順に移動します。

7. PowerShell ウィンドウで、次のコマンドを実行して以下の作業を行います。

    * IIS サーバーをインストールする
    * 既定の iisstart.htm ファイルを削除する
    * VM の名前が表示された新しい iisstart.htm ファイルを追加する。

   ```powershell
    
    # install IIS server role
    Install-WindowsFeature -name Web-Server -IncludeManagementTools
    
    # remove default htm file
     remove-item  C:\inetpub\wwwroot\iisstart.htm
    
    # Add a new htm file that displays server name
     Add-Content -Path "C:\inetpub\wwwroot\iisstart.htm" -Value $("Hello World from " + $env:computername)
   ```
8. **myVM1** との Bastion セッションを閉じます。

9. 手順 1 から 6 を繰り返して、IIS と更新済み iisstart.htm ファイルを **myVM2** にインストールします。


## <a name="test-the-load-balancer"></a>ロード バランサーをテストする

1. **[概要]** 画面で、ロード バランサーのプライベート IP アドレスを見つけます。 左側のメニューで **[すべてのサービス]** を選択し、 **[すべてのリソース]** を選択して、**myLoadBalancer** を選択します。

2. **myLoadBalancer** の **[概要]** で、 **[プライベート IP アドレス]** の横にあるアドレスを書き留めるか、コピーしておきます。

3. 左側のメニューで **[すべてのサービス]** を選択し、 **[すべてのリソース]** を選択して、リソースの一覧から **myResourceGroupLB** リソース グループにある **myTestVM** を選択します。

4. **[概要]** ページで **[接続]** 、 **[要塞]** の順に選択します。

6. VM 作成時に入力したユーザー名とパスワードを入力します。

7. **myTestVM** で **Internet Explorer** 開きます。

8. 前の手順の IP アドレスをブラウザーのアドレス バーに入力します。 IIS Web サーバーの既定のページがブラウザーに表示されます。

    :::image type="content" source="./media/quickstart-load-balancer-standard-internal-portal/load-balancer-test.png" alt-text="標準の内部ロード バランサーを作成する" border="true":::
   
ロード バランサーが 3 つの VM すべてにトラフィックを分散していることを確認するには、各 VM の IIS Web サーバーの既定のページをカスタマイズした後、クライアント マシンで Web ブラウザーを強制的に最新の情報に更新します。

## <a name="clean-up-resources"></a>リソースをクリーンアップする

リソース グループ、ロード バランサー、および関連するすべてのリソースは、不要になったら削除します。 これを行うには、リソースを含むリソース グループ (**myResourceGroupLB**) を選択し、 **[削除]** を選択します。

## <a name="next-steps"></a>次のステップ

このクイック スタートでは次の作業を行います。

* Azure の Standard または Basic の内部ロード バランサーを作成しました
* 2 つの VM をロード バランサーにアタッチしました。
* ロード バランサー トラフィック規則と正常性プローブを構成し、ロード バランサーをテストしました。 

Azure Load Balancer の詳細については、「[Azure Load Balancer の概要](load-balancer-overview.md)」および「[Load Balancer に関してよく寄せられる質問](load-balancer-faqs.md)」を参照してください。

* [Load Balancer と可用性ゾーン](load-balancer-standard-availability-zones.md)について理解を深めます。
* [Azure Bastion](https://docs.microsoft.com/azure/bastion/bastion-overview) について理解を深めます。
