---
title: ポータル内でのサービス管理
titleSuffix: Azure Cognitive Search
description: Azure portal を使用して、Microsoft Azure のホスト型クラウド検索サービスである Azure Cognitive Search サービスを管理します。
manager: nitinme
author: HeidiSteen
ms.author: heidist
tags: azure-portal
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 06/24/2020
ms.openlocfilehash: a623436cdeaac89d140b3834808fb975bd733f4e
ms.sourcegitcommit: 2ff0d073607bc746ffc638a84bb026d1705e543e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/06/2020
ms.locfileid: "87835954"
---
# <a name="service-administration-for-azure-cognitive-search-in-the-azure-portal"></a>Azure portal での Azure Cognitive Search のサービス管理

> [!div class="op_single_selector"]
>
> * [PowerShell](search-manage-powershell.md)
> * [REST API](https://docs.microsoft.com/rest/api/searchmanagement/)
> * [.NET SDK](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.search)
> * [ポータル](search-manage.md)
> * [Python](https://pypi.python.org/pypi/azure-mgmt-search/0.1.0)> 

Azure Cognitive Search は、高度な検索エクスペリエンスをカスタム アプリに組み込むために使用される、フル マネージドのクラウドベースの検索サービスです。 この記事では、既にプロビジョニング済みの検索サービスに対して [Azure portal](https://portal.azure.com) で実行できるサービス管理タスクについて説明します。 サービス管理は軽量設計で、次のタスクに限定されています。

* 中間ページの **[使用状況]** リンクを使用してストレージを確認します。
* 中間ページの **[監視]** リンクを使用してクエリの量と待機時間を調べ、要求がスロットルされたかどうかを確認します。
* 左側にある **[キー]** ページを使用してアクセスを管理します。
* 左側の **[スケール]** ページを使用して容量を調整します。

ポータルで実行されるのと同じタスクを、[管理 API](https://docs.microsoft.com/rest/api/searchmanagement/) や [Az.Search PowerShell モジュール](search-manage-powershell.md)を使用してプログラムで処理することもできます。 管理タスクは、ポータルとプログラマティック インターフェイスにわたって完全に表現されます。 1 つのモダリティでのみ使用できる特定の管理タスクはありません。

Azure Cognitive Search では、より詳細な監視と管理を行うために、他の Azure サービスを活用します。 検索サービス自体によって格納されるデータはコンテンツ (インデックス、インデクサーとデータ ソースの定義、およびその他のオブジェクト) だけです。 ポータルのページに報告が出力されるメトリックは、30 日のローリング サイクルで内部ログから取得されます。 ユーザーが制御するログのデータ保持とその他のイベントについては、[Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/) が必要になります。 

## <a name="fixed-service-properties"></a>固定サービスのプロパティ

検索サービスのいくつかの側面は、サービスがプロビジョニングされるときに決定され、後で変更することができません。

* サービス名 (サービスの名前は変更できません)
* サービスの場所 (元のままのサービスを別のリージョンに移動することはできません)
* レプリカとパーティションの最大数 (Basic または Standard のサービス レベルによって決まります)

Basic で最大数である 1 つのパーティションを使用して開始し、より多くのパーティションが必要になった場合は、上位のサービス レベルで[新しいサービス](search-create-service-portal.md)を作成し、その新しいサービス上にコンテンツを再作成する必要があります。 

## <a name="administrator-rights"></a>管理者権限

サービス自体のプロビジョニングまたは使用停止は、Azure サブスクリプションの管理者または共同管理者が実行できます。

エンドポイントへのアクセスに関しては、サービス URL と API キーへのアクセスを持つすべてのユーザーがコンテンツにアクセスできます。 キーの詳細については、[API キーの管理](search-security-api-keys.md)に関するページを参照してください。

* サービスに対する読み取り専用アクセスがクエリの権限で、通常は、URL とクエリ API キーを与えることによってクライアント アプリケーションに付与されます。
* 読み取り/書き込みアクセスでは、API キー、インデックス、インデクサー、データ ソース、スケジュールを含むサーバー オブジェクトを追加、削除、または変更する機能が提供されます。URL と管理 API キーを与えることによって、読み取り/書き込みアクセスが付与されます。

サービスのプロビジョニング装置に対する権限は、ロールの割り当てを通して付与されます。 [Azure ロール ベースのアクセス制御 (Azure RBAC)](../role-based-access-control/overview.md) は、Azure リソースをプロビジョニングするために [Azure Resource Manager](../azure-resource-manager/management/overview.md) 上に構築された承認システムです。 

Azure Cognitive Search のコンテキストでは、[ポータル](search-manage.md)、[PowerShell](search-manage-powershell.md)、[管理 REST API](https://docs.microsoft.com/rest/api/searchmanagement/search-howto-management-rest-api) のうちどれを使用しているかとは無関係に、[Azure ロールの割り当て](search-security-rbac.md)によって、タスクを実行できるユーザーが決定されます。

* サービスの作成または削除
* サービスのスケーリング
* API キーの削除または再生成
* 診断ログの有効化 (サービスの作成)
* トラフィック分析の有効化 (サービスの作成)

> [!TIP]
> Azure 全体のメカニズムを使用して、サブスクリプションまたはリソースをロックし、管理者権限を持つユーザーが検索サービスを誤って、または許可なく削除しないようにすることができます。 詳細については、[リソースのロックによる予期せぬ削除の防止](../azure-resource-manager/management/lock-resources.md)に関するページを参照してください。

## <a name="logging-and-system-information"></a>ログとシステム情報

Basic レベル以上では、サービス レベル アグリーメント (SLA) に従って、すべての Azure Cognitive Search サービスが 99.9% の可用性を実現するようにマイクロソフトによって監視されます。 サービスの速度が低下した場合や、要求のスループットが SLA のしきい値を下回った場合は、サポート チームが利用可能なログ ファイルを確認して問題に対処します。

Azure Cognitive Search では、[Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/) を活用し、インデックス作成とクエリのアクティビティを収集して格納します。 検索サービス自体では、そのコンテンツ (インデックス、インデクサー定義、データ ソース定義、スキルセット定義、シノニム マップ) だけが格納されます。 キャッシュ情報とログに記録された情報は、多くの場合、Azure Storage アカウントに格納されます。 インデックス作成とクエリのワークロードをログに記録することの詳細については、[ログ データの収集と分析](search-monitor-logs.md)に関するページを参照してください。

サービスに関する一般的な情報については、Azure Cognitive Search に組み込まれている機能だけを使用して、以下の方法で情報を取得できます。

* サービスの **[概要]** ページを使用し、通知、プロパティ、およびステータス メッセージを通して。
* [PowerShell](search-manage-powershell.md) または[管理 REST API](https://docs.microsoft.com/rest/api/searchmanagement/) を使用し、[サービスのプロパティを取得する](https://docs.microsoft.com/rest/api/searchmanagement/services)。 プログラム階層で提供される新しい情報や操作はありません。 スクリプトを記述できるようにインターフェイスが存在します。

## <a name="monitor-resource-usage"></a>リソース使用量を監視する

ダッシュボードでは、リソース監視が、サービス ダッシュボードに表示される情報と、サービスのクエリで取得できるいくつかのメトリックに限定されます。 サービス ダッシュボードの [使用] セクションで、パーティション リソース レベルが自分のアプリケーションに適しているかどうかをすばやく決定できます。 ログに記録されたイベントをキャプチャして保持する必要がある場合は、Azure 監視などの外部のリソースをプロビジョニングできます。 詳細については、[Azure Cognitive Search の監視](search-monitor-usage.md)に関するページをご覧ください。

検索サービス REST API を使用して、プログラムでドキュメントとインデックスの数を取得できます。 

* [インデックス統計の取得](https://docs.microsoft.com/rest/api/searchservice/Get-Index-Statistics)
* [ドキュメントのカウント](https://docs.microsoft.com/rest/api/searchservice/count-documents)

## <a name="disaster-recovery-and-service-outages"></a>障害復旧とサービスの停止

Microsoft はユーザーのデータを回収できますが、Azure Cognitive Search では、クラスターまたはデータ センターのレベルで障害が発生した場合のサービスの即時フェールオーバーは提供されません。 データ センターでクラスターの障害が発生した場合、運用チームは障害を検出してサービスの復元を行います。 サービスの復元中にダウンタイムが発生しますが、[サービス レベル アグリーメント (SLA)](https://azure.microsoft.com/support/legal/sla/search/v1_0/) に従い、サービス使用不可に対する補償としてサービス クレジットを要求できます。 

Microsoft の管理が及ばない外部の壊滅的災害の際にサービスを継続する必要がある場合は、異なるリージョンに[追加のサービスをプロビジョニング](search-create-service-portal.md)し、geo レプリケーション戦略を導入して、インデックスがすべてのサービスで完全に冗長になるようにする必要があります。

インデックスの作成と更新に[インデクサー](search-indexer-overview.md)を使っているお客様は、同じデータ ソースを利用する geo 固有のインデクサーによってディザスター リカバリーを処理できます。 異なるリージョンにある 2 つのサービスそれぞれでインデクサーを実行し、同じデータ ソースのインデックスを作成すると、geo 冗長性を実現できます。 geo 冗長性も備えたデータ ソースからインデックスを作成する場合、Azure Cognitive Search インデクサーは、プライマリ レプリカからの (新規、変更、または削除されたドキュメントの更新をマージする) 増分インデックスの作成のみを実行できることに注意してください。 フェールオーバー イベントでは、新しいプライマリ レプリカをポイントするように再度インデクサーを設定してください。 

インデクサーを使用しない場合は、アプリケーションのコードを使ってオブジェクトとデータを異なる検索サービスに並列にプッシュします。 詳細については、[Azure Cognitive Search のパフォーマンスと最適化](search-performance-optimization.md)に関する記事をご覧ください。

## <a name="backup-and-restore"></a>バックアップと復元

Azure Cognitive Search は主要なデータ ストレージ ソリューションではないため、セルフサービスのバックアップと復元のための正式なメカニズムは提供されません。 ただし、こちらの [Azure Cognitive Search .NET サンプル リポジトリ](https://github.com/Azure-Samples/azure-search-dotnet-samples)の **index-backup-restore** サンプル コードを使用して、インデックス定義とインデックス スナップショットを一連の JSON ファイルにバックアップし、後で必要に応じて、これらのファイルを使用してインデックスを復元できます。 このツールを使用して、サービス レベル間でインデックスを移動することもできます。

そうしない場合は、インデックスの作成と設定に使われるアプリケーション コードが、誤ってインデックスを削除した場合の事実上の復元オプションです。 インデックスを再構築するには、インデックスを削除し (存在する場合)、サービスでインデックスを再作成して、プライマリ データ ストアからデータを取得することによって再読み込みします。

## <a name="scale-up-or-down"></a>拡大または縮小

すべての検索サービスは、最小限の 1 つのレプリカと 1 つのパーティションで開始されます。 [より多くの容量をサポートするサービス レベル](search-limits-quotas-capacity.md)にサインアップした場合は、左側のナビゲーション ウィンドウで **[スケール]** をクリックしてリソースの使用を調整します。

いずれかのリソースで容量を追加すると、サービスで自動的に使用されます。 それ以外のアクションは必要ありませんが、新しいリソースの影響が現れるまでわずかに遅延が発生します。 追加のリソースのプロビジョニングには 15 分以上かかる場合があります。

### <a name="add-replicas"></a>レプリカの追加

1 秒あたりのクエリ (QPS) の増加や高可用性の実現は、レプリカの追加により達成できます。 各レプリカにはインデックスのコピーが 1 つあるため、レプリカを 1 つ追加することは、サービス クエリ要求の処理に使用できるインデックスを 1 つ追加することです。 高可用性を実現するには少なくとも 3 つのレプリカが必要です (詳細については、[容量の調整](search-capacity-planning.md)に関するページを参照してください)。

より多くのレプリカを持つ検索サービスでは、より多くのインデックスに対してクエリ要求を負荷分散できます。 特定のクエリの数量のレベルで、要求のサービスで利用できるインデックスのコピーが多いほど、クエリ スループットはより高速になります。 クエリの遅延が発生した場合は、追加のレプリカをオンラインにすることでパフォーマンスへの良い影響を期待できます。

レプリカを追加するとクエリのスループットは向上しますが、サービスにレプリカを追加することにより厳密に 2 倍や 3 倍になるわけではありません。 すべての検索アプリケーションは、クエリ パフォーマンスに影響を与える外部要因の影響を受けます。 クエリの応答時間を変動させる 2 つの要因として、複雑なクエリおよびネットワークの遅延があります。

### <a name="add-partitions"></a>パーティションの追加

より一般的なのはレプリカを追加することですが、ストレージが制限されている場合は、パーティションを追加してより多くの容量を取得できます。 サービスをプロビジョニングしたサービス レベルによって、パーティションを追加できるかどうかが決まります。 Basic サービス レベルは、1 つのパーティションでロックされています。 Standard サービス レベル以上では、追加のパーティションがサポートされています。

パーティションは 12 の約数 (具体的には、1、2、3、4、6、12) で追加されます。 これは、シャーディングのアーティファクトです。 インデックスは 12 個のシャードで作成され、これらはすべて 1 個のパーティションまたは均等に 2、3、4、6、12 個のパーティションに格納されます (パーティションごとに 1 つのシャード)。

### <a name="remove-replicas"></a>レプリカの削除

クエリの数量が多い期間の後 (たとえば、休日のセールの終了後)、検索クエリの負荷が正常化したら、スライダーを使用してレプリカを減らすことができます。 それ以外の手順は必要ありません。 レプリカの数を減らすと、データ センター内の仮想マシンが解放されます。 クエリとデータ インジェストの操作は、以前よりも少ない数の VM で実行されます。 レプリカの最小要件は 1 つです。

### <a name="remove-partitions"></a>パーティションの削除

追加の手順を必要としないレプリカの削除に比べ、削除できる量よりも多くのストレージを使用している場合の手順は少し複雑です。 たとえば、3 つのパーティションを使用しているソリューションでは、パーティションを 1 つまたは 2 つに減らすと、新しいストレージ領域がインデックスのホストに必要な量よりも少ない場合にエラーが発生します。 ご推察のとおり、その場合はインデックスまたは関連付けられたインデックス内のドキュメントを削減して領域を解放するか、現在の構成を維持するかを選択できます。

特定のパーティションにどのインデックス シャードが格納されているかを検出する方法はありません。 各パーティションで約 25 GB のストレージが提供されるため、現在のパーティションの数で対応できるサイズまでストレージを削減する必要があります。 1 つのパーティションに戻す場合は、12 個のシャードをすべて収める必要があります。

将来の計画を立てるには、ストレージをチェックして (「 [Get Index Statistics (Azure Search API) (インデックス統計の取得 (Azure Search API))](https://docs.microsoft.com/rest/api/searchservice/Get-Index-Statistics)」を使用) 実際にどのくらい使用したかを確認します。 

## <a name="next-steps"></a>次のステップ

* [PowerShell](search-manage-powershell.md) で自動化する

* [パフォーマンスと最適化](search-performance-optimization.md)に関する手法を確認する

* コンテンツと操作を保護するための[セキュリティ機能](search-security-overview.md)を確認する

* [診断ログ](search-monitor-logs.md)を有効にしてクエリとインデックス作成のワークロードを監視する
