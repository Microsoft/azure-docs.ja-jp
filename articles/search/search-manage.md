---
title: "Azure Portal での Azure Search のサービス管理"
description: "Azure Portal を使用して、Microsoft Azure のホスト型クラウド検索サービスである Azure Search を管理します。"
services: search
documentationcenter: 
author: HeidiSteen
manager: jhubbard
editor: 
tags: azure-portal
ms.assetid: c87d1fdd-b3b8-4702-a753-6d7e29dbe0a2
ms.service: search
ms.devlang: rest-api
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 06/18/2017
ms.author: heidist
ms.translationtype: Human Translation
ms.sourcegitcommit: 7948c99b7b60d77a927743c7869d74147634ddbf
ms.openlocfilehash: c293de5b43103c8cbec01f61a26b8b28ac7e9116
ms.contentlocale: ja-jp
ms.lasthandoff: 06/20/2017


---
# <a name="service-administration-for-azure-search-in-the-azure-portal"></a>Azure Portal での Azure Search のサービス管理
> [!div class="op_single_selector"]
> * [ポータル](search-manage.md)
> * [PowerShell](search-manage-powershell.md)
> * [.NET SDK](https://docs.microsoft.com/dotnet/api/microsoft.azure.management.search)
> * [Python](https://pypi.python.org/pypi/azure-mgmt-search/0.1.0)> 

Azure Search は、高度な検索エクスペリエンスをカスタムアプリに組み込むために使用される、完全に管理されたクラウドベースの検索サービスです。 この記事では、既にプロビジョニング済みの検索サービスに対して *Azure Portal* で実行できる " [サービス管理](https://portal.azure.com) " タスクについて説明します。 *Service administration* " は軽量設計で、次のタスクに限定されています。

* サービスへの読み取り/書き込みアクセスに使用される " *API キー* " を管理およびセキュリティ保護する。
* パーティションとレプリカの割り当てを変更することにより、サービスの容量を調整する。
* リソース使用量をサービス レベルの上限と比較して監視する。

**この記事で扱わない内容** 

*コンテンツ管理* " (インデックス管理) とは、クエリの量を把握し、ユーザーが検索した語句と検索結果からインデックス内の特定ドキュメントへの顧客誘導がどの程度成功しているかを調べるための、検索トラフィックの分析などの操作を指します。 この領域のヘルプについては、[Azure Search の検索トラフィックの分析](search-traffic-analytics.md)に関するページを参照してください。

*クエリのパフォーマンス* " も、この記事では取り扱いません。 詳細については、「[Azure Search サービスでの使用状況と統計の監視](search-monitor-usage.md)と「[Azure Search のパフォーマンスと最適化に関する考慮事項](search-performance-optimization.md)を参照してください。

"*アップグレード*" は管理タスクではありません。 リソースはサービスがプロビジョニングされたときに割り当てられるため、別のレベルに移動するには新しいサービスが必要です。 詳細については、[Azure Search サービスの作成](search-create-service-portal.md)に関するページを参照してください。

<a id="admin-rights"></a>

## <a name="administrator-rights"></a>管理者権限
サービス自体のプロビジョニングまたは使用停止は、Azure サブスクリプションの管理者または共同管理者が実行できます。

サービス内では、サービスの URL と管理 API キーにアクセスできるすべてのユーザーがサービスへの読み取り/書き込みアクセス権を持ちます。 読み取り/書き込みアクセス権は、[RBAC で定義されたロール](#rbac)によって実装されるサーバー オブジェクト (API キー、インデックス、インデクサー、データ ソース、スケジュール、ロール割り当てなど) の追加、削除、変更の権限を提供します。

Azure Search に対するすべてのユーザー操作は、サービスへの読み取り/書き込みアクセス (管理者権限) か、またはサービスへの読み取り専用アクセス (クエリ権限) のいずれかのモードに分類されます。 詳細については、「 [API キーを管理する](#manage-keys)」をご覧ください。

<a id="sys-info"></a>

## <a name="set-rbac-roles-for-administrative-access"></a>管理アクセス用の RBAC ロールを設定する
Azure では、ポータルまたはリソース マネージャー API で管理するすべてのサービスに対して、 [グローバルなロールベースの承認モデル](../active-directory/role-based-access-control-configure.md) を用意しています。 所有者、共同作成者、および閲覧者のロールによって、各ロールに割り当てられる Active Directory のユーザー、グループ、およびセキュリティ プリンシパルに対するサービス管理レベルが決まります。 

Azure Search の場合、RBAC のアクセス許可によって次の管理タスクが決まります。

| 役割 | タスク |
| --- | --- |
| 所有者 |API キー、インデックス、インデクサー、インデクサー データ ソース、インデクサー スケジュールなど、サービス上のサービスやオブジェクトを作成または削除します。<p>カウントとストレージ サイズなど、サービスの状態を表示します。<p>ロール メンバーシップを追加または削除します (所有者のみがロール メンバーシップを管理できます)。<p>サブスクリプション管理者とサービス所有者には、所有者ロールに自動メンバーシップがあります。 |
| 共同作成者 |RBAC ロール管理を除き、アクセス レベルは所有者と同じです。 たとえば、共同作成者は `api-key`を再生成できますが、ロール メンバーシップは変更できません。 |
| 閲覧者 |サービスの状態とクエリのキーを表示します。 このロールのメンバーは、サービス構成の変更ができず、管理キーの表示もできません。 |

ロールは、サービス エンドポイントへのアクセス権を付与しません。 インデックスの管理、インデックスの作成、検索データのクエリなど、検索サービスの操作は、ロールではなく API キーによって制御されます。 詳細については、「 [What is Role-based access control](../active-directory/role-based-access-control-what-is.md)」(ロールベースのアクセス制御とは) の「Authorization for management versus data operations」(管理用の承認とデータ操作) をご覧ください。

<a id="secure-keys"></a>
## <a name="logging-and-system-information"></a>ログとシステム情報
Azure Search は、ポータルまたはプログラム インターフェイスを通じて個々のサービスのログ ファイルを公開しません。 Basic レベル以上では、サービス レベル アグリーメント (SLA) に従って、すべての Azure Search サービスが 99.9% の可用性を実現するようにマイクロソフトによって監視されます。 サービスの速度が低下した場合や、要求のスループットが SLA のしきい値を下回った場合は、サポート チームが利用可能なログ ファイルを確認して問題に対処します。

サービスに関する一般的な情報は、以下の方法で入手できます。

* ポータルのサービス ダッシュボードで、プロパティ、およびステータス メッセージを確認する。
* [PowerShell](search-manage-powershell.md) または[管理 REST API](https://docs.microsoft.com/rest/api/searchmanagement/) を使用して[サービスのプロパティを取得](https://docs.microsoft.com/rest/api/searchmanagement/services)するか、インデックス リソース使用率のステータスを確認する。
* 既に説明したように、 [検索トラフィックの分析](search-traffic-analytics.md)を使用する。

<a id="manage-keys"></a>

## <a name="manage-api-keys"></a>API キーを管理する
Search サービスへのすべての HTTP 要求には、対象のサービス用に生成された API キーが必要です。 この API キーは、その Search サービス エンドポイントへのアクセスを認証するための唯一のメカニズムです。 

API キーは、ランダムに生成された数字と文字から成る文字列です。 [RBAC アクセス許可](#rbac)を通じてこのキーを削除したり、読み取ったりすることはできますが、キーをユーザー定義のパスワードに置き換えることはできません。 

検索サービスへのアクセスには 2 種類のキーが使用されます。

* 管理 (サービスに対するすべての読み取り/書き込み操作に有効)
* クエリ (インデックスに対するクエリなどの読み取り専用操作に有効)

管理 API キーは、サービスのプロビジョニング時に作成されます。 2 つの管理キーがあり、区別するために "*プライマリ*" と "*セカンダリ*" と呼ばれますが、これらは実際には交換可能です。 各サービスが 2 つの管理キーを持つため、サービスにアクセスしたままで一方のキーをロールオーバーできます。 どちらの管理キーも再生成できますが、管理キーの合計数は追加できません。 Search サービスごとに最大 2 個の管理キーがあります。

クエリ キーは、Search を直接呼び出すクライアント アプリケーション向けに設計されています。 クエリ キーは最大 50 個まで作成できます。 アプリケーション コードでは、サービスへの読み取り専用アクセスを許可するために検索の URL とクエリ API キーを指定します。 また、アプリケーション コードでは、アプリケーションで使用されるインデックスも指定します。 エンドポイント、読み取り専用アクセスのための API キー、およびターゲット インデックスの組み合わせにより、クライアント アプリケーションからの接続のスコープとアクセス レベルが定義されます。

API キーを取得または再生成するには、サービス ダッシュボードを開きます。 **[キー]** をクリックし、キー管理ページを開きます。 キーの再生成または作成のコマンドがページ上部にあります。 既定では、管理キーのみが作成されます。 クエリ API キーは手動で作成する必要があります。

 ![][9]

<a id="rbac"></a>

## <a name="secure-api-keys"></a>API キーをセキュリティ保護する
キーのセキュリティは、ポータルまたはリソース マネージャーのインターフェイス (PowerShell またはコマンドライン インターフェイス) でアクセスを制限することによって確保されます。 前述のように、サブスクリプションの管理者はすべての API キーを表示および再生成できます。 用心のために、ロールの割り当てを調べて、管理キーへのアクセス権を持つユーザーを確認してください。

1. サービスのダッシュボードで、[アクセス] アイコンをクリックして [ユーザー] ブレードを開きます。
   ![][7]
2. [ユーザー] で、既存のロールの割り当てを確認します。 想定したとおりに、サブスクリプション管理者が所有者ロールによってサービスへのフル アクセス許可を付与されています。
3. さらにドリルダウンするには、 **サブスクリプション管理者** をクリックしてロールの割り当てリストを展開し、Search サービスの共同管理者権限を持つユーザーを確認します。

アクセス許可を表示するもう 1 つの方法は、[ユーザー] ブレードで **[ロール]** をクリックすることです。 これにより、使用可能なロールと、各ロールに割り当てられているユーザーまたはグループの数が表示されます。

<a id="sub-5"></a>

## <a name="monitor-resource-usage"></a>リソース使用量を監視する
ダッシュボードでは、リソース監視が、サービス ダッシュボードに表示される情報と、サービスのクエリで取得できるいくつかのメトリックに限定されます。 サービス ダッシュボードの [使用] セクションで、パーティション リソース レベルが自分のアプリケーションに適しているかどうかをすばやく決定できます。

Search Service API を使用して、ドキュメントとインデックスの数を取得できます。 価格レベルに基づいて、これらの数に関連付けられたハードウェアの制限があります。 詳細については、 [Search サービスの制限](search-limits-quotas-capacity.md)に関する記事をご覧ください。 

* [インデックス統計の取得](https://docs.microsoft.com/rest/api/searchservice/Get-Index-Statistics)
* [ドキュメントのカウント](https://docs.microsoft.com/rest/api/searchservice/count-documents)

> [!NOTE]
> キャッシング動作により、一時的に制限を超える場合があります。 たとえば、共有サービスの使用時に、ドキュメント数がハードウェアの制限である 10,000 個を超える場合があります。 この超過は一時的であり、次の制限強制チェックで検出されます。 
> 
> 

## <a name="disaster-recovery-and-service-outages"></a>障害復旧とサービスの停止

Microsoft はユーザーのデータを回収できますが、Azure Search では、クラスターまたはデータ センターのレベルで障害が発生した場合のサービスの即時フェールオーバーは提供されません。 データ センターでクラスターの障害が発生した場合、運用チームは障害を検出してサービスの復元を行います。 サービスの復元中にダウンタイムが発生します。 ユーザーは、[サービス レベル アグリーメント (SLA)](https://azure.microsoft.com/support/legal/sla/search/v1_0/) に従い、サービス使用不可に対する補償としてサービス クレジットを要求できます。 

Microsoft の管理が及ばない外部の壊滅的災害の際にサービスを継続する必要がある場合は、異なるリージョンに[追加のサービスをプロビジョニング](search-create-service-portal.md)し、geo レプリケーション戦略を導入して、インデックスがすべてのサービスで完全に冗長になるようにする必要があります。

インデックスの作成と更新に[インデクサー](search-indexer-overview.md)を使っているお客様は、同じデータ ソースを利用する geo 固有のインデクサーによってディザスター リカバリーを処理できます。 別々のリージョンにある 2 つのサービスそれぞれでインデクサーを実行し、同じデータ ソースからインデックスを作成すると、geo 冗長性を実現できます。 geo 冗長性も備えたデータ ソースからインデックスを作成する場合、Azure Search インデクサーは、プライマリ レプリカからの増分インデックス作成のみを実行できることに注意してください。 フェールオーバー イベントでは、新しいプライマリ レプリカをポイントするように再度インデクサーを設定してください。 

インデクサーを使用しない場合は、アプリケーションのコードを使ってオブジェクトとデータを異なる検索サービスに並列にプッシュします。 詳細については、「 [Performance and optimization in Azure Search](search-performance-optimization.md)」(Azure Search のパフォーマンスと最適化) をご覧ください。

## <a name="backup-and-restore"></a>バックアップと復元

Azure Search は主要なデータ ストレージ ソリューションではないため、セルフサービスのバックアップと復元のための正式なメカニズムは提供されません。 インデックスの作成と設定に使われるアプリケーション コードが、誤ってインデックスを削除した場合の事実上の復元オプションです。 

インデックスを再構築するには、インデックスを削除し (存在する場合)、サービスでインデックスを再作成して、プライマリ データ ストアからデータを取得することによって再読み込みします。 または、地域的障害がある場合は、[カスタマー サポート]()にインデックスの復旧を依頼できます。


<a id="scale"></a>

## <a name="scale-up-or-down"></a>拡大または縮小
すべての検索サービスは、最小限の 1 つのレプリカと 1 つのパーティションで開始されます。 [専用リソースを提供するレベル](search-limits-quotas-capacity.md)にサインアップしている場合は、サービス ダッシュボードの **[スケール]** タイルをクリックし、リソースの使用状況を調整します。

いずれかのリソースで容量を追加すると、サービスで自動的に使用されます。 それ以外のアクションは必要ありませんが、新しいリソースの影響が現れるまでわずかに遅延が発生します。 追加のリソースのプロビジョニングには 15 分以上かかる場合があります。

 ![][10]

### <a name="add-replicas"></a>レプリカの追加
1 秒あたりのクエリ (QPS) の増加や高可用性の実現は、レプリカの追加により達成できます。 各レプリカにはインデックスのコピーが 1 つあるため、レプリカを 1 つ追加することは、サービス クエリ要求の処理に使用できるインデックスを 1 つ追加することです。 高可用性を実現するには少なくとも 3 つのレプリカが必要です (詳細については、「 [Capacity Planning](search-capacity-planning.md) 」(容量計画) をご覧ください。

より多くのレプリカを持つ検索サービスでは、より多くのインデックスに対してクエリ要求を負荷分散できます。 特定のクエリの数量のレベルで、要求のサービスで利用できるインデックスのコピーが多いほど、クエリ スループットはより高速になります。 クエリの遅延が発生した場合は、追加のレプリカをオンラインにすることでパフォーマンスへの良い影響を期待できます。

レプリカを追加するとクエリのスループットは向上しますが、サービスにレプリカを追加することにより厳密に 2 倍や 3 倍になるわけではありません。 すべての検索アプリケーションは、クエリ パフォーマンスに影響を与える外部要因の影響を受けます。 クエリの応答時間を変動させる 2 つの要因として、複雑なクエリおよびネットワークの遅延があります。

### <a name="add-partitions"></a>パーティションの追加
ほとんどのサービス アプリケーションには、パーティション数ではなくレプリカ数の増加への固有のニーズがあります。 ドキュメント数を増やす必要がある場合、Standard サービスにサインアップしていればパーティションを追加できます。 Basic レベルでは、パーティションは追加できません。

Standard レベルでは、パーティションが 12 の倍数単位 (具体的には、1、2、3、4、6、12) で追加されます。 これは、シャーディングのアーティファクトです。 インデックスは 12 個のシャードで作成され、これらはすべて 1 個のパーティションまたは均等に 2、3、4、6、12 個のパーティションに格納されます (パーティションごとに 1 つのシャード)。

### <a name="remove-replicas"></a>レプリカの削除
クエリの数量が多い期間の後 (たとえば、休日のセールの終了後) には、ほとんどの場合、検索クエリの負荷が正常化したらレプリカを減らすことができます。

そのためには、レプリカ スライダーを少ない数の方に動かします。 それ以外の手順は必要ありません。 レプリカの数を減らすと、データ センター内の仮想マシンが解放されます。 クエリとデータ インジェストの操作は、以前よりも少ない数の VM で実行されます。 最小数は 1 つのレプリカです。

### <a name="remove-partitions"></a>パーティションの削除
追加の手順を必要としないレプリカの削除に比べ、削除できる量よりも多くのストレージを使用している場合の手順は少し複雑です。 たとえば、3 つのパーティションを使用しているソリューションでは、パーティションを 1 つまたは 2 つに減らすと、新しいストレージが必要な量よりも少ない場合はエラーが生成されます。 ご推察のとおり、その場合はインデックスまたは関連付けられたインデックス内のドキュメントを削減して領域を解放するか、現在の構成を維持するかを選択できます。

特定のパーティションにどのインデックス シャードが格納されているかを検出する方法はありません。 各パーティションで約 25 GB のストレージが提供されるため、現在のパーティションの数で対応できるサイズまでストレージを削減する必要があります。 1 つのパーティションに戻す場合は、12 個のシャードをすべて収める必要があります。

将来の計画を立てるには、ストレージをチェックして (「 [Get Index Statistics (Azure Search API) (インデックス統計の取得 (Azure Search API))](https://docs.microsoft.com/rest/api/searchservice/Get-Index-Statistics)」を使用) 実際にどのくらい使用したかを確認します。 

<a id="advanced-deployment"></a>

## <a name="best-practices-on-scale-and-deployment"></a>スケールとデプロイメントに関するベスト プラクティス
この 30 分間のビデオでは、地理的に分散したワークロードを含む、高度なデプロイメント シナリオのベスト プラクティスを確認します。 同じ点を説明したヘルプ ページとして、「 [Performance and optimization in Azure Search](search-performance-optimization.md) 」(Azure Search のパフォーマンスと最適化) もご覧ください。

> [!VIDEO https://channel9.msdn.com/Events/Microsoft-Azure/AzureCon-2015/ACON319/player]
> 
> 

<a id="next-steps"></a>

## <a name="next-steps"></a>次のステップ
サービス管理の背後にある概念を把握できたら、[PowerShell](search-manage-powershell.md) を使ってタスクを自動化することを検討してください。

また、[パフォーマンスと最適化の記事](search-performance-optimization.md)を確認することをお勧めします。

さらに、前のセクションで紹介したビデオを見ることもお勧めします。 ビデオでは、このセクションで触れたテクニックが詳しく説明されています。

<!--Image references-->
[7]: ./media/search-manage/rbac-icon.png
[8]: ./media/search-manage/Azure-Search-Manage-1-URL.png
[9]: ./media/search-manage/Azure-Search-Manage-2-Keys.png
[10]: ./media/search-manage/Azure-Search-Manage-3-ScaleUp.png




