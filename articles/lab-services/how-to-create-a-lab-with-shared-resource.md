---
title: 共有リソースを使用してラボを作成する方法 | Azure Lab Services
description: 学生間で共有されるリソースを必要とするラボを作成する方法について説明します。
author: emaher
ms.topic: article
ms.date: 06/26/2020
ms.author: enewman
ms.openlocfilehash: 9cb5698f95aa220208fb02a35a52ff5363a173ac
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/02/2020
ms.locfileid: "85443368"
---
# <a name="how-to-create-a-lab-with-a-shared-resource-in-azure-lab-services"></a>Azure Lab Services で共有リソースを使用してラボを作成する方法

クラスルーム ラボを作成するとき、一部のリソースをラボ内のすべての学生間で共有することが必要な場合があります。  たとえば、データベース クラス用のライセンス サーバーや SQL Server などです。  この記事では、ラボ用に共有リソースを有効にする手順について説明します。  また、その共有リソースへのアクセスを制限する方法についても説明します。

## <a name="architecture"></a>アーキテクチャ

次の図に示すように、ラボにはラボ アカウントがあります。  ラボ アカウントには、VNET ピアリングの設定があります。これにより、ラボの仮想ネットワークは共有リソースのネットワークに接続されます。  次の図では、IP 範囲が重複していない 2 つの仮想ネットワークが示されています。  これらの IP 範囲は単なる例です。  また、共有リソースの仮想ネットワークがラボ アカウントと同じサブスクリプションにあることも注意してください。

![Lab Services と共有リソース アーキテクチャ](./media/how-to-create-a-lab-with-shared-resource/shared-resource-architecture.png)

## <a name="setup-shared-resource"></a>共有リソースをセットアップする

共有リソース用の仮想ネットワークは、ラボを作成する前に作成する必要があります。  仮想ネットワークの作成方法の詳細については、[仮想ネットワークの作成](../virtual-network/quick-create-portal.md)に関する記事を参照してください。  ラボのコンピューターの IP アドレスと重複しないように、仮想ネットワークの範囲を計画することが重要です。  ネットワークの計画の詳細については、「[仮想ネットワークを計画する](../virtual-network/virtual-network-vnet-plan-design-arm.md)」の記事を参照してください。 この例の共有リソースは、10.2.0.0/16 の範囲の仮想ネットワーク内にあります。  まだ行っていない場合は、共有リソースを保持するための[サブネットを作成](../virtual-network/virtual-network-manage-subnet.md#add-a-subnet)します。  この例では、10.2.0.0/24 の範囲を使用しますが、ネットワークのニーズによって範囲は異なる場合があります。

共有リソースとしては、仮想マシン上で実行されているソフトウェアや、Azure によって提供されるサービスなどがあります。 共有リソースは、プライベート IP アドレスを通して使用できる必要があります。  共有リソースをプライベート IP のみで使用できるようにすると、その共有リソースへのアクセスが制限されます。

図では、学生の VM からのトラフィックを制限するために使用できるネットワーク セキュリティ グループ (NSG) も示されています。  たとえば、学生の VM の IP アドレスからのトラフィックは 1 つの共有リソースにしかアクセスできないことを示すセキュリティ規則を作成できます。  セキュリティ規則の設定方法の詳細については、[ネットワーク セキュリティ グループの管理](../virtual-network/manage-network-security-group.md#work-with-security-rules)に関する記事を参照してください。 共有リソースへのアクセスを特定のラボに制限したい場合は、[ラボ アカウントのラボ設定](manage-labs.md#view-labs-in-a-lab-account)からラボの IP アドレスを取得し、その IP アドレスからのアクセスのみを許可する受信規則を設定します。  その IP アドレスに対してポート 49152 から 65535 を許可することを忘れないでください。  必要に応じて、[[仮想マシン プール] ページ](how-to-set-virtual-machine-passwords.md)を使用して、学生の VM のプライベート IP アドレスを見つけることができます。

共有リソースが、必要なソフトウェアを実行している Azure 仮想マシンである場合は、仮想マシンに対する既定のファイアウォール規則を変更することが必要になる場合があります。

## <a name="lab-account"></a>ラボ アカウント

共有リソースを使用するには、[ピアリングされた仮想ネットワーク](how-to-connect-peer-virtual-network.md)を使用するようにラボ アカウントを設定する必要があります。  この場合は、共有リソースが保持されている仮想ネットワークにピアリングします。

>[!WARNING]
>クラス用のラボは、ラボ アカウントを共有リソースの仮想ネットワークにピアリングした**後で**、作成する必要があります。  
テンプレート マシン

ラボ アカウントが仮想ネットワークとピアリングされると、テンプレート マシンは共有リソースにアクセスできるようになります。  アクセスされる共有リソースによっては、ファイアウォール規則の更新が必要になる場合があります。
