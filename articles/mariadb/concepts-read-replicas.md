---
title: Azure Database for MariaDB の読み取りレプリカ
description: この記事では、Azure Database for MariaDB の読み取りレプリカについて説明します。
author: ajlam
ms.author: andrela
ms.service: mariadb
ms.topic: conceptual
ms.date: 06/10/2019
ms.openlocfilehash: 8abe257090b5159053a37350c9e24cc27073679b
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/13/2019
ms.locfileid: "67081748"
---
# <a name="read-replicas-in-azure-database-for-mariadb"></a>Azure Database for MariaDB の読み取りレプリカ

読み取りレプリカ機能を使用すると、Azure Database for MariaDB サーバーから、読み取り専用サーバーにデータをレプリケートできます。 マスター サーバーからマスターと同じリージョン内の最大 5 つのレプリカにレプリケートできます。 レプリカは、グローバル トランザクション ID (GTID) による MariaDB エンジンのバイナリ ログ (binlog) ファイルの位置ベースのレプリケーション テクノロジを使用して、非同期で更新されます。 binlog レプリケーションの詳細については、[binlog レプリケーションの概要](https://mariadb.com/kb/en/library/replication-overview/)に関する記事を参照してください。

> [!IMPORTANT]
> 同一リージョンの読み取りレプリカは、現在パブリック プレビュー段階です。

レプリカは、通常の Azure Database for MariaDB サーバーと同様に管理する新しいサーバーです。 読み取りレプリカごとに、仮想コアおよびストレージのプロビジョニング済みコンピューティング (GB/月) に対して課金されます。

GTID レプリケーションの詳細については、[MariaDB のレプリケーションに関するドキュメント](https://mariadb.com/kb/en/library/gtid/)を参照してください。

## <a name="when-to-use-a-read-replica"></a>読み取りレプリカを使用する場合

読み取りレプリカ機能は、読み取り集中型ワークロードのパフォーマンスとスケールの向上に役立ちます。 書き込みワークロードをマスターに振り向けながら、読み取りワークロードはレプリカに分離することができます。

BI ワークロードおよび分析ワークロードでレポート用のデータ ソースとして使用するのが、読み取りレプリカの一般的なシナリオです。

レプリカは読み取り専用であるため、マスターへの書き込み容量の負担を直接減らすことにはなりません。 この機能は、書き込み集中型ワークロードを対象としていません。

読み取りレプリカ機能では、非同期レプリケーションが使用されます。 機能は、同期レプリケーション シナリオを目的としていません。 マスターとレプリカの間には測定可能な遅延が発生します。 レプリカ上のデータは、最終的にマスター上のデータと整合します。 この機能は、この遅延に対応できるワークロードに使用してください。

読み取りレプリカを使用すると、ディザスター リカバリー計画を強化できます。 リージョンで災害が発生し、マスター サーバーが利用不可になった場合は、ワークロードを別のリージョンのレプリカにリダイレクトできます。 これを行うには、まずレプリケーションの停止機能を使用してレプリカで書き込みの許可を行います。 次に、接続文字列を更新してアプリケーションをリダイレクトできます。 詳細については、[レプリケーションの停止](#stop-replication)に関するセクションを参照してください。

## <a name="create-a-replica"></a>レプリカの作成

マスター サーバーに既存のレプリカ サーバーがない場合、まずレプリケーションの準備のためにマスターが再起動されます。

レプリカ作成ワークフローを開始すると、空の Azure Database for MariaDB サーバーが作成されます。 新しいサーバーには、マスター サーバー上にあったデータが設定されます。 作成時間は、マスター上のデータ量と、最後の週次完全バックアップからの経過時間に依存します。 時間の範囲は、数分から数時間になる可能性があります。

> [!NOTE]
> サーバーに記憶域のアラートを設定していない場合、設定することをお勧めします。 サーバーがレプリケーションに影響を与えるその容量の上限に近づくと、アラートによって通知されます。

[Azure portal で読み取りレプリカを作成する](howto-read-replicas-portal.md)方法を確認してください。

## <a name="connect-to-a-replica"></a>レプリカへの接続

作成されたレプリカでは、マスター サーバーのファイアウォール規則または VNet サービス エンドポイントは継承されません。 これらの規則は、レプリカに対して個別に設定する必要があります。

レプリカの管理者アカウントは、マスター サーバーから継承されます。 マスター サーバー上のすべてのユーザー アカウントが、読み取りレプリカにレプリケートされます。 マスター サーバー上で使用可能なユーザー アカウントを使って読み取りレプリカにのみ接続できます。

通常の Azure Database for MariaDB サーバーの場合と同じように、そのホスト名と有効なユーザー アカウントを使用して、レプリカに接続できます。 管理者ユーザー名が **myadmin** の **myreplica** というサーバーの場合、mysql CLI を使用して、レプリカに接続できます。

```bash
mysql -h myreplica.mariadb.database.azure.com -u myadmin@myreplica -p
```

メッセージが表示されたら、ユーザー アカウントのパスワードを入力します。

## <a name="monitor-replication"></a>レプリケーションを監視します

Azure Database for MariaDB は、Azure Monitor に**レプリケーションのラグ (秒単位)** メトリックを提供しています。 このメトリックは、レプリカのみで使用できます。

このメトリックは、MariaDB の `SHOW SLAVE STATUS` コマンドで使用できる `seconds_behind_master` メトリックを使用して計算されます。

レプリケーションのラグがワークロードに対して許容できない値に達したときに通知されるアラートを設定します。

## <a name="stop-replication"></a>レプリケーションの停止

マスターとレプリカの間のレプリケーションを停止できます。 マスター サーバーと読み取りレプリカの間のレプリケーションを停止すると、レプリカがスタンドアロン サーバーになります。 スタンドアロン サーバー内のデータは、レプリケーション停止コマンドが起動された時点でレプリカで使用可能だったデータです。 スタンドアロン サーバーにはマスター サーバーへの変更が反映されなくなっています。

レプリカへのレプリケーションを停止すると、以前のマスターと他のレプリカへのリンクがすべて失われます。 マスターとそのレプリカの間に自動フェールオーバーはありません。

> [!IMPORTANT]
> スタンドアロン サーバーをもう一度レプリカにすることはできません。
> 読み取りレプリカでレプリケーションを停止する前に、レプリカに必要なすべてのデータがあることを確認してください。

[レプリカへのレプリケーションを停止する](howto-read-replicas-portal.md)方法を確認します。

## <a name="considerations-and-limitations"></a>考慮事項と制限事項

### <a name="pricing-tiers"></a>価格レベル

読み取りレプリカは現在、General Purpose 価格レベルとメモリ最適化価格レベルでのみ使用できます。

### <a name="master-server-restart"></a>マスター サーバーの再起動

既存のレプリカがないマスターのレプリカを作成すると、マスターは最初に、レプリケーションの準備をするために再起動します。 これを考慮して、これらの操作はオフピーク時に実行してください。

### <a name="new-replicas"></a>新しいレプリカ

読み取りレプリカは、新しい Azure Database for MariaDB サーバーとして作成されます。 既存のサーバーをレプリカにすることはできません。 別の読み取りレプリカのレプリカを作成することはできません。

### <a name="replica-configuration"></a>レプリカ構成

レプリカは、マスターと同じサーバー構成を使用して作成されます。 レプリカが作成されたら、マスター サーバーとは独立していくつかの設定 (コンピューティング世代、仮想コア、ストレージ、バックアップ保持期間、MariaDB エンジンのバージョン) を変更できます。 価格レベルも独立して変更できます (Basic レベルへの変更や Basic レベルからの変更を除く)。

> [!IMPORTANT]
> マスター サーバー構成が新しい値に更新される前に、レプリカ構成をそれと同等以上の値に更新してください。 このアクションにより、レプリカがマスターのどのような変更にも追従できるようになります。

### <a name="stopped-replicas"></a>停止されたレプリカ

マスター サーバーと読み取りレプリカの間のレプリケーションを停止すると、停止されたレプリカは、読み取りと書き込みの両方を受け入れるスタンドアロン サーバーになります。 スタンドアロン サーバーをもう一度レプリカにすることはできません。

### <a name="deleted-master-and-standalone-servers"></a>削除されたマスターおよびスタンドアロン サーバー

マスター サーバーが削除されると、すべての読み取りレプリカへのレプリケーションが停止されます。 これらのレプリカはスタンドアロン サーバーになります。 マスター サーバー自体は削除されます。

### <a name="user-accounts"></a>ユーザー アカウント

マスター サーバー上のユーザーは、読み取りレプリカにレプリケートされます。 マスター サーバー上で使用可能なユーザー アカウントを使って読み取りレプリカにのみ接続できます。

### <a name="server-parameters"></a>サーバー パラメーター

データが非同期にならないようにするため、また潜在的なデータの損失や破損を防ぐために、一部のサーバー パラメーターは、読み取りレプリカの使用時に更新されないようにロックされます。

次のサーバー パラメーターは、マスター サーバーとレプリカ サーバーの両方でロックされます。
- [`innodb_file_per_table`](https://mariadb.com/kb/en/library/innodb-system-variables/#innodb_file_per_table) 
- [`log_bin_trust_function_creators`](https://mariadb.com/kb/en/library/replication-and-binary-log-system-variables/#log_bin_trust_function_creators)

[`event_scheduler`](https://mariadb.com/kb/en/library/server-system-variables/#event_scheduler) パラメーターは、レプリカ サーバーでロックされます。

### <a name="other"></a>その他

- レプリカのレプリカの作成はサポートされていません。
- インメモリ テーブルを使用すると、レプリカの同期が解除される可能性があります。これは、MariaDB レプリケーション テクノロジの制限事項です。
- マスター サーバーのテーブルに主キーがあることを確認します。 主キーがないと、マスターとレプリカ間でレプリケーションの待機時間が発生する可能性があります。

## <a name="next-steps"></a>次の手順

- [Azure portal を使用して読み取りレプリカの作成と管理](howto-read-replicas-portal.md)を行う方法について確認する。
