---
title: "Azure 仮想ネットワークを別の VNet に接続する: クラシック | Microsoft Docs"
description: "PowerShell と Azure クラシック ポータルを使用して複数の Azure 仮想ネットワークを接続する方法。"
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-service-management
ms.assetid: 7413827f-233d-4c7c-a133-9c99cf031833
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/31/2016
ms.author: cherylmc
translationtype: Human Translation
ms.sourcegitcommit: eadb1f29da69e7f6fcc2c7c19ba67f4e3072c346
ms.openlocfilehash: 863b308125a7a9ae2b9d9104d150bd2474c064b3


---
# <a name="configure-a-vnet-to-vnet-connection-for-the-classic-deployment-model"></a>クラシック デプロイ モデルで VNet 対 VNet 接続を構成する
> [!div class="op_single_selector"]
> * [Resource Manager - Azure Portal](vpn-gateway-howto-vnet-vnet-resource-manager-portal.md)
> * [Resource Manager - PowerShell](vpn-gateway-vnet-vnet-rm-ps.md)
> * [クラシック - クラシック ポータル](virtual-networks-configure-vnet-to-vnet-connection.md)
> 
> 

この記事では、クラシック デプロイメント モデル (サービス管理とも呼ばれる) を使用して、仮想ネットワークを作成し、仮想ネットワークを相互に接続する手順を説明します。 次の手順では、Azure クラシック ポータルを使用し、VNet とゲートウェイ、PowerShell を作成して、VNet 間接続を構成します。 ポータルで接続を構成することはできません。

![VNet 間接続の図](./media/virtual-networks-configure-vnet-to-vnet-connection/v2vclassic.png)

### <a name="deployment-models-and-methods-for-vnet-to-vnet-connections"></a>VNet 間接続で使用できるデプロイメント モデルとデプロイ方法
[!INCLUDE [deployment models](../../includes/vpn-gateway-deployment-models-include.md)]

以下の表は、VNet 間の構成に関して現在利用できるデプロイメント モデルとデプロイ方法を示しています。 構成手順を説明した記事が利用できるようになったら、表から直接リンクできるようにします。

[!INCLUDE [vpn-gateway-table-vnet-vnet](../../includes/vpn-gateway-table-vnet-to-vnet-include.md)]

## <a name="about-vnet-to-vnet-connections"></a>VNet 間接続の概要
仮想ネットワーク間 (VNet 間) の接続は、仮想ネットワークをオンプレミスのサイトの場所に接続することと似ています。 どちらの接続タイプでも、VPN ゲートウェイを使用して、IPsec/IKE を使った安全なトンネルが確保されます。 

接続する VNet は、サブスクリプションやリージョンが異なっていてもかまいません。 マルチサイト構成と VNet 対 VNet 通信を組み合わせることができます。 そのため、クロスプレミス接続と仮想ネットワーク間接続とを組み合わせたネットワーク トポロジを確立することができます。

### <a name="why-connect-virtual-networks"></a>仮想ネットワークを接続する理由
仮想ネットワークを接続するのは次のような場合です。

* **リージョン間の geo 冗長性および geo プレゼンス**
  
  * インターネット接続エンドポイントを介さず、安全な接続を使って独自の geo レプリケーションや geo 同期をセットアップすることができます。
  * Azure Load Balancer と Microsoft (またはサード パーティ) のクラスタリング テクノロジを使用し、複数の Azure リージョンをまたぐ geo 冗長性を備えた、可用性に優れたワークロードをセットアップすることができます。 たとえば、複数の Azure リージョンにまたがる SQL AlwaysOn 可用性グループをセットアップすることができます。
* **特定の地域内で強固な分離境界を備えた多層アプリケーション**
  
  * 同じリージョン内の相互に接続された複数の VNet を使って多層アプリケーションをセットアップすることができます。それぞれの層のアプリケーションが強固に分離され、安全な層間通信を実現することができます。
* **サブスクリプションや組織の境界を越えた通信を Azure 内で実現**
  
  * Azure サブスクリプションを複数所有している場合、異なるサブスクリプションからのワークロードを仮想ネットワークを介して安全に接続することができます。
  * 企業やサービス プロバイダーが、安全な VPN テクノロジを使用した組織間の通信を Azure 内で実現できます。

### <a name="vnet-to-vnet-considerations-for-classic-vnets"></a>クラシック VNet での VNet 間の考慮事項
* 仮想ネットワークが属しているサブスクリプションは異なっていてもかまいません。
* 仮想ネットワークが属している Azure リージョン (場所) は異なっていてもかまいません。
* クラウド サービスや負荷分散エンドポイントは、仮にそれらが相互に接続されていたとしても、仮想ネットワークの境界を越えることはできません。
* 複数の仮想ネットワークを接続する場合は、VPN デバイスは必要ありません。
* VNet 間接続でサポートされるのは、Azure Virtual Network の接続です。 仮想ネットワークにデプロイされていない仮想マシンやクラウド サービスを接続することはできません。
* VNet 対 VNet 通信には、動的ルーティング ゲートウェイが必要です。 Azure 静的ルーティング ゲートウェイはサポートされません。
* 仮想ネットワーク接続は、マルチサイト VPN と同時に使用することができます。 1 つの仮想ネットワーク VPN ゲートウェイに最大 10 本の VPN トンネルを確立し、他の仮想ネットワークまたはオンプレミス サイトに接続することが可能です。
* 仮想ネットワークのアドレス空間とオンプレミスのローカル ネットワーク サイトのアドレス空間とが重複しないようにする必要があります。 アドレス空間が重複していると、仮想ネットワークの作成または netcfg 構成ファイルのアップロードに失敗します。
* 一対の仮想ネットワーク間に冗長トンネルを確立することはできません。
* VNet のすべての VPN トンネル (P2S VPN を含む) は、VPN ゲートウェイ上の使用可能な帯域幅を共有し、Azure 内の同じ VPN ゲートウェイ アップタイム SLA を共有します。
* VNet 間のトラフィックは、Azure バックボーン経由で送信できます。

## <a name="a-namestep1astep-1---plan-your-ip-address-ranges"></a><a name="step1"></a>手順 1 - IP アドレス範囲を決める
仮想ネットワークの構成に使用する範囲を決めることは重要です。 この構成では、VNet のアドレス範囲が、互いにまたは接続先のすべてのローカル ネットワークと重複していないことを確認する必要があります。

VNet の定義の例を下表に示します。 範囲はあくまでも参考です。 仮想ネットワークの範囲をメモしておいてください。 この情報は後続の手順で必要になります。

**設定例**

| 仮想ネットワーク | アドレス空間 | リージョン | ローカル ネットワーク サイトへの接続 |
|:--- |:--- |:--- |:--- |
| VNet1 |VNet1 (10.1.0.0/16) |米国西部 |VNet2Local (10.2.0.0/16) |
| VNet2 |VNet2 (10.2.0.0/16) |東日本 |VNet1Local (10.1.0.0/16) |

## <a name="step-2---create-vnet1"></a>手順 2 - VNet1 を作成する
この手順では、VNet1 を作成します。 例のいずれかを使用するときは、必ず実際の値に置き換えてください。 VNet が既に存在する場合は、この手順を実行する必要はありません。 ただし、2 つ目の VNet や接続先とする他の VNet と IP アドレスの範囲が重複していないことを確認する必要があります。

1. [Azure クラシック ポータル](https://manage.windowsazure.com)にログインします。 Azure ポータルでは必要な構成設定の一部がまだ利用できないため、この記事ではクラシック ポータルを使用します。
2. 画面の左下隅で、**[新規]**  >  **[ネットワーク サービス]**  >  **[仮想ネットワーク]**  >  **[カスタム作成]** をクリックして構成ウィザードを開始します。 ウィザードを移動しながら、指定された値を各ページに追加します。

### <a name="virtual-network-details"></a>Virtual Network Details
[仮想ネットワークの詳細] ページで、次の情報を入力します。

  ![Virtual Network Details](./media/virtual-networks-configure-vnet-to-vnet-connection/IC736055.png)

* **[名前]**: 仮想ネットワークの名前を指定します。 (例: VNet1)。
* **[場所]** : 仮想ネットワークを作成するとき、仮想ネットワークを Azure の場所 (リージョン) に関連付けます。 たとえば、仮想ネットワークにデプロイされた VM を物理的に米国西部に配置する場合は、その場所を選択します。 仮想ネットワークを作成した後で、その仮想ネットワークに関連付けられた場所を変更することはできません。

### <a name="dns-servers-and-vpn-connectivity"></a>DNS サーバーと VPN 接続
[DNS サーバーおよび VPN 接続] ページで、次の情報を入力し、右下にある次へ進む矢印をクリックします。

  ![DNS サーバーと VPN 接続](./media/virtual-networks-configure-vnet-to-vnet-connection/IC736056.jpg)  

* **DNS サーバー** : DNS サーバー名と IP アドレスを入力するか、以前登録した DNS サーバーをドロップダウンから選択します。 この設定で、DNS サーバーは作成されません。 この設定では、この仮想ネットワークの名前解決に使用する DNS サーバーを指定することができます。 仮想ネットワーク間で名前解決を使用する場合は、Azure で提供される名前解決を使用するのでなく、独自の DNS サーバーを構成する必要があります。
* P2S または S2S 接続用のチェック ボックスはなにも選択しないでください。 右下にある矢印をクリックし、次の画面に移動します。

### <a name="virtual-network-address-spaces"></a>Virtual Network アドレス空間
[仮想ネットワーク アドレス空間] ページで、仮想ネットワークに使用するアドレス範囲を指定します。 これらが動的 IP アドレス (DIPS) として、この仮想ネットワークにデプロイする VM や各種ロール インスタンスに割り当てられます。 

オンプレミス ネットワークにも接続する VNet を作成する場合は、オンプレミス ネットワーク用に使用しているあらゆる範囲と重複しない範囲を選択することが、特に重要です。 この場合、ネットワーク管理者と相談して調整する必要があります。 ネットワーク管理者は、場合によっては VNet で使用する IP アドレス範囲をオンプレミス ネットワークのアドレス空間の中から確保する必要があるため、ネットワーク管理者との調整が必要です。

  ![[仮想ネットワーク アドレス空間] ページ](./media/virtual-networks-configure-vnet-to-vnet-connection/IC736057.jpg)

* **[アドレス空間]** : 開始 IP とアドレス数を指定します。 指定したアドレス空間がオンプレミス ネットワーク内に存在するあらゆるアドレス空間と重複していないことを確認します。 この例では、VNet1 に 10.1.0.0/16 を使用します。
* **[サブネットの追加]** : 開始 IP とアドレス数を指定します。 追加サブネットは必須ではありませんが、VM 用に静的 DIP を持つ別のサブネットを作成することをお勧めします。 または、他のロール インスタンスとは分離したサブネットに VM を配置することができます。

**チェックマークをクリック** すると、仮想ネットワークの作成が開始されます。 完了すると、[ネットワーク] ページにある [状態] に [作成済み] と表示されます。

## <a name="step-3---create-vnet2"></a>手順 3 - VNet2 を作成する
次に、上記の手順を繰り返して VNet をもう&1; つ作成します。 後でこれら&2; つの VNet を接続します。 手順 1 の [設定例](#step1) を参照できます。 VNet が既に存在する場合は、この手順を実行する必要はありません。 ただし、接続先とするオンプレミス ネットワークや他のすべての VNet と IP アドレスの範囲が重複していないことを確認する必要があります。

## <a name="step-4---add-the-local-network-sites"></a>手順 4 - ローカル ネットワーク サイトを追加する
VNet 間構成を作成するときは、ローカル ネットワーク サイトを構成する必要があります。構成したサイトは、ポータルの **[ローカル ネットワーク]** ページに表示されます。 Azure では、各ローカル ネットワーク サイトで指定されている設定を使用して、VNet 間でトラフィックをルーティングする方法を決定します。 各ローカル ネットワーク サイトの参照に使用する名前を指定します。 この値は後でドロップダウン リストから選択するので、わかりやすい名前を使用することをお勧めします。

たとえば、VNet1 は、"VNet2Local" という名前で作成するローカル ネットワーク サイトに接続します。 VNet2Local の設定には、VNet2 のアドレス プレフィックスと、VNet2 ゲートウェイのパブリック IP アドレスが含まれます。 VNet2 は、"VNet1Local" という名前で作成したローカル ネットワーク サイトに接続します。このサイトには、VNet1 のアドレス プレフィックスと VNet1 ゲートウェイのパブリック IP アドレスが含まれます。

### <a name="a-namelocalnetaadd-the-local-network-site-vnet1local"></a><a name="localnet"></a>ローカル ネットワーク サイト VNet1Local を追加する
1. 画面の左下隅で、**[新規]**  >  **[ネットワーク サービス]**  >  **[仮想ネットワーク]**  >  **[ローカル ネットワークの追加]** をクリックします。
2. **[ローカル ネットワークの詳細を指定する]** ページの **[名前]** に、接続先とするネットワークを表すのに使用する名前を入力します。 この例では、VNet1 のゲートウェイと IP アドレスの範囲を参照する "VNet1Local" を使用することができます。
3. **[VPN デバイス IP アドレス (オプション)]** で、任意の有効なパブリック IP アドレスを入力します。 通常は、VPN デバイスの実際の外部 IP アドレスを使用します。 VNet 間構成では、VNet のゲートウェイに割り当てられているパブリック IP アドレスを使用します。 ただし、ゲートウェイをまだ作成していない場合は、プレース ホルダーとして任意の有効なパブリック IP アドレスを指定できます。 この項目を空白のままにしないでください。この構成では省略可能ではありません。 Azure によってゲートウェイが生成されたら、後でこれらの設定に戻り、対応するゲートウェイ IP アドレスを使用して設定を構成します。 矢印をクリックして、次の画面に進みます。
4. **[アドレスの指定]**ページで、VNet1 の IP アドレス範囲とアドレス数を入力します。 この入力値は、VNet1 に対して構成した範囲と厳密に対応する必要があります。 Azure では、ここで指定された IP アドレスの範囲を使用して、VNet1 向けのトラフィックをルーティングします。 チェックマークをクリックしてローカル ネットワークを作成します。

### <a name="add-the-local-network-site-vnet2local"></a>ローカル ネットワーク サイト VNet2Local を追加する
上記の手順を使用して、ローカル ネットワーク サイト "VNet2Local" を作成します。 必要に応じて、手順 1 の [設定例](#step1) の値を参照できます。

### <a name="configure-each-vnet-to-point-to-a-local-network"></a>ローカル ネットワークをポイントするように各 VNet を構成する
各 VNet は、トラフィックのルーティング先とする対応するローカル ネットワークをポイントする必要があります。 

**VNet1 の場合**

1. 仮想ネットワーク **VNet1** の **[構成]** ページに移動します。 
2. [サイト間接続] で [ローカル ネットワークに接続する] を選択し、ローカル ネットワークとしてドロップダウンから **[VNet2Local]** を選択します。 
3. 設定を保存します。

**VNet2 の場合**

1. 仮想ネットワーク **VNet2** の **[構成]** ページに移動します。 
2. [サイト間接続] で [ローカル ネットワークに接続する] を選択し、ローカル ネットワークとしてドロップダウンから **[VNet1Local]** を選択します。 
3. 設定を保存します。

## <a name="step-5---configure-a-gateway-for-each-vnet"></a>手順 5 - 各 VNet のゲートウェイを構成する
各仮想ネットワークの動的ルーティング ゲートウェイを構成します。 この構成は、静的ルーティング ゲートウェイをサポートしていません。 以前に構成し、動的ルーティング ゲートウェイが既にある VNet を使用している場合は、この手順を実行する必要はありません。 ゲートウェイが静的ルーティングである場合は、それらを削除し、動的ルーティング ゲートウェイとして作成し直す必要があります。 ゲートウェイを削除した場合は、そのゲートウェイに割り当てていたパブリック IP アドレスがリリースされるので、すべてのローカル ネットワークと VPN デバイスを、新しいゲートウェイの新しいパブリック IP アドレスを使用するように再構成する必要があります。

1. **[ネットワーク]** ページで、仮想ネットワークの状態列が **[作成済み]** であることを確認します。
2. **[名前]** 列で、仮想ネットワークの名前をクリックします。 この例では、"VNet1" を使用します。
3. **[ダッシュボード]** ページでは、この VNet に対してゲートウェイが構成されていないことがわかります。 この状態はゲートウェイを構成するための手順を進めると変化します。
4. ページの下部にある **[ゲートウェイの作成]** と **[動的ルーティング]** をクリックします。 ゲートウェイを作成するかどうかを確認するように求められたら、[はい] をクリックします。
   
      ![ゲートウェイの種類](./media/virtual-networks-configure-vnet-to-vnet-connection/IC717026.png)  
5. ゲートウェイの作成中は、ページに表示されているゲートウェイの図が黄色に変わり、"ゲートウェイを作成しています" と表示されます。 ゲートウェイが作成されるまでに、通常、30 分ぐらいかかります。
6. VNet2 について、同じ手順を実行します。 最初の VNet ゲートウェイの完了を待たずに他方の VNet 用のゲートウェイの作成を開始してかまいません。
7. ゲートウェイの状態が "接続中" に変化すると、各ゲートウェイのパブリック IP アドレスがダッシュボードに表示されます。 各 VNet に対応する IP アドレスを書き留めます。混同しないように注意してください。 先ほど各ローカル ネットワーク の [VPN デバイスの IP アドレス] に指定した仮のアドレスを編集する際は、これらの IP アドレスを使用します。

## <a name="step-6---edit-the-local-network"></a>手順 6 - ローカル ネットワークを編集する
1. **[ローカル ネットワーク]** ページで、編集するローカル ネットワークの名前をクリックし、ページの下部にある **[編集]** をクリックします。 **[VPN デバイスの IP アドレス]**で、VNet に対応するゲートウェイの IP アドレスを入力します。 たとえば、VNet1Local の場合は、VNet1 に割り当てられたゲートウェイ IP アドレスを入力します。 ページの下部にある矢印をクリックします。
2. **[アドレス空間の指定]** ページで、変更を何も行わずに右下にあるチェックマークをクリックします。

## <a name="step-7---create-the-vpn-connection"></a>手順 7 - VPN 接続を作成する
以上の手順がすべて完了したら、IPsec/IKE 事前共有キーを設定して接続を作成します。 この一連の手順には、PowerShell を使用します。ポータルで構成することはできません。 Azure PowerShell コマンドレットのインストールの詳細については、「[Azure PowerShell のインストールおよび構成方法](/powershell/azureps-cmdlets-docs)」を参照してください。 かならず、最新バージョンのサービス管理 (SM) コマンドレットをダウンロードしてください。 

1. Windows PowerShell 開いてログインします。
   
        Add-AzureAccount
2. VNet が配置されているサブスクリプションを選択します。
   
        Get-AzureSubscription | Sort SubscriptionName | Select SubscriptionName
        Select-AzureSubscription -SubscriptionName "<Subscription Name>"
3. 接続を作成します。 次の例では、共有キーがまったく同じであることに注目してください。 共有キーは常に一致する必要があります。

    VNet1 から VNet2 への接続

        Set-AzureVNetGatewayKey -VNetName VNet1 -LocalNetworkSiteName VNet2Local -SharedKey A1b2C3D4

    VNet2 から VNet1 への接続

        Set-AzureVNetGatewayKey -VNetName VNet2 -LocalNetworkSiteName VNet1Local -SharedKey A1b2C3D4

4. 接続が初期化されるのを待ちます。 ゲートウェイが初期化されると、ゲートウェイは、下図のようになります。
   
    ![ゲートウェイの状態 - 接続済み](./media/virtual-networks-configure-vnet-to-vnet-connection/IC736059.jpg)  
   
[!INCLUDE [vpn-gateway-no-nsg-include](../../includes/vpn-gateway-no-nsg-include.md)] 

## <a name="next-steps"></a>次のステップ
仮想ネットワークに仮想マシンを追加できます。 詳細については、 [Virtual Machines のドキュメント](https://docs.microsoft.com/azure/#pivot=services&panel=Compute) を参照してください。




<!--HONumber=Jan17_HO4-->


