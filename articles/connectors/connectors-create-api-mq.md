---
title: IBM MQ サーバーへの接続
description: Azure またはオンプレミスの IBM MQ サーバーと Azure Logic Apps を使用して、メッセージを送信および取得します
services: logic-apps
ms.suite: integration
author: ChristopherHouser
ms.author: chrishou
ms.reviewer: valthom, estfan, logicappspm
ms.topic: article
ms.date: 05/14/2020
tags: connectors
ms.openlocfilehash: e9e554fdc092e49f5a87049de0e3dc3163105f58
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/02/2020
ms.locfileid: "85609505"
---
# <a name="connect-to-an-ibm-mq-server-from-azure-logic-apps"></a>Azure Logic Apps からの IBM MQ サーバーへの接続

IBM MQ コネクタは、オンプレミスの、または Azure 内の IBM MQ サーバーに保管されているメッセージの送信と取得を行います。 このコネクタには、TCP/IP ネットワーク経由でリモート IBM MQ サーバーと通信する Microsoft MQ クライアントが含まれています。 この記事は、MQ コネクタを使用するためのスターター ガイドです。 まずキューの 1 つのメッセージを参照することから始め、次いでその他のアクションを試してみることができます。

IBM MQ コネクタには以下のアクションが含まれていますが、トリガーが用意されていません。

- IBM MQ サーバーからメッセージを削除せずに 1 つのメッセージを参照します。
- IBM MQ サーバーからメッセージを削除せずにメッセージのバッチを参照します。
- 1 つのメッセージを受信し、IBM MQ サーバーからメッセージを削除します。
- メッセージのバッチを受信し、IBM MQ サーバーからメッセージを削除します。
- 1 つのメッセージを IBM MQ サーバーに送信します。

正式サポートされている IBM WebSphere MQ バージョンを次に示します。

  * MQ 7.5
  * MQ 8.0
  * MQ 9.0
  * MQ 9.1

## <a name="prerequisites"></a>前提条件

* オンプレミスの MQ サーバーを使用している場合は、ご使用のネットワーク内のサーバーに[オンプレミスのデータ ゲートウェイをインストール](../logic-apps/logic-apps-gateway-install.md)します。 MQ コネクタが動作するには、オンプレミスのデータ ゲートウェイがインストールされているサーバーに .NET Framework 4.6 もインストールする必要があります。

  ゲートウェイのインストールを完了した後、Azure にオンプレミス データ ゲートウェイ用のリソースも作成する必要があります。 詳細については、[データ ゲートウェイ接続の設定に関する記事](../logic-apps/logic-apps-gateway-connection.md)を参照してください。

  MQ サーバーが公開されているか、または Azure 内で使用できる場合、データ ゲートウェイを使用する必要はありません。

* MQ アクションを追加するロジック アプリ。 このロジック アプリは、オンプレミス データ ゲートウェイ接続と同じ場所を使用し、ワークフローを開始するトリガーが既にある必要があります。

  MQ コネクタにはトリガーがないので、最初にロジック アプリにトリガーを追加する必要があります。 たとえば、繰り返しトリガーを使用できます。 ロジック アプリを初めて使用する場合は、[初めてのロジック アプリを作成する方法に関するクイックスタート](../logic-apps/quickstart-create-first-logic-app-workflow.md)を試してみてください。

<a name="create-connection"></a>

## <a name="create-mq-connection"></a>MQ 接続を作成する

MQ アクションを追加するときに MQ 接続がまだない場合は、その接続を作成するよう求められます。次に例を示します。

![接続情報を指定する](media/connectors-create-api-mq/connection-properties.png)

1. オンプレミスの MQ サーバーに接続している場合は、 **[オンプレミス データ ゲートウェイ経由で接続]** を選択します。

1. MQ サーバーの接続情報を指定します。

   * **[サーバー]** には、MQ サーバーの名前を入力するか、IP アドレスに続けてコロンとポート番号を入力します。

   * Secure Sockets Layer (SSL) を使用するには、 **[SSL を有効にしますか?]** を選択します。

     MQ コネクタは現在、クライアント認証ではなく、サーバー認証のみをサポートしています。 詳細については、「[接続と認証の問題](#connection-problems)」を参照してください。

1. **[ゲートウェイ]** セクションで、次の手順に従います。

   1. **[サブスクリプション]** 一覧から、Azure ゲートウェイ リソースに関連付けられている Azure サブスクリプションを選択します。

   1. **[接続ゲートウェイ]** 一覧から、使用する Azure ゲートウェイ リソースを選択します。

1. 完了したら **[作成]** を選択します。

<a name="connection-problems"></a>

### <a name="connection-and-authentication-problems"></a>接続と認証の問題

ロジック アプリがオンプレミスの MQ サーバーに接続しようとしているとき、次のエラーが発生することがあります。

`"MQ: Could not Connect the Queue Manager '<queue-manager-name>': The Server was expecting an SSL connection."`

* Azure で直接 MQ コネクタを使用している場合、MQ サーバーは、信頼された[証明機関](https://www.ssl.com/faqs/what-is-a-certificate-authority/)によって発行された証明書を使用する必要があります。

* オンプレミス データ ゲートウェイを使用している場合は、可能であれば、信頼された[証明機関](https://www.ssl.com/faqs/what-is-a-certificate-authority/)によって発行された証明書の使用を試みてください。 ただし、このオプションが可能でない場合は、自己署名証明書を使用することもできます。これは、信頼された[証明機関](https://www.ssl.com/faqs/what-is-a-certificate-authority/)によって発行されていないため、安全性が低いと見なされます。

  サーバーの自己署名証明書をインストールするには、**Windows Certification Manager** (certmgr.msc) ツールを使用できます。 このシナリオでは、オンプレミス データ ゲートウェイ サービスが実行されているローカル コンピューターで、 **[信頼されたルート証明機関]** レベルにある **[Local Computer] (ローカル コンピューター)** 証明書ストアに証明書をインストールする必要があります。

  1. オンプレミス データ ゲートウェイ サービスが実行されているコンピューターで、[スタート] メニューを開き、 **[ユーザー証明書の管理]** を見つけて選択します。

  1. Windows Certification Manager ツールが開いたら、 **[証明書 - ローカル コンピューター]**  >   **[信頼されたルート証明機関]** フォルダーに移動し、証明書をインストールします。

     > [!IMPORTANT]
     > 確実に **[証明書 - ローカル コンピューター]**  >  **[信頼されたルート証明機関]** ストアに証明書をインストールするようにしてください。

* MQ サーバーでは、TLS/SSL 接続に使用する暗号化仕様を定義する必要があります。 ただし、.NET の SslStream では、暗号化仕様の順序を指定することはできません。 この制限を回避するには、コネクタが TLS/SSL ネゴシエーションで送信するスイート内の最初の暗号化仕様に一致するように、MQ サーバー構成を変更できます。

  接続しようとすると、MQ サーバーは、もう一方の終端が正しくない暗号化仕様を使用したために接続が失敗したことを示すイベント メッセージをログに記録します。 このイベント メッセージには、一覧の最初に表示される暗号化仕様が含まれています。 チャネル構成の暗号化仕様を、イベント メッセージ内の暗号化仕様に一致するように更新します。

## <a name="browse-single-message"></a>1 つのメッセージを参照する

1. ロジック アプリで、トリガーまたは別のアクションの **[新しいステップ]** を選択します。

1. 検索ボックスに「`mq`」と入力し、 **[メッセージの参照]** アクションを選択します。

   ![[メッセージの参照] アクションを選択する](media/connectors-create-api-mq/browse-message.png)

1. まだ MQ 接続を作成していない場合は、[その接続を作成する](#create-connection)よう求められます。

1. 接続を作成したら、 **[メッセージの参照]** アクションのプロパティを設定します。

   | プロパティ | 説明 |
   |----------|-------------|
   | **キュー** | 接続で指定されたキューと異なる場合は、そのキューを指定します。 |
   | **MessageId**、**CorrelationId**、**GroupId**、その他のプロパティ | さまざまな MQ メッセージ プロパティに基づいたメッセージを参照します。 |
   | **IncludeInfo** | 出力に追加のメッセージ情報を含めるには、**true** を選択します。 出力の追加のメッセージ情報を省略するには、**false** を選択します。 |
   | **タイムアウト** | 値を入力して、空のキューにメッセージが到着するまで待機する時間を決定します。 何も入力しない場合は、キューの最初のメッセージが取得され、その後にメッセージの出現を待機する時間はありません。 |
   |||

   次に例を示します。

   ![[メッセージの参照] アクションのプロパティ](media/connectors-create-api-mq/browse-message-properties.png)

1. 操作が完了したら、デザイナーのツールバーで、 **[保存]** を選択します。 アプリをテストするには、 **[実行]** を選択します。

   実行が完了すると、デザイナーにワークフロー ステップとその状態が表示され、出力を確認できるようになります。

1. 各ステップに関する詳細を表示するには、そのステップのタイトル バーをクリックします。 ステップの出力に関するより詳細な情報を確認するには、 **[未加工出力の表示]** を選択します。

   ![メッセージの参照の出力](media/connectors-create-api-mq/browse-message-output.png)

   未加工出力の例を次に示します。

   ![メッセージの参照の未加工出力](media/connectors-create-api-mq/browse-message-raw-output.png)

1. **[IncludeInfo]** を **true** に設定した場合は、追加の出力が表示されます。

   ![メッセージの参照に含まれる情報](media/connectors-create-api-mq/browse-message-include-info.png)

## <a name="browse-multiple-messages"></a>複数のメッセージの参照

**[メッセージの参照]** アクションには、キューから返すメッセージの数を示す **[BatchSize]** オプションが含まれています。 **[BatchSize]** に値がない場合は、すべてのメッセージが返されます。 返される出力は、メッセージの配列です。

1. 前のステップに従いますが、代わりに **[メッセージの参照]** アクションを追加します。

1. まだ MQ 接続を作成していない場合は、[その接続を作成する](#create-connection)よう求められます。 それ以外の場合、既定では、以前に構成された最初の接続が使用されます。 新しい接続を作成するには、 **[接続の変更]** を選択します。 または、別の接続を選択します。

1. アクションに関する情報を指定します。

1. ロジック アプリを保存して実行します。

   ロジック アプリが実行を完了した後の **[メッセージの参照]** アクションからのいくつかのサンプル出力を次に示します。

   ![[メッセージの参照] のサンプル出力](media/connectors-create-api-mq/browse-messages-output.png)

## <a name="receive-single-message"></a>1 つのメッセージの受信

**[メッセージの受信]** アクションの入力と出力は、 **[Browse message]\(メッセージの参照\)** アクションと同じです。 **[メッセージの受信]** を使用した場合、メッセージはキューから削除されます。

## <a name="receive-multiple-messages"></a>複数のメッセージの受信

**[メッセージの受信]** アクションの入力と出力は、 **[Browse messages]\(メッセージの参照\)** アクションと同じです。 **[メッセージの受信]** を使用した場合、メッセージはキューから削除されます。

> [!NOTE]
> メッセージが含まれていないキューに対して参照または受信アクションを実行した場合、このアクションは失敗し、次の出力が生成されます。
>
> ![MQ の "メッセージなし" エラー](media/connectors-create-api-mq/mq-no-message-error.png)

## <a name="send-message"></a>メッセージを送信する

1. 前のステップに従いますが、代わりに **[メッセージの送信]** アクションを追加します。

1. まだ MQ 接続を作成していない場合は、[その接続を作成する](#create-connection)よう求められます。 それ以外の場合、既定では、以前に構成された最初の接続が使用されます。 新しい接続を作成するには、 **[接続の変更]** を選択します。 または、別の接続を選択します。

1. アクションに関する情報を指定します。 **[MessageType]** では、有効なメッセージの種類を選択します。 **[データグラム]** 、 **[返信]** 、または **[要求]**

   ![[メッセージの送信] アクションのプロパティ](media/connectors-create-api-mq/send-message-properties.png)

1. ロジック アプリを保存して実行します。

   ロジック アプリの実行完了後の **[Send messages] (メッセージの送信)** アクションの出力例を示します。

   ![[メッセージの送信] のサンプル出力](media/connectors-create-api-mq/send-message-output.png)

## <a name="connector-reference"></a>コネクタのレファレンス

コネクタの Swagger の説明に記載されているアクションと制限に関する技術的な詳細については、コネクタの[リファレンス ページ](/connectors/mq/)を確認してください。

## <a name="next-steps"></a>次のステップ

* 他の[Logic Apps コネクタ](../connectors/apis-list.md)を確認します。
