---
title: "Azure Logic Apps から Dynamics 365 (オンライン) に接続する | Microsoft Docs"
description: "Dynamics 365 コネクタが提供する API を使用して Dynamics 365 (オンライン) エンティティを管理するロジック アプリ ワークフローを作成します"
services: logic-apps
cloud: Azure Stack
author: Mattp123
manager: anneta
documentationcenter: 
tags: connectors
ms.assetid: 0dc2abef-7d2c-4a2d-87ca-fad21367d135
ms.service: logic-apps
ms.workload: integration
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/10/2017
ms.author: matp; LADocs
ms.translationtype: Human Translation
ms.sourcegitcommit: c785ad8dbfa427d69501f5f142ef40a2d3530f9e
ms.openlocfilehash: d35647921ff540167a3a591fb489d3bab031a5c1
ms.contentlocale: ja-jp
ms.lasthandoff: 05/26/2017

---

# <a name="connect-to-dynamics-365-from-logic-app-workflows"></a>ロジック アプリ ワークフローから Dynamics 365 に接続する

Logic Apps を使用すると、Dynamics 365 (オンライン) に接続し、レコードを作成するフロー、項目を更新するフロー、レコードのリストを返すフローなど、便利なビジネス フローを作成できます。 Dynamics 365 コネクタにより、次のことが可能になります。

* Dynamics 365 (オンライン) から取得したデータに基づいてビジネス フローを構築できます。
* 応答を取得し、出力を他のアクションで使用できるようにするアクションを使用できます。 たとえば、Dynamics 365 (オンライン) で項目が更新されときに、Office 365 を使用して電子メールを送信できます。

このトピックでは、Dynamics 365 で新しい潜在顧客が作成されるたびに、Dynamics 365 でタスクを作成するロジック アプリを作成する方法について説明します。

## <a name="prerequisites"></a>前提条件
* Azure アカウント。
* Dynamics 365 (オンライン) アカウント。

## <a name="create-a-task-when-a-new-lead-is-created-in-dynamics-365"></a>Dynamics 365 で新しい潜在顧客が作成されるたびにタスクを作成する

1.    [Azure にサインイン](https://portal.azure.com)します。

2.    Azure 検索ボックスに「`Logic apps`」と入力し、Enter キーを押します。

      ![Find Logic Apps](./media/connectors-create-api-crmonline/find-logic-apps.png)

3.    **[ロジック アプリ]** で **[追加]** をクリックします。

      ![LogicApp の追加](./media/connectors-create-api-crmonline/add-logic-app.png)

4.    ロジック アプリを作成するには、**[名前]**、**[サブスクリプション]**、**[リソース グループ]**、**[場所]** の各フィールドに必要な値を入力し、**[作成]** をクリックします。

5.    新しいロジック アプリを選択します。 **[デプロイメントに成功しました]** という通知が表示されたら、**[更新]** をクリックします。

6.    **[開発ツール]** で **[ロジック アプリ デザイナー]** をクリックします。 テンプレートの一覧で、**[空のロジック アプリ]** をクリックします。

7.    検索ボックスに「`Dynamics 365`」と入力します。 Dynamics 365 のトリガー一覧から、**[Dynamics 365 – レコードが作成されたとき]** を選択します。

8.    Dynamics 365 へのサインインを求められたら、すぐにサインインします。

9.    トリガーの詳細で次の情報を入力します。

  * **[組織名]**:  ロジック アプリでリッスンする Dynamics 365 インスタンスを選択します。

  * **[エンティティ名]**:  リッスンするエンティティを選択します。 このイベントは、ロジック アプリを起動するトリガーとして機能します。 
  このチュートリアルでは、**[潜在顧客]** を選択しています。

  * **[項目を確認する頻度]**:  これらの値により、ロジック アプリがトリガーに関連する更新を確認する頻度を設定します。 既定の設定では、3 分ごとに更新が確認されます。

    * **[頻度]**:  秒単位、分単位、時間単位、または日単位を選択します。

    * **[間隔]**:  秒数、分数、時間数、または日数をを入力します。この時間が経過すると、次の確認が行われます。

      ![ロジック アプリのトリガーの詳細](./media/connectors-create-api-crmonline/trigger-details.png)

10. **[新しいステップ]** をクリックし、**[アクションの追加]** をクリックします。

11. 検索ボックスに「`Dynamics 365`」と入力します。 アクションの一覧から、**[Dynamics 365 – 新しいレコードの作成]** を選択します。

12. 次の情報を入力します。

    * **[組織名]**:  フローでレコードを作成する Dynamics 365 インスタンスを選択します。 
    このインスタンスは、イベントをトリガーするインスタンスと同じインスタンスにする必要はありません。

    * **[エンティティ名]**:  イベントがトリガーされたときにレコードを作成するエンティティを選択します。 
    このチュートリアルでは、**[タスク]** を選択しています。

13. 表示される **[件名]** ボックスをクリックします。 表示される動的なコンテンツの一覧から、次のフィールドのいずれかを選択できます。

    * **[姓]**:  このフィールドを選択すると、タスク レコードが作成されたときに、タスクの [件名] フィールドに潜在顧客の姓が挿入されます。
    * **[トピック]**:  このフィールドを選択すると、タスク レコードが作成されたときに、タスクの [件名] フィールドに潜在顧客の [トピック] フィールドが挿入されます。 
    **[トピック]** をクリックして、トピックを **[件名]** ボックスに追加します。

      ![ロジック アプリの [新しいレコードの作成] の詳細](./media/connectors-create-api-crmonline/create-record-details.png)

14. ロジック アプリ デザイナーのツール バーの **[保存]** をクリックします。

    ![ロジック アプリ デザイナーのツール バーの [保存]](./media/connectors-create-api-crmonline/designer-toolbar-save.png)

15. ロジック アプリを起動するには、**[実行]** をクリックします。

    ![ロジック アプリ デザイナーのツール バーの [保存]](./media/connectors-create-api-crmonline/designer-toolbar-run.png)

16. Dynamics 365 for Sales で潜在顧客レコードを作成し、フローの動作を確認します。

## <a name="set-advanced-options-for-a-logic-app-step"></a>ロジック アプリのステップの詳細オプションを設定する

ロジック アプリのステップでデータをフィルター処理する方法を指定するには、そのステップで **[詳細オプションを表示する]** をクリックし、フィルター クエリまたは並べ替えクエリを追加します。

たとえば、フィルター クエリを使用してアクティブなアカウントだけを取得し、アカウント名で並べ替えることができます。 これを行うには、OData フィルター クエリ `statuscode eq 1` を入力し、動的コンテンツの一覧で **[アカウント名]** を選択します。 詳細については、MSDN の「[$filter](https://msdn.microsoft.com/library/gg309461.aspx#Anchor_1)」および「[$orderby](https://msdn.microsoft.com/library/gg309461.aspx#Anchor_2)」をご覧ください。

![ロジック アプリの詳細オプション](./media/connectors-create-api-crmonline/advanced-options.png)

### <a name="best-practices-when-using-advanced-options"></a>詳細オプションを使用する際のベスト プラクティス

フィールドに値を追加するときは、値を入力するか、動的コンテンツの一覧から値を選択するかに関係なく、フィールドの種類と一致する必要があります。

フィールドの種類  |使用方法  |参照先  |名前  |データ型  
---------|---------|---------|---------|---------
テキスト フィールド|テキスト フィールドには、1 行のテキスト、またはテキスト型のフィールドである動的コンテンツを追加する必要があります。 たとえば、[カテゴリ] フィールド、[サブカテゴリ] フィールドなどがあります。|[設定] > [カスタマイズ] > [システムのカスタマイズ] > [エンティティ] > [タスク] > [フィールド] |カテゴリ |1 行のテキスト        
整数フィールド | 一部のフィールドには、整数、または整数型フィールドである動的コンテンツを追加する必要があります。 たとえば、[達成率]、[期間] などがあります。 |[設定] > [カスタマイズ] > [システムのカスタマイズ] > [エンティティ] > [タスク] > [フィールド] |percentcomplete |整数         
日付フィールド | 一部のフィールドには、/mm/dd/yyyy 形式で入力した日付、または date 型フィールドである動的コンテンツを追加する必要があります。 たとえば、[作成日]、[開始日]、[実際の開始日]、[前回の保留時間]、[実際の終了日]、[期限] などがあります。 | [設定] > [カスタマイズ] > [システムのカスタマイズ] > [エンティティ] > [タスク] > [フィールド] |createdon |日付と時刻
レコード ID と参照タイプの両方を必要とするフィールド |別のエンティティ レコードを参照する一部のフィールドには、レコード ID と参照タイプの両方を追加する必要があります。 |[設定] > [カスタマイズ] > [システムのカスタマイズ] > [エンティティ] > [アカウント] > [フィールド]  | accountid  | 主キー

### <a name="more-examples-of-fields-that-require-both-a-record-id-and-lookup-type"></a>レコード ID と参照タイプの両方を必要とするフィールドのその他の例
ここでは、前の表を拡張して、動的コンテンツ リストから選択した値では機能しないフィールドの例を示します。 代わりに、これらのフィールドには、PowerApps でフィールドに入力されたレコード ID と参照タイプの両方が必要です。  
* [所有者] と [所有者の種類]。 [所有者] フィールドには、有効なユーザーまたはチーム レコード ID を入力する必要があります。 [所有者の種類] には、**systemusers** または **teams** を指定する必要があります。
* [顧客] と [顧客の種類]。 [顧客] フィールドには、有効なアカウントまたは連絡先レコード ID を入力する必要があります。 [顧客の種類] には、**accounts** または **contacts** を指定する必要があります。
* [関連] と [関連の種類]。 [関連] フィールドには、有効なレコード ID (アカウント レコード ID や連絡先レコード ID など) を入力する必要があります。 [関連の種類] には、レコードの参照タイプ (**accounts** や **contacts** など) を指定する必要があります。

次のタスク作成アクションの例では、タスクの [関連] フィールドにレコード ID を追加して、この ID に対応するアカウント レコードを追加します。

![フローの recordId とタイプのアカウント](./media/connectors-create-api-crmonline/recordid-type-account.png)

また、この例では、ユーザーのレコード ID に基づいて特定のユーザーにタスクを割り当てます。

![フローの recordId とタイプのアカウント](./media/connectors-create-api-crmonline/recordid-type-user.png)

レコード ID の検索方法については、次の「*レコード ID の検索*」をご覧ください。

## <a name="find-the-record-id"></a>レコード ID の検索

1. レコード (アカウント レコードなど) を開きます。

2. 操作ツール バーの **[ポップ アウト]** ![レコードのポップアウト](./media/connectors-create-api-crmonline/popout-record.png) をクリックします。
または、操作ツール バーで、既定の電子メール プログラムに完全な URL をコピーするために、**[リンクを電子メールで送信]** をクリックします。

   レコード ID は、URL のエンコード文字 %7b と %7d の間に表示されます。

   ![フローの recordId とタイプのアカウント](./media/connectors-create-api-crmonline/recordid.png)

## <a name="troubleshooting"></a>トラブルシューティング
ロジック アプリの失敗したステップのトラブルシューティングを行うには、イベントの状態の詳細を表示します。

1. **[Logic Apps]** でロジック アプリを選択し、**[概要]** をクリックします。 

   ロジック アプリの実行状態を示す [概要] エリアが表示されます。 

   ![ロジック アプリの実行状態](./media/connectors-create-api-crmonline/tshoot1.png)

2. 失敗した実行に関する詳細を表示するには、失敗したイベントをクリックします。 失敗したステップを展開するには、そのステップをクリックします。

   ![失敗したステップの展開](./media/connectors-create-api-crmonline/tshoot2.png)

   ステップの詳細が表示されます。これは、エラーの原因のトラブルシューティングに役立ちます。

   ![失敗したステップの詳細](./media/connectors-create-api-crmonline/tshoot3.png)

ロジック アプリのトラブルシューティングの詳細については、「[ロジック アプリの障害の診断](../logic-apps/logic-apps-diagnosing-failures.md)」をご覧ください。

## <a name="connector-specific-details"></a>コネクタ固有の詳細

[コネクタの詳細](/connectors/crm/)に関するページに、Swagger で定義されているトリガーとアクション、さらに制限が記載されています。 

## <a name="next-steps"></a>次のステップ
[API の一覧](apis-list.md)で、Logic Apps で使用できる他のコネクタを確認してください。

