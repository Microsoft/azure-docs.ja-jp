---
title: SFTP アカウントに接続する - Azure Logic Apps | Microsoft Docs
description: Azure Logic Apps を使用して SSH 経由で SFTP サーバーのファイルを監視、作成、管理、送信、および受信するタスクおよびプロセスを自動化する
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.reviewer: divswa, klam, LADocs
ms.assetid: 697eb8b0-4a66-40c7-be7b-6aa6b131c7ad
ms.topic: article
tags: connectors
ms.date: 10/26/2018
ms.openlocfilehash: 42e1ef3e311633f9631163bc9d3df212b608ef3a
ms.sourcegitcommit: c63fe69fd624752d04661f56d52ad9d8693e9d56
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2019
ms.locfileid: "58578375"
---
# <a name="monitor-create-and-manage-sftp-files-by-using-azure-logic-apps"></a>Azure Logic Apps を使用して SFTP ファイルの監視、作成、および管理を行う

[セキュア ファイル転送プロトコル (SFTP)](https://www.ssh.com/ssh/sftp/) サーバー上のファイルを監視、作成、送信、および受信するタスクを自動化するには、Azure Logic Apps と SFTP コネクタを使用して統合ワークフローを構築して自動化できます。 SFTP は、任意の信頼性の高いデータ ストリームを通して、ファイル アクセス、ファイル転送、およびファイル管理を提供するネットワーク プロトコルです。 次に、自動化できるタスクの例をいくつか示します。 

* ファイルの追加または変更を監視します。
* ファイルの取得、作成、コピー、更新、一覧、および削除を行います。
* ファイルの内容とメタデータを取得します。
* アーカイブをフォルダーに抽出します。

SFTP サーバー上のイベントを監視し、出力を他のアクションで使用できるようにするトリガーを使用できます。 SFTP サーバーで各種のタスクを実行するアクションを使用できます。 ロジック アプリ内の他のアクションでも、SFTP アクションからの出力を使用するようにできます。 たとえば、SFTP サーバーからファイルを定期的に取得する場合は、Office 365 Outlook コネクタまたは Outlook.com コネクタを使用して、これらのファイルやその内容に関するメールのアラートを送信できます。
ロジック アプリを初めて使用する場合は、「[Azure Logic Apps とは](../logic-apps/logic-apps-overview.md)」を参照してください。

## <a name="limits"></a>制限

* SFTP アクションで読み書きできるのは、[アクションでメッセージのチャンク](../logic-apps/logic-apps-handle-large-messages.md)を使用しない限り、"*50 MB 以下*" のファイルです (これを使用すると、この制限を回避できます)。 現在、SFTP トリガーではチャンクはサポートされていません。

* "*1 GB まで*" のファイルの場合は、[SFTP-SSH コネクタ](../connectors/connectors-sftp-ssh.md)を使用します。

* "*1 GB より大きい*" ファイルの場合は、SFTP-SSH コネクタに加えて[メッセージ チャンク](../logic-apps/logic-apps-handle-large-messages.md)を使用します。

SFTP コネクタと SFTP-SSH コネクタのその他の違いについては、SFTP-SSH に関する記事の「[SFTP-SSH と SFTP を比較する](../connectors/connectors-sftp-ssh.md#comparison)」で確認してください。

## <a name="prerequisites"></a>前提条件

* Azure サブスクリプション。 Azure サブスクリプションがない場合は、<a href="https://azure.microsoft.com/free/" target="_blank">無料の Azure アカウントにサインアップ</a>してください。 

* SFTP サーバーのアドレスとアカウントの資格情報。これにより、ロジック アプリが SFTP アカウントにアクセスできます。 [Secure Shell (SSH)](https://www.ssh.com/ssh/protocol/) プロトコルを使用するには、SSH 秘密キーと SSH 秘密キーのパスワードへのアクセスも必要です。 

  > [!NOTE]
  > 
  > SFTP コネクタは、次の秘密キーの形式をサポートしています: OpenSSH、ssh.com、および PuTTY。
  > 
  > ロジック アプリを作成している場合は、必要な SFTP トリガーまたはアクションを追加した後、SFTP サーバーの接続情報を指定する必要があります。 
  > SSH 秘密キーを使おうとしている場合は、SSH 秘密キー ファイルからキーを***コピー***し、そのキーを接続の詳細に***貼り付ける***ようにしてください。***キーは手動で入力または編集しないでください***。そのようにすると、接続が失敗することがあります。 
  > 詳細については、この記事で後述する手順を参照してください。

* [ロジック アプリの作成方法](../logic-apps/quickstart-create-first-logic-app-workflow.md)に関する基本的な知識

* SFTP アカウントにアクセスするロジック アプリ。 SFTP トリガーで開始するには、[空のロジック アプリを作成](../logic-apps/quickstart-create-first-logic-app-workflow.md)します。 SFTP アクションを使用するには、**繰り返し**トリガーなど、別のトリガーでロジック アプリを開始します。

## <a name="connect-to-sftp"></a>SFTP への接続

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. [Azure portal](https://portal.azure.com) にサインインし、ロジック アプリ デザイナーでロジック アプリを開きます (まだ開いていない場合)。

1. 空のロジック アプリの場合: 検索ボックスに、フィルターとして「SFTP」と入力します。 トリガーの一覧で、目的のトリガーを選択します。 

   または

   既存のロジック アプリの場合、アクションを追加する最後のステップの下で、**[新しいステップ]** を選択します。 
   検索ボックスに、フィルターとして「sftp」と入力します。 
   アクションの一覧で、目的のアクションを選択します。

   ステップの間にアクションを追加するには、ステップ間の矢印の上にポインターを移動します。 
   表示されるプラス記号 (**+**) を選択し、**[アクションの追加]** を選択します。

1. 接続に必要な詳細を指定します。

   > [!IMPORTANT] 
   >
   > **SSH 秘密キー** プロパティに SSH 秘密キーを入力する場合は、次の追加の手順に従ってください。これは、このプロパティの完全で正しい値を確実に指定する助けになります。 
   > 無効なキーを指定すると、接続が失敗します。
   
   任意のテキスト エディターを使用できますが、次に例として、Notepad.exe を使用してキーを正しくコピーして貼り付ける方法を示す手順の例を示します。
    
   1. テキスト エディターで SSH 秘密キーのファイルを開きます。 
   これらの手順では、例としてメモ帳を使用します。

   1. メモ帳の **[編集]** メニューで、**[すべて選択]** を選択します。

   1. **[編集]** > **[コピー]** を選択します。

   1. 追加した SFTP トリガーまたはアクションで、コピーした*完全な*キーを **SSH 秘密キー** プロパティ (これは、複数行をサポートします) に貼り付けます。 
   キーは***貼り付けるようにしてください***。 ***キーを手動で入力または編集しないでください***。

1. 接続の詳細の入力を完了したら、**[作成]** を選択します。

1. 選択したトリガーまたはアクションのために必要な詳細を指定し、ロジック アプリのワークフローの構築を続けます。

## <a name="trigger-limits"></a>トリガーの制限

SFTP トリガーは、SFTP ファイル システムをポーリングし、前回のポーリング以降に変更されたファイルを探すことによって動作します。 一部のツールでは、ファイルが変更されたときにタイムスタンプを保持できます。 これらの場合は、トリガーが動作できるように、この機能を無効にする必要があります。 一般的な設定をいくつか次に示します。

| SFTP クライアント | Action | 
|-------------|--------| 
| Winscp | **[オプション]** > **[ユーザー設定]** > **[転送]** > **[編集]** > **[Preserve timestamp] (タイムスタンプを保持する)** > **[無効]** に移動する |
| FileZilla | **[転送]** > **[Preserve timestamps of transferred files] (転送されたファイルのタイムスタンプを保持する)** > **[無効]** に移動する | 
||| 

トリガーによって新しいファイルが検出されると、トリガーはその新しいファイルが完了していて、すべて書き込まれていることを確認します。 たとえば、トリガーがファイル サーバーを確認している際に、ファイルの進行状態が変化する場合があります。 部分的に書き込まれたファイルが返されることなないように、トリガーは最新の変更を含むファイルのタイムスタンプをメモしますが、すぐにそのファイルを返すことはありません。 トリガーは、もう一度サーバーをポーリングしてファイルを返します。 場合によっては、この動作によって、最大でトリガーのポーリング間隔が 2 倍となる遅延が生じる場合があります。 

ファイルの内容を要求するとき、トリガーでは 50 MB より大きいファイルは取得されません。 50 MB より大きいファイルを取得するには、次のパターンに従います。 

* **ファイルが追加または変更されたとき (プロパティのみ)** といった、ファイルのプロパティを返すトリガーを使用します。

* **パスを使用してファイルの内容を取得する**といった、完全なファイルを読み取るアクションを使用するトリガーに従い、アクションで[メッセージ チャンク](../logic-apps/logic-apps-handle-large-messages.md)を使用します。

## <a name="examples"></a>例

<a name="file-add-modified"></a>

### <a name="sftp-trigger-when-a-file-is-added-or-modified"></a>SFTP トリガー:When a file is added or modified (ファイルの追加または変更時)

このトリガーは、SFTP サーバーでファイルが追加または変更されたときにロジック アプリ ワークフローを開始します。 たとえば、ファイルの内容をチェックし、内容が指定された条件を満たすかどうかに基づいてその内容を取得する条件を追加できます。 その後、ファイルの内容を取得し、その内容を SFTP サーバーのフォルダーに格納するアクションを追加できます。 

**企業での使用例**: このトリガーを使用して、SFTP フォルダーに顧客からの注文を表す新しいファイルがあるかどうかを監視できます。 その後、さらに処理するために注文の内容を取得し、その注文を注文データベース内に格納できるように、**ファイルの内容を取得する**などの SFTP アクションを使用できます。

ファイルの内容を要求するとき、トリガーでは 50 MB より大きいファイルは取得されません。 50 MB より大きいファイルを取得するには、次のパターンに従います。 

* **ファイルが追加または変更されたとき (プロパティのみ)** といった、ファイルのプロパティを返すトリガーを使用します。

* **パスを使用してファイルの内容を取得する**といった、完全なファイルを読み取るアクションを使用するトリガーに従い、アクションで[メッセージ チャンク](../logic-apps/logic-apps-handle-large-messages.md)を使用します。

<a name="get-content"></a>

### <a name="sftp-action-get-content"></a>SFTP アクション:コンテンツを取得する

このアクションは、SFTP サーバー上のファイルの内容を取得します。 そのため、たとえば前の例のトリガーと、ファイルの内容が満たす必要がある条件を追加できます。 条件が true であれば、内容を取得するアクションを実行できます。 

ファイルの内容を要求するとき、トリガーでは 50 MB より大きいファイルは取得されません。 50 MB より大きいファイルを取得するには、次のパターンに従います。 

* **ファイルが追加または変更されたとき (プロパティのみ)** といった、ファイルのプロパティを返すトリガーを使用します。

* **パスを使用してファイルの内容を取得する**といった、完全なファイルを読み取るアクションを使用するトリガーに従い、アクションで[メッセージ チャンク](../logic-apps/logic-apps-handle-large-messages.md)を使用します。

## <a name="connector-reference"></a>コネクタのレファレンス

コネクタの OpenAPI (以前の Swagger) の説明に記載されているトリガー、アクション、および制限に関する技術的な詳細については、コネクタの[リファレンス ページ](/connectors/sftpconnector/)を参照してください。

## <a name="get-support"></a>サポートを受ける

* 質問がある場合は、[Azure Logic Apps フォーラム](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps)にアクセスしてください。
* 機能のアイデアについて投稿や投票を行うには、[Logic Apps のユーザー フィードバック サイト](https://aka.ms/logicapps-wish)にアクセスしてください。

## <a name="next-steps"></a>次の手順

* 他の[Logic Apps コネクタ](../connectors/apis-list.md)を確認します。
