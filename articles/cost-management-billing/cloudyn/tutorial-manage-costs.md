---
title: 'チュートリアル: Azure の Cloudyn を使用してコストを管理する'
description: このチュートリアルでは、コストの配賦とショーバック/チャージバック レポートを使用してコストを管理します。
author: bandersmsft
ms.author: banders
ms.date: 03/12/2020
ms.topic: tutorial
ms.service: cost-management-billing
ms.subservice: cloudyn
ms.custom: seodec18
ms.reviewer: benshy
ROBOTS: NOINDEX
ms.openlocfilehash: 52858b93c61de8ee3d6416915c1eba407622a1d3
ms.sourcegitcommit: 56cbd6d97cb52e61ceb6d3894abe1977713354d9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/20/2020
ms.locfileid: "88683557"
---
# <a name="tutorial-manage-costs-by-using-cloudyn"></a>チュートリアル:Cloudyn を使用してコストを管理する

Cloudyn では、タグに基づいてコストを配賦することによって、コストを管理したりショーバック レポートを生成したりします。 消費されたクラウド リソースには、コスト配賦プロセスでコストを割り当てます。 すべてのリソースがタグで分類されたとき、コストが完全に配賦済みとなります。 コストの配賦後、ダッシュボードおよびレポートを使ってユーザーにショーバックまたはチャージバックを行うことができます。 しかし、Cloudyn を使い始めてみると、タグ付けが済んでいないリソースや、タグ付けができないリソースが多く存在する場合があります。

たとえば、エンジニアリングにかかった経費を精算してもらいたい場合があるとします。 リソース コストに基づいて、特定の金額が必要であることをエンジニアリング チームに示せる必要があります。 "*エンジニアリング*" というタグの付いたすべての消費リソースのレポートを提示することができます。

この記事では、タグとカテゴリを同義で使用することがあります。 カテゴリは広範なコレクションであり、多くのものになる場合があります。 ビジネス ユニット、コスト センター、Web サービス、またはタグが付けられたすべてのもが含まれる可能性があります。 タグは名前と値のペアで、同じタグを複数のリソースやリソース グループに適用することでリソースを分類したり、統合した請求情報を表示および管理したりできるようにします。 以前のバージョンの Azure portal では、"*タグ名*" は "*キー*" と呼ばれていました。 タグは、単一の Azure サブスクリプションに対して作成され、単一の Azure サブスクリプションによって格納されます。 AWS でのタグは、キー/値ペアで構成されます。 Azure と AWS の両方で "*キー*" という用語が使用されてきたので、Cloudyn でもその用語を使用しています。 カテゴリ マネージャーでは、キー (タグ名) を使用してタグをマージします。

このチュートリアルでは、以下の内容を学習します。

> [!div class="checklist"]
> * カスタム タグを使用してコストを配賦する。
> * ショーバック レポートとチャージバック レポートを作成する。

Azure サブスクリプションをお持ちでない場合は、開始する前に[無料アカウント](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)を作成してください。

[!INCLUDE [cloudyn-note](../../../includes/cloudyn-note.md)]

## <a name="prerequisites"></a>前提条件

- Azure アカウントが必要です。
- Cloudyn を使用するには評価版の登録または有料サブスクリプションが必要です。
- Cloudyn ポータルで、[アクティブ化されていないアカウントをアクティブにする必要があります](activate-subs-accounts.md)。
- [ゲスト レベルの監視](azure-vm-extended-metrics.md)を、仮想マシンで有効にする必要があります。


## <a name="use-custom-tags-to-allocate-costs"></a>カスタム タグを使用してコストを配賦する

Cloudyn は、Azure からリソース グループのタグ データを取得し、リソースにタグ情報を自動的に伝達します。 コストの割り当てでは、リソース タグでコストを確認できます。

コスト配賦モデルを使用して、カテゴリ化されていない (タグなしの) リソースに内部的に適用されるカテゴリ (タグ) を定義し、コストをグループ化して、タグなしのコストを処理するルールを定義します。 コスト配賦規則は、サービスのコストが他のサービスに配布される、ユーザーの保存された指示です。 その後、作成したモデルを選択すると、"*コスト配賦*" レポートにそれらのリソースのタグ/カテゴリが表示されます。

"*コスト分析*" レポートにはこれらのリソースのタグ情報が表示されないことに注意してください。 また、コスト配賦を使用して Cloudyn で適用されたタグは Azure に送信されないので、Azure portal では表示されません。

コスト配賦を始めるにあたって最初に行うことは、コスト モデルを使用してスコープを定義することです。 コスト モデルは、コストを変更するものではなく、コストを配分するものです。 コスト モデルを作成するときは、コスト エンティティやアカウント、サブスクリプションのほか、さまざまなタグごとにデータを分けます。 たとえば一般的なタグとして、請求コード、コスト センター、グループ名が挙げられます。 さらにタグは、組織の他の部署にショーバックまたはチャージバックを実施するのにも役立ちます。

カスタム コスト配賦モデルを作成するには、レポートのメニューで **[Costs]\(コスト\)** &gt; **[Cost Management]\(コスト管理\)** &gt; **[Cost Allocation 360°]\(コスト配賦 360 度\)** の順に選択します。

![[Cost Allocation 360°]\(コスト配賦 360 度\) が選択されたダッシュボードを示す例](./media/tutorial-manage-costs/cost-allocation-360.png)

**[Cost Allocation 360°]\(コスト配賦 360 度\)** ページで **[Add]\(追加\)** を選択し、コスト モデルの名前と説明を入力します。 すべてのアカウントを選択するか、または個別のアカウントを選択します。 個別のアカウントを使用する場合は、さまざまなクラウド サービス プロバイダーから複数のアカウントを選択することができます。 次に、 **[Categorization]\(分類\)** をクリックして、検出されたタグの中からコスト データを分類するタグを選びます。 モデルに含めるタグ (カテゴリ) を選択してください。 次の例では、 **[Unit]\(部署\)** タグが選択されています。

![コスト モデルの分類を示す例](./media/tutorial-manage-costs/cost-model01.png)

この例を見ると、$19,680 が未分類 (タグなし) であることがわかります。

次に、 **[Uncategorized Resources]\(未分類のリソース\)** を選択し、未配賦のコストがあるサービスを選択します。 さらに、コストを配賦するためのルールを定義します。

たとえば、Azure のストレージ コストを複数の Azure 仮想マシン (VM) に均等に配分するとします。 そのためには、 **[Azure/Storage]** サービスを選択し、 **[Proportional to Categorized]\(分類済みの～に比例\)** を選択して、 **[Azure/VM]** を選択します。 そのうえで **[Create]\(作成\)** を選択します。

![コスト モデル配賦ルールの例 (均等配分)](./media/tutorial-manage-costs/cost-model02.png)



また別の例として、すべての Azure ネットワーク コストを組織の特定の部署に配賦する場合もあるでしょう。 その場合は、 **[Azure/Network]\(Azure/ネットワーク\)** サービスを選択し、 **[Define Allocation Rule]\(配賦ルールの定義\)** で **[Explicit Distribution]\(明示的配分\)** を選択します。 次の図では、配分比率を 100 に設定し、部署として **G&amp;A** を選択しています。

![コスト モデル配賦ルールの例 (特定の部署に配賦)](./media/tutorial-manage-costs/cost-model03.png)



未分類となっている残りのリソースすべてについて、追加の配賦ルールを作成します。

アマゾン ウェブ サービス (AWS) の予約済みインスタンスが未配賦となっている場合は、 **[Reserved Instances]\(予約済みインスタンス\)** のタグ付きカテゴリにそれらを割り当てることができます。

コストを配賦するために行った選択の内容を確認するには、 **[Summary]\(サマリー\)** を選択します。 情報を保存し、後でさらに別のルールを追加する場合は、 **[Save As Draft]\(下書きとして保存\)** を選択します。 または、情報を保存したうえで、Cloudyn でコスト配賦モデルの処理を開始する場合は、 **[Save and Activate]\(保存して有効にする\)** を選択します。

コスト モデルの一覧に、新しいコスト モデルが **[Processing]\(処理中\) ステータス**で表示されます。 Cloudyn データベースにコスト モデルが反映されるまでにしばらく時間がかかる場合があります。 処理が完了すると、ステータスが **[Completed]\(完了\)** に更新されます。 コスト分析レポートの **[Extended Filters]\(拡張フィルター\)** &gt; **[Cost Model]\(コスト モデル\)** でコスト モデルのデータを確認できます。

### <a name="category-manager"></a>カテゴリ マネージャー

カテゴリ マネージャーは、複数のカテゴリの値 (タグ) をマージして新しいカテゴリを作成するのを支援するデータクレンジング ツールです。 カテゴリを選択して既存の値をマージするためのルールを作成する、ルールベースの単純なツールとなっています。 たとえば、**R&amp;D** と **dev** という、どちらも開発グループを表すカテゴリが既に存在している場合に活用できます。

Cloudyn ポータルで、右上にある歯車アイコンをクリックして **[Category Manager]\(カテゴリ マネージャー\)** を選択します。 新しいカテゴリを作成するには、プラス記号 ( **+** ) を選択します。 カテゴリの名前を入力し、新しいカテゴリに追加するキーを **[Keys]\(キー\)** に入力します。

ルールを定義するときは、OR 条件を使って複数の値を追加できます。 基本的な文字列操作を実行することもできます。 どちらの場合も、 **[Rules]\(ルール\)** の右側にある省略記号 ( **…** ) をクリックします。

新しいルールを定義するには、 **[Rules]\(ルール\)** 領域で新しいルールを作成します。 たとえば、 **[Rules]\(ルール\)** に「**dev**」と入力し、 **[Actions]\(アクション\)** に「**R&amp;D**」と入力します。 完了したら、新しいカテゴリを保存します。

次の画像は、**Work-Load** という名前の新しいカテゴリに対して作成したルールの例を示しています。

![新しい作業負荷のカテゴリを示す例](./media/tutorial-manage-costs/category01.png)

### <a name="tag-sources-and-reports"></a>タグのソースとレポート

Cloudyn レポートに表示されるタグ データの起点は、次の 3 つの場所です。

- クラウド プロバイダーのリソース API
- クラウド プロバイダーの Billing API
- 次のソースから手動で作成されたタグ:
    - Cloudyn エンティティ タグ - Cloudyn エンティティに適用されたユーザー定義のメタデータ
    - Category Manager - 既存のタグに適用されるルールに基づいて新しいタグを作成する、データ クレンジング ツール

Cloudyn コスト レポートのクラウド プロバイダーのタグを表示するには、コスト配賦 360 度を使用してカスタムのコスト配賦モデルを作成する必要があります。 その場合は、 **[Costs]\(コスト\)**  >  **[Cost Management]\(コスト管理\)**  >  **[Cost Allocation 360]\(コスト配賦 360 度\)** の順に選択し、目的のタグを選択してから、タグなしのコストを扱う規則を定義します。 次に、新しいコスト モデルを作成します。 その後、コスト配賦分析のレポートを表示して、Azure リソース タグを表示、フィルター処理、および並べ替えできます。

Azure リソース タグは、 **[Costs]\(コスト\)**  >  **[Cost Allocation Analysis]\(コスト配賦分析\)** レポートにのみ表示されます。

クラウド プロバイダーの課金タグは、すべてのコスト レポートに表示されます。

Cloudyn エンティティ タグと手動で作成したタグは、すべてのコスト レポートに表示されます。


## <a name="create-showback-and-chargeback-reports"></a>ショーバック レポートとチャージバック レポートを作成する

ショーバックとチャージバックを実施するために組織が使う手法はさまざまです。 しかし、どちらの目的であれ、その土台として、Cloudyn ポータルに用意されているダッシュボードとレポートを利用することは可能です。 組織内のユーザーが必要に応じてダッシュボードとレポートを閲覧できるようにアクセス権を与えることができます。 コスト分析のすべてのレポートは、ユーザーにその消費リソースが開示されるという点で、ショーバックに対応しています。 また、これらを通じてユーザーは、組織内のグループに固有のコストや利用状況データを深く掘り下げることができます。

コスト配賦の結果を表示するには、コスト分析レポートを開いて、作成済みのコスト モデルを選択します。 そのうえで、コスト モデルで選択したタグによる分類基準を追加することになります。

![新しいコストのデータ例を示すコスト分析レポート](./media/tutorial-manage-costs/cost-analysis.png)

特定のグループによって消費された具体的なサービスに注目したレポートを簡単に作成して保存することができます。 たとえば、Azure VM を大量に使用する部門があるとします。 Azure VM を条件としてフィルタリングされたレポートを作成することで、消費量とコストを明らかにできます。

他のチームにスナップショット データを提出する必要がある場合は、PDF 形式または CSV 形式でレポートをエクスポートすることができます。


## <a name="next-steps"></a>次のステップ

このチュートリアルでは、以下の内容を学習しました。

> [!div class="checklist"]
> * カスタム タグを使用してコストを配賦する。
> * ショーバック レポートとチャージバック レポートを作成する。



次のチュートリアルに進み、データへのアクセスの制御について学習してください。

> [!div class="nextstepaction"]
> [データへのアクセスを制御する](tutorial-user-access.md)
