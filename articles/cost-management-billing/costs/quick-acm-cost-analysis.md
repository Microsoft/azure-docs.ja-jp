---
title: クイックスタート - コスト分析を使用して Azure のコストを調査する
description: このクイック スタートは、コスト分析を使用して Azure 組織のコストを調査および分析するために役立ちます。
author: bandersmsft
ms.author: banders
ms.date: 01/04/2021
ms.topic: quickstart
ms.service: cost-management-billing
ms.subservice: cost-management
ms.reviewer: micflan
ms.custom: contperf-fy21q2
ms.openlocfilehash: 83f2d87e3f4a03ff17526ea5706e4f87b8f39487
ms.sourcegitcommit: 6d6030de2d776f3d5fb89f68aaead148c05837e2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/05/2021
ms.locfileid: "97882451"
---
# <a name="quickstart-explore-and-analyze-costs-with-cost-analysis"></a>クイック スタート:コスト分析を使用してコストを調査および分析する

Azure コストを正しく制御して最適化するには、コストが組織内のどこで発生しているかを把握する必要があります。 また、サービスのコストがどれくらいの金額であり、どのような環境やシステムをサポートしているかを認識することも有効です。 あらゆるコストを調査することは、組織の消費パターンを正確に把握するために重要です。 消費パターンを使用して、コスト管理のメカニズム (予算など) を適用できます。

このクイック スタートでは、コスト分析を使用して組織のコストを調査および分析します。 組織ごとの集計コストを表示することで、時間の経過に伴いコストがどこで発生しているかを把握したり、消費傾向を識別したりできます。 一定期間の累積コストを表示することで、予算に対する月単位、四半期ごと、場合によっては年単位のコスト傾向を見積もることができます。 予算は、財務上の制約に対処するうえで役立ちます。 また、予算は、日単位または月単位のコストを確認して、支出の不規則性を特定するために使用します。 また、さらに分析を行うか、または外部システムで使用するために、現在のレポートのデータをダウンロードできます。

このクイックスタートでは、次の方法について説明します。

- コスト分析でコストを確認する
- コスト ビューをカスタマイズする
- コスト分析データをダウンロードする

## <a name="prerequisites"></a>前提条件

コスト分析では、さまざまな種類の Azure アカウントがサポートされています。 サポートされているアカウントの種類の完全な一覧については、「[Understand Cost Management data (Cost Management データの概要)](understand-cost-mgt-data.md)」を参照してください。 コスト データを表示するには、少なくとも Azure アカウントの読み取りアクセス許可が必要です。

Azure Cost Management データに対するアクセス権の割り当てについては、[データへのアクセス許可の割り当て](./assign-access-acm-data.md)に関するページを参照してください。

新しいサブスクリプションをご利用の場合、すぐには Cost Management 機能を使用できません。 すべての Cost Management 機能を使用できるようになるまでに、最大 48 時間かかる場合があります。

## <a name="sign-in-to-azure"></a>Azure へのサインイン

- Azure Portal ( https://portal.azure.com ) にサインインします。

## <a name="review-costs-in-cost-analysis"></a>コスト分析でコストを確認する

コスト分析でコストを確認するには、Azure portal でスコープを開き、メニューで **[コスト分析]** を選択します。 たとえば、 **[サブスクリプション]** に移動し、一覧からサブスクリプションを選択して、メニューから **[コスト分析]** を選択します。 コスト分析で別のスコープに切り替えるには、 **[スコープ]** ピルを使用します。

選択したスコープは、データの統合とコスト情報へのアクセスの制御のために、Cost Management 全体を通して使用されます。 スコープを使用する場合は、複数選択を行いません。 代わりに、他のユーザーがロールアップする、より大きなスコープを選択してから、必要な入れ子のスコープにフィルターで絞り込みます。 ユーザーによっては、複数の入れ子になったスコープをカバーする単一の親スコープにアクセスできない場合があるため、このアプローチを理解することは重要です。

コスト分析を使用する方法の詳細については、ビデオ「[Azure portal で Cost Management を使用する方法](https://www.youtube.com/watch?v=mfxysF-kTFA)」をご覧ください。 他の動画を視聴するには、[Cost Management の YouTube チャンネル](https://www.youtube.com/c/AzureCostManagement)にアクセスしてください。

>[!VIDEO https://www.youtube.com/embed/mfxysF-kTFA]

初期のコスト分析ビューには、次の領域が含まれています。

**累積コスト ビュー**: 定義済みのコスト分析ビューの構成が表されます。 各ビューには、日付範囲、細分性、グループ化、フィルターの設定が含まれます。 既定のビューでは現在の請求期間に対する累積コストが示されますが、他の組み込みビューに変更できます。

**実際のコスト**: 当月の合計使用量と購入コストが表示されます。この値が計上されて請求書で示されます。

**予測**: 選択した期間に対する合計予想コストが表示されます。

**予算**: 選択したスコープの計画的な使用制限が示されます (使用可能な場合)。

**細分性の累積**: 請求期間の開始から始めて、日単位のコストの総集計が示されます。 請求先アカウントまたはサブスクリプションのための予算を作成した後、予算に対する消費傾向をすばやく確認できます。 日付の上にカーソルを置くと、その日までの累積コストが表示されます。

**ピボット (ドーナツ) グラフ**: 総コストを一般的な標準プロパティのセット別に分割する動的ピボットが提供されます。 当月のコストが、大きいものから小さいものの順に表示されます。 これらのピボット グラフは、別のピボットを選択することによっていつでも変更できます。 コストは、既定では、サービス (測定カテゴリ)、場所 (リージョン)、および子スコープによって分類されます。 たとえば、登録アカウントは請求先アカウントの下、リソース グループはサブスクリプションの下、リソースはリソース グループの下です。

![Azure portal でのコスト分析の初期表示](./media/quick-acm-cost-analysis/cost-analysis-01.png)

### <a name="understand-forecast"></a>予測について

コスト予測では、選択した期間における推定コストの予測が表示されます。 このモデルは、時系列回帰モデルに基づいています。 コストを正確に予測するために、少なくとも 10 日間のコストと使用状況の最新データが必要です。 指定の期間に対して、予測モデルでは、予測期間のトレーニング データの同等の部分が必要です。 たとえば、3 か月の予測には、少なくとも 3 か月間のコストと使用状況の最新データが必要です。

このモデルでは、最大 6 か月間のトレーニング データを使用して、1 年間のコストを予測します。 予測が変更されるには、少なくとも 7 日間のトレーニング データが必要です。 予測は、コストや使用パターンにおける急増や急減など、大幅な変化に基づいています。 予測では、 **[Group by]\(グループ化\)** プロパティ内の項目ごとに個々の予測が生成されることはありません。 合計の累積コストの予測のみが提供されます。 複数の通貨を使用する場合、モデルではコストの予測が米国ドルでのみ提供されます。

モデルはデータの急減および急増に依存するため、予約インスタンスのような大規模の購入は予測を人為的に膨らませる原因となります。 予測期間と購入規模は、予測が影響を受ける期間に影響を与えます。 支出が安定すると、予測は通常に戻ります。

## <a name="customize-cost-views"></a>コスト ビューをカスタマイズする

コスト分析には、最も一般的な目標に合わせて最適化された 4 つの組み込みビューがあります。

表示 | 答える質問の例
--- | ---
累積コスト | 今月のこれまでの出費はどれくらいですか。 予算内に収まるでしょうか。
1 日あたりのコスト | 過去 30 日間の 1 日あたりのコストに増加はみられましたか。
サービスごとのコスト | 過去 3 回分の請求書で月間使用量はどのように推移しましたか。
リソースごとのコスト | 今月はこれまで、どのリソースに最もコストがかかっていますか。
請求書の詳細 | 前回の請求書にはどのような料金がありましたか。

![今月の例の選択を示すビュー セレクター](./media/quick-acm-cost-analysis/view-selector.png)

ただし、より深い分析が必要な多くのケースが存在します。 カスタマイズは、ページの一番上の日付の選択から始まります。

コスト分析では、既定では当月のデータが示されます。 一般的な日付範囲にすばやく切り替えるには、日付セレクターを使用します。 例としては、過去 7 日間、先月、今年、またはカスタムの日付範囲があります。 従量課金制サブスクリプションには、現在の請求期間や最後の請求書のように、カレンダーの月に制約されない請求期間に基づいた日付範囲も含まれます。 メニューの上部にある **<前へ** および **次へ>** リンクを使用して、それぞれ前の期間または次の期間にジャンプします。 たとえば、 **[< 前へ]** を使用すると、**最後の 7 日間** から、**8 から 14 日前**、**15 から 21 日前** というように、順番に切り替わります。 カスタムの期間を選択するときは、選択できる最大期間は 1 年間 (たとえば、1 月 1 日から 12 月 31 日) であることに注意してください。

![今月の例の選択を示す日付セレクター](./media/quick-acm-cost-analysis/date-selector.png)

コスト分析では、既定では **累積** コストも示されます。 累積コストには前の数日に加えて、各日のすべてのコストが含まれており、日単位の集計コストの絶えず増加するビューが表示されます。 このビューは、選択された時間範囲の間、予算に対してどのような傾向があるかを示すように最適化されています。

予算オーバーの可能性を明らかにするには、予測グラフ ビューを使用します。 予算オーバーの可能性がある場合は、予想される支出超過が赤で示されます。 グラフにもインジケーター シンボルが表示されます。 シンボルをポイントすると、予算をオーバーする推定日が表示されます。

![予算オーバーの可能性の表示例](./media/quick-acm-cost-analysis/budget-breach.png)

毎日のコストを示す **日単位** のビューもあります。 日単位のビューには、増加の傾向は示されません。 このビューは、不規則性をコストの急上昇または日ごとの低下として示すように設計されています。 予算を選択した場合、日単位のビューにも日単位の予算の見積もりが表示されます。

日単位のコストが、常に見積もられた日単位の予算を上回っている場合は、月単位の予算を超えることを予測できます。 見積もられた日単位の予算は、低いレベルで予算を視覚化するために役立つ手段です。 日単位のコストに変動があるときは、見積もられた日単位の予算と月単位の予算の比較の正確性が低くなります。

支出の予測を有効にした場合の最近の支出の日単位表示を次に示します。
![今月の日単位のコストの例を示す日単位のビュー](./media/quick-acm-cost-analysis/daily-view.png)

支出予測を無効にすると、将来の日付の予想支出は表示されません。 また、過去の期間のコストを調べるときは、コスト予測は表示されません。

一般に、8 から 12 時間以内の消費リソースのデータまたは通知を見ることができます。

共通のプロパティで **グループ化** してコストを明細化し、最も寄与した要因を識別します。 たとえば、リソース タグでグループ化するには、グループ化の基準とするタグ キーを選択します。 タグの値ごとのコスト明細が表示され、そのタグが適用されていないリソースについては別途セグメントが表示されます。

ほとんどの Azure リソースでは、タグ付けがサポートされています。 ただし、一部のタグは Cost Management および請求で使用できません。 また、リソース グループのタグはサポートされていません。 タグのサポートは、タグがリソースに適用された "*後*" にレポートされた使用状況に適用されます。 タグは、過去のコスト データには適用されません。

Azure タグ ポリシーを使用してコスト データの可視性を向上させる方法については、[Azure Cost Management でタグ ポリシーを確認する方法](https://www.youtube.com/watch?v=nHQYcYGKuyw)に関するビデオをご覧ください。

今月の Azure サービス コストの表示を次に示します。

![先月の Azure サービス コストの例を示す、グループ化された日単位の累積ビュー](./media/quick-acm-cost-analysis/grouped-daily-accum-view.png)

既定では、コスト分析には発生して請求書に記載予定のすべての使用および購入のコストが表示されます (**実際のコスト** とも呼ばれます)。 実際コストを表示することは、請求書を調整するために最適です。 ただし、支出の異常やその他のコスト変化を監視している場合、購入コストの急増は警告を示す可能性があります。 予約購入コストが原因の急増を平坦化するには、**償却コスト** に切り替えます。

![期間全体に予約購入を分散させ、予約を使用したリソースに割り当てるには、実際コストと償却コストを切り替えます](./media/quick-acm-cost-analysis/metric-picker.png)

償却コストでは、予約購入が日単位に分割されて、予約期間全体に分配されます。 たとえば、1 月 1 日に 365 ドルで購入したのではなく、1 月 1 日から 12 月 31 日までの毎日 1.00 ドルずつ購入したように表示されます。 基本の償却に加えて、これらのコストは予約を使用した特定のリソースに再割り当てされて関連付けられます。 たとえば、その 1 日あたり 1.00 ドルの料金が 2 つの仮想マシン間で分割された場合、その日には 2 つの 0.50 ドルの料金が表示されます。 予約の一部がその日に利用されていない場合、該当する仮想マシンに関連付けられた 0.50 ドルの料金が 1 つ表示され、もう 1 つの 0.50 ドルの料金には料金種類 `UnusedReservation` が表示されます。 未使用予約コストは償却コストを表示するときにだけ表示できます。

コスト表示方法の変更のため、実際コストおよび償却コストの表示では表示される合計の値が異なることに注意することが重要です。 一般に、予約購入の月の合計コストは償却コストを表示すると減少し、予約購入の後の月は増加します。 償却は予約購入でのみ使用でき、この時点では Azure Marketplace 購入には適用されません。

次の図では、リソース グループ名が示されています。 タグでグループ化してタグ別に合計コストを表示したり、 **[リソースごとのコスト]** ビューを使って特定のリソースのすべてのタグを表示したりできます。

![リソース グループの名前を示す現在のビューの完全なデータ](./media/quick-acm-cost-analysis/full-data-set.png)

特定の属性によってコストをグループ化すると、上位 10 個のコスト要因が高いものから順に表示されます。 10 個を超える場合、上位 9 個のコスト要因と、 **[その他]** グループが表示されます。このグループは、残りのすべてのグループをまとめて表しています。 タグでグループ化すると、タグ キーが適用されていないコストについて **[タグなし]** グループが表示されます。 タグなしのコストがタグ付きのコストより高い場合でも、 **[タグなし]** は常に最後になります。 タグの値が 10 個以上ある場合、タグなしのコストは、 **[その他]** に含められます。 テーブル ビューに切り替え、細分性を **[なし]** に変更して、すべての値が最高コストから最低コストまで順位付けされていることを確認します。

クラシックの仮想マシン、ネットワーク、およびストレージ リソースでは、詳細な課金データは共有されません。 それらは、コストをグループ化する場合、**クラシック サービス** としてマージされます。

メイン グラフの下のピボット グラフには、選択された期間やフィルターに対応するコストの全体像が把握しやすいよう各種のグループが表示されます。 プロパティまたはタグを選択すると、あらゆるディメンションに基づく集計コストが表示されます。

![ピボット グラフを示す例](./media/quick-acm-cost-analysis/pivot-charts.png)

任意のビューの完全なデータ セットを表示することができます。 適用したすべての選択またはフィルターが、表示されるデータに影響します。 完全なデータセットを表示するには、**グラフの種類** の一覧を選択して、 **[テーブル]** ビューを選択します。

![テーブル ビューでの現在のビューのデータ](./media/quick-acm-cost-analysis/chart-type-table-view.png)

## <a name="saving-and-sharing-customized-views"></a>カスタマイズされたビューの保存と共有

コスト分析を Azure portal のダッシュボードにピン留めするか、またはコスト分析へのリンクをコピーすることで、カスタマイズされたビューを保存して他のユーザーと共有します。

ポータルを使用してコストに関する知識を組織で共有する方法の詳細については、ビデオ「[Azure Cost Management のビューを共有、保存する](https://www.youtube.com/watch?v=kQkXXj-SmvQ)」をご覧ください。 他の動画を視聴するには、[Cost Management の YouTube チャンネル](https://www.youtube.com/c/AzureCostManagement)にアクセスしてください。

>[!VIDEO https://www.youtube.com/embed/kQkXXj-SmvQ]

コスト分析をピン留めするには、右上隅または "<Subscription Name> | コスト分析" のすぐ後ろにあるピン アイコンを選択します。 コスト分析をピン留めすると、メイン グラフまたはテーブル ビューだけが保存されます。 他のユーザーがタイルにアクセスできるようにするには、ダッシュボードを共有します。 共有ではダッシュボードの構成だけが共有され、基になるデータへのアクセス権は他のユーザーに付与されません。 コストへのアクセス権がないのに、共有ダッシュボードにアクセスすると、"アクセス拒否" メッセージが表示されます。

コスト分析へのリンクを共有するには、ウィンドウの上部にある **[共有]** を選択します。 カスタム URL が表示され、この特定のスコープに対するこの特定のビューが開かれます。 コストへのアクセス権がない場合にこの URL を受け取ると、"アクセス拒否" メッセージが表示されます。

## <a name="download-usage-data"></a>使用状況データのダウンロード

### <a name="portal"></a>[ポータル](#tab/azure-portal)

詳細な分析、独自のデータとの結合、独自のシステムへの統合などのために、データをダウンロードすることが必要になる場合があります。 Cost Management では、いくつかのオプションが提供されています。 まず、コスト分析で得られるような簡単な概要が必要な場合は、必要とするビューを作成します。 次に、 **[エクスポート]** を選択し、 **[データを CSV にダウンロード]** または **[データを Excel にダウンロード]** を選択してダウンロードします。 Excel のダウンロードでは、スコープ、クエリ構成、合計、生成日など、ダウンロードの生成に使用したビューに関するより多くのコンテキストが提供されます。

完全な未集計のデータセットが必要な場合は、課金アカウントからダウンロードします。 次に、ポータルの左側のナビゲーション ウィンドウにあるサービスの一覧から、 **[コストの管理と請求]** に移動します。 該当する場合は、課金アカウントを選択します。 **[使用量 + 請求金額]** に移動し、請求期間の **[ダウンロード]** アイコンを選択します。

### <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

まず、Azure CLI の環境を準備します。

[!INCLUDE [azure-cli-prepare-your-environment-no-header.md](../../../includes/azure-cli-prepare-your-environment-no-header.md)]

サブスクリプションの月度累計使用量情報を照会するには、サインイン後、[az costmanagement query](/cli/azure/ext/costmanagement/costmanagement#ext_costmanagement_az_costmanagement_query) コマンドを使用します。

```azurecli
az costmanagement query --timeframe MonthToDate --type Usage \
   --scope "subscriptions/00000000-0000-0000-0000-000000000000"
```

**--dataset-filter** などのパラメーターを使用してクエリを絞り込むこともできます。

```azurecli
az costmanagement query --timeframe MonthToDate --type Usage \
   --scope "subscriptions/00000000-0000-0000-0000-000000000000" \
   --dataset-filter "{\"and\":[{\"or\":[{\"dimension\":{\"name\":\"ResourceLocation\",\"operator\":\"In\",\"values\":[\"East US\",\"West Europe\"]}},{\"tag\":{\"name\":\"Environment\",\"operator\":\"In\",\"values\":[\"UAT\",\"Prod\"]}}]},{\"dimension\":{\"name\":\"ResourceGroup\",\"operator\":\"In\",\"values\":[\"API\"]}}]}"
```

**--dataset-filter** パラメーターには、JSON 文字列または `@json-file` を指定します。

[az costmanagement export](/cli/azure/ext/costmanagement/costmanagement/export) コマンドを使用して、利用状況データを Azure ストレージ アカウントにエクスポートすることもできます。 そこからデータをダウンロードすることができます。

1. リソース グループを作成するか、または既存のリソース グループを使用します。 リソース グループを作成するには、[az group create](/cli/azure/group#az_group_create) コマンドを実行します。

   ```azurecli
   az group create --name TreyNetwork --location "East US"
   ```

1. エクスポートを受信するためのストレージ アカウントを作成するか、既存のストレージ アカウントを使用します。 アカウントを作成するには、[az storage account create](/cli/azure/storage/account#az_storage_account_create) コマンドを使用します。

   ```azurecli
   az storage account create --resource-group TreyNetwork --name cmdemo
   ```

1. [az costmanagement export create](/cli/azure/ext/costmanagement/costmanagement/export#ext_costmanagement_az_costmanagement_export_create) コマンドを実行して、エクスポートを作成します。

   ```azurecli
   az costmanagement export create --name DemoExport --type Usage \
   --scope "subscriptions/00000000-0000-0000-0000-000000000000" --storage-account-id cmdemo \
   --storage-container democontainer --timeframe MonthToDate --storage-directory demodirectory
   ```

---

## <a name="clean-up-resources"></a>リソースのクリーンアップ

- ピン留めしたコスト分析用にカスタマイズされたビューが不要になった場合は、それがピン留めされているダッシュボードに移動し、ピン留めされたビューを削除します。
- ダウンロードした使用状況データ ファイルが不要になった場合は、必ず削除してください。

## <a name="next-steps"></a>次のステップ

最初のチュートリアルに進み、予算の作成と管理の方法を学習してください。

> [!div class="nextstepaction"]
> [予算を作成して管理する](tutorial-acm-create-budgets.md)